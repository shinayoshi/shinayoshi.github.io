
<!DOCTYPE html>
<html class="no-js" lang="ja">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="generator" content="Hugo 0.15" />

    <base href="http://www.shinayoshi.net/" />
    <title>shinayoshi&#39;s note</title>
    <link rel="canonical" href="http://www.shinayoshi.net/" />
    <link href="http://www.shinayoshi.net//img/favicon.ico" type="image/vnd.microsoft.icon" rel="icon" />
    <link href="http://www.shinayoshi.net/index.xml" rel="alternate" title="shinayoshi&#39;s note" type="application/rss+xml" />

    
    <link href="http://www.shinayoshi.net//css/bootstrap.min.css" rel="stylesheet">

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://yandex.st/highlightjs/8.0/styles/default.min.css">

    
    
    
  </head>
  <body>
    <div id="wrap">


      <header role="banner">
        <nav class="navbar navbar-default" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" title="toggle navbar" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="http://www.shinayoshi.net//">shinayoshi&#39;s note</a>
            </div>
            <div class="navbar-collapse collapse">
              <ul class="nav navbar-nav">
                <li><a href="http://www.shinayoshi.net//">Home</a></li>
                <li><a href="http://www.shinayoshi.net//post/">All posts</a></li>
              </ul>
              <ul class="nav navbar-nav navbar-right">
                
                <li>
                  <form class="search navbar-form navbar-right" role="search" action="https://www.google.com/search" method="GET">
                    <input type="hidden" name="sitesearch" value="www.shinayoshi.net" />
                    <div class="form-group">
                      <input type="text" class="form-control" placeholder="Search" name="q" />
                    </div>
                  </form>
                </li>
                
                <li>
                  <a class="subscribe-rss" href="http://www.shinayoshi.net/index.xml" title="subscribe via RSS">
                    <i class="fa fa-rss fa-lg"></i>
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </nav>
      </header>


      <div id="main" role="main" class="container">
        <div id="content">
          <div class="row">
            <div class="page-content col-md-9">
              
              <article>
                <div class="title">
                  <h1><a href="http://www.shinayoshi.net/post/2017/01/15/backup-raspberrypi/">家庭内インターネット接続環境を構築する その17</a></h1>
                  <p>
                    <span class="label label-primary">Sun Jan 15, 2017</span> in
                    
                    
                    <a href="http://www.shinayoshi.net//categories/server">server</a>
                     using tags
                    
                    
                    <a href="http://www.shinayoshi.net//tags/raspberrypi">raspberrypi</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/home-network">home-network</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homenas1">homenas1</a>
                    
                  </p>
                </div>
                <div class="contents">
                  <p>FortiGate 60DとRaspberry Piを使用して家庭内インターネット接続環境を構築します。
最終的には以下のような構成を想定しています。</p>

<p><img src="/img/20161022_01/home-network.png" alt="home network" width="640px" /></p>

<p>今回は<code>homenas1</code>のバックアップを行います。</p>

<p>##</p>

<p>gitのインストール</p>

<pre><code>$ sudo -E apt-get install git
パッケージリストを読み込んでいます... 完了
依存関係ツリーを作成しています                
状態情報を読み取っています... 完了
以下の追加パッケージがインストールされます:
  git-man liberror-perl
提案パッケージ:
  gettext-base git-daemon-run git-daemon-sysvinit git-doc git-el git-email
  git-gui gitk gitweb git-arch git-cvs git-mediawiki git-svn
以下のパッケージが新たにインストールされます:
  git git-man liberror-perl
アップグレード: 0 個、新規インストール: 3 個、削除: 0 個、保留: 1 個。
4,015 kB のアーカイブを取得する必要があります。
この操作後に追加で 20.4 MB のディスク容量が消費されます。
続行しますか? [Y/n] y
取得:1 http://mirrordirector.raspbian.org/raspbian/ jessie/main liberror-perl all 0.17-1.1 [22.4 kB]
取得:2 http://mirrordirector.raspbian.org/raspbian/ jessie/main git-man all 1:2.1.4-2.1+deb8u2 [1,267 kB]
取得:3 http://mirrordirector.raspbian.org/raspbian/ jessie/main git armhf 1:2.1.4-2.1+deb8u2 [2,725 kB]
4,015 kB を 6秒 で取得しました (630 kB/s)                                      
以前に未選択のパッケージ liberror-perl を選択しています。
(データベースを読み込んでいます ... 現在 33218 個のファイルとディレクトリがインストールされています。)
.../liberror-perl_0.17-1.1_all.deb を展開する準備をしています ...
liberror-perl (0.17-1.1) を展開しています...
以前に未選択のパッケージ git-man を選択しています。
.../git-man_1%3a2.1.4-2.1+deb8u2_all.deb を展開する準備をしています ...
git-man (1:2.1.4-2.1+deb8u2) を展開しています...
以前に未選択のパッケージ git を選択しています。
.../git_1%3a2.1.4-2.1+deb8u2_armhf.deb を展開する準備をしています ...
git (1:2.1.4-2.1+deb8u2) を展開しています...
man-db (2.7.0.2-5) のトリガを処理しています ...
liberror-perl (0.17-1.1) を設定しています ...
git-man (1:2.1.4-2.1+deb8u2) を設定しています ...
git (1:2.1.4-2.1+deb8u2) を設定しています ...
$
</code></pre>

<p>rpi-cloneのインストール</p>

<pre><code>$ git clone https://github.com/billw2/rpi-clone.git
Cloning into 'rpi-clone'...
remote: Counting objects: 58, done.
remote: Total 58 (delta 0), reused 0 (delta 0), pack-reused 58
Unpacking objects: 100% (58/58), done.
Checking connectivity... done.
$
$ ls -l rpi-clone/
合計 20
-rw-r--r-- 1 pi pi  4026  1月 15 00:57 README.md
-rwxr-xr-x 1 pi pi 13933  1月 15 00:57 rpi-clone
$
$ sudo cp -p rpi-clone/rpi-clone /usr/local/sbin/
</code></pre>

<p>rpi-cloneでのバックアップ</p>

<p>今回、バックアップ先のmicroSDカードのデバイスは<code>sdd</code>でしたので、<code>rpi-clone</code>コマンドの引数には<code>sdd</code>を指定しています。32GBのmicroSDカードのバックアップには5分程度かかりました。</p>

<pre><code>$ sudo rpi-clone sdd -f

Forcing a partition initialization of destination disk sdd
The existing destination disk 'sdd' partitions are:
Disk /dev/sdd: 31725MB
Partition Table: msdos

Number  Start   End      Size     Type     File system  Flags
 1      4.19MB  70.3MB   66.1MB   primary  fat16        lba
 2      70.3MB  31725MB  31654MB  primary  ext4

*** All data on destination disk sdd will be overwritten! ***

Do you want to initialize the destination disk /dev/sdd? (yes/no): yes

Imaging the partition structure, copying 78 megabytes...
78+0 レコード入力
78+0 レコード出力
81788928 バイト (82 MB) コピーされました、 25.7102 秒、 3.2 MB/秒
Running fsck on /dev/sdd1...
Sizing partition 2 (root partition) to use all SD card space...
mke2fs 1.42.12 (29-Aug-2014)
/dev/sdd2 contains a ext4 file system
	last mounted on / on Sun Jan  1 18:13:44 2017
Creating filesystem with 7728128 4k blocks and 1933312 inodes
Filesystem UUID: bffb6652-49b7-45ce-a9c6-46e745372a7c
Superblock backups stored on blocks: 
	32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 
	4096000

Allocating group tables: done                            
Writing inode tables: done                            
Creating journal (32768 blocks): done
Writing superblocks and filesystem accounting information:        
done


/dev/sdd is initialized and resized.  Its partitions are:
Disk /dev/sdd: 31725MB
Partition Table: msdos

Number  Start   End      Size     Type     File system  Flags
 1      4.19MB  70.3MB   66.1MB   primary  fat16        lba
 2      70.3MB  31725MB  31654MB  primary  ext4


Your booted /dev/mmcblk0p2 rootfs existing label: 
You may enter a label for the destination rootfs /dev/sdd2: 
======== Clone Summary ========
Clone mode               :  rsync all files to sdd root file system
Clone destination disk   :  sdd
Clone destination rootfs :  /dev/sdd2 (no label) on /mnt/clone
Clone destination bootfs :  /dev/sdd1 on /mnt/clone/boot
Verbose mode             :  off
===============================
Final check, is it Ok to proceed with the clone (yes/no)?: yes
=&gt; Mounting /dev/sdd2 (no label) on /mnt/clone
=&gt; Mounting /dev/sdd1 on /mnt/clone/boot
===============================
Starting the filesystem rsync to sdd
(This may take several minutes)...
*** Done with clone to /dev/sdd ***
    Started: 01:07:27    Finished: 01:10:05

Hit Enter when ready to unmount the /dev/sdd partitions...
unmounting /mnt/clone/boot
unmounting /mnt/clone
===============================
$
</code></pre>

<p>バックアップmicroSDカードからのリストア</p>

<p>バックアップmicroSDカードをRaspberry Piにセットして起動するだけです。特にリストアという作業は必要ありません。</p>

<p>以上</p>

                </div>
              </article>
              
              <article>
                <div class="title">
                  <h1><a href="http://www.shinayoshi.net/post/2017/01/12/setting-rsnapshot/">家庭内インターネット接続環境を構築する その16</a></h1>
                  <p>
                    <span class="label label-primary">Thu Jan 12, 2017</span> in
                    
                    
                    <a href="http://www.shinayoshi.net//categories/server">server</a>
                     using tags
                    
                    
                    <a href="http://www.shinayoshi.net//tags/raspberrypi">raspberrypi</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/home-network">home-network</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homenas1">homenas1</a>
                    
                  </p>
                </div>
                <div class="contents">
                  

<p>FortiGate 60DとRaspberry Piを使用して家庭内インターネット接続環境を構築します。
最終的には以下のような構成を想定しています。</p>

<p><img src="/img/20161022_01/home-network.png" alt="home network" width="640px" /></p>

<p>今回は<code>homenas1</code>にrsnapshotを導入してファイルバックアップを行う設定を行います。</p>

<p>なおバックアップ元は<code>/mnt/nas/</code>、バックアップ先は<code>/mnt/backup/</code>を想定しています。</p>

<pre><code>$ df -h
/dev/sdc1        917G   72M  871G    1% /mnt/backup
/dev/md0         394G   71M  374G    1% /mnt/nas
$
</code></pre>

<h2 id="rsnapshotのインストール:3d6ec9515f60bc1021728b9e428098dd">rsnapshotのインストール</h2>

<pre><code>$ sudo -E apt-get install rsnapshot
パッケージリストを読み込んでいます... 完了
依存関係ツリーを作成しています                
状態情報を読み取っています... 完了
以下の追加パッケージがインストールされます:
  liblchown-perl rsync
以下のパッケージが新たにインストールされます:
  liblchown-perl rsnapshot rsync
アップグレード: 0 個、新規インストール: 3 個、削除: 0 個、保留: 1 個。
507 kB のアーカイブを取得する必要があります。
この操作後に追加で 1,133 kB のディスク容量が消費されます。
続行しますか? [Y/n] y
取得:1 http://mirrordirector.raspbian.org/raspbian/ jessie/main liblchown-perl armhf 1.01-2+b1 [8,828 B]
取得:2 http://mirrordirector.raspbian.org/raspbian/ jessie/main rsync armhf 3.1.1-3 [373 kB]
取得:3 http://mirrordirector.raspbian.org/raspbian/ jessie/main rsnapshot all 1.3.1-4+deb8u1 [125 kB]
507 kB を 1秒 で取得しました (286 kB/s)
以前に未選択のパッケージ liblchown-perl を選択しています。
(データベースを読み込んでいます ... 現在 33129 個のファイルとディレクトリがインストールされています。)
.../liblchown-perl_1.01-2+b1_armhf.deb を展開する準備をしています ...
liblchown-perl (1.01-2+b1) を展開しています...
以前に未選択のパッケージ rsync を選択しています。
.../rsync_3.1.1-3_armhf.deb を展開する準備をしています ...
rsync (3.1.1-3) を展開しています...
以前に未選択のパッケージ rsnapshot を選択しています。
.../rsnapshot_1.3.1-4+deb8u1_all.deb を展開する準備をしています ...
rsnapshot (1.3.1-4+deb8u1) を展開しています...
man-db (2.7.0.2-5) のトリガを処理しています ...
systemd (215-17+deb8u5) のトリガを処理しています ...
liblchown-perl (1.01-2+b1) を設定しています ...
rsync (3.1.1-3) を設定しています ...
rsnapshot (1.3.1-4+deb8u1) を設定しています ...
systemd (215-17+deb8u5) のトリガを処理しています ...
$
</code></pre>

<h2 id="rsnapshotの設定:3d6ec9515f60bc1021728b9e428098dd">rsnapshotの設定</h2>

<p>rsnapshot.confの設定変更</p>

<pre><code>$ sudo cp -p /etc/rsnapshot.conf{,.org}
$ ls -l /etc/rsnapshot.conf*
-rw-r--r-- 1 root root 8414  3月 10  2016 /etc/rsnapshot.conf
-rw-r--r-- 1 root root 8414  3月 10  2016 /etc/rsnapshot.conf.org
$
$ sudo vi /etc/rsnapshot
#snapshot_root  /var/cache/rsnapshot/
snapshot_root   /mnt/backup/

#retain         hourly  6
retain          daily   7
retain          weekly  4
retain  monthly 3

#backup /home/          localhost/
#backup /etc/           localhost/
#backup /usr/local/     localhost/
backup	/mnt/nas/	localhost/
$
$ diff /etc/rsnapshot.conf.org /etc/rsnapshot.conf
27c27,28
&lt; snapshot_root	/var/cache/rsnapshot/
---
&gt; #snapshot_root	/var/cache/rsnapshot/
&gt; snapshot_root	/mnt/backup/
97c98
&lt; retain		hourly	6
---
&gt; #retain		hourly	6
100c101
&lt; #retain	monthly	3
---
&gt; retain	monthly	3
230,232c231,233
&lt; backup	/home/		localhost/
&lt; backup	/etc/		localhost/
&lt; backup	/usr/local/	localhost/
---
&gt; #backup	/home/		localhost/
&gt; #backup	/etc/		localhost/
&gt; #backup	/usr/local/	localhost/
239a241
&gt; backup	/mnt/nas/	localhost/
$
</code></pre>

<p>rsnapshot.confのコンフィグテスト</p>

<pre><code>$ sudo rsnapshot configtest
Syntax OK
$
</code></pre>

<p>crontabの設定変更</p>

<pre><code>$ sudo crontab -l &gt; crontab.backup20170112
no crontab for root
$
$ sudo crontab -e
50 2 * * * /usr/bin/rsnapshot daily
40 2 * * 1 /usr/bin/rsnapshot weekly
30 2 1 * * /usr/bin/rsnapshot monthly
$
$ sudo crontab -l &gt; crontab.backup20170112-01
$ diff crontab.backup20170112 crontab.backup20170112-01
&gt; 50 2 * * * /usr/bin/rsnapshot daily
&gt; 40 2 * * 1 /usr/bin/rsnapshot weekly
&gt; 30 2 1 * * /usr/bin/rsnapshot monthly
$
</code></pre>

<h2 id="restoreについて:3d6ec9515f60bc1021728b9e428098dd">Restoreについて</h2>

<pre><code>$ rsync -a /mnt/backup/localhost/monthly.0/localhost/. /mnt/nas/
$ rsync -a /mnt/backup/localhost/weekly.0/localhost/. /mnt/nas/
$ rsync -a /mnt/backup/localhost/daily.0/localhost/. /mnt/nas/
</code></pre>

<h2 id="参考:3d6ec9515f60bc1021728b9e428098dd">参考</h2>

<ul>
<li><a href="http://rsnapshot.org/">rsnapshot | rsnapshot</a></li>
<li><a href="https://workaround.org/rsnapshot-and-usb-drives/">Backups with rsnaphot to external USB drives</a></li>
<li><a href="https://wiki.gentoo.org/wiki/A_simple_backup_scheme_using_rsnapshot">A simple backup scheme using rsnapshot - Gentoo Wiki</a></li>
</ul>

<p>以上</p>

                </div>
              </article>
              
              <article>
                <div class="title">
                  <h1><a href="http://www.shinayoshi.net/post/2017/01/09/setting-snmpd/">家庭内インターネット接続環境を構築する その15</a></h1>
                  <p>
                    <span class="label label-primary">Mon Jan 9, 2017</span> in
                    
                    
                    <a href="http://www.shinayoshi.net//categories/server">server</a>
                     using tags
                    
                    
                    <a href="http://www.shinayoshi.net//tags/raspberrypi">raspberrypi</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/home-network">home-network</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homenas1">homenas1</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homemon1">homemon1</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homemon2">homemon2</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homepxy1">homepxy1</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homepot1">homepot1</a>
                    
                  </p>
                </div>
                <div class="contents">
                  

<p>FortiGate 60DとRaspberry Piを使用して家庭内インターネット接続環境を構築します。
最終的には以下のような構成を想定しています。</p>

<p><img src="/img/20161022_01/home-network.png" alt="home network" width="640px" /></p>

<p>前回はCactiを導入しました。
今回はCactiに<code>homenas1</code>、<code>homemon1</code>、<code>homemon2</code>、<code>homepxy1</code>、<code>homepot1</code>を登録していきます。SNMPv3を使用してSNMPの値を取得します。</p>

<h2 id="snmpdのインストール:f59bc3c40d42508a4e65c03888e7814a">snmpdのインストール</h2>

<p>追加するデバイス(Server)にsnmpdをインストールする。</p>

<pre><code>$ sudo -E apt-get install snmpd snmp
パッケージリストを読み込んでいます... 完了
依存関係ツリーを作成しています                
状態情報を読み取っています... 完了
以下の追加パッケージがインストールされます:
  libperl5.20 libsensors4 libsnmp-base libsnmp30
提案パッケージ:
  lm-sensors snmp-mibs-downloader snmptrapd
以下のパッケージが新たにインストールされます:
  libperl5.20 libsensors4 libsnmp-base libsnmp30 snmp snmpd
アップグレード: 0 個、新規インストール: 6 個、削除: 0 個、保留: 1 個。
3,836 kB のアーカイブを取得する必要があります。
この操作後に追加で 7,088 kB のディスク容量が消費されます。
続行しますか? [Y/n] y
取得:1 http://mirrordirector.raspbian.org/raspbian/ jessie/main libperl5.20 armhf 5.20.2-3+deb8u6 [1,354 B]
取得:2 http://mirrordirector.raspbian.org/raspbian/ jessie/main libsensors4 armhf 1:3.3.5-2 [48.9 kB]
取得:3 http://mirrordirector.raspbian.org/raspbian/ jessie/main libsnmp-base all 5.7.2.1+dfsg-1 [1,544 kB]
取得:4 http://mirrordirector.raspbian.org/raspbian/ jessie/main libsnmp30 armhf 5.7.2.1+dfsg-1 [2,040 kB]
取得:5 http://mirrordirector.raspbian.org/raspbian/ jessie/main snmp armhf 5.7.2.1+dfsg-1 [145 kB]
取得:6 http://mirrordirector.raspbian.org/raspbian/ jessie/main snmpd armhf 5.7.2.1+dfsg-1 [56.8 kB]
3,836 kB を 2秒 で取得しました (1,283 kB/s)
パッケージを事前設定しています ...
以前に未選択のパッケージ libsensors4:armhf を選択しています。
(データベースを読み込んでいます ... 現在 32914 個のファイルとディレクトリがインストールされています。)
.../libsensors4_1%3a3.3.5-2_armhf.deb を展開する準備をしています ...
libsensors4:armhf (1:3.3.5-2) を展開しています...
以前に未選択のパッケージ libperl5.20 を選択しています。
.../libperl5.20_5.20.2-3+deb8u6_armhf.deb を展開する準備をしています ...
libperl5.20 (5.20.2-3+deb8u6) を展開しています...
以前に未選択のパッケージ libsnmp-base を選択しています。
.../libsnmp-base_5.7.2.1+dfsg-1_all.deb を展開する準備をしています ...
libsnmp-base (5.7.2.1+dfsg-1) を展開しています...
以前に未選択のパッケージ libsnmp30:armhf を選択しています。
.../libsnmp30_5.7.2.1+dfsg-1_armhf.deb を展開する準備をしています ...
libsnmp30:armhf (5.7.2.1+dfsg-1) を展開しています...
以前に未選択のパッケージ snmp を選択しています。
.../snmp_5.7.2.1+dfsg-1_armhf.deb を展開する準備をしています ...
snmp (5.7.2.1+dfsg-1) を展開しています...
以前に未選択のパッケージ snmpd を選択しています。
.../snmpd_5.7.2.1+dfsg-1_armhf.deb を展開する準備をしています ...
snmpd (5.7.2.1+dfsg-1) を展開しています...
man-db (2.7.0.2-5) のトリガを処理しています ...
systemd (215-17+deb8u5) のトリガを処理しています ...
libsensors4:armhf (1:3.3.5-2) を設定しています ...
libperl5.20 (5.20.2-3+deb8u6) を設定しています ...
libsnmp-base (5.7.2.1+dfsg-1) を設定しています ...
libsnmp30:armhf (5.7.2.1+dfsg-1) を設定しています ...
snmp (5.7.2.1+dfsg-1) を設定しています ...
snmpd (5.7.2.1+dfsg-1) を設定しています ...
adduser: 警告: ホームディレクトリ `/var/lib/snmp' は、現在作成中のユーザの所属になっていません。
libc-bin (2.19-18+deb8u6) のトリガを処理しています ...
systemd (215-17+deb8u5) のトリガを処理しています ...
$
</code></pre>

<p>snmpconfツールを使用してsnmpd.confを作成します。
SNMPv3を使用する前提で質問に回答していきます。</p>

<pre><code>$ snmpconf -g basic_setup

The following installed configuration files were found:

   1:  /etc/snmp/snmp.conf
   2:  /etc/snmp/snmpd.conf

Would you like me to read them in?  Their content will be merged with the
output files created by this session.

Valid answer examples: &quot;all&quot;, &quot;none&quot;,&quot;3&quot;,&quot;1,2,5&quot;

Read in which (default = all): 2
************************************************ 
*** Beginning basic system information setup ***
************************************************ 
Do you want to configure the information returned in the system MIB group (contact info, etc)? (default = y): n
************************************** 
*** BEGINNING ACCESS CONTROL SETUP ***
************************************** 
Do you want to configure the agent's access control? (default = y): y
Do you want to allow SNMPv3 read-write user based access (default = y): n
Do you want to allow SNMPv3 read-only user based access (default = y): y

Configuring: rouser
Description:
  a SNMPv3 read-only user
    arguments:  user [noauth|auth|priv] [restriction_oid]

Enter the SNMPv3 user that should have read-only access to the system: snmpuser
The minimum security level required for that user [noauth|auth|priv, default = auth]: priv
The OID that this community should be restricted to [if appropriate]: 

Finished Output: rouser  snmpuser priv 
Do another rouser line? (default = y): n
Do you want to allow SNMPv1/v2c read-write community access (default = y): n
Do you want to allow SNMPv1/v2c read-only community access (default = y): n
**************************************** 
*** Beginning trap destination setup ***
**************************************** 
Do you want to configure where and if the agent will send traps? (default = y): n
**************************************** 
*** Beginning monitoring setup ***
**************************************** 
Do you want to configure the agent's ability to monitor various aspects of your system? (default = y): n


The following files were created:

  snmpd.conf  

These files should be moved to /usr/share/snmp if you
want them used by everyone on the system.  In the future, if you add 
the -i option to the command line I'll copy them there automatically for you.

Or, if you want them for your personal use only, copy them to
/home/pi/.snmp .  In the future, if you add the -p option to the
command line I'll copy them there automatically for you.
$
</code></pre>

<p>snmpd.confを設置します。</p>

<pre><code>$ sudo mv /etc/snmp/snmpd.conf{,.org}
$ sudo mv snmpd.conf /etc/snmp/
$
$ sudo chown root:root /etc/snmp/snmpd.conf
$ sudo chmod 600 /etc/snmp/snmpd.conf
$
$ ls -l /etc/snmp/*
-rw-r--r-- 1 root root  211  4月 15  2015 /etc/snmp/snmp.conf
-rw------- 1 root root  472  1月  9 17:39 /etc/snmp/snmpd.conf
-rw------- 1 root root 7116  4月 18  2015 /etc/snmp/snmpd.conf.org
$
</code></pre>

<p>SNMPv3ユーザを作成します。</p>

<pre><code>$ sudo systemctl stop snmpd
$ sudo cp -p /var/lib/snmp/snmpd.conf{,.org}
$
$ ls -l /var/lib/snmp/snmpd.conf*
-rw------- 1 snmp snmp 1089  1月  9 17:43 /var/lib/snmp/snmpd.conf
-rw------- 1 snmp snmp 1089  1月  9 17:43 /var/lib/snmp/snmpd.conf.org
$
$ sudo vi /var/lib/snmp/snmpd.conf
createUser snmpuser SHA snmp_pass AES snmp_pass
$ sudo systemctl start snmpd
$
</code></pre>

<p>SNMPv3で値を取得できることを確認します。</p>

<pre><code>$ snmpwalk -v 3 -u snmpuser -l authPriv -a SHA -A snmp_pass -x AES -X snmp_pass localhost .
</code></pre>

<ul>
<li><a href="http://www.infraexpert.com/study/tcpip21.html">TCP/IP - SNMPとは</a></li>
</ul>

<h2 id="iptablesの通信許可:f59bc3c40d42508a4e65c03888e7814a">iptablesの通信許可</h2>

<p>CactiからのSNMP通信を許可します。</p>

<pre><code>##INPUTチェーン
#SNMPは許可
$ sudo iptables -A INPUT -m state --state NEW -m udp -p udp -s 192.168.30.0/24 --dport 161 -j ACCEPT
</code></pre>

<p>iptablesの設定を保存します。</p>

<pre><code>$ sudo netfilter-persistent save
</code></pre>

<h2 id="cactiにデバイス-server-を登録:f59bc3c40d42508a4e65c03888e7814a">Cactiにデバイス(Server)を登録</h2>

<p>↓Cactiにログイン。<code>User Name</code>と<code>Password</code>を入力して<code>Login</code>をクリックします。</p>

<p><img src="/img/20170109_03/register-cacti-01.png" alt="register-cacti-01" width="320px" /></p>

<p>↓Cactiログイン後の画面。<code>Devices</code>をクリックします。</p>

<p><img src="/img/20170109_03/register-cacti-02.png" alt="register-cacti-02" width="320px" /></p>

<p>↓デバイスの管理画面。<code>Add</code>をクリックします。</p>

<p><img src="/img/20170109_03/register-cacti-03.png" alt="register-cacti-03" width="320px" /></p>

<p>↓デバイスの登録画面。必要事項を入力して<code>Create</code>をクリックします。</p>

<p><img src="/img/20170109_03/register-cacti-04.png" alt="register-cacti-04" width="320px" /></p>

<p>↓デバイスの登録完了画面。<code>SNMP Information</code>にデバイスの情報が表示されていることを確認します。<code>Create Graphs for this Host</code>をクリックします。</p>

<p><img src="/img/20170109_03/register-cacti-05.png" alt="register-cacti-05" width="320px" /></p>

<p>↓作成したいグラフを選択して<code>Create</code>をクリックします。</p>

<p><img src="/img/20170109_03/register-cacti-06.png" alt="register-cacti-06" width="320px" /></p>

<p>↓グラフが作成されたことを確認します。</p>

<p><img src="/img/20170109_03/register-cacti-07.png" alt="register-cacti-07" width="320px" /></p>

<p>↓左のメニューから<code>Graph Trees</code>をクリックし、<code>Default Tree</code>をクリックします。</p>

<p><img src="/img/20170109_03/register-cacti-08.png" alt="register-cacti-08" width="320px" /></p>

<p>↓ツリーの管理画面。<code>Add</code>をクリックします。</p>

<p><img src="/img/20170109_03/register-cacti-09.png" alt="register-cacti-09" width="320px" /></p>

<p>↓ツリーへのデバイス登録画面。必要事項を入力して<code>Create</code>をクリックします。</p>

<p><img src="/img/20170109_03/register-cacti-10.png" alt="register-cacti-10" width="320px" /></p>

<p>↓ツリーの管理画面。デバイスが登録されたことを確認します。</p>

<p><img src="/img/20170109_03/register-cacti-11.png" alt="register-cacti-11" width="320px" /></p>

<p>↓グラフ画面。追加したデバイスのグラフが表示されることを確認します。</p>

<p><img src="/img/20170109_03/register-cacti-12.png" alt="register-cacti-12" width="320px" /></p>

<p>以上</p>

                </div>
              </article>
              
              <article>
                <div class="title">
                  <h1><a href="http://www.shinayoshi.net/post/2017/01/09/setting-cacti/">家庭内インターネット接続環境を構築する その14</a></h1>
                  <p>
                    <span class="label label-primary">Mon Jan 9, 2017</span> in
                    
                    
                    <a href="http://www.shinayoshi.net//categories/server">server</a>
                     using tags
                    
                    
                    <a href="http://www.shinayoshi.net//tags/raspberrypi">raspberrypi</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/home-network">home-network</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homemon1">homemon1</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homemon2">homemon2</a>
                    
                  </p>
                </div>
                <div class="contents">
                  

<p>FortiGate 60DとRaspberry Piを使用して家庭内インターネット接続環境を構築します。
最終的には以下のような構成を想定しています。</p>

<p><img src="/img/20161022_01/home-network.png" alt="home network" width="640px" /></p>

<p>今回は<code>homemon1</code>、<code>homemon2</code>にCactiを導入します。</p>

<h2 id="cactiのインストール:155ae028b993b1af7e622df9d1a9e821">Cactiのインストール</h2>

<p>Cactiをインストールします。
途中でApache2の設定やMySQLのパスワードについて聞かれるので適宜回答します。</p>

<pre><code>$ sudo -E apt-get install cacti cacti-spine
パッケージリストを読み込んでいます... 完了
依存関係ツリーを作成しています                
状態情報を読み取っています... 完了
以下の追加パッケージがインストールされます:
  dbconfig-common fontconfig javascript-common libcairo2 libdatrie1 libdbi1
  libgraphite2-3 libharfbuzz0b libjs-jquery libjs-jquery-cookie libpango-1.0-0
  libpangocairo-1.0-0 libpangoft2-1.0-0 libphp-adodb libpixman-1-0 librrd4
  libthai-data libthai0 libxcb-render0 libxcb-shm0 libxrender1 php5-snmp
  rrdtool snmp
提案パッケージ:
  moreutils snmp-mibs-downloader php5-adodb librrds-perl
以下のパッケージが新たにインストールされます:
  cacti cacti-spine dbconfig-common fontconfig javascript-common libcairo2
  libdatrie1 libdbi1 libgraphite2-3 libharfbuzz0b libjs-jquery
  libjs-jquery-cookie libpango-1.0-0 libpangocairo-1.0-0 libpangoft2-1.0-0
  libphp-adodb libpixman-1-0 librrd4 libthai-data libthai0 libxcb-render0
  libxcb-shm0 libxrender1 php5-snmp rrdtool snmp
アップグレード: 0 個、新規インストール: 26 個、削除: 0 個、保留: 1 個。
6,777 kB のアーカイブを取得する必要があります。
この操作後に追加で 16.6 MB のディスク容量が消費されます。
続行しますか? [Y/n] y
取得:1 http://mirrordirector.raspbian.org/raspbian/ jessie/main fontconfig armhf 2.11.0-6.3+deb8u1 [402 kB]
取得:2 http://archive.raspberrypi.org/debian/ jessie/main libpixman-1-0 armhf 0.33.3+git20151011-7de61d8-rpi1 [156 kB]
取得:3 http://mirrordirector.raspbian.org/raspbian/ jessie/main libxcb-render0 armhf 1.10-3 [16.0 kB]
取得:4 http://mirrordirector.raspbian.org/raspbian/ jessie/main libxcb-shm0 armhf 1.10-3 [11.0 kB]
取得:5 http://mirrordirector.raspbian.org/raspbian/ jessie/main libxrender1 armhf 1:0.9.8-1 [30.4 kB]
取得:6 http://mirrordirector.raspbian.org/raspbian/ jessie/main libdatrie1 armhf 0.2.8-1 [29.1 kB]
取得:7 http://mirrordirector.raspbian.org/raspbian/ jessie/main libgraphite2-3 armhf 1.3.6-1~deb8u1 [62.5 kB]
取得:8 http://archive.raspberrypi.org/debian/ jessie/main libcairo2 armhf 1.14.0-2.1+deb8u1+rpi1 [662 kB]
取得:9 http://mirrordirector.raspbian.org/raspbian/ jessie/main libharfbuzz0b armhf 0.9.35-2 [464 kB]
取得:10 http://mirrordirector.raspbian.org/raspbian/ jessie/main libthai-data all 0.1.21-1 [159 kB]
取得:11 http://mirrordirector.raspbian.org/raspbian/ jessie/main libthai0 armhf 0.1.21-1 [43.4 kB]
取得:12 http://mirrordirector.raspbian.org/raspbian/ jessie/main dbconfig-common all 1.8.47+nmu3+deb8u1 [628 kB]
取得:13 http://mirrordirector.raspbian.org/raspbian/ jessie/main javascript-common all 11 [6,120 B]
取得:14 http://mirrordirector.raspbian.org/raspbian/ jessie/main libdbi1 armhf 0.9.0-4 [27.4 kB]
取得:15 http://mirrordirector.raspbian.org/raspbian/ jessie/main libjs-jquery all 1.7.2+dfsg-3.2 [97.5 kB]
取得:16 http://mirrordirector.raspbian.org/raspbian/ jessie/main libjs-jquery-cookie all 10-1 [7,978 B]
取得:17 http://mirrordirector.raspbian.org/raspbian/ jessie/main libphp-adodb all 5.15-1 [567 kB]
取得:18 http://mirrordirector.raspbian.org/raspbian/ jessie/main librrd4 armhf 1.4.8-1.2 [195 kB]
取得:19 http://mirrordirector.raspbian.org/raspbian/ jessie/main php5-snmp armhf 5.6.29+dfsg-0+deb8u1 [16.1 kB]
取得:20 http://mirrordirector.raspbian.org/raspbian/ jessie/main rrdtool armhf 1.4.8-1.2 [424 kB]
取得:21 http://archive.raspberrypi.org/debian/ jessie/ui libpango-1.0-0 armhf 1.36.8-3+rpi1 [274 kB]
取得:22 http://mirrordirector.raspbian.org/raspbian/ jessie/main snmp armhf 5.7.2.1+dfsg-1 [145 kB]
取得:23 http://mirrordirector.raspbian.org/raspbian/ jessie/main cacti all 0.8.8b+dfsg-8+deb8u6 [1,895 kB]
取得:24 http://archive.raspberrypi.org/debian/ jessie/ui libpangoft2-1.0-0 armhf 1.36.8-3+rpi1 [208 kB]
取得:25 http://mirrordirector.raspbian.org/raspbian/ jessie/main cacti-spine armhf 0.8.8b-1+b3 [53.9 kB]
取得:26 http://archive.raspberrypi.org/debian/ jessie/ui libpangocairo-1.0-0 armhf 1.36.8-3+rpi1 [197 kB]
6,777 kB を 21秒 で取得しました (311 kB/s)                                     
パッケージを事前設定しています ...

↓&lt;了解&gt;を選択してEnter
 ┌─────────────────────┤ libphp-adodb を設定しています ├─────────────────────┐
 │                                                                           │ 
 │ 警告: php に対するインクルードパスが変更されています!                     │ 
 │                                                                           │ 
 │ libphp-adobd は /usr/share/adodb にインストールされなくなっています。新   │ 
 │ しいインストールのパスは /usr/share/php/adodb です。                      │ 
 │                                                                           │ 
 │ php.ini ファイルを更新してください。web サーバの設定も変更する必要がある  │ 
 │ かもしれません。                                                          │ 
 │                                                                           │ 
 │                                  &lt;了解&gt;                                   │ 
 │                                                                           │ 
 └───────────────────────────────────────────────────────────────────────────┘ 

↓apache2を選択してEnter
 ┌────────────────────────┤ cacti を設定しています ├─────────────────────────┐
 │ Cacti が自動的に設定するウェブサーバを選んでください。                    │ 
 │                                                                           │ 
 │ ウェブサーバを手作業で設定したい場合は「どれでもない」を選んでください。  │ 
 │                                                                           │ 
 │ ウェブサーバ:                                                             │ 
 │                                                                           │ 
 │                               apache2                                     │ 
 │                               lighttpd                                    │ 
 │                               どれでもない                                │ 
 │                                                                           │ 
 │                                                                           │ 
 │                                  &lt;了解&gt;                                   │ 
 │                                                                           │ 
 └───────────────────────────────────────────────────────────────────────────┘ 

以前に未選択のパッケージ fontconfig を選択しています。
(データベースを読み込んでいます ... 現在 37219 個のファイルとディレクトリがインストールされています。)
.../fontconfig_2.11.0-6.3+deb8u1_armhf.deb を展開する準備をしています ...
fontconfig (2.11.0-6.3+deb8u1) を展開しています...
以前に未選択のパッケージ libpixman-1-0:armhf を選択しています。
.../libpixman-1-0_0.33.3+git20151011-7de61d8-rpi1_armhf.deb を展開する準備をしています ...
libpixman-1-0:armhf (0.33.3+git20151011-7de61d8-rpi1) を展開しています...
以前に未選択のパッケージ libxcb-render0:armhf を選択しています。
.../libxcb-render0_1.10-3_armhf.deb を展開する準備をしています ...
libxcb-render0:armhf (1.10-3) を展開しています...
以前に未選択のパッケージ libxcb-shm0:armhf を選択しています。
.../libxcb-shm0_1.10-3_armhf.deb を展開する準備をしています ...
libxcb-shm0:armhf (1.10-3) を展開しています...
以前に未選択のパッケージ libxrender1:armhf を選択しています。
.../libxrender1_1%3a0.9.8-1_armhf.deb を展開する準備をしています ...
libxrender1:armhf (1:0.9.8-1) を展開しています...
以前に未選択のパッケージ libcairo2:armhf を選択しています。
.../libcairo2_1.14.0-2.1+deb8u1+rpi1_armhf.deb を展開する準備をしています ...
libcairo2:armhf (1.14.0-2.1+deb8u1+rpi1) を展開しています...
以前に未選択のパッケージ libdatrie1:armhf を選択しています。
.../libdatrie1_0.2.8-1_armhf.deb を展開する準備をしています ...
libdatrie1:armhf (0.2.8-1) を展開しています...
以前に未選択のパッケージ libgraphite2-3:armhf を選択しています。
.../libgraphite2-3_1.3.6-1~deb8u1_armhf.deb を展開する準備をしています ...
libgraphite2-3:armhf (1.3.6-1~deb8u1) を展開しています...
以前に未選択のパッケージ libharfbuzz0b:armhf を選択しています。
.../libharfbuzz0b_0.9.35-2_armhf.deb を展開する準備をしています ...
libharfbuzz0b:armhf (0.9.35-2) を展開しています...
以前に未選択のパッケージ libthai-data を選択しています。
.../libthai-data_0.1.21-1_all.deb を展開する準備をしています ...
libthai-data (0.1.21-1) を展開しています...
以前に未選択のパッケージ libthai0:armhf を選択しています。
.../libthai0_0.1.21-1_armhf.deb を展開する準備をしています ...
libthai0:armhf (0.1.21-1) を展開しています...
以前に未選択のパッケージ libpango-1.0-0:armhf を選択しています。
.../libpango-1.0-0_1.36.8-3+rpi1_armhf.deb を展開する準備をしています ...
libpango-1.0-0:armhf (1.36.8-3+rpi1) を展開しています...
以前に未選択のパッケージ libpangoft2-1.0-0:armhf を選択しています。
.../libpangoft2-1.0-0_1.36.8-3+rpi1_armhf.deb を展開する準備をしています ...
libpangoft2-1.0-0:armhf (1.36.8-3+rpi1) を展開しています...
以前に未選択のパッケージ libpangocairo-1.0-0:armhf を選択しています。
.../libpangocairo-1.0-0_1.36.8-3+rpi1_armhf.deb を展開する準備をしています ...
libpangocairo-1.0-0:armhf (1.36.8-3+rpi1) を展開しています...
以前に未選択のパッケージ dbconfig-common を選択しています。
.../dbconfig-common_1.8.47+nmu3+deb8u1_all.deb を展開する準備をしています ...
dbconfig-common (1.8.47+nmu3+deb8u1) を展開しています...
以前に未選択のパッケージ javascript-common を選択しています。
.../javascript-common_11_all.deb を展開する準備をしています ...
javascript-common (11) を展開しています...
以前に未選択のパッケージ libdbi1:armhf を選択しています。
.../libdbi1_0.9.0-4_armhf.deb を展開する準備をしています ...
libdbi1:armhf (0.9.0-4) を展開しています...
以前に未選択のパッケージ libjs-jquery を選択しています。
.../libjs-jquery_1.7.2+dfsg-3.2_all.deb を展開する準備をしています ...
libjs-jquery (1.7.2+dfsg-3.2) を展開しています...
以前に未選択のパッケージ libjs-jquery-cookie を選択しています。
.../libjs-jquery-cookie_10-1_all.deb を展開する準備をしています ...
libjs-jquery-cookie (10-1) を展開しています...
以前に未選択のパッケージ libphp-adodb を選択しています。
.../libphp-adodb_5.15-1_all.deb を展開する準備をしています ...
libphp-adodb (5.15-1) を展開しています...
以前に未選択のパッケージ librrd4 を選択しています。
.../librrd4_1.4.8-1.2_armhf.deb を展開する準備をしています ...
librrd4 (1.4.8-1.2) を展開しています...
以前に未選択のパッケージ php5-snmp を選択しています。
.../php5-snmp_5.6.29+dfsg-0+deb8u1_armhf.deb を展開する準備をしています ...
php5-snmp (5.6.29+dfsg-0+deb8u1) を展開しています...
以前に未選択のパッケージ rrdtool を選択しています。
.../rrdtool_1.4.8-1.2_armhf.deb を展開する準備をしています ...
rrdtool (1.4.8-1.2) を展開しています...
以前に未選択のパッケージ snmp を選択しています。
.../snmp_5.7.2.1+dfsg-1_armhf.deb を展開する準備をしています ...
snmp (5.7.2.1+dfsg-1) を展開しています...
以前に未選択のパッケージ cacti を選択しています。
.../cacti_0.8.8b+dfsg-8+deb8u6_all.deb を展開する準備をしています ...
cacti (0.8.8b+dfsg-8+deb8u6) を展開しています...
以前に未選択のパッケージ cacti-spine を選択しています。
.../cacti-spine_0.8.8b-1+b3_armhf.deb を展開する準備をしています ...
cacti-spine (0.8.8b-1+b3) を展開しています...
man-db (2.7.0.2-5) のトリガを処理しています ...
libapache2-mod-php5 (5.6.29+dfsg-0+deb8u1) のトリガを処理しています ...
fontconfig (2.11.0-6.3+deb8u1) を設定しています ...
Regenerating fonts cache... done.
libpixman-1-0:armhf (0.33.3+git20151011-7de61d8-rpi1) を設定しています ...
libxcb-render0:armhf (1.10-3) を設定しています ...
libxcb-shm0:armhf (1.10-3) を設定しています ...
libxrender1:armhf (1:0.9.8-1) を設定しています ...
libcairo2:armhf (1.14.0-2.1+deb8u1+rpi1) を設定しています ...
libdatrie1:armhf (0.2.8-1) を設定しています ...
libgraphite2-3:armhf (1.3.6-1~deb8u1) を設定しています ...
libharfbuzz0b:armhf (0.9.35-2) を設定しています ...
libthai-data (0.1.21-1) を設定しています ...
libthai0:armhf (0.1.21-1) を設定しています ...
libpango-1.0-0:armhf (1.36.8-3+rpi1) を設定しています ...
libpangoft2-1.0-0:armhf (1.36.8-3+rpi1) を設定しています ...
libpangocairo-1.0-0:armhf (1.36.8-3+rpi1) を設定しています ...
dbconfig-common (1.8.47+nmu3+deb8u1) を設定しています ...

Creating config file /etc/dbconfig-common/config with new version
javascript-common (11) を設定しています ...
apache2_invoke: Enable configuration javascript-common
libdbi1:armhf (0.9.0-4) を設定しています ...
libjs-jquery (1.7.2+dfsg-3.2) を設定しています ...
libjs-jquery-cookie (10-1) を設定しています ...
libphp-adodb (5.15-1) を設定しています ...
librrd4 (1.4.8-1.2) を設定しています ...
php5-snmp (5.6.29+dfsg-0+deb8u1) を設定しています ...

Creating config file /etc/php5/mods-available/snmp.ini with new version
php5_invoke: Enable module snmp for cli SAPI
php5_invoke: Enable module snmp for apache2 SAPI
rrdtool (1.4.8-1.2) を設定しています ...
snmp (5.7.2.1+dfsg-1) を設定しています ...
cacti (0.8.8b+dfsg-8+deb8u6) を設定しています ...

↓&lt;はい&gt;を選択してEnter
 ┌────────────────────────┤ cacti を設定しています ├─────────────────────────┐
 │                                                                           │ 
 │ cacti は利用できるようになる前にはデータベースをインストールして設定する  │ 
 │ 必要があります。この設定を dbconfig-common で管理するようにもできます。   │ 
 │                                                                           │ 
 │ あなたが熟練したデータベース管理者でこの設定について手動で何をするのかを  │ 
 │ 知っている場合、あるいはデータベースが既にインストール及び設定されている  │ 
 │ 場合は、この選択を選ばない方が良いでしょう。何をすればいいのかについての  │ 
 │ 詳細については、大抵 /usr/share/doc/cacti に置かれています。              │ 
 │                                                                           │ 
 │ そうでない場合は、恐らくこの設定を選ぶのが良いでしょう。                  │ 
 │                                                                           │ 
 │ cacti のデータベースを dbconfig-common で設定しますか?                    │ 
 │                                                                           │ 
 │                    &lt;はい&gt;                      &lt;いいえ&gt;                   │ 
 │                                                                           │ 
 └───────────────────────────────────────────────────────────────────────────┘ 

↓MySQLのrootユーザのパスワードを入力し、&lt;了解&gt;を選択してEnter
  ┌────────────────────────┤ cacti を設定しています ├────────────────────────┐
  │ このパッケージが MySQL データベースとユーザを作る際に使う管理者権限アカ  │ 
  │ ウントのパスワードを入力してください。                                   │ 
  │                                                                          │ 
  │ データベースの管理権限を持つユーザのパスワード:                          │ 
  │                                                                          │ 
  │ ________________________________________________________________________ │ 
  │                                                                          │ 
  │                   &lt;了解&gt;                     &lt;取消&gt;                      │ 
  │                                                                          │ 
  └──────────────────────────────────────────────────────────────────────────┘ 

↓MySQLのcactiユーザのパスワードを入力し、&lt;了解&gt;を選択してEnter
  ┌────────────────────────┤ cacti を設定しています ├────────────────────────┐
  │ データベースサーバに cacti が登録するパスワードを入力してください。空の  │ 
  │ ままにしておくと、ランダムパスワードが生成されます。                     │ 
  │                                                                          │ 
  │ cacti 用の MySQL アプリケーションパスワード:                             │ 
  │                                                                          │ 
  │ ________________________________________________________________________ │ 
  │                                                                          │ 
  │                   &lt;了解&gt;                     &lt;取消&gt;                      │ 
  │                                                                          │ 
  └──────────────────────────────────────────────────────────────────────────┘ 

↓再度MySQLのcactiユーザのパスワード入力し、&lt;了解&gt;を選択してEnter
  ┌────┤ cacti を設定しています ├─────┐
  │                                   │ 
  │                                   │ 
  │ パスワードの確認:                 │ 
  │                                   │ 
  │ _________________________________ │ 
  │                                   │ 
  │      &lt;了解&gt;        &lt;取消&gt;         │ 
  │                                   │ 
  └───────────────────────────────────┘ 

dbconfig-common: writing config to /etc/dbconfig-common/cacti.conf

Creating config file /etc/dbconfig-common/cacti.conf with new version

Creating config file /etc/cacti/debian.php with new version
granting access to database cacti for cacti@localhost: success.
verifying access for cacti@localhost: success.
creating database cacti: success.
verifying database cacti exists: success.
populating database via sql...  done.
dbconfig-common: flushing administrative password

Creating config file /etc/apache2/conf-available/cacti.conf with new version

Creating config file /etc/lighttpd/conf-available/20-cacti.conf with new version
apache2_invoke: Enable configuration cacti
cacti-spine (0.8.8b-1+b3) を設定しています ...

Creating config file /etc/cacti/spine.conf with new version
libc-bin (2.19-18+deb8u6) のトリガを処理しています ...
libapache2-mod-php5 (5.6.29+dfsg-0+deb8u1) のトリガを処理しています ...
$
</code></pre>

<p>データベースをMyISAMからInnoDBに変更します。</p>

<pre><code>$ cd /usr/share/cacti/cli
$ sudo php convert_innodb.php
Converting All Non-Memory Cacti Database Tables to Innodb with Less than '300000' Records
Converting Table -&gt; 'cdef' Successful
Converting Table -&gt; 'cdef_items' Successful
Converting Table -&gt; 'colors' Successful
Converting Table -&gt; 'data_input' Successful
Converting Table -&gt; 'data_input_data' Successful
Converting Table -&gt; 'data_input_fields' Successful
Converting Table -&gt; 'data_local' Successful
Converting Table -&gt; 'data_template' Successful
Converting Table -&gt; 'data_template_data' Successful
Converting Table -&gt; 'data_template_data_rra' Successful
Converting Table -&gt; 'data_template_rrd' Successful
Converting Table -&gt; 'graph_local' Successful
Converting Table -&gt; 'graph_template_input' Successful
Converting Table -&gt; 'graph_template_input_defs' Successful
Converting Table -&gt; 'graph_templates' Successful
Converting Table -&gt; 'graph_templates_gprint' Successful
Converting Table -&gt; 'graph_templates_graph' Successful
Converting Table -&gt; 'graph_templates_item' Successful
Converting Table -&gt; 'graph_tree' Successful
Converting Table -&gt; 'graph_tree_items' Successful
Converting Table -&gt; 'host' Successful
Converting Table -&gt; 'host_graph' Successful
Converting Table -&gt; 'host_snmp_cache' Successful
Converting Table -&gt; 'host_snmp_query' Successful
Converting Table -&gt; 'host_template' Successful
Converting Table -&gt; 'host_template_graph' Successful
Converting Table -&gt; 'host_template_snmp_query' Successful
Converting Table -&gt; 'plugin_config' Successful
Converting Table -&gt; 'plugin_db_changes' Successful
Converting Table -&gt; 'plugin_hooks' Successful
Converting Table -&gt; 'plugin_realms' Successful
Converting Table -&gt; 'poller' Successful
Converting Table -&gt; 'poller_command' Successful
Converting Table -&gt; 'poller_item' Successful
Converting Table -&gt; 'poller_output' Successful
Converting Table -&gt; 'poller_reindex' Successful
Converting Table -&gt; 'poller_time' Successful
Converting Table -&gt; 'rra' Successful
Converting Table -&gt; 'rra_cf' Successful
Converting Table -&gt; 'settings' Successful
Converting Table -&gt; 'settings_graphs' Successful
Converting Table -&gt; 'settings_tree' Successful
Converting Table -&gt; 'snmp_query' Successful
Converting Table -&gt; 'snmp_query_graph' Successful
Converting Table -&gt; 'snmp_query_graph_rrd' Successful
Converting Table -&gt; 'snmp_query_graph_rrd_sv' Successful
Converting Table -&gt; 'snmp_query_graph_sv' Successful
Converting Table -&gt; 'user_auth' Successful
Converting Table -&gt; 'user_auth_perms' Successful
Converting Table -&gt; 'user_auth_realm' Successful
Converting Table -&gt; 'user_log' Successful
Converting Table -&gt; 'version' Successful
$
</code></pre>

<h3 id="cactiへのアクセス:155ae028b993b1af7e622df9d1a9e821">Cactiへのアクセス</h3>

<p>ブラウザからCactiのURL(<code>http://IPアドレス/cacti</code>)にアクセスします。</p>

<p>Cactiの初期設定画面が表示されるので、画面の指示に従いながら設定を行う。</p>

<p>↓Nextをクリック</p>

<p><img src="/img/20170109_02/cacti-install-01.png" alt="cacti-install-01" width="320px" /></p>

<p>↓Nextをクリック</p>

<p><img src="/img/20170109_02/cacti-install-02.png" alt="cacti-install-02" width="320px" /></p>

<p>↓Errorがないことを確認してFinishをクリック</p>

<p><img src="/img/20170109_02/cacti-install-03.png" alt="cacti-install-03" width="320px" /></p>

<p>↓admin/adminでログイン</p>

<p><img src="/img/20170109_02/cacti-install-04.png" alt="cacti-install-04" width="320px" /></p>

<p>↓adminの新しいパスワードを入力してSaveをクリック</p>

<p><img src="/img/20170109_02/cacti-install-05.png" alt="cacti-install-05" width="320px" /></p>

<p>↓ログイン後の初期画面</p>

<p><img src="/img/20170109_02/cacti-install-06.png" alt="cacti-install-06" width="320px" /></p>

<p>以上</p>

                </div>
              </article>
              
              <article>
                <div class="title">
                  <h1><a href="http://www.shinayoshi.net/post/2017/01/09/setting-zabbix-agent/">家庭内インターネット接続環境を構築する その13</a></h1>
                  <p>
                    <span class="label label-primary">Mon Jan 9, 2017</span> in
                    
                    
                    <a href="http://www.shinayoshi.net//categories/server">server</a>
                     using tags
                    
                    
                    <a href="http://www.shinayoshi.net//tags/raspberrypi">raspberrypi</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/home-network">home-network</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homenas1">homenas1</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homemon1">homemon1</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homemon2">homemon2</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homepxy1">homepxy1</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homepot1">homepot1</a>
                    
                  </p>
                </div>
                <div class="contents">
                  

<p>FortiGate 60DとRaspberry Piを使用して家庭内インターネット接続環境を構築します。
最終的には以下のような構成を想定しています。</p>

<p><img src="/img/20161022_01/home-network.png" alt="home network" width="640px" /></p>

<p>前回はZabbix Serverを導入しました。
今回は<code>homenas1</code>、<code>homemon1</code>、<code>homemon2</code>、<code>homepxy1</code>、<code>homepot1</code>にZabbix Agentを導入していきます。</p>

<h2 id="zabbix-agentのインストール:46d78a109e92aa27b1ca04b613e55e42">Zabbix Agentのインストール</h2>

<p>Zabbix Agentをインストールします。</p>

<pre><code>$ sudo -E apt-get install zabbix-agent
パッケージリストを読み込んでいます... 完了
依存関係ツリーを作成しています                
状態情報を読み取っています... 完了
以下の追加パッケージがインストールされます:
  libcurl3-gnutls libpci3 pciutils
以下のパッケージが新たにインストールされます:
  libcurl3-gnutls libpci3 pciutils zabbix-agent
アップグレード: 0 個、新規インストール: 4 個、削除: 0 個、保留: 1 個。
819 kB のアーカイブを取得する必要があります。
この操作後に追加で 2,344 kB のディスク容量が消費されます。
続行しますか? [Y/n] y
取得:1 http://mirrordirector.raspbian.org/raspbian/ jessie/main libpci3 armhf 1:3.2.1-3 [48.2 kB]
取得:2 http://mirrordirector.raspbian.org/raspbian/ jessie/main libcurl3-gnutls armhf 7.38.0-4+deb8u5 [225 kB]
取得:3 http://mirrordirector.raspbian.org/raspbian/ jessie/main pciutils armhf 1:3.2.1-3 [251 kB]
取得:4 http://mirrordirector.raspbian.org/raspbian/ jessie/main zabbix-agent armhf 1:2.2.7+dfsg-2+deb8u1 [296 kB]
819 kB を 2秒 で取得しました (346 kB/s)
以前に未選択のパッケージ libpci3:armhf を選択しています。
(データベースを読み込んでいます ... 現在 33530 個のファイルとディレクトリがインストールされています。)
.../libpci3_1%3a3.2.1-3_armhf.deb を展開する準備をしています ...
libpci3:armhf (1:3.2.1-3) を展開しています...
以前に未選択のパッケージ libcurl3-gnutls:armhf を選択しています。
.../libcurl3-gnutls_7.38.0-4+deb8u5_armhf.deb を展開する準備をしています ...
libcurl3-gnutls:armhf (7.38.0-4+deb8u5) を展開しています...
以前に未選択のパッケージ pciutils を選択しています。
.../pciutils_1%3a3.2.1-3_armhf.deb を展開する準備をしています ...
pciutils (1:3.2.1-3) を展開しています...
以前に未選択のパッケージ zabbix-agent を選択しています。
.../zabbix-agent_1%3a2.2.7+dfsg-2+deb8u1_armhf.deb を展開する準備をしています ...
zabbix-agent (1:2.2.7+dfsg-2+deb8u1) を展開しています...
man-db (2.7.0.2-5) のトリガを処理しています ...
systemd (215-17+deb8u5) のトリガを処理しています ...
libpci3:armhf (1:3.2.1-3) を設定しています ...
libcurl3-gnutls:armhf (7.38.0-4+deb8u5) を設定しています ...
pciutils (1:3.2.1-3) を設定しています ...
zabbix-agent (1:2.2.7+dfsg-2+deb8u1) を設定しています ...

Creating config file /etc/zabbix/zabbix_agentd.conf with new version
libc-bin (2.19-18+deb8u6) のトリガを処理しています ...
systemd (215-17+deb8u5) のトリガを処理しています ...
$
</code></pre>

<h3 id="zabbix-agentの設定:46d78a109e92aa27b1ca04b613e55e42">Zabbix Agentの設定</h3>

<p>Zabbix Agentを設定します。
以下では<code>homepxy1</code>を設定した際の例を記載します。</p>

<pre><code>$ sudo cp -p /etc/zabbix/zabbix_agentd.conf{,.org}
$ ls -l /etc/zabbix/zabbix_agentd.conf*
-rw-r--r-- 1 root root 7570  9月 18 03:38 /etc/zabbix/zabbix_agentd.conf
-rw-r--r-- 1 root root 7570  9月 18 03:38 /etc/zabbix/zabbix_agentd.conf.org
$
$ sudo vi /etc/zabbix/zabbix_agentd.conf
#Server=127.0.0.1
Server=192.168.30.10,192.168.30.20

#ServerActive=127.0.0.1
ServerActive=192.168.30.10,192.168.30.20

#Hostname=Zabbix server
Hostname=homepxy1
$
</code></pre>

<p>Zabbix Agentを再起動します。</p>

<pre><code>$ sudo systemctl restart zabbix-agent
$ sudo systemctl enable zabbix-agent
Synchronizing state for zabbix-agent.service with sysvinit using update-rc.d...
Executing /usr/sbin/update-rc.d zabbix-agent defaults
Executing /usr/sbin/update-rc.d zabbix-agent enable
$
</code></pre>

<h3 id="iptablesの通信許可-iptablesを設定しているホストのみ:46d78a109e92aa27b1ca04b613e55e42">iptablesの通信許可(iptablesを設定しているホストのみ)</h3>

<p>Zabbix Serverとの通信を許可する。</p>

<pre><code>#Zabbix-Agentへの通信は許可
$ sudo iptables -A INPUT -m state --state NEW -m tcp -p tcp -s 192.168.30.0/24 --dport 10050 -j ACCEPT

#Zabbix-Serverへの通信は許可
$ sudo iptables -A OUTPUT -m state --state NEW -m tcp -p tcp -d 192.168.30.0/24 --dport 10051 -j ACCEPT
</code></pre>

<p>iptablesの設定を保存します。</p>

<pre><code>$ sudo netfilter-persistent save
run-parts: executing /usr/share/netfilter-persistent/plugins.d/15-ip4tables save
run-parts: executing /usr/share/netfilter-persistent/plugins.d/25-ip6tables save
$
</code></pre>

<h3 id="zabbix-serverでの監視登録:46d78a109e92aa27b1ca04b613e55e42">Zabbix Serverでの監視登録</h3>

<ul>
<li>Zabbixへのログイン</li>
</ul>

<p>ブラウザからZabbix ServerのURL(<code>http://IPアドレス/zabbix</code>)にアクセスしてログインします。</p>

<p><img src="/img/20170109_01/zabbix-agent-install-01.png" alt="zabbix-agent-install-01" width="320px" /></p>

<ul>
<li>監視対象ホストの追加</li>
</ul>

<p><code>Configuration</code> -&gt; <code>Hosts</code>を選択します。</p>

<p><img src="/img/20170109_01/zabbix-agent-install-02.png" alt="zabbix-agent-install-02" width="320px" /></p>

<p><code>Create host</code>を選択し、<code>Host</code>タブの以下の項目を入力します。</p>

<pre><code>Host name: homepxy1
Groups: Linux servers
Agent interfaces: 192.168.20.10
</code></pre>

<p><img src="/img/20170109_01/zabbix-agent-install-03.png" alt="zabbix-agent-install-03" width="320px" /></p>

<p><code>Templates</code>タブの以下の項目を入力します。</p>

<pre><code>Linked templates: Template OS Linux
</code></pre>

<p><img src="/img/20170109_01/zabbix-agent-install-04.png" alt="zabbix-agent-install-04" width="320px" /></p>

<p><code>Save</code>をクリックします。</p>

<ul>
<li>監視対象ホストの追加確認</li>
</ul>

<p><code>Hosts</code>のリストに追加したホスト名が表示されていること、StatusがMonitoredになっていることを確認します。</p>

<p><img src="/img/20170109_01/zabbix-agent-install-05.png" alt="zabbix-agent-install-05" width="320px" /></p>

<p>以下は対象ホストをすべて登録した状態になります。</p>

<p><img src="/img/20170109_01/zabbix-agent-install-06.png" alt="zabbix-agent-install-06" width="320px" /></p>

<p>以上</p>

                </div>
              </article>
              
              <article>
                <div class="title">
                  <h1><a href="http://www.shinayoshi.net/post/2017/01/08/setting-zabbix-server/">家庭内インターネット接続環境を構築する その12</a></h1>
                  <p>
                    <span class="label label-primary">Sun Jan 8, 2017</span> in
                    
                    
                    <a href="http://www.shinayoshi.net//categories/server">server</a>
                     using tags
                    
                    
                    <a href="http://www.shinayoshi.net//tags/raspberrypi">raspberrypi</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/home-network">home-network</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homemon1">homemon1</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homemon2">homemon2</a>
                    
                  </p>
                </div>
                <div class="contents">
                  

<p>FortiGate 60DとRaspberry Piを使用して家庭内インターネット接続環境を構築します。
最終的には以下のような構成を想定しています。</p>

<p><img src="/img/20161022_01/home-network.png" alt="home network" width="640px" /></p>

<p>前回に引き続き<code>homemon1</code>、<code>homemon2</code>を構築していきます。
本環境の監視を行うためにZabbixを導入します。</p>

<h2 id="zabbix-serverのインストール:d408cd6d355b48aec871928776dae66b">Zabbix Serverのインストール</h2>

<pre><code>$ sudo -E apt-get install zabbix-server-mysql zabbix-frontend-php php5-mysql task-japanese
パッケージリストを読み込んでいます... 完了
依存関係ツリーを作成しています                
状態情報を読み取っています... 完了
以下の追加パッケージがインストールされます:
  apache2 apache2-bin apache2-data apache2-utils bdf2psf fbterm
  fontconfig-config fonts-dejavu-core fping libaio1 libapache2-mod-php5
  libapr1 libaprutil1 libaprutil1-dbd-sqlite3 libaprutil1-ldap libcurl3-gnutls
  libdbd-mysql-perl libdbi-perl libfontconfig1 libfontenc1 libgd3
  libhtml-template-perl libiksemel3 libjbig0 libltdl7 liblua5.1-0
  libmysqlclient18 libodbc1 libonig2 libopenipmi0 libpci3
  libperl4-corelibs-perl libperl5.20 libqdbm14 libsensors4 libsnmp-base
  libsnmp30 libterm-readkey-perl libtiff5 libvpx1 libxfont1 libxpm4 lsof lv
  manpages-ja manpages-ja-dev mysql-client-5.5 mysql-common mysql-server
  mysql-server-5.5 mysql-server-core-5.5 nkf php5 php5-cli php5-common php5-gd
  php5-json php5-ldap php5-readline psf-unifont snmpd ssl-cert ttf-dejavu-core
  ttf-unifont unifont x11-common xfonts-encodings xfonts-unifont xfonts-utils
提案パッケージ:
  www-browser apache2-doc apache2-suexec-pristine apache2-suexec-custom
  php-pear libclone-perl libmldbm-perl libnet-daemon-perl
  libsql-statement-perl libgd-tools libipc-sharedcache-perl libmyodbc
  odbc-postgresql tdsodbc unixodbc-bin lm-sensors snmp-mibs-downloader mailx
  tinyca php5-user-cache snmptrapd openssl-blacklist unifont-bin
以下のパッケージが新たにインストールされます:
  apache2 apache2-bin apache2-data apache2-utils bdf2psf fbterm
  fontconfig-config fonts-dejavu-core fping libaio1 libapache2-mod-php5
  libapr1 libaprutil1 libaprutil1-dbd-sqlite3 libaprutil1-ldap libcurl3-gnutls
  libdbd-mysql-perl libdbi-perl libfontconfig1 libfontenc1 libgd3
  libhtml-template-perl libiksemel3 libjbig0 libltdl7 liblua5.1-0
  libmysqlclient18 libodbc1 libonig2 libopenipmi0 libpci3
  libperl4-corelibs-perl libperl5.20 libqdbm14 libsensors4 libsnmp-base
  libsnmp30 libterm-readkey-perl libtiff5 libvpx1 libxfont1 libxpm4 lsof lv
  manpages-ja manpages-ja-dev mysql-client-5.5 mysql-common mysql-server
  mysql-server-5.5 mysql-server-core-5.5 nkf php5 php5-cli php5-common php5-gd
  php5-json php5-ldap php5-mysql php5-readline psf-unifont snmpd ssl-cert
  task-japanese ttf-dejavu-core ttf-unifont unifont x11-common
  xfonts-encodings xfonts-unifont xfonts-utils zabbix-frontend-php
  zabbix-server-mysql
アップグレード: 0 個、新規インストール: 73 個、削除: 0 個、保留: 1 個。
43.9 MB のアーカイブを取得する必要があります。
この操作後に追加で 211 MB のディスク容量が消費されます。
続行しますか? [Y/n] y
取得:1 http://archive.raspberrypi.org/debian/ jessie/main libxfont1 armhf 1:1.5.2-1 [119 kB]
取得:2 http://mirrordirector.raspbian.org/raspbian/ jessie/main libpci3 armhf 1:3.2.1-3 [48.2 kB]
取得:3 http://mirrordirector.raspbian.org/raspbian/ jessie/main libapr1 armhf 1.5.1-3 [77.1 kB]
取得:4 http://mirrordirector.raspbian.org/raspbian/ jessie/main libaprutil1 armhf 1.5.4-1 [75.9 kB]
取得:5 http://mirrordirector.raspbian.org/raspbian/ jessie/main libaprutil1-dbd-sqlite3 armhf 1.5.4-1 [17.7 kB]
取得:6 http://mirrordirector.raspbian.org/raspbian/ jessie/main libaprutil1-ldap armhf 1.5.4-1 [16.7 kB]
取得:7 http://mirrordirector.raspbian.org/raspbian/ jessie/main liblua5.1-0 armhf 5.1.5-7.1 [83.7 kB]
取得:8 http://mirrordirector.raspbian.org/raspbian/ jessie/main apache2-bin armhf 2.4.10-10+deb8u7 [893 kB]
取得:9 http://mirrordirector.raspbian.org/raspbian/ jessie/main apache2-utils armhf 2.4.10-10+deb8u7 [194 kB]
取得:10 http://mirrordirector.raspbian.org/raspbian/ jessie/main apache2-data all 2.4.10-10+deb8u7 [163 kB]
取得:11 http://mirrordirector.raspbian.org/raspbian/ jessie/main apache2 armhf 2.4.10-10+deb8u7 [207 kB]
取得:12 http://mirrordirector.raspbian.org/raspbian/ jessie/main libaio1 armhf 0.3.110-1 [9,228 B]
取得:13 http://mirrordirector.raspbian.org/raspbian/ jessie/main libcurl3-gnutls armhf 7.38.0-4+deb8u5 [225 kB]
取得:14 http://mirrordirector.raspbian.org/raspbian/ jessie/main fonts-dejavu-core all 2.34-1 [1,047 kB]
取得:15 http://mirrordirector.raspbian.org/raspbian/ jessie/main fontconfig-config all 2.11.0-6.3+deb8u1 [274 kB]
取得:16 http://mirrordirector.raspbian.org/raspbian/ jessie/main libfontconfig1 armhf 2.11.0-6.3+deb8u1 [312 kB]
取得:17 http://mirrordirector.raspbian.org/raspbian/ jessie/main libfontenc1 armhf 1:1.1.2-1 [23.9 kB]
取得:18 http://mirrordirector.raspbian.org/raspbian/ jessie/main libjbig0 armhf 2.1-3.1 [27.5 kB]
取得:19 http://mirrordirector.raspbian.org/raspbian/ jessie/main libtiff5 armhf 4.0.3-12.3+deb8u1 [194 kB]
取得:20 http://mirrordirector.raspbian.org/raspbian/ jessie/main libvpx1 armhf 1.3.0-3+rvt [783 kB]
取得:21 http://mirrordirector.raspbian.org/raspbian/ jessie/main libxpm4 armhf 1:3.5.11-1 [41.7 kB]
取得:22 http://mirrordirector.raspbian.org/raspbian/ jessie/main libgd3 armhf 2.1.0-5+deb8u8 [127 kB]
取得:23 http://mirrordirector.raspbian.org/raspbian/ jessie/main libiksemel3 armhf 1.4-2 [23.4 kB]
取得:24 http://mirrordirector.raspbian.org/raspbian/ jessie/main libltdl7 armhf 2.4.2-1.11 [42.5 kB]
取得:25 http://mirrordirector.raspbian.org/raspbian/ jessie/main mysql-common all 5.5.53-0+deb8u1 [75.5 kB]
取得:26 http://mirrordirector.raspbian.org/raspbian/ jessie/main libmysqlclient18 armhf 5.5.53-0+deb8u1 [617 kB]
取得:27 http://mirrordirector.raspbian.org/raspbian/ jessie/main libodbc1 armhf 2.3.1-3 [179 kB]
取得:28 http://mirrordirector.raspbian.org/raspbian/ jessie/main libonig2 armhf 5.9.5-3.2 [101 kB]
取得:29 http://mirrordirector.raspbian.org/raspbian/ jessie/main libsensors4 armhf 1:3.3.5-2 [48.9 kB]
取得:30 http://mirrordirector.raspbian.org/raspbian/ jessie/main libperl5.20 armhf 5.20.2-3+deb8u6 [1,354 B]
取得:31 http://mirrordirector.raspbian.org/raspbian/ jessie/main libsnmp-base all 5.7.2.1+dfsg-1 [1,544 kB]
取得:32 http://mirrordirector.raspbian.org/raspbian/ jessie/main libsnmp30 armhf 5.7.2.1+dfsg-1 [2,040 kB]
取得:33 http://mirrordirector.raspbian.org/raspbian/ jessie/main libdbi-perl armhf 1.631-3+b1 [807 kB]
取得:34 http://mirrordirector.raspbian.org/raspbian/ jessie/main libdbd-mysql-perl armhf 4.028-2+deb8u2 [113 kB]
取得:35 http://mirrordirector.raspbian.org/raspbian/ jessie/main libterm-readkey-perl armhf 2.32-1+b2 [26.1 kB]
取得:36 http://mirrordirector.raspbian.org/raspbian/ jessie/main mysql-client-5.5 armhf 5.5.53-0+deb8u1 [1,447 kB]
取得:37 http://mirrordirector.raspbian.org/raspbian/ jessie/main mysql-server-core-5.5 armhf 5.5.53-0+deb8u1 [3,448 kB]
取得:38 http://mirrordirector.raspbian.org/raspbian/ jessie/main mysql-server-5.5 armhf 5.5.53-0+deb8u1 [1,591 kB]
取得:39 http://mirrordirector.raspbian.org/raspbian/ jessie/main libperl4-corelibs-perl all 0.003-1 [43.6 kB]
取得:40 http://mirrordirector.raspbian.org/raspbian/ jessie/main lsof armhf 4.86+dfsg-1 [321 kB]
取得:41 http://mirrordirector.raspbian.org/raspbian/ jessie/main bdf2psf all 1.123 [50.4 kB]
取得:42 http://mirrordirector.raspbian.org/raspbian/ jessie/main fbterm armhf 1.7-2 [53.0 kB]
取得:43 http://mirrordirector.raspbian.org/raspbian/ jessie/main fping armhf 3.10-2 [35.2 kB]
取得:44 http://mirrordirector.raspbian.org/raspbian/ jessie/main libqdbm14 armhf 1.8.78-5+b1 [86.0 kB]
取得:45 http://mirrordirector.raspbian.org/raspbian/ jessie/main php5-common armhf 5.6.29+dfsg-0+deb8u1 [720 kB]
取得:46 http://mirrordirector.raspbian.org/raspbian/ jessie/main php5-json armhf 1.3.6-1 [16.9 kB]
取得:47 http://mirrordirector.raspbian.org/raspbian/ jessie/main php5-cli armhf 5.6.29+dfsg-0+deb8u1 [1,904 kB]
取得:48 http://mirrordirector.raspbian.org/raspbian/ jessie/main libapache2-mod-php5 armhf 5.6.29+dfsg-0+deb8u1 [1,879 kB]
取得:49 http://mirrordirector.raspbian.org/raspbian/ jessie/main libhtml-template-perl all 2.95-1 [66.8 kB]
取得:50 http://mirrordirector.raspbian.org/raspbian/ jessie/main libopenipmi0 armhf 2.0.16-1.4 [396 kB]
取得:51 http://mirrordirector.raspbian.org/raspbian/ jessie/main lv armhf 4.51-2.2 [311 kB]
取得:52 http://mirrordirector.raspbian.org/raspbian/ jessie/main manpages-ja all 0.5.0.0.20140515+dfsg-1 [3,607 kB]
取得:53 http://mirrordirector.raspbian.org/raspbian/ jessie/main php5 all 5.6.29+dfsg-0+deb8u1 [1,312 B]
取得:54 http://mirrordirector.raspbian.org/raspbian/ jessie/main task-japanese all 3.31+deb8u1 [884 B]
取得:55 http://mirrordirector.raspbian.org/raspbian/ jessie/main manpages-ja-dev all 0.5.0.0.20140515+dfsg-1 [2,274 kB]
取得:56 http://mirrordirector.raspbian.org/raspbian/ jessie/main mysql-server all 5.5.53-0+deb8u1 [73.8 kB]
取得:57 http://mirrordirector.raspbian.org/raspbian/ jessie/main nkf armhf 2.13-4 [121 kB]
取得:58 http://mirrordirector.raspbian.org/raspbian/ jessie/main php5-gd armhf 5.6.29+dfsg-0+deb8u1 [23.2 kB]
取得:59 http://mirrordirector.raspbian.org/raspbian/ jessie/main php5-ldap armhf 5.6.29+dfsg-0+deb8u1 [19.0 kB]
取得:60 http://mirrordirector.raspbian.org/raspbian/ jessie/main php5-mysql armhf 5.6.29+dfsg-0+deb8u1 [52.2 kB]
取得:61 http://mirrordirector.raspbian.org/raspbian/ jessie/main php5-readline armhf 5.6.29+dfsg-0+deb8u1 [11.2 kB]
取得:62 http://mirrordirector.raspbian.org/raspbian/ jessie/main psf-unifont all 1:7.0.06-1 [35.0 kB]
取得:63 http://mirrordirector.raspbian.org/raspbian/ jessie/main snmpd armhf 5.7.2.1+dfsg-1 [56.8 kB]
取得:64 http://mirrordirector.raspbian.org/raspbian/ jessie/main ssl-cert all 1.0.35 [20.9 kB]
取得:65 http://mirrordirector.raspbian.org/raspbian/ jessie/main ttf-dejavu-core all 2.34-1 [30.7 kB]
取得:66 http://mirrordirector.raspbian.org/raspbian/ jessie/main x11-common all 1:7.7+7 [287 kB]
取得:67 http://mirrordirector.raspbian.org/raspbian/ jessie/main xfonts-encodings all 1:1.0.4-2 [574 kB]
取得:68 http://mirrordirector.raspbian.org/raspbian/ jessie/main xfonts-utils armhf 1:7.7+2 [68.8 kB]
取得:69 http://mirrordirector.raspbian.org/raspbian/ jessie/main ttf-unifont all 1:7.0.06-1 [4,963 kB]
取得:70 http://mirrordirector.raspbian.org/raspbian/ jessie/main xfonts-unifont all 1:7.0.06-1 [2,679 kB]
取得:71 http://mirrordirector.raspbian.org/raspbian/ jessie/main unifont all 1:7.0.06-1 [1,419 kB]
取得:72 http://mirrordirector.raspbian.org/raspbian/ jessie/main zabbix-frontend-php all 1:2.2.7+dfsg-2+deb8u1 [2,901 kB]
取得:73 http://mirrordirector.raspbian.org/raspbian/ jessie/main zabbix-server-mysql armhf 1:2.2.7+dfsg-2+deb8u1 [1,696 kB]
43.9 MB を 1分 11秒 で取得しました (617 kB/s)                                  
パッケージからテンプレートを展開しています: 100%
パッケージを事前設定しています ...

↓rootアカウントのパスワードを設定します。
 ┌───────────────────┤ mysql-server-5.5 を設定しています ├───────────────────┐
 │ 強制ではありませんが、MySQL を管理する &quot;root&quot; ユーザのパスワードを設定す  │ 
 │ ることを強くお勧めします。                                                │ 
 │                                                                           │ 
 │ この値を空のままにしておいた場合は、パスワードは変更されません。          │ 
 │                                                                           │ 
 │ MySQL の &quot;root&quot; ユーザに対する新しいパスワード:                           │ 
 │                                                                           │ 
 │ _________________________________________________________________________ │ 
 │                                                                           │ 
 │                                  &lt;了解&gt;                                   │ 
 │                                                                           │ 
 └───────────────────────────────────────────────────────────────────────────┘ 

↓再度rootアカウントのパスワードを入力します。
 ┌──────┤ mysql-server-5.5 を設定しています ├───────┐
 │                                                  │ 
 │                                                  │ 
 │ MySQL の &quot;root&quot; ユーザに対する新しいパスワード:  │ 
 │                                                  │ 
 │ ________________________________________________ │ 
 │                                                  │ 
 │                      &lt;了解&gt;                      │ 
 │                                                  │ 
 └──────────────────────────────────────────────────┘ 

以前に未選択のパッケージ libpci3:armhf を選択しています。
(データベースを読み込んでいます ... 現在 31244 個のファイルとディレクトリがインストールされています。)
.../libpci3_1%3a3.2.1-3_armhf.deb を展開する準備をしています ...
libpci3:armhf (1:3.2.1-3) を展開しています...
以前に未選択のパッケージ libapr1:armhf を選択しています。
.../libapr1_1.5.1-3_armhf.deb を展開する準備をしています ...
libapr1:armhf (1.5.1-3) を展開しています...
以前に未選択のパッケージ libaprutil1:armhf を選択しています。
.../libaprutil1_1.5.4-1_armhf.deb を展開する準備をしています ...
libaprutil1:armhf (1.5.4-1) を展開しています...
以前に未選択のパッケージ libaprutil1-dbd-sqlite3:armhf を選択しています。
.../libaprutil1-dbd-sqlite3_1.5.4-1_armhf.deb を展開する準備をしています ...
libaprutil1-dbd-sqlite3:armhf (1.5.4-1) を展開しています...
以前に未選択のパッケージ libaprutil1-ldap:armhf を選択しています。
.../libaprutil1-ldap_1.5.4-1_armhf.deb を展開する準備をしています ...
libaprutil1-ldap:armhf (1.5.4-1) を展開しています...
以前に未選択のパッケージ liblua5.1-0:armhf を選択しています。
.../liblua5.1-0_5.1.5-7.1_armhf.deb を展開する準備をしています ...
liblua5.1-0:armhf (5.1.5-7.1) を展開しています...
以前に未選択のパッケージ apache2-bin を選択しています。
.../apache2-bin_2.4.10-10+deb8u7_armhf.deb を展開する準備をしています ...
apache2-bin (2.4.10-10+deb8u7) を展開しています...
以前に未選択のパッケージ apache2-utils を選択しています。
.../apache2-utils_2.4.10-10+deb8u7_armhf.deb を展開する準備をしています ...
apache2-utils (2.4.10-10+deb8u7) を展開しています...
以前に未選択のパッケージ apache2-data を選択しています。
.../apache2-data_2.4.10-10+deb8u7_all.deb を展開する準備をしています ...
apache2-data (2.4.10-10+deb8u7) を展開しています...
以前に未選択のパッケージ apache2 を選択しています。
.../apache2_2.4.10-10+deb8u7_armhf.deb を展開する準備をしています ...
apache2 (2.4.10-10+deb8u7) を展開しています...
以前に未選択のパッケージ libaio1:armhf を選択しています。
.../libaio1_0.3.110-1_armhf.deb を展開する準備をしています ...
libaio1:armhf (0.3.110-1) を展開しています...
以前に未選択のパッケージ libcurl3-gnutls:armhf を選択しています。
.../libcurl3-gnutls_7.38.0-4+deb8u5_armhf.deb を展開する準備をしています ...
libcurl3-gnutls:armhf (7.38.0-4+deb8u5) を展開しています...
以前に未選択のパッケージ fonts-dejavu-core を選択しています。
.../fonts-dejavu-core_2.34-1_all.deb を展開する準備をしています ...
fonts-dejavu-core (2.34-1) を展開しています...
以前に未選択のパッケージ fontconfig-config を選択しています。
.../fontconfig-config_2.11.0-6.3+deb8u1_all.deb を展開する準備をしています ...
fontconfig-config (2.11.0-6.3+deb8u1) を展開しています...
以前に未選択のパッケージ libfontconfig1:armhf を選択しています。
.../libfontconfig1_2.11.0-6.3+deb8u1_armhf.deb を展開する準備をしています ...
libfontconfig1:armhf (2.11.0-6.3+deb8u1) を展開しています...
以前に未選択のパッケージ libfontenc1:armhf を選択しています。
.../libfontenc1_1%3a1.1.2-1_armhf.deb を展開する準備をしています ...
libfontenc1:armhf (1:1.1.2-1) を展開しています...
以前に未選択のパッケージ libjbig0:armhf を選択しています。
.../libjbig0_2.1-3.1_armhf.deb を展開する準備をしています ...
libjbig0:armhf (2.1-3.1) を展開しています...
以前に未選択のパッケージ libtiff5:armhf を選択しています。
.../libtiff5_4.0.3-12.3+deb8u1_armhf.deb を展開する準備をしています ...
libtiff5:armhf (4.0.3-12.3+deb8u1) を展開しています...
以前に未選択のパッケージ libvpx1:armhf を選択しています。
.../libvpx1_1.3.0-3+rvt_armhf.deb を展開する準備をしています ...
libvpx1:armhf (1.3.0-3+rvt) を展開しています...
以前に未選択のパッケージ libxpm4:armhf を選択しています。
.../libxpm4_1%3a3.5.11-1_armhf.deb を展開する準備をしています ...
libxpm4:armhf (1:3.5.11-1) を展開しています...
以前に未選択のパッケージ libgd3:armhf を選択しています。
.../libgd3_2.1.0-5+deb8u8_armhf.deb を展開する準備をしています ...
libgd3:armhf (2.1.0-5+deb8u8) を展開しています...
以前に未選択のパッケージ libiksemel3:armhf を選択しています。
.../libiksemel3_1.4-2_armhf.deb を展開する準備をしています ...
libiksemel3:armhf (1.4-2) を展開しています...
以前に未選択のパッケージ libltdl7:armhf を選択しています。
.../libltdl7_2.4.2-1.11_armhf.deb を展開する準備をしています ...
libltdl7:armhf (2.4.2-1.11) を展開しています...
以前に未選択のパッケージ mysql-common を選択しています。
.../mysql-common_5.5.53-0+deb8u1_all.deb を展開する準備をしています ...
mysql-common (5.5.53-0+deb8u1) を展開しています...
以前に未選択のパッケージ libmysqlclient18:armhf を選択しています。
.../libmysqlclient18_5.5.53-0+deb8u1_armhf.deb を展開する準備をしています ...
libmysqlclient18:armhf (5.5.53-0+deb8u1) を展開しています...
以前に未選択のパッケージ libodbc1:armhf を選択しています。
.../libodbc1_2.3.1-3_armhf.deb を展開する準備をしています ...
libodbc1:armhf (2.3.1-3) を展開しています...
以前に未選択のパッケージ libonig2:armhf を選択しています。
.../libonig2_5.9.5-3.2_armhf.deb を展開する準備をしています ...
libonig2:armhf (5.9.5-3.2) を展開しています...
以前に未選択のパッケージ libsensors4:armhf を選択しています。
.../libsensors4_1%3a3.3.5-2_armhf.deb を展開する準備をしています ...
libsensors4:armhf (1:3.3.5-2) を展開しています...
以前に未選択のパッケージ libperl5.20 を選択しています。
.../libperl5.20_5.20.2-3+deb8u6_armhf.deb を展開する準備をしています ...
libperl5.20 (5.20.2-3+deb8u6) を展開しています...
以前に未選択のパッケージ libsnmp-base を選択しています。
.../libsnmp-base_5.7.2.1+dfsg-1_all.deb を展開する準備をしています ...
libsnmp-base (5.7.2.1+dfsg-1) を展開しています...
以前に未選択のパッケージ libsnmp30:armhf を選択しています。
.../libsnmp30_5.7.2.1+dfsg-1_armhf.deb を展開する準備をしています ...
libsnmp30:armhf (5.7.2.1+dfsg-1) を展開しています...
以前に未選択のパッケージ libdbi-perl を選択しています。
.../libdbi-perl_1.631-3+b1_armhf.deb を展開する準備をしています ...
libdbi-perl (1.631-3+b1) を展開しています...
以前に未選択のパッケージ libdbd-mysql-perl を選択しています。
.../libdbd-mysql-perl_4.028-2+deb8u2_armhf.deb を展開する準備をしています ...
libdbd-mysql-perl (4.028-2+deb8u2) を展開しています...
以前に未選択のパッケージ libterm-readkey-perl を選択しています。
.../libterm-readkey-perl_2.32-1+b2_armhf.deb を展開する準備をしています ...
libterm-readkey-perl (2.32-1+b2) を展開しています...
以前に未選択のパッケージ mysql-client-5.5 を選択しています。
.../mysql-client-5.5_5.5.53-0+deb8u1_armhf.deb を展開する準備をしています ...
mysql-client-5.5 (5.5.53-0+deb8u1) を展開しています...
以前に未選択のパッケージ mysql-server-core-5.5 を選択しています。
.../mysql-server-core-5.5_5.5.53-0+deb8u1_armhf.deb を展開する準備をしています ...
mysql-server-core-5.5 (5.5.53-0+deb8u1) を展開しています...
man-db (2.7.0.2-5) のトリガを処理しています ...
systemd (215-17+deb8u5) のトリガを処理しています ...
mysql-common (5.5.53-0+deb8u1) を設定しています ...
以前に未選択のパッケージ mysql-server-5.5 を選択しています。
(データベースを読み込んでいます ... 現在 32643 個のファイルとディレクトリがインストールされています。)
.../mysql-server-5.5_5.5.53-0+deb8u1_armhf.deb を展開する準備をしています ...
mysql-server-5.5 (5.5.53-0+deb8u1) を展開しています...
以前に未選択のパッケージ libperl4-corelibs-perl を選択しています。
.../libperl4-corelibs-perl_0.003-1_all.deb を展開する準備をしています ...
libperl4-corelibs-perl (0.003-1) を展開しています...
以前に未選択のパッケージ lsof を選択しています。
.../lsof_4.86+dfsg-1_armhf.deb を展開する準備をしています ...
lsof (4.86+dfsg-1) を展開しています...
以前に未選択のパッケージ bdf2psf を選択しています。
.../archives/bdf2psf_1.123_all.deb を展開する準備をしています ...
bdf2psf (1.123) を展開しています...
以前に未選択のパッケージ fbterm を選択しています。
.../fbterm_1.7-2_armhf.deb を展開する準備をしています ...
fbterm (1.7-2) を展開しています...
以前に未選択のパッケージ fping を選択しています。
.../fping_3.10-2_armhf.deb を展開する準備をしています ...
fping (3.10-2) を展開しています...
以前に未選択のパッケージ libqdbm14 を選択しています。
.../libqdbm14_1.8.78-5+b1_armhf.deb を展開する準備をしています ...
libqdbm14 (1.8.78-5+b1) を展開しています...
以前に未選択のパッケージ php5-common を選択しています。
.../php5-common_5.6.29+dfsg-0+deb8u1_armhf.deb を展開する準備をしています ...
php5-common (5.6.29+dfsg-0+deb8u1) を展開しています...
以前に未選択のパッケージ php5-json を選択しています。
.../php5-json_1.3.6-1_armhf.deb を展開する準備をしています ...
php5-json (1.3.6-1) を展開しています...
以前に未選択のパッケージ php5-cli を選択しています。
.../php5-cli_5.6.29+dfsg-0+deb8u1_armhf.deb を展開する準備をしています ...
php5-cli (5.6.29+dfsg-0+deb8u1) を展開しています...
以前に未選択のパッケージ libapache2-mod-php5 を選択しています。
.../libapache2-mod-php5_5.6.29+dfsg-0+deb8u1_armhf.deb を展開する準備をしています ...
libapache2-mod-php5 (5.6.29+dfsg-0+deb8u1) を展開しています...
以前に未選択のパッケージ libhtml-template-perl を選択しています。
.../libhtml-template-perl_2.95-1_all.deb を展開する準備をしています ...
libhtml-template-perl (2.95-1) を展開しています...
以前に未選択のパッケージ libopenipmi0 を選択しています。
.../libopenipmi0_2.0.16-1.4_armhf.deb を展開する準備をしています ...
libopenipmi0 (2.0.16-1.4) を展開しています...
以前に未選択のパッケージ libxfont1:armhf を選択しています。
.../libxfont1_1%3a1.5.2-1_armhf.deb を展開する準備をしています ...
libxfont1:armhf (1:1.5.2-1) を展開しています...
以前に未選択のパッケージ lv を選択しています。
.../archives/lv_4.51-2.2_armhf.deb を展開する準備をしています ...
lv (4.51-2.2) を展開しています...
以前に未選択のパッケージ manpages-ja を選択しています。
.../manpages-ja_0.5.0.0.20140515+dfsg-1_all.deb を展開する準備をしています ...
manpages-ja (0.5.0.0.20140515+dfsg-1) を展開しています...
以前に未選択のパッケージ manpages-ja-dev を選択しています。
.../manpages-ja-dev_0.5.0.0.20140515+dfsg-1_all.deb を展開する準備をしています ...
manpages-ja-dev (0.5.0.0.20140515+dfsg-1) を展開しています...
以前に未選択のパッケージ mysql-server を選択しています。
.../mysql-server_5.5.53-0+deb8u1_all.deb を展開する準備をしています ...
mysql-server (5.5.53-0+deb8u1) を展開しています...
以前に未選択のパッケージ nkf を選択しています。
.../archives/nkf_2.13-4_armhf.deb を展開する準備をしています ...
nkf (2.13-4) を展開しています...
以前に未選択のパッケージ php5 を選択しています。
.../php5_5.6.29+dfsg-0+deb8u1_all.deb を展開する準備をしています ...
php5 (5.6.29+dfsg-0+deb8u1) を展開しています...
以前に未選択のパッケージ php5-gd を選択しています。
.../php5-gd_5.6.29+dfsg-0+deb8u1_armhf.deb を展開する準備をしています ...
php5-gd (5.6.29+dfsg-0+deb8u1) を展開しています...
以前に未選択のパッケージ php5-ldap を選択しています。
.../php5-ldap_5.6.29+dfsg-0+deb8u1_armhf.deb を展開する準備をしています ...
php5-ldap (5.6.29+dfsg-0+deb8u1) を展開しています...
以前に未選択のパッケージ php5-mysql を選択しています。
.../php5-mysql_5.6.29+dfsg-0+deb8u1_armhf.deb を展開する準備をしています ...
php5-mysql (5.6.29+dfsg-0+deb8u1) を展開しています...
以前に未選択のパッケージ php5-readline を選択しています。
.../php5-readline_5.6.29+dfsg-0+deb8u1_armhf.deb を展開する準備をしています ...
php5-readline (5.6.29+dfsg-0+deb8u1) を展開しています...
以前に未選択のパッケージ psf-unifont を選択しています。
.../psf-unifont_1%3a7.0.06-1_all.deb を展開する準備をしています ...
psf-unifont (1:7.0.06-1) を展開しています...
以前に未選択のパッケージ snmpd を選択しています。
.../snmpd_5.7.2.1+dfsg-1_armhf.deb を展開する準備をしています ...
snmpd (5.7.2.1+dfsg-1) を展開しています...
以前に未選択のパッケージ ssl-cert を選択しています。
.../ssl-cert_1.0.35_all.deb を展開する準備をしています ...
ssl-cert (1.0.35) を展開しています...
以前に未選択のパッケージ task-japanese を選択しています。
.../task-japanese_3.31+deb8u1_all.deb を展開する準備をしています ...
task-japanese (3.31+deb8u1) を展開しています...
以前に未選択のパッケージ ttf-dejavu-core を選択しています。
.../ttf-dejavu-core_2.34-1_all.deb を展開する準備をしています ...
ttf-dejavu-core (2.34-1) を展開しています...
以前に未選択のパッケージ x11-common を選択しています。
.../x11-common_1%3a7.7+7_all.deb を展開する準備をしています ...
x11-common (1:7.7+7) を展開しています...
以前に未選択のパッケージ xfonts-encodings を選択しています。
.../xfonts-encodings_1%3a1.0.4-2_all.deb を展開する準備をしています ...
xfonts-encodings (1:1.0.4-2) を展開しています...
以前に未選択のパッケージ xfonts-utils を選択しています。
.../xfonts-utils_1%3a7.7+2_armhf.deb を展開する準備をしています ...
xfonts-utils (1:7.7+2) を展開しています...
以前に未選択のパッケージ ttf-unifont を選択しています。
.../ttf-unifont_1%3a7.0.06-1_all.deb を展開する準備をしています ...
ttf-unifont (1:7.0.06-1) を展開しています...
以前に未選択のパッケージ xfonts-unifont を選択しています。
.../xfonts-unifont_1%3a7.0.06-1_all.deb を展開する準備をしています ...
xfonts-unifont (1:7.0.06-1) を展開しています...
以前に未選択のパッケージ unifont を選択しています。
.../unifont_1%3a7.0.06-1_all.deb を展開する準備をしています ...
unifont (1:7.0.06-1) を展開しています...
以前に未選択のパッケージ zabbix-frontend-php を選択しています。
.../zabbix-frontend-php_1%3a2.2.7+dfsg-2+deb8u1_all.deb を展開する準備をしています ...
zabbix-frontend-php (1:2.2.7+dfsg-2+deb8u1) を展開しています...
以前に未選択のパッケージ zabbix-server-mysql を選択しています。
.../zabbix-server-mysql_1%3a2.2.7+dfsg-2+deb8u1_armhf.deb を展開する準備をしています ...
zabbix-server-mysql (1:2.2.7+dfsg-2+deb8u1) を展開しています...
man-db (2.7.0.2-5) のトリガを処理しています ...
systemd (215-17+deb8u5) のトリガを処理しています ...
libc-bin (2.19-18+deb8u6) のトリガを処理しています ...
libpci3:armhf (1:3.2.1-3) を設定しています ...
libapr1:armhf (1.5.1-3) を設定しています ...
libaprutil1:armhf (1.5.4-1) を設定しています ...
libaprutil1-dbd-sqlite3:armhf (1.5.4-1) を設定しています ...
libaprutil1-ldap:armhf (1.5.4-1) を設定しています ...
liblua5.1-0:armhf (5.1.5-7.1) を設定しています ...
apache2-bin (2.4.10-10+deb8u7) を設定しています ...
apache2-utils (2.4.10-10+deb8u7) を設定しています ...
apache2-data (2.4.10-10+deb8u7) を設定しています ...
apache2 (2.4.10-10+deb8u7) を設定しています ...
Enabling module mpm_event.
Enabling module authz_core.
Enabling module authz_host.
Enabling module authn_core.
Enabling module auth_basic.
Enabling module access_compat.
Enabling module authn_file.
Enabling module authz_user.
Enabling module alias.
Enabling module dir.
Enabling module autoindex.
Enabling module env.
Enabling module mime.
Enabling module negotiation.
Enabling module setenvif.
Enabling module filter.
Enabling module deflate.
Enabling module status.
Enabling conf charset.
Enabling conf localized-error-pages.
Enabling conf other-vhosts-access-log.
Enabling conf security.
Enabling conf serve-cgi-bin.
Enabling site 000-default.
libaio1:armhf (0.3.110-1) を設定しています ...
libcurl3-gnutls:armhf (7.38.0-4+deb8u5) を設定しています ...
fonts-dejavu-core (2.34-1) を設定しています ...
fontconfig-config (2.11.0-6.3+deb8u1) を設定しています ...
libfontconfig1:armhf (2.11.0-6.3+deb8u1) を設定しています ...
libfontenc1:armhf (1:1.1.2-1) を設定しています ...
libjbig0:armhf (2.1-3.1) を設定しています ...
libtiff5:armhf (4.0.3-12.3+deb8u1) を設定しています ...
libvpx1:armhf (1.3.0-3+rvt) を設定しています ...
libxpm4:armhf (1:3.5.11-1) を設定しています ...
libgd3:armhf (2.1.0-5+deb8u8) を設定しています ...
libiksemel3:armhf (1.4-2) を設定しています ...
libltdl7:armhf (2.4.2-1.11) を設定しています ...
libmysqlclient18:armhf (5.5.53-0+deb8u1) を設定しています ...
libodbc1:armhf (2.3.1-3) を設定しています ...
libonig2:armhf (5.9.5-3.2) を設定しています ...
libsensors4:armhf (1:3.3.5-2) を設定しています ...
libperl5.20 (5.20.2-3+deb8u6) を設定しています ...
libsnmp-base (5.7.2.1+dfsg-1) を設定しています ...
libsnmp30:armhf (5.7.2.1+dfsg-1) を設定しています ...
libdbi-perl (1.631-3+b1) を設定しています ...
libdbd-mysql-perl (4.028-2+deb8u2) を設定しています ...
libterm-readkey-perl (2.32-1+b2) を設定しています ...
mysql-client-5.5 (5.5.53-0+deb8u1) を設定しています ...
mysql-server-core-5.5 (5.5.53-0+deb8u1) を設定しています ...
mysql-server-5.5 (5.5.53-0+deb8u1) を設定しています ...
170108 22:06:42 [Warning] Using unique option prefix key_buffer instead of key_buffer_size is deprecated and will be removed in a future release. Please use the full name instead.
170108 22:06:42 [Note] Ignoring --secure-file-priv value as server is running with --bootstrap.
170108 22:06:42 [Note] /usr/sbin/mysqld (mysqld 5.5.53-0+deb8u1) starting as process 14599 ...
libperl4-corelibs-perl (0.003-1) を設定しています ...
lsof (4.86+dfsg-1) を設定しています ...
bdf2psf (1.123) を設定しています ...
fbterm (1.7-2) を設定しています ...
fping (3.10-2) を設定しています ...
libqdbm14 (1.8.78-5+b1) を設定しています ...
php5-common (5.6.29+dfsg-0+deb8u1) を設定しています ...

Creating config file /etc/php5/mods-available/pdo.ini with new version
php5_invoke: Enable module pdo for cli SAPI
php5_invoke: Enable module pdo for apache2 SAPI

Creating config file /etc/php5/mods-available/opcache.ini with new version
php5_invoke: Enable module opcache for cli SAPI
php5_invoke: Enable module opcache for apache2 SAPI
php5-json (1.3.6-1) を設定しています ...
php5_invoke: Enable module json for cli SAPI
php5_invoke: Enable module json for apache2 SAPI
php5-cli (5.6.29+dfsg-0+deb8u1) を設定しています ...
update-alternatives: /usr/bin/php (php) を提供するために自動モードで /usr/bin/php5 を使います
update-alternatives: /usr/bin/phar (phar) を提供するために自動モードで /usr/bin/phar5 を使います

Creating config file /etc/php5/cli/php.ini with new version
libapache2-mod-php5 (5.6.29+dfsg-0+deb8u1) を設定しています ...

Creating config file /etc/php5/apache2/php.ini with new version
Module mpm_event disabled.
Enabling module mpm_prefork.
apache2_switch_mpm Switch to prefork
apache2_invoke: Enable module php5
libhtml-template-perl (2.95-1) を設定しています ...
libopenipmi0 (2.0.16-1.4) を設定しています ...
libxfont1:armhf (1:1.5.2-1) を設定しています ...
lv (4.51-2.2) を設定しています ...
manpages-ja (0.5.0.0.20140515+dfsg-1) を設定しています ...
manpages-ja-dev (0.5.0.0.20140515+dfsg-1) を設定しています ...
mysql-server (5.5.53-0+deb8u1) を設定しています ...
nkf (2.13-4) を設定しています ...
php5 (5.6.29+dfsg-0+deb8u1) を設定しています ...
php5-gd (5.6.29+dfsg-0+deb8u1) を設定しています ...

Creating config file /etc/php5/mods-available/gd.ini with new version
php5_invoke: Enable module gd for cli SAPI
php5_invoke: Enable module gd for apache2 SAPI
php5-ldap (5.6.29+dfsg-0+deb8u1) を設定しています ...

Creating config file /etc/php5/mods-available/ldap.ini with new version
php5_invoke: Enable module ldap for cli SAPI
php5_invoke: Enable module ldap for apache2 SAPI
php5-mysql (5.6.29+dfsg-0+deb8u1) を設定しています ...

Creating config file /etc/php5/mods-available/mysql.ini with new version
php5_invoke: Enable module mysql for cli SAPI
php5_invoke: Enable module mysql for apache2 SAPI

Creating config file /etc/php5/mods-available/mysqli.ini with new version
php5_invoke: Enable module mysqli for cli SAPI
php5_invoke: Enable module mysqli for apache2 SAPI

Creating config file /etc/php5/mods-available/pdo_mysql.ini with new version
php5_invoke: Enable module pdo_mysql for cli SAPI
php5_invoke: Enable module pdo_mysql for apache2 SAPI
php5-readline (5.6.29+dfsg-0+deb8u1) を設定しています ...

Creating config file /etc/php5/mods-available/readline.ini with new version
php5_invoke: Enable module readline for cli SAPI
php5_invoke: Enable module readline for apache2 SAPI
psf-unifont (1:7.0.06-1) を設定しています ...
snmpd (5.7.2.1+dfsg-1) を設定しています ...
adduser: 警告: ホームディレクトリ `/var/lib/snmp' は、現在作成中のユーザの所属になっていません。
ssl-cert (1.0.35) を設定しています ...
task-japanese (3.31+deb8u1) を設定しています ...
ttf-dejavu-core (2.34-1) を設定しています ...
x11-common (1:7.7+7) を設定しています ...
update-rc.d: warning: start and stop actions are no longer supported; falling back to defaults
xfonts-encodings (1:1.0.4-2) を設定しています ...
xfonts-utils (1:7.7+2) を設定しています ...
ttf-unifont (1:7.0.06-1) を設定しています ...
xfonts-unifont (1:7.0.06-1) を設定しています ...
unifont (1:7.0.06-1) を設定しています ...
zabbix-frontend-php (1:2.2.7+dfsg-2+deb8u1) を設定しています ...
zabbix-server-mysql (1:2.2.7+dfsg-2+deb8u1) を設定しています ...

Creating config file /etc/zabbix/zabbix_server.conf with new version
libc-bin (2.19-18+deb8u6) のトリガを処理しています ...
systemd (215-17+deb8u5) のトリガを処理しています ...
libapache2-mod-php5 (5.6.29+dfsg-0+deb8u1) のトリガを処理しています ...
$
</code></pre>

<h3 id="mysqlの初期設定:d408cd6d355b48aec871928776dae66b">MySQLの初期設定</h3>

<p>MySQLのセキュア設定</p>

<pre><code>$ mysql_secure_installation 




NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MySQL
      SERVERS IN PRODUCTION USE!  PLEASE READ EACH STEP CAREFULLY!


In order to log into MySQL to secure it, we'll need the current
password for the root user.  If you've just installed MySQL, and
you haven't set the root password yet, the password will be blank,
so you should just press enter here.

Enter current password for root (enter for none): 
OK, successfully used password, moving on...

Setting the root password ensures that nobody can log into the MySQL
root user without the proper authorisation.

You already have a root password set, so you can safely answer 'n'.

Change the root password? [Y/n] n
 ... skipping.

By default, a MySQL installation has an anonymous user, allowing anyone
to log into MySQL without having to have a user account created for
them.  This is intended only for testing, and to make the installation
go a bit smoother.  You should remove them before moving into a
production environment.

Remove anonymous users? [Y/n] Y
 ... Success!

Normally, root should only be allowed to connect from 'localhost'.  This
ensures that someone cannot guess at the root password from the network.

Disallow root login remotely? [Y/n] Y
 ... Success!

By default, MySQL comes with a database named 'test' that anyone can
access.  This is also intended only for testing, and should be removed
before moving into a production environment.

Remove test database and access to it? [Y/n] Y
 - Dropping test database...
ERROR 1008 (HY000) at line 1: Can't drop database 'test'; database doesn't exist
 ... Failed!  Not critical, keep moving...
 - Removing privileges on test database...
 ... Success!

Reloading the privilege tables will ensure that all changes made so far
will take effect immediately.

Reload privilege tables now? [Y/n] Y
 ... Success!

Cleaning up...



All done!  If you've completed all of the above steps, your MySQL
installation should now be secure.

Thanks for using MySQL!


</code></pre>

<p>MySQLの初期設定</p>

<pre><code>$ sudo cp -p /etc/mysql/my.cnf{,.org}
$ ls -l /etc/mysql/my.cnf*
-rw-r--r-- 1 root root 3533 10月 17 17:49 /etc/mysql/my.cnf
-rw-r--r-- 1 root root 3533 10月 17 17:49 /etc/mysql/my.cnf.org
$
$ sudo vi /etc/mysql/my.cnf
[mysqld]
# Add the following line to last of mysqld section
character-set-server=utf8
collation-server=utf8_general_ci
skip-character-set-client-handshake
default-storage-engine=InnoDB
innodb_file_per_table
innodb_buffer_pool_size=256M
skip-name-resolve

[mysqldump]
# Add the following line to last of mysqldump section
default-character-set=utf8

[mysql]
# Add the following line to last of mysql section
default-character-set=utf8
</code></pre>

<ul>
<li><a href="https://dev.mysql.com/doc/refman/5.5/en/server-system-variables.html">MySQL :: MySQL 5.5 Reference Manual :: 5.1.4 Server System Variables</a></li>
</ul>

<p>MySQLの再起動</p>

<pre><code>$ sudo systemctl restart mysql
$ sudo systemctl enable mysql
Synchronizing state for mysql.service with sysvinit using update-rc.d...
Executing /usr/sbin/update-rc.d mysql defaults
Executing /usr/sbin/update-rc.d mysql enable
$
</code></pre>

<h3 id="apache2の初期設定:d408cd6d355b48aec871928776dae66b">Apache2の初期設定</h3>

<p>Apache2のセキュリティ設定</p>

<pre><code>$ sudo cp -p /etc/apache2/conf-available/security.conf{,.org}
$ ls -l /etc/apache2/conf-available/security.conf*
-rw-r--r-- 1 root root 2190  8月  7 19:56 /etc/apache2/conf-available/security.conf
-rw-r--r-- 1 root root 2190  8月  7 19:56 /etc/apache2/conf-available/security.conf.org
$
$ sudo vi /etc/apache2/conf-available/security.conf
ServerTokens Prod
ServerSignature Off
$
</code></pre>

<p>Apache2の文字コード設定</p>

<pre><code>$ sudo cp -p /etc/apache2/conf-available/charset.conf{,.org}
$ ls -l /etc/apache2/conf-available/charset.conf*
-rw-r--r-- 1 root root 315  7月  6  2016 /etc/apache2/conf-available/charset.conf
-rw-r--r-- 1 root root 315  7月  6  2016 /etc/apache2/conf-available/charset.conf.org
$
$ sudo vi /etc/apache2/conf-available/charset.conf
#AddDefaultCharset UTF-8
$
</code></pre>

<p>Apache2のServerName設定</p>

<pre><code>$ sudo sh -c &quot;echo ServerName ${HOSTNAME} &gt; /etc/apache2/conf-available/fqdn.conf&quot;
$ sudo a2enconf fqdn
Enabling conf fqdn.
To activate the new configuration, you need to run:
  service apache2 reload
$
</code></pre>

<p>Apache2の再起動</p>

<pre><code>$ sudo apachectl configtest
Syntax OK
$
$ sudo systemctl restart apache2
$ sudo systemctl enable apache2
Synchronizing state for apache2.service with sysvinit using update-rc.d...
Executing /usr/sbin/update-rc.d apache2 defaults
Executing /usr/sbin/update-rc.d apache2 enable
$
</code></pre>

<h3 id="zabbix-serverの設定:d408cd6d355b48aec871928776dae66b">Zabbix Serverの設定</h3>

<p>データベースの作成</p>

<pre><code>$ mysql -uroot -p
Enter password: 
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 37
Server version: 5.5.53-0+deb8u1 (Raspbian)

Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt; 
mysql&gt; create database zabbix character set utf8 collate utf8_bin;
Query OK, 1 row affected (0.00 sec)

mysql&gt; 
mysql&gt; grant all privileges on zabbix.* to zabbix@localhost identified by 'zabbix_password';
Query OK, 0 rows affected (0.01 sec)

mysql&gt; 
mysql&gt; quit
Bye
$
$ zcat /usr/share/zabbix-server-mysql/schema.sql.gz | mysql -uzabbix -p zabbix
Enter password: 
$
$ zcat /usr/share/zabbix-server-mysql/images.sql.gz | mysql -uzabbix -p zabbix
Enter password: 
$
$ zcat /usr/share/zabbix-server-mysql/data.sql.gz | mysql -uzabbix -p zabbix
Enter password: 
$
</code></pre>

<p>Apache2のZabbixサイト設定</p>

<pre><code>$ sudo cp -p /usr/share/doc/zabbix-frontend-php/examples/apache.conf /etc/apache2/conf-available/zabbix.conf
$
$ sudo vi /etc/apache2/conf-available/zabbix.conf
php_value max_execution_time 300
php_value memory_limit 128M
php_value post_max_size 16M
php_value upload_max_filesize 2M
php_value max_input_time 300
php_value date.timezone Asia/Tokyo
$
$ cat /etc/apache2/conf-available/zabbix.conf
# Define /zabbix alias, this is the default
&lt;IfModule mod_alias.c&gt;
    Alias /zabbix /usr/share/zabbix
    php_value max_execution_time 300
    php_value memory_limit 128M
    php_value post_max_size 16M
    php_value upload_max_filesize 2M
    php_value max_input_time 300
    php_value date.timezone Asia/Tokyo
&lt;/IfModule&gt;
$
$ sudo a2enconf zabbix
Enabling conf zabbix.
To activate the new configuration, you need to run:
  service apache2 reload
$
$ sudo apachectl configtest
Syntax OK
$
$ sudo systemctl restart apache2
$
</code></pre>

<h3 id="zabbixのサーバ設定:d408cd6d355b48aec871928776dae66b">Zabbixのサーバ設定</h3>

<pre><code>$ sudo cp -p /etc/zabbix/zabbix_server.conf{,.org}
$ ls -l /etc/zabbix/zabbix_server.conf*
-rw-r--r-- 1 root root 12634  9月 18 03:38 /etc/zabbix/zabbix_server.conf
-rw-r--r-- 1 root root 12634  9月 18 03:38 /etc/zabbix/zabbix_server.conf.org
$
$ sudo vi /etc/zabbix/zabbix_server.conf
DBHost=localhost
DBName=zabbix
DBUser=zabbix
DBPassword=zabbix_password
$
$ sudo cp -p /etc/default/zabbix-server{,.org}
$ ls -l /etc/default/zabbix-server*
-rw-r--r-- 1 root root 407  6月  6  2016 /etc/default/zabbix-server
-rw-r--r-- 1 root root 407  6月  6  2016 /etc/default/zabbix-server.org
$
$ sudo vi /etc/default/zabbix-server
#START=no
START=yes
$
$ sudo ln -s /usr/share/fonts/truetype/unifont/unifont.ttf /usr/share/zabbix/fonts/
$
$ sudo cp -p /usr/share/zabbix/include/defines.inc.php{,.org}
$ ls -l /usr/share/zabbix/include/defines.inc.php*
-rw-r--r-- 1 root root 30844 10月 24  2014 /usr/share/zabbix/include/defines.inc.php
-rw-r--r-- 1 root root 30844 10月 24  2014 /usr/share/zabbix/include/defines.inc.php.org
$
$ sudo vi /usr/share/zabbix/include/defines.inc.php
//define('ZBX_GRAPH_FONT_NAME',           'DejaVuSans'); // font file name
define('ZBX_GRAPH_FONT_NAME',           'unifont'); // font file name
$
</code></pre>

<p>Zabbix Serverの再起動</p>

<pre><code>$ sudo systemctl restart zabbix-server
$ sudo systemctl enable zabbix-server
Synchronizing state for zabbix-server.service with sysvinit using update-rc.d...
Executing /usr/sbin/update-rc.d zabbix-server defaults
Executing /usr/sbin/update-rc.d zabbix-server enable
$
</code></pre>

<h3 id="zabbix-serverへのアクセス:d408cd6d355b48aec871928776dae66b">Zabbix Serverへのアクセス</h3>

<p>ブラウザからZabbix ServerのURL(<code>http://IPアドレス/zabbix</code>)にアクセスします。</p>

<p>Zabbixの初期設定画面が表示されるので、画面の指示に従いながら設定を行います。</p>

<ul>
<li>1.Welcome</li>
</ul>

<p><code>Next</code>をクリックします。</p>

<p><img src="/img/20170108_01/zabbix-install-01.png" alt="zabbix-install-01" width="320px" /></p>

<ul>
<li>2.Check of pre-requisites</li>
</ul>

<p>すべて<code>OK</code>になっていることを確認して、<code>Next</code>をクリックします。</p>

<p><img src="/img/20170108_01/zabbix-install-02.png" alt="zabbix-install-02" width="320px" /></p>

<ul>
<li>3.Configure DB connection</li>
</ul>

<p>以下の情報を入力し、<code>Test connection</code>をクリックします。<code>OK</code>が表示されることを確認して、<code>Next</code>をクリックします。</p>

<pre><code>Database type: MySQL
Database host: localhost
Database port: 0
Database name: zabbix
User: zabbix
Password: zabbix_password
</code></pre>

<p><img src="/img/20170108_01/zabbix-install-05.png" alt="zabbix-install-05" width="320px" /></p>

<ul>
<li>4.Zabbix server details</li>
</ul>

<p>以下の情報を確認し、<code>Next</code>をクリックします。</p>

<pre><code>Host: localhost
Port: 10051
Name:
</code></pre>

<p><img src="/img/20170108_01/zabbix-install-06.png" alt="zabbix-install-06" width="320px" /></p>

<ul>
<li>5.Pre-Installation summary</li>
</ul>

<p>表示内容に間違いがないことを確認し、<code>Next</code>をクリックします。</p>

<p><img src="/img/20170108_01/zabbix-install-07.png" alt="zabbix-install-07" width="320px" /></p>

<ul>
<li>6.Install</li>
</ul>

<p><code>Configuration file &quot;/etc/zabbix/zabbix.conf.php&quot; created: Fail</code>と表示されます。</p>

<p><img src="/img/20170108_01/zabbix-install-08.png" alt="zabbix-install-08" width="320px" /></p>

<p>その場合は<code>Download configuration file</code>をクリックして<code>zabbix.conf.php</code>をダウンロードし、手動で<code>/etc/zabbix/</code>に配置します。</p>

<pre><code>$ ls -l /etc/zabbix/zabbix.conf.php 
-rw-r--r-- 1 root root 425  1月  8 23:17 /etc/zabbix/zabbix.conf.php
$
</code></pre>

<p><code>Retry</code>をクリックして<code>Configuration file &quot;/etc/zabbix/zabbix.conf.php&quot; created: OK</code>になったことを確認します。<code>Finish</code>をクリックします。</p>

<p><img src="/img/20170108_01/zabbix-install-09.png" alt="zabbix-install-09" width="320px" /></p>

<h3 id="zabbix-serverへのログイン:d408cd6d355b48aec871928776dae66b">Zabbix Serverへのログイン</h3>

<p>Zabbixの初期設定が完了するとログイン画面が表示されるので、デフォルトアカウント(<code>Admin/zabbix</code>)でログインします。 ログイン後は画面右上のProfileを開き、パスワードを変更しておきます。</p>

<p><img src="/img/20170108_01/zabbix-install-10.png" alt="zabbix-install-10" width="320px" /></p>

<p>以上</p>

                </div>
              </article>
              
              <article>
                <div class="title">
                  <h1><a href="http://www.shinayoshi.net/post/2017/01/07/setting-rsyslog/">家庭内インターネット接続環境を構築する その11</a></h1>
                  <p>
                    <span class="label label-primary">Sat Jan 7, 2017</span> in
                    
                    
                    <a href="http://www.shinayoshi.net//categories/server">server</a>
                     using tags
                    
                    
                    <a href="http://www.shinayoshi.net//tags/raspberrypi">raspberrypi</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/home-network">home-network</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homemon1">homemon1</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homemon2">homemon2</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homefw01">homefw01</a>
                    
                  </p>
                </div>
                <div class="contents">
                  

<p>FortiGate 60DとRaspberry Piを使用して家庭内インターネット接続環境を構築します。
最終的には以下のような構成を想定しています。</p>

<p><img src="/img/20161022_01/home-network.png" alt="home network" width="640px" /></p>

<p>前回に引き続き<code>homemon1</code>、<code>homemon2</code>を構築していきます。
FortiGate 60Dの通過ログやセキュリティイベントログを記録するためにSyslogサーバを構築します。</p>

<h2 id="rsyslogの設定:273aa48f87da59ed5cb2388af8a4171d">rsyslogの設定</h2>

<p>ネットワーク機器のSyslogを保存する用の設定</p>

<p>ネットワーク機器のIPアドレスまたはホスト名でディレクトリを作成し、IPアドレスまたはホスト名でログファイルを作成する。
例）/var/log/network-device/ホスト名/ホスト名.log</p>

<pre><code>$ sudo cp -p /etc/rsyslog.conf{,.org}
$ ls -l /etc/rsyslog.conf*
-rw-r--r-- 1 root root 2632 12月 14  2015 /etc/rsyslog.conf
-rw-r--r-- 1 root root 2632 12月 14  2015 /etc/rsyslog.conf.org
$
$ sudo vi /etc/rsyslog.conf
#$ModLoad imudp
#$UDPServerRun 514
$ModLoad imudp
$UDPServerRun 514

$WorkDirectory /var/spool/rsyslog

#
# Queue
#
$MainMsgQueueType LinkedList
#$ActionQueueType Direct

$ diff /etc/rsyslog.conf.org /etc/rsyslog.conf
16,17c16,17
&lt; #$ModLoad imudp
&lt; #$UDPServerRun 514
---
&gt; $ModLoad imudp
&gt; $UDPServerRun 514
46a47,52
&gt; 
&gt; #
&gt; # Queue
&gt; #
&gt; $MainMsgQueueType LinkedList
&gt; #$ActionQueueType Direct
$
$ sudo vi /etc/rsyslog.d/network-device.conf
$template NetworkDeviceFileName,&quot;/var/log/network-device/%hostname:::secpath-replace%/%hostname:::secpath-replace%-%$year%%$month%%$day%.log&quot;
if $fromhost-ip != '127.0.0.1' then ?NetworkDeviceFileName
&amp; ~
</code></pre>

<p>rsyslogの再起動</p>

<pre><code>$ sudo systemctl restart rsyslog
</code></pre>

<ul>
<li><a href="https://access.redhat.com/documentation/ja-JP/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/s1-working_with_queues_in_rsyslog.html">20.4. Rsyslog でのキュー (Queue) を使った操作</a></li>
</ul>

<h2 id="ログローテート:273aa48f87da59ed5cb2388af8a4171d">ログローテート</h2>

<p>ログローテートの設定</p>

<pre><code>$ sudo vi /etc/logrotate.d/network-device
/var/log/network-device/*/*.log
{
	daily
	rotate 1
	maxage 92
	nocreate
	missingok
	ifempty
	compress
	sharedscripts
}
</code></pre>

<p>logrotateをテスト実行し、エラーがないことを確認</p>

<pre><code>$ sudo logrotate -dv /etc/logrotate.d/network-device 
reading config file /etc/logrotate.d/network-device

Handling 1 logs

rotating pattern: /var/log/network-device/*/*.log
 after 1 days (92 rotations)
empty log files are rotated, old logs are removed
considering log /var/log/network-device/192.168.30.254/192.168.30.254.log
  log does not need rotating
not running postrotate script, since no logs were rotated
</code></pre>

<ul>
<li><a href="http://server-setting.info/centos/loglotation.html">ログローテーション(logrotate)を使ってみる ( httpd(apache)の設定例 ) | レンタルサーバー・自宅サーバー設定・構築のヒント</a></li>
<li><a href="https://open-groove.net/linux/logrotate-test/">logrotate（ログローテート）の動作確認 | OpenGroove</a></li>
</ul>

<h2 id="fortigate-60dのsyslog送信設定:273aa48f87da59ed5cb2388af8a4171d">FortiGate 60DのSyslog送信設定</h2>

<p>FortiGate 60DからSyslogサーバにsyslog送信を行うように設定</p>

<pre><code># config log syslogd setting
(setting)# set status enable
(setting)# set server &quot;192.168.30.10&quot;
(setting)# end
#
# config log syslogd setting
(setting)# set status enable
(setting)# set server &quot;192.168.30.20&quot;
(setting)# end
#
</code></pre>

<p>FortiGate 60Dのsyslog送信設定の確認</p>

<pre><code># show log syslogd setting
config log syslogd setting
	set status enable
	set server &quot;192.168.30.10&quot;
end
#
# show log syslogd2 setting
config log syslogd2 setting
	set status enable
	set server &quot;192.168.30.20&quot;
end
#
</code></pre>

<p>以上</p>

                </div>
              </article>
              
              <article>
                <div class="title">
                  <h1><a href="http://www.shinayoshi.net/post/2017/01/07/setting-ntp-server/">家庭内インターネット接続環境を構築する その10</a></h1>
                  <p>
                    <span class="label label-primary">Sat Jan 7, 2017</span> in
                    
                    
                    <a href="http://www.shinayoshi.net//categories/server">server</a>
                     using tags
                    
                    
                    <a href="http://www.shinayoshi.net//tags/raspberrypi">raspberrypi</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/home-network">home-network</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homemon1">homemon1</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homemon2">homemon2</a>
                    
                  </p>
                </div>
                <div class="contents">
                  

<p>FortiGate 60DとRaspberry Piを使用して家庭内インターネット接続環境を構築します。
最終的には以下のような構成を想定しています。</p>

<p><img src="/img/20161022_01/home-network.png" alt="home network" width="640px" /></p>

<p>今回は<code>homemon1</code>、<code>homemon2</code>を構築していきます。
まずは本環境内の機器から時刻同期を行えるようにNTPサーバを構築します。</p>

<h2 id="ntpサーバの構築:1f1fc8ca38bc68f6fa4bdfc515f760ab">NTPサーバの構築</h2>

<pre><code>$ sudo cp -p /etc/ntp.conf{,.backup20170107}
$ ls -l /etc/ntp.conf*
-rw-r--r-- 1 root root 2052  9月 23 13:25 /etc/ntp.conf
-rw-r--r-- 1 root root 2052  9月 23 13:25 /etc/ntp.conf.backup20170107
-rw-r--r-- 1 root root 1988  7月 26 07:36 /etc/ntp.conf.org
$
$ sudo vi /etc/ntp.conf
# Clients from this (example!) subnet have unlimited access, but only if
# cryptographically authenticated.
#restrict 192.168.123.0 mask 255.255.255.0 notrust
restrict 192.168.10.0 mask 255.255.255.0 nomodify notrap nopeer
restrict 192.168.20.0 mask 255.255.255.0 nomodify notrap nopeer
restrict 192.168.30.0 mask 255.255.255.0 nomodify notrap nopeer
restrict 192.168.40.0 mask 255.255.255.0 nomodify notrap nopeer
$
$ diff /etc/ntp.conf.backup20170107 /etc/ntp.conf
47a48,51
&gt; restrict 192.168.10.0 mask 255.255.255.0 nomodify notrap nopeer
&gt; restrict 192.168.20.0 mask 255.255.255.0 nomodify notrap nopeer
&gt; restrict 192.168.30.0 mask 255.255.255.0 nomodify notrap nopeer
&gt; restrict 192.168.40.0 mask 255.255.255.0 nomodify notrap nopeer
$
</code></pre>

<p>NTPサーバの再起動</p>

<pre><code>$ sudo systemctl restart ntp
</code></pre>

<p>以上</p>

                </div>
              </article>
              
              <article>
                <div class="title">
                  <h1><a href="http://www.shinayoshi.net/post/2017/01/07/setting-cowrie-security/">家庭内インターネット接続環境を構築する その9</a></h1>
                  <p>
                    <span class="label label-primary">Sat Jan 7, 2017</span> in
                    
                    
                    <a href="http://www.shinayoshi.net//categories/server">server</a>
                     using tags
                    
                    
                    <a href="http://www.shinayoshi.net//tags/raspberrypi">raspberrypi</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/home-network">home-network</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homepot1">homepot1</a>
                    
                  </p>
                </div>
                <div class="contents">
                  

<p>FortiGate 60DとRaspberry Piを使用して家庭内インターネット接続環境を構築します。
最終的には以下のような構成を想定しています。</p>

<p><img src="/img/20161022_01/home-network.png" alt="home network" width="640px" /></p>

<p>前回に引き続き<code>homepot1</code>を構築していきます。
Cowrieを使用するにあたりやっておきたいセキュリティ設定を行っていきます。</p>

<h2 id="ipv6の無効化:cb5f0701b8057bc3422a1cfa2b48de88">IPv6の無効化</h2>

<p>IPv6は使用しないため、IPv6を無効化します。</p>

<pre><code>$ sudo sysctl -w net.ipv6.conf.all.disable_ipv6=1
net.ipv6.conf.all.disable_ipv6 = 1
$
$ sudo sysctl -w net.ipv6.conf.default.disable_ipv6=1
net.ipv6.conf.default.disable_ipv6 = 1
$
$ sudo sysctl -a | grep disable_ipv6
sysctl: reading key &quot;net.ipv6.conf.all.stable_secret&quot;
net.ipv6.conf.all.disable_ipv6 = 1
sysctl: reading key &quot;net.ipv6.conf.default.stable_secret&quot;
net.ipv6.conf.default.disable_ipv6 = 1
sysctl: reading key &quot;net.ipv6.conf.eth0.stable_secret&quot;
net.ipv6.conf.eth0.disable_ipv6 = 1
sysctl: reading key &quot;net.ipv6.conf.eth1.stable_secret&quot;
net.ipv6.conf.eth1.disable_ipv6 = 1
sysctl: reading key &quot;net.ipv6.conf.lo.stable_secret&quot;
net.ipv6.conf.lo.disable_ipv6 = 1
$
</code></pre>

<p>再起動後もIPv6が無効化するように設定します。</p>

<pre><code>$ sudo vi /etc/sysctl.d/10-disableipv6.conf
net.ipv6.conf.all.disable_ipv6=1
net.ipv6.conf.default.disable_ipv6=1
</code></pre>

<h2 id="selinuxの無効化:cb5f0701b8057bc3422a1cfa2b48de88">SELinuxの無効化</h2>

<p>Raspbian(Jessie)ではデフォルトでSELinuxが使えないようなので、特にやることなし。</p>

<h2 id="iptablesの設定:cb5f0701b8057bc3422a1cfa2b48de88">iptablesの設定</h2>

<p>iptablesでfirewallを設定します。</p>

<pre><code>#Cowrieポートのポートフォワード(別手順で設定済み)
#$ sudo iptables -t nat -A PREROUTING -p tcp --dport 22 -j REDIRECT --to-port 2222

##INPUTチェーン
#IPスプーフィング対策
$ sudo iptables -A INPUT -p tcp --tcp-flags SYN,ACK SYN,ACK -m state --state NEW -j REJECT --reject-with tcp-reset

#セッションハイジャック対策
$ sudo iptables -A INPUT -p tcp ! --syn -m state --state NEW -j DROP

#不正なパケット拒否
$ sudo iptables -A INPUT -m state --state INVALID -j DROP

#内部からの通信を始めた場合のパケットは許可
$ sudo iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

#ループバックからの通信は通す
$ sudo iptables -A INPUT -i lo -j ACCEPT

#ICMPパケットは許可
$ sudo iptables -A INPUT -p icmp -j ACCEPT

#DHCPクライアントとしてDHCPに必要な通信は通す
#$ sudo iptables -A INPUT -p udp --dport 67 --sport 68 -j ACCEPT

#SSH(20022/tcp)は許可(ローカルネットワークからの接続のみ許可)
$ sudo iptables -A INPUT -m state --state NEW -m tcp -p tcp -s 192.168.10.0/24 --dport 20022 -j ACCEPT

#HTTPは許可(ローカルネットワークからの接続のみ許可)
$ sudo iptables -A INPUT -m state --state NEW -m tcp -p tcp -s 192.168.10.0/24 --dport 80 -j ACCEPT

#Cowrieは許可(5回まで新規接続許可。それ以降は1分に1回に制限。10分間無接続なら制限解除)
$ sudo iptables -A INPUT -p tcp --dport 2222 -m state --state NEW -m hashlimit --hashlimit-name ssh_limit --hashlimit 1/m --hashlimit-burst 5 --hashlimit-mode srcip --hashlimit-htable-expire 600000 -j ACCEPT

#Zabbix-Agentへの通信は許可
#$ sudo iptables -A INPUT -m state --state NEW -m tcp -p tcp -s 192.168.30.0/24 --dport 10050 -j ACCEPT

##OUTPUTチェーン
#ループバックへの通信は通す
$ sudo iptables -A OUTPUT -o lo -j ACCEPT

#ICMP応答のパケットは通す
$ sudo iptables -A OUTPUT -p icmp -m state --state ESTABLISHED,RELATED -j ACCEPT

#外部からの通信を始めた場合のパケットを許可
$ sudo iptables -A OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

#tcp-resetの通信は通す
$ sudo iptables -A OUTPUT -p tcp --tcp-flags FIN,SYN,RST RST -m state --state ESTABLISHED,RELATED -j ACCEPT

#DHCPクライアントとしてDHCPに必要な通信は通す
#$ sudo iptables -A OUTPUT -p udp --dport 68 --sport 67 -j ACCEPT

#ユーザrootが発したパケットは許可
$ sudo iptables -A OUTPUT -m owner --uid-owner 0 -j ACCEPT

#NTPは許可
$ sudo iptables -A OUTPUT -m state --state NEW -m udp -p udp --dport 123 -j ACCEPT

#Zabbix-Serverへの通信は許可
#$ sudo iptables -A OUTPUT -m state --state NEW -m tcp -p tcp -d 192.168.30.0/24 --dport 10051 -j ACCEPT

#外部からの通信は拒否。外部への通信も拒否。
$ sudo iptables -P INPUT DROP
$ sudo iptables -P FORWARD DROP
$ sudo iptables -P OUTPUT DROP
</code></pre>

<p>iptablesの設定を保存します。</p>

<pre><code>$ sudo netfilter-persistent save
run-parts: executing /usr/share/netfilter-persistent/plugins.d/15-ip4tables save
run-parts: executing /usr/share/netfilter-persistent/plugins.d/25-ip6tables save
$
</code></pre>

<ul>
<li><a href="http://techracho.bpsinc.jp/yamasita-taisuke/2013_05_01/8351">iptablesで鉄壁？の守りを実現する3つのTips</a></li>
<li><a href="http://www.unix-power.net/linux/iptables.html">CentOS iptablesによるパケットフィルタ</a></li>
<li><a href="http://kassyjp.ninja-web.net/ras/jessie/iptables.htm">2.iptables（ファイアウォール）のセットアップ - RaspberryPiで各種サーバー作り！ - ある阪大生の物置小屋</a></li>
</ul>

<h2 id="ログ出力先をsyslogに変更:cb5f0701b8057bc3422a1cfa2b48de88">ログ出力先をsyslogに変更</h2>

<p>twistdの作成するログは1000000MB程度でログローテートされてしまうため、Syslogに出力するように変更して日次でログローテートするように変更します。</p>

<p>ログ保管用のディレクトリ作成</p>

<pre><code>$ sudo mkdir /var/log/cowrie
$ sudo chown cowrie:adm /var/log/cowrie/
</code></pre>

<p>rsyslogの設定</p>

<pre><code>$ sudo vi /etc/rsyslog.d/cowrie.conf
if $programname == 'cowrie' then /var/log/cowrie/cowrie.log
&amp; ~
</code></pre>

<p>rsyslogの再起動</p>

<pre><code>$ sudo systemctl restart rsyslog
</code></pre>

<p>Cowrieのログ出力先変更</p>

<pre><code>$ sudo su - cowrie
$ cd cowrie
$ cp -p start.sh{,.backup20170107}
$ ls -l start.sh*
-rwxr-xr-x 1 cowrie cowrie 922  1月  5 05:21 start.sh
-rwxr-xr-x 1 cowrie cowrie 922  1月  4 21:10 start.sh.backup20170105
-rwxr-xr-x 1 cowrie cowrie 922  1月  5 05:21 start.sh.backup20170107
-rwxr-xr-x 1 cowrie cowrie 920  1月  4 19:05 start.sh.org
$
$ vi start.sh
$ diff start.sh.backup20170107 start.sh
35c35
&lt;     twistd $XARGS $DAEMONIZE -l log/cowrie.log --umask 0027 --pidfile ${PIDFILE} cowrie
---
&gt;     twistd $XARGS $DAEMONIZE --syslog --prefix cowrie --umask 0027 --pidfile ${PIDFILE} cowrie
37c37
&lt;     authbind --deep twistd $DAEMONIZE $XARGS -l log/cowrie.log --umask 0027 --pidfile ${PIDFILE} cowrie
---
&gt;     authbind --deep twistd $DAEMONIZE $XARGS --syslog --prefix cowrie --umask 0027 --pidfile ${PIDFILE} cowrie
$
</code></pre>

<h2 id="logrotateの設定:cb5f0701b8057bc3422a1cfa2b48de88">logrotateの設定</h2>

<p>logrotateをインストールします(通常はインストール済みのはずです)。</p>

<pre><code>$ sudo -E apt-get install logrotate
パッケージリストを読み込んでいます... 完了
依存関係ツリーを作成しています                
状態情報を読み取っています... 完了
logrotate はすでに最新版です。
アップグレード: 0 個、新規インストール: 0 個、削除: 0 個、保留: 0 個。
$
</code></pre>

<p>Cowrie用のlogrotate設定を作成</p>

<pre><code>$ sudo vi /etc/logrotate.d/cowrie
/var/log/cowrie/cowrie.log
{
        daily
        rotate 92
        dateext
        create 0640 cowrie adm
        missingok
        ifempty
        compress
        postrotate
                invoke-rc.d rsyslog rotate &gt; /dev/null
        endscript
}
</code></pre>

<p>logrotateをテスト実行し、エラーがないことを確認</p>

<pre><code>$ sudo logrotate -d /etc/logrotate.d/cowrie
reading config file /etc/logrotate.d/cowrie

Handling 1 logs

rotating pattern: /var/log/cowrie/cowrie.log
 after 1 days (92 rotations)
empty log files are rotated, old logs are removed
considering log /var/log/cowrie/cowrie.log
  log /var/log/cowrie/cowrie.log does not exist -- skipping
$
</code></pre>

<ul>
<li><a href="http://server-setting.info/centos/loglotation.html">ログローテーション(logrotate)を使ってみる ( httpd(apache)の設定例 ) | レンタルサーバー・自宅サーバー設定・構築のヒント</a></li>
<li><a href="https://open-groove.net/linux/logrotate-test/">logrotate（ログローテート）の動作確認 | OpenGroove</a></li>
</ul>

<h2 id="logwatchのインストール:cb5f0701b8057bc3422a1cfa2b48de88">logwatchのインストール</h2>

<p>logwatchをインストール</p>

<pre><code>$ sudo -E apt-get install logwatch
パッケージリストを読み込んでいます... 完了
依存関係ツリーを作成しています                
状態情報を読み取っています... 完了
以下の追加パッケージがインストールされます:
  bsd-mailx exim4-base exim4-config exim4-daemon-light libdate-manip-perl
  liblockfile-bin liblockfile1 libsys-cpu-perl
提案パッケージ:
  mail-reader eximon4 exim4-doc-html exim4-doc-info spf-tools-perl swaks
  fortune-mod
推奨パッケージ:
  mailx
以下のパッケージが新たにインストールされます:
  bsd-mailx exim4-base exim4-config exim4-daemon-light libdate-manip-perl
  liblockfile-bin liblockfile1 libsys-cpu-perl logwatch
アップグレード: 0 個、新規インストール: 9 個、削除: 0 個、保留: 0 個。
3,532 kB のアーカイブを取得する必要があります。
この操作後に追加で 17.1 MB のディスク容量が消費されます。
続行しますか? [Y/n] y
取得:1 http://mirrordirector.raspbian.org/raspbian/ jessie/main liblockfile-bin armhf 1.09-6 [18.2 kB]
取得:2 http://mirrordirector.raspbian.org/raspbian/ jessie/main liblockfile1 armhf 1.09-6 [14.7 kB]
取得:3 http://mirrordirector.raspbian.org/raspbian/ jessie/main exim4-config all 4.84.2-2+deb8u2 [503 kB]
取得:4 http://mirrordirector.raspbian.org/raspbian/ jessie/main exim4-base armhf 4.84.2-2+deb8u2 [1,046 kB]
取得:5 http://mirrordirector.raspbian.org/raspbian/ jessie/main exim4-daemon-light armhf 4.84.2-2+deb8u2 [578 kB]
取得:6 http://mirrordirector.raspbian.org/raspbian/ jessie/main bsd-mailx armhf 8.1.2-0.20141216cvs-2 [74.3 kB]
取得:7 http://mirrordirector.raspbian.org/raspbian/ jessie/main libdate-manip-perl all 6.47-1 [923 kB]
取得:8 http://mirrordirector.raspbian.org/raspbian/ jessie/main libsys-cpu-perl armhf 0.61-1+b1 [9,800 B]
取得:9 http://mirrordirector.raspbian.org/raspbian/ jessie/main logwatch all 7.4.1-2 [365 kB]
3,532 kB を 48秒 で取得しました (72.9 kB/s)                                    
パッケージを事前設定しています ...
以前に未選択のパッケージ liblockfile-bin を選択しています。
(データベースを読み込んでいます ... 現在 36617 個のファイルとディレクトリがインストールされています。)
.../liblockfile-bin_1.09-6_armhf.deb を展開する準備をしています ...
liblockfile-bin (1.09-6) を展開しています...
以前に未選択のパッケージ liblockfile1:armhf を選択しています。
.../liblockfile1_1.09-6_armhf.deb を展開する準備をしています ...
liblockfile1:armhf (1.09-6) を展開しています...
以前に未選択のパッケージ exim4-config を選択しています。
.../exim4-config_4.84.2-2+deb8u2_all.deb を展開する準備をしています ...
exim4-config (4.84.2-2+deb8u2) を展開しています...
以前に未選択のパッケージ exim4-base を選択しています。
.../exim4-base_4.84.2-2+deb8u2_armhf.deb を展開する準備をしています ...
exim4-base (4.84.2-2+deb8u2) を展開しています...
以前に未選択のパッケージ exim4-daemon-light を選択しています。
.../exim4-daemon-light_4.84.2-2+deb8u2_armhf.deb を展開する準備をしています ...
exim4-daemon-light (4.84.2-2+deb8u2) を展開しています...
以前に未選択のパッケージ bsd-mailx を選択しています。
.../bsd-mailx_8.1.2-0.20141216cvs-2_armhf.deb を展開する準備をしています ...
bsd-mailx (8.1.2-0.20141216cvs-2) を展開しています...
以前に未選択のパッケージ libdate-manip-perl を選択しています。
.../libdate-manip-perl_6.47-1_all.deb を展開する準備をしています ...
libdate-manip-perl (6.47-1) を展開しています...
以前に未選択のパッケージ libsys-cpu-perl を選択しています。
.../libsys-cpu-perl_0.61-1+b1_armhf.deb を展開する準備をしています ...
libsys-cpu-perl (0.61-1+b1) を展開しています...
以前に未選択のパッケージ logwatch を選択しています。
.../logwatch_7.4.1-2_all.deb を展開する準備をしています ...
logwatch (7.4.1-2) を展開しています...
man-db (2.7.0.2-5) のトリガを処理しています ...
systemd (215-17+deb8u5) のトリガを処理しています ...
liblockfile-bin (1.09-6) を設定しています ...
liblockfile1:armhf (1.09-6) を設定しています ...
exim4-config (4.84.2-2+deb8u2) を設定しています ...
Adding system-user for exim (v4)
exim4-base (4.84.2-2+deb8u2) を設定しています ...
exim: DB upgrade, deleting hints-db
exim4-daemon-light (4.84.2-2+deb8u2) を設定しています ...
bsd-mailx (8.1.2-0.20141216cvs-2) を設定しています ...
update-alternatives: /usr/bin/mailx (mailx) を提供するために自動モードで /usr/bin/bsd-mailx を使います
libdate-manip-perl (6.47-1) を設定しています ...
libsys-cpu-perl (0.61-1+b1) を設定しています ...
logwatch (7.4.1-2) を設定しています ...
libc-bin (2.19-18+deb8u6) のトリガを処理しています ...
systemd (215-17+deb8u5) のトリガを処理しています ...
$
</code></pre>

<p>logwatchの実行結果を確認</p>

<pre><code>$ sudo logwatch --output stdout
</code></pre>

<p>以上</p>

                </div>
              </article>
              
              <article>
                <div class="title">
                  <h1><a href="http://www.shinayoshi.net/post/2017/01/05/setting-kippo-graph/">家庭内インターネット接続環境を構築する その8</a></h1>
                  <p>
                    <span class="label label-primary">Thu Jan 5, 2017</span> in
                    
                    
                    <a href="http://www.shinayoshi.net//categories/server">server</a>
                     using tags
                    
                    
                    <a href="http://www.shinayoshi.net//tags/raspberrypi">raspberrypi</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/home-network">home-network</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homepot1">homepot1</a>
                    
                  </p>
                </div>
                <div class="contents">
                  

<p>FortiGate 60DとRaspberry Piを使用して家庭内インターネット接続環境を構築します。
最終的には以下のような構成を想定しています。</p>

<p><img src="/img/20161022_01/home-network.png" alt="home network" width="640px" /></p>

<p>前回に引き続き<code>homepot1</code>を構築していきます。</p>

<h2 id="kippo-graphによるsshハニーポット-cowrie-の可視化:05481c997d19830c663ad9e91abca85e">Kippo-GraphによるSSHハニーポット(Cowrie)の可視化</h2>

<h3 id="mysqlのインストールと初期化:05481c997d19830c663ad9e91abca85e">MySQLのインストールと初期化</h3>

<p>MySQLをインストールします。
インストール途中でMySQLのrootアカウントのパスワードを求められるので、適宜設定します。</p>

<pre><code>$ sudo -E apt-get install mysql-server
パッケージリストを読み込んでいます... 完了
依存関係ツリーを作成しています                
状態情報を読み取っています... 完了
以下の追加パッケージがインストールされます:
  libaio1 libdbd-mysql-perl libdbi-perl libhtml-template-perl libmysqlclient18
  libterm-readkey-perl mysql-client-5.5 mysql-common mysql-server-5.5
  mysql-server-core-5.5
提案パッケージ:
  libclone-perl libmldbm-perl libnet-daemon-perl libsql-statement-perl
  libipc-sharedcache-perl mailx tinyca
以下のパッケージが新たにインストールされます:
  libaio1 libdbd-mysql-perl libdbi-perl libhtml-template-perl libmysqlclient18
  libterm-readkey-perl mysql-client-5.5 mysql-common mysql-server
  mysql-server-5.5 mysql-server-core-5.5
アップグレード: 0 個、新規インストール: 11 個、削除: 0 個、保留: 0 個。
8,275 kB のアーカイブを取得する必要があります。
この操作後に追加で 89.3 MB のディスク容量が消費されます。
続行しますか? [Y/n] y
取得:1 http://mirrordirector.raspbian.org/raspbian/ jessie/main libaio1 armhf 0.3.110-1 [9,228 B]
取得:2 http://mirrordirector.raspbian.org/raspbian/ jessie/main mysql-common all 5.5.53-0+deb8u1 [75.5 kB]
取得:3 http://mirrordirector.raspbian.org/raspbian/ jessie/main libmysqlclient18 armhf 5.5.53-0+deb8u1 [617 kB]
取得:4 http://mirrordirector.raspbian.org/raspbian/ jessie/main libdbi-perl armhf 1.631-3+b1 [807 kB]
取得:5 http://mirrordirector.raspbian.org/raspbian/ jessie/main libdbd-mysql-perl armhf 4.028-2+deb8u2 [113 kB]
取得:6 http://mirrordirector.raspbian.org/raspbian/ jessie/main libterm-readkey-perl armhf 2.32-1+b2 [26.1 kB]
取得:7 http://mirrordirector.raspbian.org/raspbian/ jessie/main mysql-client-5.5 armhf 5.5.53-0+deb8u1 [1,447 kB]
取得:8 http://mirrordirector.raspbian.org/raspbian/ jessie/main mysql-server-core-5.5 armhf 5.5.53-0+deb8u1 [3,448 kB]
取得:9 http://mirrordirector.raspbian.org/raspbian/ jessie/main mysql-server-5.5 armhf 5.5.53-0+deb8u1 [1,591 kB]
取得:10 http://mirrordirector.raspbian.org/raspbian/ jessie/main libhtml-template-perl all 2.95-1 [66.8 kB]
取得:11 http://mirrordirector.raspbian.org/raspbian/ jessie/main mysql-server all 5.5.53-0+deb8u1 [73.8 kB]
8,275 kB を 22秒 で取得しました (376 kB/s)                                     
パッケージを事前設定しています ...

↓rootアカウントのパスワードを設定します。
 ┌───────────────────┤ mysql-server-5.5 を設定しています ├───────────────────┐
 │ 強制ではありませんが、MySQL を管理する &quot;root&quot; ユーザのパスワードを設定す  │ 
 │ ることを強くお勧めします。                                                │ 
 │                                                                           │ 
 │ この値を空のままにしておいた場合は、パスワードは変更されません。          │ 
 │                                                                           │ 
 │ MySQL の &quot;root&quot; ユーザに対する新しいパスワード:                           │ 
 │                                                                           │ 
 │ _________________________________________________________________________ │ 
 │                                                                           │ 
 │                                  &lt;了解&gt;                                   │ 
 │                                                                           │ 
 └───────────────────────────────────────────────────────────────────────────┘ 


↓再度rootアカウントのパスワードを入力します。
 ┌──────┤ mysql-server-5.5 を設定しています ├───────┐
 │                                                  │ 
 │                                                  │ 
 │ MySQL の &quot;root&quot; ユーザに対する新しいパスワード:  │ 
 │                                                  │ 
 │ ****____________________________________________ │ 
 │                                                  │ 
 │                      &lt;了解&gt;                      │ 
 │                                                  │ 
 └──────────────────────────────────────────────────┘ 

以前に未選択のパッケージ libaio1:armhf を選択しています。
(データベースを読み込んでいます ... 現在 35107 個のファイルとディレクトリがインストールされています。)
.../libaio1_0.3.110-1_armhf.deb を展開する準備をしています ...
libaio1:armhf (0.3.110-1) を展開しています...
以前に未選択のパッケージ mysql-common を選択しています。
.../mysql-common_5.5.53-0+deb8u1_all.deb を展開する準備をしています ...
mysql-common (5.5.53-0+deb8u1) を展開しています...
以前に未選択のパッケージ libmysqlclient18:armhf を選択しています。
.../libmysqlclient18_5.5.53-0+deb8u1_armhf.deb を展開する準備をしています ...
libmysqlclient18:armhf (5.5.53-0+deb8u1) を展開しています...
以前に未選択のパッケージ libdbi-perl を選択しています。
.../libdbi-perl_1.631-3+b1_armhf.deb を展開する準備をしています ...
libdbi-perl (1.631-3+b1) を展開しています...
以前に未選択のパッケージ libdbd-mysql-perl を選択しています。
.../libdbd-mysql-perl_4.028-2+deb8u2_armhf.deb を展開する準備をしています ...
libdbd-mysql-perl (4.028-2+deb8u2) を展開しています...
以前に未選択のパッケージ libterm-readkey-perl を選択しています。
.../libterm-readkey-perl_2.32-1+b2_armhf.deb を展開する準備をしています ...
libterm-readkey-perl (2.32-1+b2) を展開しています...
以前に未選択のパッケージ mysql-client-5.5 を選択しています。
.../mysql-client-5.5_5.5.53-0+deb8u1_armhf.deb を展開する準備をしています ...
mysql-client-5.5 (5.5.53-0+deb8u1) を展開しています...
以前に未選択のパッケージ mysql-server-core-5.5 を選択しています。
.../mysql-server-core-5.5_5.5.53-0+deb8u1_armhf.deb を展開する準備をしています ...
mysql-server-core-5.5 (5.5.53-0+deb8u1) を展開しています...
man-db (2.7.0.2-5) のトリガを処理しています ...
mysql-common (5.5.53-0+deb8u1) を設定しています ...
以前に未選択のパッケージ mysql-server-5.5 を選択しています。
(データベースを読み込んでいます ... 現在 35472 個のファイルとディレクトリがインストールされています。)
.../mysql-server-5.5_5.5.53-0+deb8u1_armhf.deb を展開する準備をしています ...
mysql-server-5.5 (5.5.53-0+deb8u1) を展開しています...
以前に未選択のパッケージ libhtml-template-perl を選択しています。
.../libhtml-template-perl_2.95-1_all.deb を展開する準備をしています ...
libhtml-template-perl (2.95-1) を展開しています...
以前に未選択のパッケージ mysql-server を選択しています。
.../mysql-server_5.5.53-0+deb8u1_all.deb を展開する準備をしています ...
mysql-server (5.5.53-0+deb8u1) を展開しています...
man-db (2.7.0.2-5) のトリガを処理しています ...
systemd (215-17+deb8u5) のトリガを処理しています ...
libaio1:armhf (0.3.110-1) を設定しています ...
libmysqlclient18:armhf (5.5.53-0+deb8u1) を設定しています ...
libdbi-perl (1.631-3+b1) を設定しています ...
libdbd-mysql-perl (4.028-2+deb8u2) を設定しています ...
libterm-readkey-perl (2.32-1+b2) を設定しています ...
mysql-client-5.5 (5.5.53-0+deb8u1) を設定しています ...
mysql-server-core-5.5 (5.5.53-0+deb8u1) を設定しています ...
mysql-server-5.5 (5.5.53-0+deb8u1) を設定しています ...
170105  3:45:31 [Warning] Using unique option prefix key_buffer instead of key_buffer_size is deprecated and will be removed in a future release. Please use the full name instead.
170105  3:45:31 [Note] Ignoring --secure-file-priv value as server is running with --bootstrap.
170105  3:45:31 [Note] /usr/sbin/mysqld (mysqld 5.5.53-0+deb8u1) starting as process 6055 ...
libhtml-template-perl (2.95-1) を設定しています ...
mysql-server (5.5.53-0+deb8u1) を設定しています ...
libc-bin (2.19-18+deb8u6) のトリガを処理しています ...
systemd (215-17+deb8u5) のトリガを処理しています ...
$
</code></pre>

<p>MySQLのセキュア設定</p>

<pre><code>$ mysql_secure_installation 




NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MySQL
      SERVERS IN PRODUCTION USE!  PLEASE READ EACH STEP CAREFULLY!


In order to log into MySQL to secure it, we'll need the current
password for the root user.  If you've just installed MySQL, and
you haven't set the root password yet, the password will be blank,
so you should just press enter here.

Enter current password for root (enter for none): 
OK, successfully used password, moving on...

Setting the root password ensures that nobody can log into the MySQL
root user without the proper authorisation.

You already have a root password set, so you can safely answer 'n'.

Change the root password? [Y/n] n
 ... skipping.

By default, a MySQL installation has an anonymous user, allowing anyone
to log into MySQL without having to have a user account created for
them.  This is intended only for testing, and to make the installation
go a bit smoother.  You should remove them before moving into a
production environment.

Remove anonymous users? [Y/n] Y
 ... Success!

Normally, root should only be allowed to connect from 'localhost'.  This
ensures that someone cannot guess at the root password from the network.

Disallow root login remotely? [Y/n] Y
 ... Success!

By default, MySQL comes with a database named 'test' that anyone can
access.  This is also intended only for testing, and should be removed
before moving into a production environment.

Remove test database and access to it? [Y/n] Y
 - Dropping test database...
ERROR 1008 (HY000) at line 1: Can't drop database 'test'; database doesn't exist
 ... Failed!  Not critical, keep moving...
 - Removing privileges on test database...
 ... Success!

Reloading the privilege tables will ensure that all changes made so far
will take effect immediately.

Reload privilege tables now? [Y/n] Y
 ... Success!

Cleaning up...



All done!  If you've completed all of the above steps, your MySQL
installation should now be secure.

Thanks for using MySQL!


$
</code></pre>

<p>MySQLの初期設定</p>

<pre><code>$ sudo cp -p /etc/mysql/my.cnf{,.org}
$ ls -l /etc/mysql/my.cnf*
-rw-r--r-- 1 root root 3533 10月 17 17:49 /etc/mysql/my.cnf
-rw-r--r-- 1 root root 3533 10月 17 17:49 /etc/mysql/my.cnf.org
$
$ sudo vi /etc/mysql/my.cnf
[mysqld]
# Add the following line to last of mysqld section
character-set-server=utf8
collation-server=utf8_general_ci
skip-character-set-client-handshake
default-storage-engine=InnoDB
innodb_file_per_table
innodb_buffer_pool_size=256M
skip-name-resolve

[mysqldump]
# Add the following line to last of mysqldump section
default-character-set=utf8

[mysql]
# Add the following line to last of mysql section
default-character-set=utf8
</code></pre>

<ul>
<li><a href="https://dev.mysql.com/doc/refman/5.5/en/server-system-variables.html">MySQL :: MySQL 5.5 Reference Manual :: 5.1.4 Server System Variables</a></li>
</ul>

<p>MySQLの再起動</p>

<pre><code>$ sudo systemctl restart mysql
$ sudo systemctl enable mysql
Synchronizing state for mysql.service with sysvinit using update-rc.d...
Executing /usr/sbin/update-rc.d mysql defaults
Executing /usr/sbin/update-rc.d mysql enable
$
</code></pre>

<h3 id="cowrieのログ出力先を変更:05481c997d19830c663ad9e91abca85e">Cowrieのログ出力先を変更</h3>

<p>Cowrie用データベースの作成</p>

<pre><code>$ mysql -uroot -p
Enter password: 
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 37
Server version: 5.5.53-0+deb8u1 (Raspbian)

Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt; create database cowrie character set utf8 collate utf8_bin;
Query OK, 1 row affected (0.00 sec)

mysql&gt; grant all privileges on cowrie.* to cowrie@localhost identified by 'cowrie_password';
Query OK, 0 rows affected (0.00 sec)

mysql&gt; quit
Bye
$
$ cd ${COWRIE_INSTALL_DIR}
$ cat doc/sql/mysql.sql | mysql -ucowrie -p cowrie
Enter password:
$
$ mysql -ucowrie -p
Enter password: 
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 39
Server version: 5.5.53-0+deb8u1 (Raspbian)

Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt; use cowrie
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql&gt; show tables;
+------------------+
| Tables_in_cowrie |
+------------------+
| auth             |
| clients          |
| downloads        |
| input            |
| keyfingerprints  |
| sensors          |
| sessions         |
| ttylog           |
+------------------+
8 rows in set (0.00 sec)

mysql&gt; 
mysql&gt; quit
Bye
$
</code></pre>

<p>CowrieのログをMySQLのデータベースに出力する事前準備</p>

<pre><code>$ sudo -E apt-get install libmysqlclient-dev
パッケージリストを読み込んでいます... 完了
依存関係ツリーを作成しています                
状態情報を読み取っています... 完了
以下のパッケージが新たにインストールされます:
  libmysqlclient-dev
アップグレード: 0 個、新規インストール: 1 個、削除: 0 個、保留: 0 個。
889 kB のアーカイブを取得する必要があります。
この操作後に追加で 4,866 kB のディスク容量が消費されます。
取得:1 http://mirrordirector.raspbian.org/raspbian/ jessie/main libmysqlclient-dev armhf 5.5.53-0+deb8u1 [889 kB]
889 kB を 2秒 で取得しました (306 kB/s)     
以前に未選択のパッケージ libmysqlclient-dev を選択しています。
(データベースを読み込んでいます ... 現在 38240 個のファイルとディレクトリがインストールされています。)
.../libmysqlclient-dev_5.5.53-0+deb8u1_armhf.deb を展開する準備をしています ...
libmysqlclient-dev (5.5.53-0+deb8u1) を展開しています...
man-db (2.7.0.2-5) のトリガを処理しています ...
libmysqlclient-dev (5.5.53-0+deb8u1) を設定しています ...
$
$ sudo su - cowrie
$ cd cowrie/
$ source cowrie-env/bin/activate
$ pip install mysql-python
Downloading/unpacking mysql-python
  Downloading MySQL-python-1.2.5.zip (108kB): 108kB downloaded
  Running setup.py (path:/tmp/pip-build-prjaIE/mysql-python/setup.py) egg_info for package mysql-python
Installing collected packages: mysql-python
  Running setup.py install for mysql-python
    building '_mysql' extension
    arm-linux-gnueabihf-gcc -pthread -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -fno-strict-aliasing -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -fPIC -Dversion_info=(1,2,5,'final',1) -D__version__=1.2.5 -I/usr/include/mysql -I/usr/include/python2.7 -c _mysql.c -o build/temp.linux-armv7l-2.7/_mysql.o -DBIG_JOINS=1 -fno-strict-aliasing -g -DNDEBUG
    In file included from _mysql.c:44:0:
    /usr/include/mysql/my_config.h:423:0: warning: &quot;HAVE_WCSCOLL&quot; redefined
     #define HAVE_WCSCOLL
     ^
    In file included from /usr/include/python2.7/pyconfig.h:13:0,
                     from /usr/include/python2.7/Python.h:8,
                     from _mysql.c:29:
    /usr/include/arm-linux-gnueabihf/python2.7/pyconfig.h:911:0: note: this is the location of the previous definition
     #define HAVE_WCSCOLL 1
     ^
    arm-linux-gnueabihf-gcc -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wl,-z,relro -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security build/temp.linux-armv7l-2.7/_mysql.o -L/usr/lib/arm-linux-gnueabihf -lmysqlclient_r -lpthread -lz -lm -ldl -o build/lib.linux-armv7l-2.7/_mysql.so
  Could not find .egg-info directory in install record for mysql-python
Successfully installed mysql-python
Cleaning up...
$
$ deactivate
$
</code></pre>

<p>CowrieのログをMySQLのデータベースに出力</p>

<pre><code>$ sudo su - cowrie
$ cd cowrie/
$ cp -p cowrie.cfg{,.backup20170105}
$ ls -l cowrie.cfg*
-rw-r--r-- 1 cowrie cowrie 11597  1月  4 20:16 cowrie.cfg
-rw-r--r-- 1 cowrie cowrie 11597  1月  4 20:16 cowrie.cfg.backup20170105
-rw-r--r-- 1 cowrie cowrie 11555  1月  4 19:05 cowrie.cfg.dist
$
$ vi cowrie.cfg
# Comment out the following line
#[output_jsonlog]
#logfile = log/cowrie.json

# Remove '#'
[output_mysql]
host = localhost
database = cowrie
username = cowrie
password = cowrie_password
port = 3306
debug = false
</code></pre>

<p>Cowrieの再起動</p>

<pre><code>$ sudo supervisorctl restart cowrie
cowrie: stopped
cowrie: started
$
$ sudo supervisorctl status cowrie
cowrie                           RUNNING    pid 7848, uptime 0:00:02
$
</code></pre>

<h3 id="apache2のインストール:05481c997d19830c663ad9e91abca85e">Apache2のインストール</h3>

<p>Apache2をインストールする。</p>

<pre><code>$ sudo -E apt-get install apache2
パッケージリストを読み込んでいます... 完了
依存関係ツリーを作成しています                
状態情報を読み取っています... 完了
以下の追加パッケージがインストールされます:
  apache2-bin apache2-data apache2-utils libapr1 libaprutil1
  libaprutil1-dbd-sqlite3 libaprutil1-ldap liblua5.1-0 ssl-cert
提案パッケージ:
  www-browser apache2-doc apache2-suexec-pristine apache2-suexec-custom
  openssl-blacklist
以下のパッケージが新たにインストールされます:
  apache2 apache2-bin apache2-data apache2-utils libapr1 libaprutil1
  libaprutil1-dbd-sqlite3 libaprutil1-ldap liblua5.1-0 ssl-cert
アップグレード: 0 個、新規インストール: 10 個、削除: 0 個、保留: 0 個。
1,750 kB のアーカイブを取得する必要があります。
この操作後に追加で 5,241 kB のディスク容量が消費されます。
続行しますか? [Y/n] y
取得:1 http://mirrordirector.raspbian.org/raspbian/ jessie/main libapr1 armhf 1.5.1-3 [77.1 kB]
取得:2 http://mirrordirector.raspbian.org/raspbian/ jessie/main libaprutil1 armhf 1.5.4-1 [75.9 kB]
取得:3 http://mirrordirector.raspbian.org/raspbian/ jessie/main libaprutil1-dbd-sqlite3 armhf 1.5.4-1 [17.7 kB]
取得:4 http://mirrordirector.raspbian.org/raspbian/ jessie/main libaprutil1-ldap armhf 1.5.4-1 [16.7 kB]
取得:5 http://mirrordirector.raspbian.org/raspbian/ jessie/main liblua5.1-0 armhf 5.1.5-7.1 [83.7 kB]
取得:6 http://mirrordirector.raspbian.org/raspbian/ jessie/main apache2-bin armhf 2.4.10-10+deb8u7 [893 kB]
取得:7 http://mirrordirector.raspbian.org/raspbian/ jessie/main apache2-utils armhf 2.4.10-10+deb8u7 [194 kB]
取得:8 http://mirrordirector.raspbian.org/raspbian/ jessie/main apache2-data all 2.4.10-10+deb8u7 [163 kB]
取得:9 http://mirrordirector.raspbian.org/raspbian/ jessie/main apache2 armhf 2.4.10-10+deb8u7 [207 kB]
取得:10 http://mirrordirector.raspbian.org/raspbian/ jessie/main ssl-cert all 1.0.35 [20.9 kB]
1,750 kB を 6秒 で取得しました (256 kB/s)                                      
パッケージを事前設定しています ...
以前に未選択のパッケージ libapr1:armhf を選択しています。
(データベースを読み込んでいます ... 現在 35575 個のファイルとディレクトリがインストールされています。)
.../libapr1_1.5.1-3_armhf.deb を展開する準備をしています ...
libapr1:armhf (1.5.1-3) を展開しています...
以前に未選択のパッケージ libaprutil1:armhf を選択しています。
.../libaprutil1_1.5.4-1_armhf.deb を展開する準備をしています ...
libaprutil1:armhf (1.5.4-1) を展開しています...
以前に未選択のパッケージ libaprutil1-dbd-sqlite3:armhf を選択しています。
.../libaprutil1-dbd-sqlite3_1.5.4-1_armhf.deb を展開する準備をしています ...
libaprutil1-dbd-sqlite3:armhf (1.5.4-1) を展開しています...
以前に未選択のパッケージ libaprutil1-ldap:armhf を選択しています。
.../libaprutil1-ldap_1.5.4-1_armhf.deb を展開する準備をしています ...
libaprutil1-ldap:armhf (1.5.4-1) を展開しています...
以前に未選択のパッケージ liblua5.1-0:armhf を選択しています。
.../liblua5.1-0_5.1.5-7.1_armhf.deb を展開する準備をしています ...
liblua5.1-0:armhf (5.1.5-7.1) を展開しています...
以前に未選択のパッケージ apache2-bin を選択しています。
.../apache2-bin_2.4.10-10+deb8u7_armhf.deb を展開する準備をしています ...
apache2-bin (2.4.10-10+deb8u7) を展開しています...
以前に未選択のパッケージ apache2-utils を選択しています。
.../apache2-utils_2.4.10-10+deb8u7_armhf.deb を展開する準備をしています ...
apache2-utils (2.4.10-10+deb8u7) を展開しています...
以前に未選択のパッケージ apache2-data を選択しています。
.../apache2-data_2.4.10-10+deb8u7_all.deb を展開する準備をしています ...
apache2-data (2.4.10-10+deb8u7) を展開しています...
以前に未選択のパッケージ apache2 を選択しています。
.../apache2_2.4.10-10+deb8u7_armhf.deb を展開する準備をしています ...
apache2 (2.4.10-10+deb8u7) を展開しています...
以前に未選択のパッケージ ssl-cert を選択しています。
.../ssl-cert_1.0.35_all.deb を展開する準備をしています ...
ssl-cert (1.0.35) を展開しています...
man-db (2.7.0.2-5) のトリガを処理しています ...
systemd (215-17+deb8u5) のトリガを処理しています ...
libapr1:armhf (1.5.1-3) を設定しています ...
libaprutil1:armhf (1.5.4-1) を設定しています ...
libaprutil1-dbd-sqlite3:armhf (1.5.4-1) を設定しています ...
libaprutil1-ldap:armhf (1.5.4-1) を設定しています ...
liblua5.1-0:armhf (5.1.5-7.1) を設定しています ...
apache2-bin (2.4.10-10+deb8u7) を設定しています ...
apache2-utils (2.4.10-10+deb8u7) を設定しています ...
apache2-data (2.4.10-10+deb8u7) を設定しています ...
apache2 (2.4.10-10+deb8u7) を設定しています ...
Enabling module mpm_event.
Enabling module authz_core.
Enabling module authz_host.
Enabling module authn_core.
Enabling module auth_basic.
Enabling module access_compat.
Enabling module authn_file.
Enabling module authz_user.
Enabling module alias.
Enabling module dir.
Enabling module autoindex.
Enabling module env.
Enabling module mime.
Enabling module negotiation.
Enabling module setenvif.
Enabling module filter.
Enabling module deflate.
Enabling module status.
Enabling conf charset.
Enabling conf localized-error-pages.
Enabling conf other-vhosts-access-log.
Enabling conf security.
Enabling conf serve-cgi-bin.
Enabling site 000-default.
ssl-cert (1.0.35) を設定しています ...
libc-bin (2.19-18+deb8u6) のトリガを処理しています ...
systemd (215-17+deb8u5) のトリガを処理しています ...
$
</code></pre>

<p>Apache2のセキュリティ設定</p>

<pre><code>$ sudo cp -p /etc/apache2/conf-available/security.conf{,.org}
$ ls -l /etc/apache2/conf-available/security.conf*
-rw-r--r-- 1 root root 2190  8月  7 19:56 /etc/apache2/conf-available/security.conf
-rw-r--r-- 1 root root 2190  8月  7 19:56 /etc/apache2/conf-available/security.conf.org
$
$ sudo vi /etc/apache2/conf-available/security.conf
ServerTokens Prod
ServerSignature Off
$
</code></pre>

<p>Apache2の文字コード設定</p>

<pre><code>$ sudo cp -p /etc/apache2/conf-available/charset.conf{,.org}
$ ls -l /etc/apache2/conf-available/charset.conf*
-rw-r--r-- 1 root root 315  7月  6  2016 /etc/apache2/conf-available/charset.conf
-rw-r--r-- 1 root root 315  7月  6  2016 /etc/apache2/conf-available/charset.conf.org
$
$ sudo vi /etc/apache2/conf-available/charset.conf
#AddDefaultCharset UTF-8
$
</code></pre>

<p>Apache2のServerName設定</p>

<pre><code>$ sudo sh -c &quot;echo ServerName ${HOSTNAME} &gt; /etc/apache2/conf-available/fqdn.conf&quot;
$ sudo a2enconf fqdn
Enabling conf fqdn.
To activate the new configuration, you need to run:
  service apache2 reload
$
</code></pre>

<p>Apache2の再起動</p>

<pre><code>$ sudo apachectl configtest
Syntax OK
$
$ sudo systemctl restart apache2
$ sudo systemctl enable apache2
Synchronizing state for apache2.service with sysvinit using update-rc.d...
Executing /usr/sbin/update-rc.d apache2 defaults
Executing /usr/sbin/update-rc.d apache2 enable
$
</code></pre>

<h3 id="kippo-graphのインストール:05481c997d19830c663ad9e91abca85e">Kippo-Graphのインストール</h3>

<p>Kippo-GraphのWebサイト(<code>https://bruteforce.gr/kippo-graph</code>)を参考にKippo-Graphをインストールする。</p>

<p>関連パッケージのインストール</p>

<pre><code>$ sudo -E apt-get install libapache2-mod-php5 php5-mysql php5-gd php5-curl
パッケージリストを読み込んでいます... 完了
依存関係ツリーを作成しています                
状態情報を読み取っています... 完了
以下の追加パッケージがインストールされます:
  fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libjbig0 libonig2
  libperl4-corelibs-perl libqdbm14 libtiff5 libvpx1 libxpm4 lsof php5-cli
  php5-common php5-json php5-readline
提案パッケージ:
  php-pear libgd-tools php5-user-cache
以下のパッケージが新たにインストールされます:
  fontconfig-config fonts-dejavu-core libapache2-mod-php5 libfontconfig1
  libgd3 libjbig0 libonig2 libperl4-corelibs-perl libqdbm14 libtiff5 libvpx1
  libxpm4 lsof php5-cli php5-common php5-curl php5-gd php5-json php5-mysql
  php5-readline
アップグレード: 0 個、新規インストール: 20 個、削除: 0 個、保留: 0 個。
7,989 kB のアーカイブを取得する必要があります。
この操作後に追加で 26.1 MB のディスク容量が消費されます。
続行しますか? [Y/n] y
取得:1 http://mirrordirector.raspbian.org/raspbian/ jessie/main fonts-dejavu-core all 2.34-1 [1,047 kB]
取得:2 http://mirrordirector.raspbian.org/raspbian/ jessie/main fontconfig-config all 2.11.0-6.3+deb8u1 [274 kB]
取得:3 http://mirrordirector.raspbian.org/raspbian/ jessie/main libfontconfig1 armhf 2.11.0-6.3+deb8u1 [312 kB]
取得:4 http://mirrordirector.raspbian.org/raspbian/ jessie/main libjbig0 armhf 2.1-3.1 [27.5 kB]
取得:5 http://mirrordirector.raspbian.org/raspbian/ jessie/main libtiff5 armhf 4.0.3-12.3+deb8u1 [194 kB]
取得:6 http://mirrordirector.raspbian.org/raspbian/ jessie/main libvpx1 armhf 1.3.0-3+rvt [783 kB]
取得:7 http://mirrordirector.raspbian.org/raspbian/ jessie/main libxpm4 armhf 1:3.5.11-1 [41.7 kB]
取得:8 http://mirrordirector.raspbian.org/raspbian/ jessie/main libgd3 armhf 2.1.0-5+deb8u8 [127 kB]
取得:9 http://mirrordirector.raspbian.org/raspbian/ jessie/main libonig2 armhf 5.9.5-3.2 [101 kB]
取得:10 http://mirrordirector.raspbian.org/raspbian/ jessie/main libperl4-corelibs-perl all 0.003-1 [43.6 kB]
取得:11 http://mirrordirector.raspbian.org/raspbian/ jessie/main lsof armhf 4.86+dfsg-1 [321 kB]
取得:12 http://mirrordirector.raspbian.org/raspbian/ jessie/main libqdbm14 armhf 1.8.78-5+b1 [86.0 kB]
取得:13 http://mirrordirector.raspbian.org/raspbian/ jessie/main php5-common armhf 5.6.29+dfsg-0+deb8u1 [720 kB]
取得:14 http://mirrordirector.raspbian.org/raspbian/ jessie/main php5-json armhf 1.3.6-1 [16.9 kB]
取得:15 http://mirrordirector.raspbian.org/raspbian/ jessie/main php5-cli armhf 5.6.29+dfsg-0+deb8u1 [1,904 kB]
取得:16 http://mirrordirector.raspbian.org/raspbian/ jessie/main libapache2-mod-php5 armhf 5.6.29+dfsg-0+deb8u1 [1,879 kB]
取得:17 http://mirrordirector.raspbian.org/raspbian/ jessie/main php5-curl armhf 5.6.29+dfsg-0+deb8u1 [24.5 kB]
取得:18 http://mirrordirector.raspbian.org/raspbian/ jessie/main php5-gd armhf 5.6.29+dfsg-0+deb8u1 [23.2 kB]
取得:19 http://mirrordirector.raspbian.org/raspbian/ jessie/main php5-mysql armhf 5.6.29+dfsg-0+deb8u1 [52.2 kB]
取得:20 http://mirrordirector.raspbian.org/raspbian/ jessie/main php5-readline armhf 5.6.29+dfsg-0+deb8u1 [11.2 kB]
7,989 kB を 19秒 で取得しました (403 kB/s)                                     
パッケージを事前設定しています ...
以前に未選択のパッケージ fonts-dejavu-core を選択しています。
(データベースを読み込んでいます ... 現在 36265 個のファイルとディレクトリがインストールされています。)
.../fonts-dejavu-core_2.34-1_all.deb を展開する準備をしています ...
fonts-dejavu-core (2.34-1) を展開しています...
以前に未選択のパッケージ fontconfig-config を選択しています。
.../fontconfig-config_2.11.0-6.3+deb8u1_all.deb を展開する準備をしています ...
fontconfig-config (2.11.0-6.3+deb8u1) を展開しています...
以前に未選択のパッケージ libfontconfig1:armhf を選択しています。
.../libfontconfig1_2.11.0-6.3+deb8u1_armhf.deb を展開する準備をしています ...
libfontconfig1:armhf (2.11.0-6.3+deb8u1) を展開しています...
以前に未選択のパッケージ libjbig0:armhf を選択しています。
.../libjbig0_2.1-3.1_armhf.deb を展開する準備をしています ...
libjbig0:armhf (2.1-3.1) を展開しています...
以前に未選択のパッケージ libtiff5:armhf を選択しています。
.../libtiff5_4.0.3-12.3+deb8u1_armhf.deb を展開する準備をしています ...
libtiff5:armhf (4.0.3-12.3+deb8u1) を展開しています...
以前に未選択のパッケージ libvpx1:armhf を選択しています。
.../libvpx1_1.3.0-3+rvt_armhf.deb を展開する準備をしています ...
libvpx1:armhf (1.3.0-3+rvt) を展開しています...
以前に未選択のパッケージ libxpm4:armhf を選択しています。
.../libxpm4_1%3a3.5.11-1_armhf.deb を展開する準備をしています ...
libxpm4:armhf (1:3.5.11-1) を展開しています...
以前に未選択のパッケージ libgd3:armhf を選択しています。
.../libgd3_2.1.0-5+deb8u8_armhf.deb を展開する準備をしています ...
libgd3:armhf (2.1.0-5+deb8u8) を展開しています...
以前に未選択のパッケージ libonig2:armhf を選択しています。
.../libonig2_5.9.5-3.2_armhf.deb を展開する準備をしています ...
libonig2:armhf (5.9.5-3.2) を展開しています...
以前に未選択のパッケージ libperl4-corelibs-perl を選択しています。
.../libperl4-corelibs-perl_0.003-1_all.deb を展開する準備をしています ...
libperl4-corelibs-perl (0.003-1) を展開しています...
以前に未選択のパッケージ lsof を選択しています。
.../lsof_4.86+dfsg-1_armhf.deb を展開する準備をしています ...
lsof (4.86+dfsg-1) を展開しています...
以前に未選択のパッケージ libqdbm14 を選択しています。
.../libqdbm14_1.8.78-5+b1_armhf.deb を展開する準備をしています ...
libqdbm14 (1.8.78-5+b1) を展開しています...
以前に未選択のパッケージ php5-common を選択しています。
.../php5-common_5.6.29+dfsg-0+deb8u1_armhf.deb を展開する準備をしています ...
php5-common (5.6.29+dfsg-0+deb8u1) を展開しています...
以前に未選択のパッケージ php5-json を選択しています。
.../php5-json_1.3.6-1_armhf.deb を展開する準備をしています ...
php5-json (1.3.6-1) を展開しています...
以前に未選択のパッケージ php5-cli を選択しています。
.../php5-cli_5.6.29+dfsg-0+deb8u1_armhf.deb を展開する準備をしています ...
php5-cli (5.6.29+dfsg-0+deb8u1) を展開しています...
以前に未選択のパッケージ libapache2-mod-php5 を選択しています。
.../libapache2-mod-php5_5.6.29+dfsg-0+deb8u1_armhf.deb を展開する準備をしています ...
libapache2-mod-php5 (5.6.29+dfsg-0+deb8u1) を展開しています...
以前に未選択のパッケージ php5-curl を選択しています。
.../php5-curl_5.6.29+dfsg-0+deb8u1_armhf.deb を展開する準備をしています ...
php5-curl (5.6.29+dfsg-0+deb8u1) を展開しています...
以前に未選択のパッケージ php5-gd を選択しています。
.../php5-gd_5.6.29+dfsg-0+deb8u1_armhf.deb を展開する準備をしています ...
php5-gd (5.6.29+dfsg-0+deb8u1) を展開しています...
以前に未選択のパッケージ php5-mysql を選択しています。
.../php5-mysql_5.6.29+dfsg-0+deb8u1_armhf.deb を展開する準備をしています ...
php5-mysql (5.6.29+dfsg-0+deb8u1) を展開しています...
以前に未選択のパッケージ php5-readline を選択しています。
.../php5-readline_5.6.29+dfsg-0+deb8u1_armhf.deb を展開する準備をしています ...
php5-readline (5.6.29+dfsg-0+deb8u1) を展開しています...
man-db (2.7.0.2-5) のトリガを処理しています ...
fonts-dejavu-core (2.34-1) を設定しています ...
fontconfig-config (2.11.0-6.3+deb8u1) を設定しています ...
libfontconfig1:armhf (2.11.0-6.3+deb8u1) を設定しています ...
libjbig0:armhf (2.1-3.1) を設定しています ...
libtiff5:armhf (4.0.3-12.3+deb8u1) を設定しています ...
libvpx1:armhf (1.3.0-3+rvt) を設定しています ...
libxpm4:armhf (1:3.5.11-1) を設定しています ...
libgd3:armhf (2.1.0-5+deb8u8) を設定しています ...
libonig2:armhf (5.9.5-3.2) を設定しています ...
libperl4-corelibs-perl (0.003-1) を設定しています ...
lsof (4.86+dfsg-1) を設定しています ...
libqdbm14 (1.8.78-5+b1) を設定しています ...
php5-common (5.6.29+dfsg-0+deb8u1) を設定しています ...

Creating config file /etc/php5/mods-available/pdo.ini with new version
php5_invoke: Enable module pdo for apache2 SAPI
php5_invoke: Enable module pdo for cli SAPI

Creating config file /etc/php5/mods-available/opcache.ini with new version
php5_invoke: Enable module opcache for apache2 SAPI
php5_invoke: Enable module opcache for cli SAPI
php5-json (1.3.6-1) を設定しています ...
php5_invoke: Enable module json for apache2 SAPI
php5_invoke: Enable module json for cli SAPI
php5-cli (5.6.29+dfsg-0+deb8u1) を設定しています ...
update-alternatives: /usr/bin/php (php) を提供するために自動モードで /usr/bin/php5 を使います
update-alternatives: /usr/bin/phar (phar) を提供するために自動モードで /usr/bin/phar5 を使います

Creating config file /etc/php5/cli/php.ini with new version
libapache2-mod-php5 (5.6.29+dfsg-0+deb8u1) を設定しています ...

Creating config file /etc/php5/apache2/php.ini with new version
Module mpm_event disabled.
Enabling module mpm_prefork.
apache2_switch_mpm Switch to prefork
apache2_invoke: Enable module php5
php5-curl (5.6.29+dfsg-0+deb8u1) を設定しています ...

Creating config file /etc/php5/mods-available/curl.ini with new version
php5_invoke: Enable module curl for apache2 SAPI
php5_invoke: Enable module curl for cli SAPI
php5-gd (5.6.29+dfsg-0+deb8u1) を設定しています ...

Creating config file /etc/php5/mods-available/gd.ini with new version
php5_invoke: Enable module gd for apache2 SAPI
php5_invoke: Enable module gd for cli SAPI
php5-mysql (5.6.29+dfsg-0+deb8u1) を設定しています ...

Creating config file /etc/php5/mods-available/mysql.ini with new version
php5_invoke: Enable module mysql for apache2 SAPI
php5_invoke: Enable module mysql for cli SAPI

Creating config file /etc/php5/mods-available/mysqli.ini with new version
php5_invoke: Enable module mysqli for apache2 SAPI
php5_invoke: Enable module mysqli for cli SAPI

Creating config file /etc/php5/mods-available/pdo_mysql.ini with new version
php5_invoke: Enable module pdo_mysql for apache2 SAPI
php5_invoke: Enable module pdo_mysql for cli SAPI
php5-readline (5.6.29+dfsg-0+deb8u1) を設定しています ...

Creating config file /etc/php5/mods-available/readline.ini with new version
php5_invoke: Enable module readline for apache2 SAPI
php5_invoke: Enable module readline for cli SAPI
libc-bin (2.19-18+deb8u6) のトリガを処理しています ...
libapache2-mod-php5 (5.6.29+dfsg-0+deb8u1) のトリガを処理しています ...
$
$ sudo -E apt-get install dnsutils
パッケージリストを読み込んでいます... 完了
依存関係ツリーを作成しています                
状態情報を読み取っています... 完了
提案パッケージ:
  rblcheck
以下のパッケージが新たにインストールされます:
  dnsutils
アップグレード: 0 個、新規インストール: 1 個、削除: 0 個、保留: 0 個。
113 kB のアーカイブを取得する必要があります。
この操作後に追加で 325 kB のディスク容量が消費されます。
取得:1 http://mirrordirector.raspbian.org/raspbian/ jessie/main dnsutils armhf 1:9.9.5.dfsg-9+deb8u8 [113 kB]
113 kB を 2秒 で取得しました (46.6 kB/s)
以前に未選択のパッケージ dnsutils を選択しています。
(データベースを読み込んでいます ... 現在 36608 個のファイルとディレクトリがインストールされています。)
.../dnsutils_1%3a9.9.5.dfsg-9+deb8u8_armhf.deb を展開する準備をしています ...
dnsutils (1:9.9.5.dfsg-9+deb8u8) を展開しています...
man-db (2.7.0.2-5) のトリガを処理しています ...
dnsutils (1:9.9.5.dfsg-9+deb8u8) を設定しています ...
$
$ sudo systemctl restart apache2
$
</code></pre>

<p>Kippo-Graphのインストール</p>

<pre><code>$ wget http://bruteforce.gr/wp-content/uploads/kippo-graph-1.5.1.tar.gz
--2017-01-05 04:54:31--  http://bruteforce.gr/wp-content/uploads/kippo-graph-1.5.1.tar.gz
192.168.20.10:3128 に接続しています... 接続しました。
Proxy による接続要求を送信しました、応答を待っています... 200 OK
長さ: 17800301 (17M) [application/x-gzip]
`kippo-graph-1.5.1.tar.gz' に保存中

kippo-graph-1.5.1.t 100%[=====================&gt;]  16.98M   147KB/s 時間 1m 57s 

2017-01-05 04:56:28 (149 KB/s) - `kippo-graph-1.5.1.tar.gz' へ保存完了 [17800301/17800301]

$
$ sudo tar zxvf kippo-graph-1.5.1.tar.gz -C /usr/share
kippo-graph-1.5.1/
kippo-graph-1.5.1/.gitignore
kippo-graph-1.5.1/.htaccess
kippo-graph-1.5.1/LICENSE.txt
kippo-graph-1.5.1/README.md
kippo-graph-1.5.1/TODO.txt
kippo-graph-1.5.1/class/
kippo-graph-1.5.1/class/KippoGeo.class.php
kippo-graph-1.5.1/class/KippoGraph.class.php
kippo-graph-1.5.1/class/KippoIP.class.php
kippo-graph-1.5.1/class/KippoInput.class.php
kippo-graph-1.5.1/class/KippoPlayLog.class.php
kippo-graph-1.5.1/config.php.dist
kippo-graph-1.5.1/favicon.ico
kippo-graph-1.5.1/gallery.php
kippo-graph-1.5.1/generated-graphs/
kippo-graph-1.5.1/generated-graphs/index.php
kippo-graph-1.5.1/gpl.txt
kippo-graph-1.5.1/images/
kippo-graph-1.5.1/images/alienvault.ico
kippo-graph-1.5.1/images/bg.gif
kippo-graph-1.5.1/images/dshield.ico
kippo-graph-1.5.1/images/first.png
kippo-graph-1.5.1/images/fortiguard.ico
kippo-graph-1.5.1/images/index.php
kippo-graph-1.5.1/images/ip_tracer.png
kippo-graph-1.5.1/images/ipvoid.ico
kippo-graph-1.5.1/images/kippo-graph-img.png
kippo-graph-1.5.1/images/last.png
kippo-graph-1.5.1/images/mcafee.ico
kippo-graph-1.5.1/images/next.png
kippo-graph-1.5.1/images/novirusthanks.ico
kippo-graph-1.5.1/images/play.ico
kippo-graph-1.5.1/images/prev.png
kippo-graph-1.5.1/images/robtex.ico
kippo-graph-1.5.1/images/virustotal.ico
kippo-graph-1.5.1/images/warning.png
kippo-graph-1.5.1/images/watchguard.ico
kippo-graph-1.5.1/include/
kippo-graph-1.5.1/include/export.php
kippo-graph-1.5.1/include/geoplugin/
kippo-graph-1.5.1/include/geoplugin/geoplugin.class.php
kippo-graph-1.5.1/include/index.php
kippo-graph-1.5.1/include/kippo-ip.ajax.php
kippo-graph-1.5.1/include/languages/
kippo-graph-1.5.1/include/languages/lang.ar.php
kippo-graph-1.5.1/include/languages/lang.cs.php
kippo-graph-1.5.1/include/languages/lang.de.php
kippo-graph-1.5.1/include/languages/lang.el.php
kippo-graph-1.5.1/include/languages/lang.en.php
kippo-graph-1.5.1/include/languages/lang.es.php
kippo-graph-1.5.1/include/languages/lang.et.php
kippo-graph-1.5.1/include/languages/lang.fr.php
kippo-graph-1.5.1/include/languages/lang.it.php
kippo-graph-1.5.1/include/languages/lang.nl.php
kippo-graph-1.5.1/include/languages/lang.pl.php
kippo-graph-1.5.1/include/languages/lang.sk.php
kippo-graph-1.5.1/include/languages/lang.sv.php
kippo-graph-1.5.1/include/libchart/
kippo-graph-1.5.1/include/libchart/COPYING
kippo-graph-1.5.1/include/libchart/ChangeLog
kippo-graph-1.5.1/include/libchart/README
kippo-graph-1.5.1/include/libchart/classes/
kippo-graph-1.5.1/include/libchart/classes/libchart.php
kippo-graph-1.5.1/include/libchart/classes/model/
kippo-graph-1.5.1/include/libchart/classes/model/ChartConfig.php
kippo-graph-1.5.1/include/libchart/classes/model/DataSet.php
kippo-graph-1.5.1/include/libchart/classes/model/Point.php
kippo-graph-1.5.1/include/libchart/classes/model/XYDataSet.php
kippo-graph-1.5.1/include/libchart/classes/model/XYSeriesDataSet.php
kippo-graph-1.5.1/include/libchart/classes/view/
kippo-graph-1.5.1/include/libchart/classes/view/axis/
kippo-graph-1.5.1/include/libchart/classes/view/axis/Axis.php
kippo-graph-1.5.1/include/libchart/classes/view/axis/Bound.php
kippo-graph-1.5.1/include/libchart/classes/view/caption/
kippo-graph-1.5.1/include/libchart/classes/view/caption/Caption.php
kippo-graph-1.5.1/include/libchart/classes/view/chart/
kippo-graph-1.5.1/include/libchart/classes/view/chart/BarChart.php
kippo-graph-1.5.1/include/libchart/classes/view/chart/Chart.php
kippo-graph-1.5.1/include/libchart/classes/view/chart/HorizontalBarChart.php
kippo-graph-1.5.1/include/libchart/classes/view/chart/LineChart.php
kippo-graph-1.5.1/include/libchart/classes/view/chart/PieChart.php
kippo-graph-1.5.1/include/libchart/classes/view/chart/VerticalBarChart.php
kippo-graph-1.5.1/include/libchart/classes/view/color/
kippo-graph-1.5.1/include/libchart/classes/view/color/Color.php
kippo-graph-1.5.1/include/libchart/classes/view/color/ColorSet.php
kippo-graph-1.5.1/include/libchart/classes/view/color/Palette.php
kippo-graph-1.5.1/include/libchart/classes/view/plot/
kippo-graph-1.5.1/include/libchart/classes/view/plot/Plot.php
kippo-graph-1.5.1/include/libchart/classes/view/primitive/
kippo-graph-1.5.1/include/libchart/classes/view/primitive/Padding.php
kippo-graph-1.5.1/include/libchart/classes/view/primitive/Primitive.php
kippo-graph-1.5.1/include/libchart/classes/view/primitive/Rectangle.php
kippo-graph-1.5.1/include/libchart/classes/view/text/
kippo-graph-1.5.1/include/libchart/classes/view/text/Text.php
kippo-graph-1.5.1/include/libchart/doc/
kippo-graph-1.5.1/include/libchart/doc/DEJAVU_LICENSE
kippo-graph-1.5.1/include/libchart/doc/GNU_GPL_V3
kippo-graph-1.5.1/include/libchart/fonts/
kippo-graph-1.5.1/include/libchart/fonts/DejaVuSansCondensed-Bold.ttf
kippo-graph-1.5.1/include/libchart/fonts/DejaVuSansCondensed.ttf
kippo-graph-1.5.1/include/libchart/fonts/OpenSans-Bold.ttf
kippo-graph-1.5.1/include/libchart/fonts/OpenSans-Regular.ttf
kippo-graph-1.5.1/include/libchart/images/
kippo-graph-1.5.1/include/libchart/images/PoweredBy.png
kippo-graph-1.5.1/include/maxmind/
kippo-graph-1.5.1/include/maxmind/GeoLite2-City.mmdb
kippo-graph-1.5.1/include/maxmind/geoip2.phar
kippo-graph-1.5.1/include/misc/
kippo-graph-1.5.1/include/misc/ip2host.php
kippo-graph-1.5.1/include/misc/versionCheck.php
kippo-graph-1.5.1/include/misc/xss_clean.php
kippo-graph-1.5.1/include/play.php
kippo-graph-1.5.1/include/qgooglevisualapi/
kippo-graph-1.5.1/include/qgooglevisualapi/QAnnotatedtimelineGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QApikeyGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QAreachartGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QBarchartGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QColumnchartGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QConfig.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QGaugeGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QInflector.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QIntensitymapGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QLinechartGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QMagictableGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QMapGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QMixupGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QMotionchartGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QOrgchartGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QPiechartGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QScatterchartGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QTableGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QTool.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QVizualisationGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QWordcloudGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/config.inc.php
kippo-graph-1.5.1/include/qgooglevisualapi/readme.txt
kippo-graph-1.5.1/include/rb.php
kippo-graph-1.5.1/include/sql.php
kippo-graph-1.5.1/include/tor/
kippo-graph-1.5.1/include/tor/tor.class.php
kippo-graph-1.5.1/include/tor/tor_exit_node_list.txt
kippo-graph-1.5.1/index.php
kippo-graph-1.5.1/kippo-geo.php
kippo-graph-1.5.1/kippo-graph.php
kippo-graph-1.5.1/kippo-input.php
kippo-graph-1.5.1/kippo-ip.php
kippo-graph-1.5.1/kippo-playlog.php
kippo-graph-1.5.1/kippo-scanner.php
kippo-graph-1.5.1/robots.txt
kippo-graph-1.5.1/scripts/
kippo-graph-1.5.1/scripts/BinFileReader.js
kippo-graph-1.5.1/scripts/fancybox/
kippo-graph-1.5.1/scripts/fancybox/blank.gif
kippo-graph-1.5.1/scripts/fancybox/fancy_close.png
kippo-graph-1.5.1/scripts/fancybox/fancy_loading.png
kippo-graph-1.5.1/scripts/fancybox/fancy_nav_left.png
kippo-graph-1.5.1/scripts/fancybox/fancy_nav_right.png
kippo-graph-1.5.1/scripts/fancybox/fancy_shadow_e.png
kippo-graph-1.5.1/scripts/fancybox/fancy_shadow_n.png
kippo-graph-1.5.1/scripts/fancybox/fancy_shadow_ne.png
kippo-graph-1.5.1/scripts/fancybox/fancy_shadow_nw.png
kippo-graph-1.5.1/scripts/fancybox/fancy_shadow_s.png
kippo-graph-1.5.1/scripts/fancybox/fancy_shadow_se.png
kippo-graph-1.5.1/scripts/fancybox/fancy_shadow_sw.png
kippo-graph-1.5.1/scripts/fancybox/fancy_shadow_w.png
kippo-graph-1.5.1/scripts/fancybox/fancy_title_left.png
kippo-graph-1.5.1/scripts/fancybox/fancy_title_main.png
kippo-graph-1.5.1/scripts/fancybox/fancy_title_over.png
kippo-graph-1.5.1/scripts/fancybox/fancy_title_right.png
kippo-graph-1.5.1/scripts/fancybox/fancybox-x.png
kippo-graph-1.5.1/scripts/fancybox/fancybox-y.png
kippo-graph-1.5.1/scripts/fancybox/fancybox.png
kippo-graph-1.5.1/scripts/fancybox/index.php
kippo-graph-1.5.1/scripts/fancybox/jquery.easing-1.3.pack.js
kippo-graph-1.5.1/scripts/fancybox/jquery.fancybox-1.3.2.css
kippo-graph-1.5.1/scripts/fancybox/jquery.fancybox-1.3.2.js
kippo-graph-1.5.1/scripts/fancybox/jquery.fancybox-1.3.2.pack.js
kippo-graph-1.5.1/scripts/fancybox/jquery.fancybox-1.3.2.setup.js
kippo-graph-1.5.1/scripts/fancybox/jquery.mousewheel-3.0.4.pack.js
kippo-graph-1.5.1/scripts/hoverIntent.js
kippo-graph-1.5.1/scripts/index.php
kippo-graph-1.5.1/scripts/jquery-1.4.1.min.js
kippo-graph-1.5.1/scripts/jquery-1.4.4.min.js
kippo-graph-1.5.1/scripts/jquery.getUrlParam.js
kippo-graph-1.5.1/scripts/jquery.tablesorter.js
kippo-graph-1.5.1/scripts/jquery.tablesorter.pager.js
kippo-graph-1.5.1/scripts/jspl.js
kippo-graph-1.5.1/scripts/superfish.js
kippo-graph-1.5.1/styles/
kippo-graph-1.5.1/styles/forms.css
kippo-graph-1.5.1/styles/gallery.css
kippo-graph-1.5.1/styles/homepage.css
kippo-graph-1.5.1/styles/index.php
kippo-graph-1.5.1/styles/layout.css
kippo-graph-1.5.1/styles/navi.css
kippo-graph-1.5.1/styles/playlog.css
kippo-graph-1.5.1/styles/portfolio.css
kippo-graph-1.5.1/styles/tables.css
kippo-graph-1.5.1/styles/tablesorter.css
$
$ sudo vi /etc/apache2/conf-available/kippo-graph.conf
&lt;IfModule mod_alias.c&gt;
    Alias /kippo-graph /usr/share/kippo-graph-1.5.1
&lt;/IfModule&gt;
$
$ sudo a2enconf kippo-graph
Enabling conf kippo-graph.
To activate the new configuration, you need to run:
  service apache2 reload
$
$ sudo apachectl configtest
Syntax OK
$
$ sudo systemctl restart apache2
$
</code></pre>

<p>Kippo-Graphの設定</p>

<pre><code>$ sudo chmod 777 /usr/share/kippo-graph-1.5.1/generated-graphs/
$ sudo cp -p /usr/share/kippo-graph-1.5.1/config.php.dist /usr/share/kippo-graph-1.5.1/config.php
$ ls -l /usr/share/kippo-graph-1.5.1/config.php*
-rw-rw-r-- 1 root root 3777  6月 22  2015 /usr/share/kippo-graph-1.5.1/config.php
-rw-rw-r-- 1 root root 3777  6月 22  2015 /usr/share/kippo-graph-1.5.1/config.php.dist
$
$ sudo vi /usr/share/kippo-graph-1.5.1/config.php
define('DB_HOST', 'localhost');
define('DB_USER', 'cowrie');
define('DB_PASS', 'cowrie_password');
define('DB_NAME', 'cowrie');
define('DB_PORT', '3306');
</code></pre>

<h3 id="kippo-graphの修正:05481c997d19830c663ad9e91abca85e">Kippo-Graphの修正</h3>

<p>KippoとCowrieのデータベースのテーブル構造の違いにより一部動かない機能(KIPPO-PLAYLOG)がありました。</p>

<p>PLAYLOGを再生するために以下のファイルを修正しました。一応、PLAYLOGが再生できるようになりましたが、他の部分に影響がないかは不明です。。。試すとしても自己責任でお願いします。</p>

<p><code>class/KippoPlayLog.class.php</code>の修正</p>

<pre><code>$ cd /usr/share/kippo-graph-1.5.1
$ sudo cp -p class/KippoPlayLog.class.php{,.org}
$ ls -l class/KippoPlayLog.class.php*
-rw-rw-r-- 1 root root 2134  6月 22  2015 class/KippoPlayLog.class.php
-rw-rw-r-- 1 root root 2134  6月 22  2015 class/KippoPlayLog.class.php.org
$
$ sudo vi class/KippoPlayLog.class.php
$ diff class/KippoPlayLog.class.php.org class/KippoPlayLog.class.php
21c21
&lt;             SELECT ttylog.session, timestamp, ROUND(LENGTH(ttylog)/1024, 2) AS size
---
&gt;             SELECT ttylog.session, timestamp, ROUND(size/1024, 2) AS size
$
</code></pre>

<p><code>include/play.php</code>の修正</p>

<pre><code>$ cd /usr/share/kippo-graph-1.5.1
$ sudo cp -p include/play.php{,.org}
$ls -l include/play.php*
-rw-rw-r-- 1 root root 10994  6月 22  2015 include/play.php
-rw-rw-r-- 1 root root 10994  6月 22  2015 include/play.php.org
$
$ sudo vi include/play.php
$ diff play.php.org play.php
70c70
&lt;                 $log = base64_encode($row['ttylog']);
---
&gt;                 $log = base64_encode(file_get_contents($row['ttylog']));
</code></pre>

<p>ttylogへのシンボリックリンク作成</p>

<pre><code>$ cd /usr/share/kippo-graph-1.5.1/include
$ sudo ln -s /home/cowrie/cowrie/log/ log
$ sudo chgrp www-data /home/cowrie/cowrie/log/tty/
$ sudo chmod g+s /home/cowrie/cowrie/log/tty/
$ ls -dl /home/cowrie/cowrie/log/tty
drwxr-sr-x 2 cowrie www-data 4096  1月  4 19:05 /home/cowrie/cowrie/log/tty
$
</code></pre>

<p>Cowrie起動スクリプトの修正</p>

<pre><code>$ sudo su - cowrie
$ cd cowrie
$ cp -p start.sh{,.backup20170105}
$ ls -l start.sh*
-rwxr-xr-x 1 cowrie cowrie 922  1月  4 21:10 start.sh
-rwxr-xr-x 1 cowrie cowrie 922  1月  4 21:10 start.sh.backup20170105
-rwxr-xr-x 1 cowrie cowrie 920  1月  4 19:05 start.sh.org
$
$ vi start.sh
$ diff start.sh.org start.sh
7c7
&lt; DAEMONIZE=&quot;&quot;
---
&gt; DAEMONIZE=&quot;-n&quot;
35c35
&lt;     twistd $XARGS $DAEMONIZE -l log/cowrie.log --umask 0077 --pidfile ${PIDFILE} cowrie
---
&gt;     twistd $XARGS $DAEMONIZE -l log/cowrie.log --umask 0027 --pidfile ${PIDFILE} cowrie
37c37
&lt;     authbind --deep twistd $DAEMONIZE $XARGS -l log/cowrie.log --umask 0077 --pidfile ${PIDFILE} cowrie
---
&gt;     authbind --deep twistd $DAEMONIZE $XARGS -l log/cowrie.log --umask 0027 --pidfile ${PIDFILE} cowrie
$
</code></pre>

<p>Cowrieの再起動</p>

<pre><code>$ sudo supervisorctl restart cowrie
cowrie: stopped
cowrie: started
$
</code></pre>

<p>以上</p>

                </div>
              </article>
              
              <div class="pagination">
                <ul class="pager">
  
  <li>Page 1 of 4</li>
  
  <li class="next"><a href="/page/2/">Older &rarr;</a></li>
  
</ul>

              </div>
            </div>
            <div class="sidebar col-md-3">
              <aside>
  
<section class="panel panel-default">
  <div class="panel-heading">
    <h1 class="panel-title">Profile</h1>
  </div>
  <div id="profile" class="panel-body text-center">
    <img src="http://www.shinayoshi.net//img/logo.png" alt="logo" class="img-responsive center-block" />
    <p>
      <a href="http://www.shinayoshi.net//about/">Author: shinayoshi</a>
    </p>
    <ul class="list-inline">
  
  <li>
    <a href="https://twitter.com/shinayoshi_net" target="_blank">
      <i class="fa fa-twitter-square fa-lg"></i>
    </a>
  </li>
  

  

  

  
  <li>
    <a href="https://github.com/shinayoshi" target="_blank">
      <i class="fa fa-github-square fa-lg"></i>
    </a>
  </li>
  

  
  <li>
    <a href="https://bitbucket.org/shinayoshi" target="_blank">
      <i class="fa fa-bitbucket-square fa-lg"></i>
    </a>
  </li>
  

  
  <li>
    <a href="http://www.slideshare.net/shinayoshi" target="_blank">
      <i class="fa fa-slideshare fa-lg"></i>
    </a>
  </li>
  
</ul>

  </div>
</section>

  <section class="panel panel-default">
  <div class="panel-heading">
    <h1 class="panel-title">Recent Posts</h1>
  </div>
  <div id="recent_posts" class="list-group">
    
      
      <a href="http://www.shinayoshi.net/post/2017/01/15/backup-raspberrypi/" class="list-group-item">家庭内インターネット接続環境を構築する その17 [ 2017-01-15 ]</a>
      
      <a href="http://www.shinayoshi.net/post/2017/01/12/setting-rsnapshot/" class="list-group-item">家庭内インターネット接続環境を構築する その16 [ 2017-01-12 ]</a>
      
      <a href="http://www.shinayoshi.net/post/2017/01/09/setting-snmpd/" class="list-group-item">家庭内インターネット接続環境を構築する その15 [ 2017-01-09 ]</a>
      
      <a href="http://www.shinayoshi.net/post/2017/01/09/setting-cacti/" class="list-group-item">家庭内インターネット接続環境を構築する その14 [ 2017-01-09 ]</a>
      
      <a href="http://www.shinayoshi.net/post/2017/01/09/setting-zabbix-agent/" class="list-group-item">家庭内インターネット接続環境を構築する その13 [ 2017-01-09 ]</a>
      
      <a href="http://www.shinayoshi.net/post/2017/01/08/setting-zabbix-server/" class="list-group-item">家庭内インターネット接続環境を構築する その12 [ 2017-01-08 ]</a>
      
      <a href="http://www.shinayoshi.net/post/2017/01/07/setting-rsyslog/" class="list-group-item">家庭内インターネット接続環境を構築する その11 [ 2017-01-07 ]</a>
      
      <a href="http://www.shinayoshi.net/post/2017/01/07/setting-ntp-server/" class="list-group-item">家庭内インターネット接続環境を構築する その10 [ 2017-01-07 ]</a>
      
      <a href="http://www.shinayoshi.net/post/2017/01/07/setting-cowrie-security/" class="list-group-item">家庭内インターネット接続環境を構築する その9 [ 2017-01-07 ]</a>
      
      <a href="http://www.shinayoshi.net/post/2017/01/05/setting-kippo-graph/" class="list-group-item">家庭内インターネット接続環境を構築する その8 [ 2017-01-05 ]</a>
      
      <a href="http://www.shinayoshi.net/post/2017/01/04/setting-cowrie/" class="list-group-item">家庭内インターネット接続環境を構築する その7 [ 2017-01-04 ]</a>
      
      <a href="http://www.shinayoshi.net/post/2017/01/03/setting-proxy/" class="list-group-item">家庭内インターネット接続環境を構築する その6 [ 2017-01-03 ]</a>
      
      <a href="http://www.shinayoshi.net/post/2017/01/03/setting-cache-dns/" class="list-group-item">家庭内インターネット接続環境を構築する その5 [ 2017-01-03 ]</a>
      
      <a href="http://www.shinayoshi.net/post/2017/01/02/setting-fileserver/" class="list-group-item">家庭内インターネット接続環境を構築する その4 [ 2017-01-02 ]</a>
      
      <a href="http://www.shinayoshi.net/post/2017/01/01/setting-usb-storage/" class="list-group-item">家庭内インターネット接続環境を構築する その3 [ 2017-01-01 ]</a>
      
    
  </div>
</section>

  
<section class="panel panel-default">
  <div class="panel-heading">
    <h1 class="panel-title">Categories</h1>
  </div>
  <div id="categories" class="list-group">
    
    <a href="http://www.shinayoshi.net//categories/diary" class="list-group-item"><span class="badge">2</span>diary</a>
    
    <a href="http://www.shinayoshi.net//categories/server" class="list-group-item"><span class="badge">36</span>server</a>
    
  </div>
</section>

  
<section class="panel panel-default">
  <div class="panel-heading">
    <h1 class="panel-title">Tags</h1>
  </div>
  <div id="tags" class="panel-body">
    
    
    <a href="http://www.shinayoshi.net//tags/backup" >backup (1)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/bind" >bind (1)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/blog" >blog (1)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/cacti" >cacti (2)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/centos" >centos (2)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/cowrie" >cowrie (3)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/fgt-60d" >fgt-60d (1)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/fortigate" >fortigate (1)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/home-network" >home-network (17)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/homefw01" >homefw01 (1)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/homemon1" >homemon1 (6)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/homemon2" >homemon2 (6)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/homenas1" >homenas1 (6)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/homepot1" >homepot1 (5)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/homepxy1" >homepxy1 (4)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/igo" >igo (1)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/jessie" >jessie (14)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/kippo-graph" >kippo-graph (1)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/kivy" >kivy (1)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/raspberrypi" >raspberrypi (32)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/shogi" >shogi (1)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/squid" >squid (1)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/wifi" >wifi (1)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/zabbix" >zabbix (3)</a>
    
    
  </div>
</section>

</aside>

            </div>
          </div>
        </div>
      </div>

      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <hr />
          </div>
        </div>
      </div>
      <footer role="contentinfo">
        <div class="container">
          <p class="text-muted credits">
            Copyright (c) 2017 shinayoshi<br />
            <small>
              <span class="credit">Powered By <a href="http://hugo.spf13.com">Hugo</a></span>
            </small>
          </p>
        </div>
      </footer>

      
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
      
      <script src="http://www.shinayoshi.net//js/bootstrap.min.js"></script>

      <script src="https://yandex.st/highlightjs/8.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script>
      
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-37226857-2', 'auto');
  ga('send', 'pageview');
</script>


    </div>
  </body>
</html>

