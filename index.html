
<!DOCTYPE html>
<html class="no-js" lang="ja">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="generator" content="Hugo 0.15" />

    <base href="http://www.shinayoshi.net/" />
    <title>shinayoshi&#39;s note</title>
    <link rel="canonical" href="http://www.shinayoshi.net/" />
    <link href="http://www.shinayoshi.net//img/favicon.ico" type="image/vnd.microsoft.icon" rel="icon" />
    <link href="http://www.shinayoshi.net/index.xml" rel="alternate" title="shinayoshi&#39;s note" type="application/rss+xml" />

    
    <link href="http://www.shinayoshi.net//css/bootstrap.min.css" rel="stylesheet">

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://yandex.st/highlightjs/8.0/styles/default.min.css">

    
    
    
  </head>
  <body>
    <div id="wrap">


      <header role="banner">
        <nav class="navbar navbar-default" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" title="toggle navbar" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="http://www.shinayoshi.net//">shinayoshi&#39;s note</a>
            </div>
            <div class="navbar-collapse collapse">
              <ul class="nav navbar-nav">
                <li><a href="http://www.shinayoshi.net//">Home</a></li>
                <li><a href="http://www.shinayoshi.net//post/">All posts</a></li>
              </ul>
              <ul class="nav navbar-nav navbar-right">
                
                <li>
                  <form class="search navbar-form navbar-right" role="search" action="https://www.google.com/search" method="GET">
                    <input type="hidden" name="sitesearch" value="www.shinayoshi.net" />
                    <div class="form-group">
                      <input type="text" class="form-control" placeholder="Search" name="q" />
                    </div>
                  </form>
                </li>
                
                <li>
                  <a class="subscribe-rss" href="http://www.shinayoshi.net/index.xml" title="subscribe via RSS">
                    <i class="fa fa-rss fa-lg"></i>
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </nav>
      </header>


      <div id="main" role="main" class="container">
        <div id="content">
          <div class="row">
            <div class="page-content col-md-9">
              
              <article>
                <div class="title">
                  <h1><a href="http://www.shinayoshi.net/post/2017/01/07/setting-rsyslog/">家庭内インターネット接続環境を構築する その11</a></h1>
                  <p>
                    <span class="label label-primary">Sat Jan 7, 2017</span> in
                    
                    
                    <a href="http://www.shinayoshi.net//categories/server">server</a>
                     using tags
                    
                    
                    <a href="http://www.shinayoshi.net//tags/raspberrypi">raspberrypi</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/home-network">home-network</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homemon1">homemon1</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homemon2">homemon2</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homefw01">homefw01</a>
                    
                  </p>
                </div>
                <div class="contents">
                  

<p>FortiGate 60DとRaspberry Piを使用して家庭内インターネット接続環境を構築します。
最終的には以下のような構成を想定しています。</p>

<p><img src="/img/20161022_01/home-network.png" alt="home network" width="640px" /></p>

<p>前回に引き続き<code>homemon1</code>、<code>homemon2</code>を構築していきます。
FortiGate 60Dの通過ログやセキュリティイベントログを記録するためにSyslogサーバを構築します。</p>

<h2 id="rsyslogの設定:273aa48f87da59ed5cb2388af8a4171d">rsyslogの設定</h2>

<p>ネットワーク機器のSyslogを保存する用の設定</p>

<p>ネットワーク機器のIPアドレスまたはホスト名でディレクトリを作成し、IPアドレスまたはホスト名でログファイルを作成する。
例）/var/log/network-device/ホスト名/ホスト名.log</p>

<pre><code>$ sudo cp -p /etc/rsyslog.conf{,.org}
$ ls -l /etc/rsyslog.conf*
-rw-r--r-- 1 root root 2632 12月 14  2015 /etc/rsyslog.conf
-rw-r--r-- 1 root root 2632 12月 14  2015 /etc/rsyslog.conf.org
$
$ sudo vi /etc/rsyslog.conf
#$ModLoad imudp
#$UDPServerRun 514
$ModLoad imudp
$UDPServerRun 514

$WorkDirectory /var/spool/rsyslog

#
# Queue
#
$MainMsgQueueType LinkedList
#$ActionQueueType Direct

$ diff /etc/rsyslog.conf.org /etc/rsyslog.conf
16,17c16,17
&lt; #$ModLoad imudp
&lt; #$UDPServerRun 514
---
&gt; $ModLoad imudp
&gt; $UDPServerRun 514
46a47,52
&gt; 
&gt; #
&gt; # Queue
&gt; #
&gt; $MainMsgQueueType LinkedList
&gt; #$ActionQueueType Direct
$
$ sudo vi /etc/rsyslog.d/network-device.conf
$template NetworkDeviceFileName,&quot;/var/log/network-device/%hostname:::secpath-replace%/%hostname:::secpath-replace%.log&quot;
if $fromhost-ip != '127.0.0.1' then ?NetworkDeviceFileName
</code></pre>

<p>rsyslogの再起動</p>

<pre><code>$ sudo systemctl restart rsyslog
</code></pre>

<ul>
<li><a href="https://access.redhat.com/documentation/ja-JP/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/s1-working_with_queues_in_rsyslog.html">20.4. Rsyslog でのキュー (Queue) を使った操作</a></li>
</ul>

<h2 id="ログローテート:273aa48f87da59ed5cb2388af8a4171d">ログローテート</h2>

<p>ログローテートの設定</p>

<pre><code>$ sudo vi /etc/logrotate.d/network-device
/var/log/network-device/*/*.log
{
	daily
	rotate 92
	dateext
	create 0640 root adm
	missingok
	ifempty
	compress
	sharedscripts
	postrotate
		invoke-rc.d rsyslog rotate &gt; /dev/null
	endscript
}
</code></pre>

<p>logrotateをテスト実行し、エラーがないことを確認</p>

<pre><code>$ sudo logrotate -dv /etc/logrotate.d/network-device 
reading config file /etc/logrotate.d/network-device

Handling 1 logs

rotating pattern: /var/log/network-device/*/*.log
 after 1 days (92 rotations)
empty log files are rotated, old logs are removed
considering log /var/log/network-device/192.168.30.254/192.168.30.254.log
  log does not need rotating
not running postrotate script, since no logs were rotated
</code></pre>

<ul>
<li><a href="http://server-setting.info/centos/loglotation.html">ログローテーション(logrotate)を使ってみる ( httpd(apache)の設定例 ) | レンタルサーバー・自宅サーバー設定・構築のヒント</a></li>
<li><a href="https://open-groove.net/linux/logrotate-test/">logrotate（ログローテート）の動作確認 | OpenGroove</a></li>
</ul>

<h2 id="fortigate-60dのsyslog送信設定:273aa48f87da59ed5cb2388af8a4171d">FortiGate 60DのSyslog送信設定</h2>

<p>FortiGate 60DからSyslogサーバにsyslog送信を行うように設定</p>

<pre><code># config log syslogd setting
(setting)# set status enable
(setting)# set server &quot;192.168.30.10&quot;
(setting)# end
#
# config log syslogd setting
(setting)# set status enable
(setting)# set server &quot;192.168.30.20&quot;
(setting)# end
#
</code></pre>

<p>FortiGate 60Dのsyslog送信設定の確認</p>

<pre><code># show log syslogd setting
config log syslogd setting
	set status enable
	set server &quot;192.168.30.10&quot;
end
#
# show log syslogd2 setting
config log syslogd2 setting
	set status enable
	set server &quot;192.168.30.20&quot;
end
#
</code></pre>

<p>以上</p>

                </div>
              </article>
              
              <article>
                <div class="title">
                  <h1><a href="http://www.shinayoshi.net/post/2017/01/07/setting-ntp-server/">家庭内インターネット接続環境を構築する その10</a></h1>
                  <p>
                    <span class="label label-primary">Sat Jan 7, 2017</span> in
                    
                    
                    <a href="http://www.shinayoshi.net//categories/server">server</a>
                     using tags
                    
                    
                    <a href="http://www.shinayoshi.net//tags/raspberrypi">raspberrypi</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/home-network">home-network</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homemon1">homemon1</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homemon2">homemon2</a>
                    
                  </p>
                </div>
                <div class="contents">
                  

<p>FortiGate 60DとRaspberry Piを使用して家庭内インターネット接続環境を構築します。
最終的には以下のような構成を想定しています。</p>

<p><img src="/img/20161022_01/home-network.png" alt="home network" width="640px" /></p>

<p>今回は<code>homemon1</code>、<code>homemon2</code>を構築していきます。
まずは本環境内の機器から時刻同期を行えるようにNTPサーバを構築します。</p>

<h2 id="ntpサーバの構築:1f1fc8ca38bc68f6fa4bdfc515f760ab">NTPサーバの構築</h2>

<pre><code>$ sudo cp -p /etc/ntp.conf{,.backup20170107}
$ ls -l /etc/ntp.conf*
-rw-r--r-- 1 root root 2052  9月 23 13:25 /etc/ntp.conf
-rw-r--r-- 1 root root 2052  9月 23 13:25 /etc/ntp.conf.backup20170107
-rw-r--r-- 1 root root 1988  7月 26 07:36 /etc/ntp.conf.org
$
$ sudo vi /etc/ntp.conf
# Clients from this (example!) subnet have unlimited access, but only if
# cryptographically authenticated.
#restrict 192.168.123.0 mask 255.255.255.0 notrust
restrict 192.168.10.0 mask 255.255.255.0 nomodify notrap nopeer
restrict 192.168.20.0 mask 255.255.255.0 nomodify notrap nopeer
restrict 192.168.30.0 mask 255.255.255.0 nomodify notrap nopeer
restrict 192.168.40.0 mask 255.255.255.0 nomodify notrap nopeer
$
$ diff /etc/ntp.conf.backup20170107 /etc/ntp.conf
47a48,51
&gt; restrict 192.168.10.0 mask 255.255.255.0 nomodify notrap nopeer
&gt; restrict 192.168.20.0 mask 255.255.255.0 nomodify notrap nopeer
&gt; restrict 192.168.30.0 mask 255.255.255.0 nomodify notrap nopeer
&gt; restrict 192.168.40.0 mask 255.255.255.0 nomodify notrap nopeer
$
</code></pre>

<p>NTPサーバの再起動</p>

<pre><code>$ sudo systemctl restart ntp
</code></pre>

<p>以上</p>

                </div>
              </article>
              
              <article>
                <div class="title">
                  <h1><a href="http://www.shinayoshi.net/post/2017/01/07/setting-cowrie-security/">家庭内インターネット接続環境を構築する その9</a></h1>
                  <p>
                    <span class="label label-primary">Sat Jan 7, 2017</span> in
                    
                    
                    <a href="http://www.shinayoshi.net//categories/server">server</a>
                     using tags
                    
                    
                    <a href="http://www.shinayoshi.net//tags/raspberrypi">raspberrypi</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/home-network">home-network</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homepot1">homepot1</a>
                    
                  </p>
                </div>
                <div class="contents">
                  

<p>FortiGate 60DとRaspberry Piを使用して家庭内インターネット接続環境を構築します。
最終的には以下のような構成を想定しています。</p>

<p><img src="/img/20161022_01/home-network.png" alt="home network" width="640px" /></p>

<p>前回に引き続き<code>homepot1</code>を構築していきます。
Cowrieを使用するにあたりやっておきたいセキュリティ設定を行っていきます。</p>

<h2 id="ipv6の無効化:cb5f0701b8057bc3422a1cfa2b48de88">IPv6の無効化</h2>

<p>IPv6は使用しないため、IPv6を無効化します。</p>

<pre><code>$ sudo sysctl -w net.ipv6.conf.all.disable_ipv6=1
net.ipv6.conf.all.disable_ipv6 = 1
$
$ sudo sysctl -w net.ipv6.conf.default.disable_ipv6=1
net.ipv6.conf.default.disable_ipv6 = 1
$
$ sudo sysctl -a | grep disable_ipv6
sysctl: reading key &quot;net.ipv6.conf.all.stable_secret&quot;
net.ipv6.conf.all.disable_ipv6 = 1
sysctl: reading key &quot;net.ipv6.conf.default.stable_secret&quot;
net.ipv6.conf.default.disable_ipv6 = 1
sysctl: reading key &quot;net.ipv6.conf.eth0.stable_secret&quot;
net.ipv6.conf.eth0.disable_ipv6 = 1
sysctl: reading key &quot;net.ipv6.conf.eth1.stable_secret&quot;
net.ipv6.conf.eth1.disable_ipv6 = 1
sysctl: reading key &quot;net.ipv6.conf.lo.stable_secret&quot;
net.ipv6.conf.lo.disable_ipv6 = 1
$
</code></pre>

<p>再起動後もIPv6が無効化するように設定します。</p>

<pre><code>$ sudo vi /etc/sysctl.d/10-disableipv6.conf
net.ipv6.conf.all.disable_ipv6=1
net.ipv6.conf.default.disable_ipv6=1
</code></pre>

<h2 id="selinuxの無効化:cb5f0701b8057bc3422a1cfa2b48de88">SELinuxの無効化</h2>

<p>Raspbian(Jessie)ではデフォルトでSELinuxが使えないようなので、特にやることなし。</p>

<h2 id="iptablesの設定:cb5f0701b8057bc3422a1cfa2b48de88">iptablesの設定</h2>

<p>iptablesでfirewallを設定します。</p>

<pre><code>#Cowrieポートのポートフォワード(別手順で設定済み)
#$ sudo iptables -t nat -A PREROUTING -p tcp --dport 22 -j REDIRECT --to-port 2222

##INPUTチェーン
#IPスプーフィング対策
$ sudo iptables -A INPUT -p tcp --tcp-flags SYN,ACK SYN,ACK -m state --state NEW -j REJECT --reject-with tcp-reset

#セッションハイジャック対策
$ sudo iptables -A INPUT -p tcp ! --syn -m state --state NEW -j DROP

#不正なパケット拒否
$ sudo iptables -A INPUT -m state --state INVALID -j DROP

#内部からの通信を始めた場合のパケットは許可
$ sudo iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

#ループバックからの通信は通す
$ sudo iptables -A INPUT -i lo -j ACCEPT

#ICMPパケットは許可
$ sudo iptables -A INPUT -p icmp -j ACCEPT

#DHCPクライアントとしてDHCPに必要な通信は通す
#$ sudo iptables -A INPUT -p udp --dport 67 --sport 68 -j ACCEPT

#SSH(20022/tcp)は許可(ローカルネットワークからの接続のみ許可)
$ sudo iptables -A INPUT -m state --state NEW -m tcp -p tcp -s 192.168.10.0/24 --dport 20022 -j ACCEPT

#HTTPは許可(ローカルネットワークからの接続のみ許可)
$ sudo iptables -A INPUT -m state --state NEW -m tcp -p tcp -s 192.168.10.0/24 --dport 80 -j ACCEPT

#Cowrieは許可(5回まで新規接続許可。それ以降は1分に1回に制限。10分間無接続なら制限解除)
$ sudo iptables -A INPUT -p tcp --dport 2222 -m state --state NEW -m hashlimit --hashlimit-name ssh_limit --hashlimit 1/m --hashlimit-burst 5 --hashlimit-mode srcip --hashlimit-htable-expire 600000 -j ACCEPT

#Zabbix-Agentへの通信は許可
#$ sudo iptables -A INPUT -m state --state NEW -m tcp -p tcp -s 192.168.30.0/24 --dport 10050 -j ACCEPT

##OUTPUTチェーン
#ループバックへの通信は通す
$ sudo iptables -A OUTPUT -o lo -j ACCEPT

#ICMP応答のパケットは通す
$ sudo iptables -A OUTPUT -p icmp -m state --state ESTABLISHED,RELATED -j ACCEPT

#外部からの通信を始めた場合のパケットを許可
$ sudo iptables -A OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

#tcp-resetの通信は通す
$ sudo iptables -A OUTPUT -p tcp --tcp-flags FIN,SYN,RST RST -m state --state ESTABLISHED,RELATED -j ACCEPT

#DHCPクライアントとしてDHCPに必要な通信は通す
#$ sudo iptables -A OUTPUT -p udp --dport 68 --sport 67 -j ACCEPT

#ユーザrootが発したパケットは許可
$ sudo iptables -A OUTPUT -m owner --uid-owner 0 -j ACCEPT

#NTPは許可
$ sudo iptables -A OUTPUT -m state --state NEW -m udp -p udp --dport 123 -j ACCEPT

#Zabbix-Serverへの通信は許可
#$ sudo iptables -A OUTPUT -m state --state NEW -m tcp -p tcp -d 192.168.30.0/24 --dport 10051 -j ACCEPT

#外部からの通信は拒否。外部への通信も拒否。
$ sudo iptables -P INPUT DROP
$ sudo iptables -P FORWARD DROP
$ sudo iptables -P OUTPUT DROP
</code></pre>

<p>iptablesの設定を保存します。</p>

<pre><code>$ sudo netfilter-persistent save
run-parts: executing /usr/share/netfilter-persistent/plugins.d/15-ip4tables save
run-parts: executing /usr/share/netfilter-persistent/plugins.d/25-ip6tables save
$
</code></pre>

<ul>
<li><a href="http://techracho.bpsinc.jp/yamasita-taisuke/2013_05_01/8351">iptablesで鉄壁？の守りを実現する3つのTips</a></li>
<li><a href="http://www.unix-power.net/linux/iptables.html">CentOS iptablesによるパケットフィルタ</a></li>
<li><a href="http://kassyjp.ninja-web.net/ras/jessie/iptables.htm">2.iptables（ファイアウォール）のセットアップ - RaspberryPiで各種サーバー作り！ - ある阪大生の物置小屋</a></li>
</ul>

<h2 id="ログ出力先をsyslogに変更:cb5f0701b8057bc3422a1cfa2b48de88">ログ出力先をsyslogに変更</h2>

<p>twistdの作成するログは1000000MB程度でログローテートされてしまうため、Syslogに出力するように変更して日次でログローテートするように変更します。</p>

<p>ログ保管用のディレクトリ作成</p>

<pre><code>$ sudo mkdir /var/log/cowrie
$ sudo chown cowrie:adm /var/log/cowrie/
</code></pre>

<p>rsyslogの設定</p>

<pre><code>$ sudo vi /etc/rsyslog.d/cowrie.conf
if $programname == 'cowrie' then /var/log/cowrie/cowrie.log
&amp; ~
</code></pre>

<p>rsyslogの再起動</p>

<pre><code>$ sudo systemctl restart rsyslog
</code></pre>

<p>Cowrieのログ出力先変更</p>

<pre><code>$ sudo su - cowrie
$ cd cowrie
$ cp -p start.sh{,.backup20170107}
$ ls -l start.sh*
-rwxr-xr-x 1 cowrie cowrie 922  1月  5 05:21 start.sh
-rwxr-xr-x 1 cowrie cowrie 922  1月  4 21:10 start.sh.backup20170105
-rwxr-xr-x 1 cowrie cowrie 922  1月  5 05:21 start.sh.backup20170107
-rwxr-xr-x 1 cowrie cowrie 920  1月  4 19:05 start.sh.org
$
$ vi start.sh
$ diff start.sh.backup20170107 start.sh
35c35
&lt;     twistd $XARGS $DAEMONIZE -l log/cowrie.log --umask 0027 --pidfile ${PIDFILE} cowrie
---
&gt;     twistd $XARGS $DAEMONIZE --syslog --prefix cowrie --umask 0027 --pidfile ${PIDFILE} cowrie
37c37
&lt;     authbind --deep twistd $DAEMONIZE $XARGS -l log/cowrie.log --umask 0027 --pidfile ${PIDFILE} cowrie
---
&gt;     authbind --deep twistd $DAEMONIZE $XARGS --syslog --prefix cowrie --umask 0027 --pidfile ${PIDFILE} cowrie
$
</code></pre>

<h2 id="logrotateの設定:cb5f0701b8057bc3422a1cfa2b48de88">logrotateの設定</h2>

<p>logrotateをインストールします(通常はインストール済みのはずです)。</p>

<pre><code>$ sudo -E apt-get install logrotate
パッケージリストを読み込んでいます... 完了
依存関係ツリーを作成しています                
状態情報を読み取っています... 完了
logrotate はすでに最新版です。
アップグレード: 0 個、新規インストール: 0 個、削除: 0 個、保留: 0 個。
$
</code></pre>

<p>Cowrie用のlogrotate設定を作成</p>

<pre><code>$ sudo vi /etc/logrotate.d/cowrie
/var/log/cowrie/cowrie.log
{
        daily
        rotate 92
        dateext
        create 0640 cowrie adm
        missingok
        ifempty
        compress
        postrotate
                invoke-rc.d rsyslog rotate &gt; /dev/null
        endscript
}
</code></pre>

<p>logrotateをテスト実行し、エラーがないことを確認</p>

<pre><code>$ sudo logrotate -d /etc/logrotate.d/cowrie
reading config file /etc/logrotate.d/cowrie

Handling 1 logs

rotating pattern: /var/log/cowrie/cowrie.log
 after 1 days (92 rotations)
empty log files are rotated, old logs are removed
considering log /var/log/cowrie/cowrie.log
  log /var/log/cowrie/cowrie.log does not exist -- skipping
$
</code></pre>

<ul>
<li><a href="http://server-setting.info/centos/loglotation.html">ログローテーション(logrotate)を使ってみる ( httpd(apache)の設定例 ) | レンタルサーバー・自宅サーバー設定・構築のヒント</a></li>
<li><a href="https://open-groove.net/linux/logrotate-test/">logrotate（ログローテート）の動作確認 | OpenGroove</a></li>
</ul>

<h2 id="logwatchのインストール:cb5f0701b8057bc3422a1cfa2b48de88">logwatchのインストール</h2>

<p>logwatchをインストール</p>

<pre><code>$ sudo -E apt-get install logwatch
パッケージリストを読み込んでいます... 完了
依存関係ツリーを作成しています                
状態情報を読み取っています... 完了
以下の追加パッケージがインストールされます:
  bsd-mailx exim4-base exim4-config exim4-daemon-light libdate-manip-perl
  liblockfile-bin liblockfile1 libsys-cpu-perl
提案パッケージ:
  mail-reader eximon4 exim4-doc-html exim4-doc-info spf-tools-perl swaks
  fortune-mod
推奨パッケージ:
  mailx
以下のパッケージが新たにインストールされます:
  bsd-mailx exim4-base exim4-config exim4-daemon-light libdate-manip-perl
  liblockfile-bin liblockfile1 libsys-cpu-perl logwatch
アップグレード: 0 個、新規インストール: 9 個、削除: 0 個、保留: 0 個。
3,532 kB のアーカイブを取得する必要があります。
この操作後に追加で 17.1 MB のディスク容量が消費されます。
続行しますか? [Y/n] y
取得:1 http://mirrordirector.raspbian.org/raspbian/ jessie/main liblockfile-bin armhf 1.09-6 [18.2 kB]
取得:2 http://mirrordirector.raspbian.org/raspbian/ jessie/main liblockfile1 armhf 1.09-6 [14.7 kB]
取得:3 http://mirrordirector.raspbian.org/raspbian/ jessie/main exim4-config all 4.84.2-2+deb8u2 [503 kB]
取得:4 http://mirrordirector.raspbian.org/raspbian/ jessie/main exim4-base armhf 4.84.2-2+deb8u2 [1,046 kB]
取得:5 http://mirrordirector.raspbian.org/raspbian/ jessie/main exim4-daemon-light armhf 4.84.2-2+deb8u2 [578 kB]
取得:6 http://mirrordirector.raspbian.org/raspbian/ jessie/main bsd-mailx armhf 8.1.2-0.20141216cvs-2 [74.3 kB]
取得:7 http://mirrordirector.raspbian.org/raspbian/ jessie/main libdate-manip-perl all 6.47-1 [923 kB]
取得:8 http://mirrordirector.raspbian.org/raspbian/ jessie/main libsys-cpu-perl armhf 0.61-1+b1 [9,800 B]
取得:9 http://mirrordirector.raspbian.org/raspbian/ jessie/main logwatch all 7.4.1-2 [365 kB]
3,532 kB を 48秒 で取得しました (72.9 kB/s)                                    
パッケージを事前設定しています ...
以前に未選択のパッケージ liblockfile-bin を選択しています。
(データベースを読み込んでいます ... 現在 36617 個のファイルとディレクトリがインストールされています。)
.../liblockfile-bin_1.09-6_armhf.deb を展開する準備をしています ...
liblockfile-bin (1.09-6) を展開しています...
以前に未選択のパッケージ liblockfile1:armhf を選択しています。
.../liblockfile1_1.09-6_armhf.deb を展開する準備をしています ...
liblockfile1:armhf (1.09-6) を展開しています...
以前に未選択のパッケージ exim4-config を選択しています。
.../exim4-config_4.84.2-2+deb8u2_all.deb を展開する準備をしています ...
exim4-config (4.84.2-2+deb8u2) を展開しています...
以前に未選択のパッケージ exim4-base を選択しています。
.../exim4-base_4.84.2-2+deb8u2_armhf.deb を展開する準備をしています ...
exim4-base (4.84.2-2+deb8u2) を展開しています...
以前に未選択のパッケージ exim4-daemon-light を選択しています。
.../exim4-daemon-light_4.84.2-2+deb8u2_armhf.deb を展開する準備をしています ...
exim4-daemon-light (4.84.2-2+deb8u2) を展開しています...
以前に未選択のパッケージ bsd-mailx を選択しています。
.../bsd-mailx_8.1.2-0.20141216cvs-2_armhf.deb を展開する準備をしています ...
bsd-mailx (8.1.2-0.20141216cvs-2) を展開しています...
以前に未選択のパッケージ libdate-manip-perl を選択しています。
.../libdate-manip-perl_6.47-1_all.deb を展開する準備をしています ...
libdate-manip-perl (6.47-1) を展開しています...
以前に未選択のパッケージ libsys-cpu-perl を選択しています。
.../libsys-cpu-perl_0.61-1+b1_armhf.deb を展開する準備をしています ...
libsys-cpu-perl (0.61-1+b1) を展開しています...
以前に未選択のパッケージ logwatch を選択しています。
.../logwatch_7.4.1-2_all.deb を展開する準備をしています ...
logwatch (7.4.1-2) を展開しています...
man-db (2.7.0.2-5) のトリガを処理しています ...
systemd (215-17+deb8u5) のトリガを処理しています ...
liblockfile-bin (1.09-6) を設定しています ...
liblockfile1:armhf (1.09-6) を設定しています ...
exim4-config (4.84.2-2+deb8u2) を設定しています ...
Adding system-user for exim (v4)
exim4-base (4.84.2-2+deb8u2) を設定しています ...
exim: DB upgrade, deleting hints-db
exim4-daemon-light (4.84.2-2+deb8u2) を設定しています ...
bsd-mailx (8.1.2-0.20141216cvs-2) を設定しています ...
update-alternatives: /usr/bin/mailx (mailx) を提供するために自動モードで /usr/bin/bsd-mailx を使います
libdate-manip-perl (6.47-1) を設定しています ...
libsys-cpu-perl (0.61-1+b1) を設定しています ...
logwatch (7.4.1-2) を設定しています ...
libc-bin (2.19-18+deb8u6) のトリガを処理しています ...
systemd (215-17+deb8u5) のトリガを処理しています ...
$
</code></pre>

<p>logwatchの実行結果を確認</p>

<pre><code>$ sudo logwatch --output stdout
</code></pre>

<p>以上</p>

                </div>
              </article>
              
              <article>
                <div class="title">
                  <h1><a href="http://www.shinayoshi.net/post/2017/01/05/setting-kippo-graph/">家庭内インターネット接続環境を構築する その8</a></h1>
                  <p>
                    <span class="label label-primary">Thu Jan 5, 2017</span> in
                    
                    
                    <a href="http://www.shinayoshi.net//categories/server">server</a>
                     using tags
                    
                    
                    <a href="http://www.shinayoshi.net//tags/raspberrypi">raspberrypi</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/home-network">home-network</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homepot1">homepot1</a>
                    
                  </p>
                </div>
                <div class="contents">
                  

<p>FortiGate 60DとRaspberry Piを使用して家庭内インターネット接続環境を構築します。
最終的には以下のような構成を想定しています。</p>

<p><img src="/img/20161022_01/home-network.png" alt="home network" width="640px" /></p>

<p>前回に引き続き<code>homepot1</code>を構築していきます。</p>

<h2 id="kippo-graphによるsshハニーポット-cowrie-の可視化:05481c997d19830c663ad9e91abca85e">Kippo-GraphによるSSHハニーポット(Cowrie)の可視化</h2>

<h3 id="mysqlのインストールと初期化:05481c997d19830c663ad9e91abca85e">MySQLのインストールと初期化</h3>

<p>MySQLをインストールします。
インストール途中でMySQLのrootアカウントのパスワードを求められるので、適宜設定します。</p>

<pre><code>$ sudo -E apt-get install mysql-server
パッケージリストを読み込んでいます... 完了
依存関係ツリーを作成しています                
状態情報を読み取っています... 完了
以下の追加パッケージがインストールされます:
  libaio1 libdbd-mysql-perl libdbi-perl libhtml-template-perl libmysqlclient18
  libterm-readkey-perl mysql-client-5.5 mysql-common mysql-server-5.5
  mysql-server-core-5.5
提案パッケージ:
  libclone-perl libmldbm-perl libnet-daemon-perl libsql-statement-perl
  libipc-sharedcache-perl mailx tinyca
以下のパッケージが新たにインストールされます:
  libaio1 libdbd-mysql-perl libdbi-perl libhtml-template-perl libmysqlclient18
  libterm-readkey-perl mysql-client-5.5 mysql-common mysql-server
  mysql-server-5.5 mysql-server-core-5.5
アップグレード: 0 個、新規インストール: 11 個、削除: 0 個、保留: 0 個。
8,275 kB のアーカイブを取得する必要があります。
この操作後に追加で 89.3 MB のディスク容量が消費されます。
続行しますか? [Y/n] y
取得:1 http://mirrordirector.raspbian.org/raspbian/ jessie/main libaio1 armhf 0.3.110-1 [9,228 B]
取得:2 http://mirrordirector.raspbian.org/raspbian/ jessie/main mysql-common all 5.5.53-0+deb8u1 [75.5 kB]
取得:3 http://mirrordirector.raspbian.org/raspbian/ jessie/main libmysqlclient18 armhf 5.5.53-0+deb8u1 [617 kB]
取得:4 http://mirrordirector.raspbian.org/raspbian/ jessie/main libdbi-perl armhf 1.631-3+b1 [807 kB]
取得:5 http://mirrordirector.raspbian.org/raspbian/ jessie/main libdbd-mysql-perl armhf 4.028-2+deb8u2 [113 kB]
取得:6 http://mirrordirector.raspbian.org/raspbian/ jessie/main libterm-readkey-perl armhf 2.32-1+b2 [26.1 kB]
取得:7 http://mirrordirector.raspbian.org/raspbian/ jessie/main mysql-client-5.5 armhf 5.5.53-0+deb8u1 [1,447 kB]
取得:8 http://mirrordirector.raspbian.org/raspbian/ jessie/main mysql-server-core-5.5 armhf 5.5.53-0+deb8u1 [3,448 kB]
取得:9 http://mirrordirector.raspbian.org/raspbian/ jessie/main mysql-server-5.5 armhf 5.5.53-0+deb8u1 [1,591 kB]
取得:10 http://mirrordirector.raspbian.org/raspbian/ jessie/main libhtml-template-perl all 2.95-1 [66.8 kB]
取得:11 http://mirrordirector.raspbian.org/raspbian/ jessie/main mysql-server all 5.5.53-0+deb8u1 [73.8 kB]
8,275 kB を 22秒 で取得しました (376 kB/s)                                     
パッケージを事前設定しています ...

→rootアカウントのパスワードを設定します。
 ┌───────────────────┤ mysql-server-5.5 を設定しています ├───────────────────┐
 │ 強制ではありませんが、MySQL を管理する &quot;root&quot; ユーザのパスワードを設定す  │ 
 │ ることを強くお勧めします。                                                │ 
 │                                                                           │ 
 │ この値を空のままにしておいた場合は、パスワードは変更されません。          │ 
 │                                                                           │ 
 │ MySQL の &quot;root&quot; ユーザに対する新しいパスワード:                           │ 
 │                                                                           │ 
 │ _________________________________________________________________________ │ 
 │                                                                           │ 
 │                                  &lt;了解&gt;                                   │ 
 │                                                                           │ 
 └───────────────────────────────────────────────────────────────────────────┘ 


→再度rootアカウントのパスワードを入力します。
 ┌──────┤ mysql-server-5.5 を設定しています ├───────┐
 │                                                  │ 
 │                                                  │ 
 │ MySQL の &quot;root&quot; ユーザに対する新しいパスワード:  │ 
 │                                                  │ 
 │ ****____________________________________________ │ 
 │                                                  │ 
 │                      &lt;了解&gt;                      │ 
 │                                                  │ 
 └──────────────────────────────────────────────────┘ 

以前に未選択のパッケージ libaio1:armhf を選択しています。
(データベースを読み込んでいます ... 現在 35107 個のファイルとディレクトリがインストールされています。)
.../libaio1_0.3.110-1_armhf.deb を展開する準備をしています ...
libaio1:armhf (0.3.110-1) を展開しています...
以前に未選択のパッケージ mysql-common を選択しています。
.../mysql-common_5.5.53-0+deb8u1_all.deb を展開する準備をしています ...
mysql-common (5.5.53-0+deb8u1) を展開しています...
以前に未選択のパッケージ libmysqlclient18:armhf を選択しています。
.../libmysqlclient18_5.5.53-0+deb8u1_armhf.deb を展開する準備をしています ...
libmysqlclient18:armhf (5.5.53-0+deb8u1) を展開しています...
以前に未選択のパッケージ libdbi-perl を選択しています。
.../libdbi-perl_1.631-3+b1_armhf.deb を展開する準備をしています ...
libdbi-perl (1.631-3+b1) を展開しています...
以前に未選択のパッケージ libdbd-mysql-perl を選択しています。
.../libdbd-mysql-perl_4.028-2+deb8u2_armhf.deb を展開する準備をしています ...
libdbd-mysql-perl (4.028-2+deb8u2) を展開しています...
以前に未選択のパッケージ libterm-readkey-perl を選択しています。
.../libterm-readkey-perl_2.32-1+b2_armhf.deb を展開する準備をしています ...
libterm-readkey-perl (2.32-1+b2) を展開しています...
以前に未選択のパッケージ mysql-client-5.5 を選択しています。
.../mysql-client-5.5_5.5.53-0+deb8u1_armhf.deb を展開する準備をしています ...
mysql-client-5.5 (5.5.53-0+deb8u1) を展開しています...
以前に未選択のパッケージ mysql-server-core-5.5 を選択しています。
.../mysql-server-core-5.5_5.5.53-0+deb8u1_armhf.deb を展開する準備をしています ...
mysql-server-core-5.5 (5.5.53-0+deb8u1) を展開しています...
man-db (2.7.0.2-5) のトリガを処理しています ...
mysql-common (5.5.53-0+deb8u1) を設定しています ...
以前に未選択のパッケージ mysql-server-5.5 を選択しています。
(データベースを読み込んでいます ... 現在 35472 個のファイルとディレクトリがインストールされています。)
.../mysql-server-5.5_5.5.53-0+deb8u1_armhf.deb を展開する準備をしています ...
mysql-server-5.5 (5.5.53-0+deb8u1) を展開しています...
以前に未選択のパッケージ libhtml-template-perl を選択しています。
.../libhtml-template-perl_2.95-1_all.deb を展開する準備をしています ...
libhtml-template-perl (2.95-1) を展開しています...
以前に未選択のパッケージ mysql-server を選択しています。
.../mysql-server_5.5.53-0+deb8u1_all.deb を展開する準備をしています ...
mysql-server (5.5.53-0+deb8u1) を展開しています...
man-db (2.7.0.2-5) のトリガを処理しています ...
systemd (215-17+deb8u5) のトリガを処理しています ...
libaio1:armhf (0.3.110-1) を設定しています ...
libmysqlclient18:armhf (5.5.53-0+deb8u1) を設定しています ...
libdbi-perl (1.631-3+b1) を設定しています ...
libdbd-mysql-perl (4.028-2+deb8u2) を設定しています ...
libterm-readkey-perl (2.32-1+b2) を設定しています ...
mysql-client-5.5 (5.5.53-0+deb8u1) を設定しています ...
mysql-server-core-5.5 (5.5.53-0+deb8u1) を設定しています ...
mysql-server-5.5 (5.5.53-0+deb8u1) を設定しています ...
170105  3:45:31 [Warning] Using unique option prefix key_buffer instead of key_buffer_size is deprecated and will be removed in a future release. Please use the full name instead.
170105  3:45:31 [Note] Ignoring --secure-file-priv value as server is running with --bootstrap.
170105  3:45:31 [Note] /usr/sbin/mysqld (mysqld 5.5.53-0+deb8u1) starting as process 6055 ...
libhtml-template-perl (2.95-1) を設定しています ...
mysql-server (5.5.53-0+deb8u1) を設定しています ...
libc-bin (2.19-18+deb8u6) のトリガを処理しています ...
systemd (215-17+deb8u5) のトリガを処理しています ...
$
</code></pre>

<p>MySQLのセキュア設定</p>

<pre><code>$ mysql_secure_installation 




NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MySQL
      SERVERS IN PRODUCTION USE!  PLEASE READ EACH STEP CAREFULLY!


In order to log into MySQL to secure it, we'll need the current
password for the root user.  If you've just installed MySQL, and
you haven't set the root password yet, the password will be blank,
so you should just press enter here.

Enter current password for root (enter for none): 
OK, successfully used password, moving on...

Setting the root password ensures that nobody can log into the MySQL
root user without the proper authorisation.

You already have a root password set, so you can safely answer 'n'.

Change the root password? [Y/n] n
 ... skipping.

By default, a MySQL installation has an anonymous user, allowing anyone
to log into MySQL without having to have a user account created for
them.  This is intended only for testing, and to make the installation
go a bit smoother.  You should remove them before moving into a
production environment.

Remove anonymous users? [Y/n] Y
 ... Success!

Normally, root should only be allowed to connect from 'localhost'.  This
ensures that someone cannot guess at the root password from the network.

Disallow root login remotely? [Y/n] Y
 ... Success!

By default, MySQL comes with a database named 'test' that anyone can
access.  This is also intended only for testing, and should be removed
before moving into a production environment.

Remove test database and access to it? [Y/n] Y
 - Dropping test database...
ERROR 1008 (HY000) at line 1: Can't drop database 'test'; database doesn't exist
 ... Failed!  Not critical, keep moving...
 - Removing privileges on test database...
 ... Success!

Reloading the privilege tables will ensure that all changes made so far
will take effect immediately.

Reload privilege tables now? [Y/n] Y
 ... Success!

Cleaning up...



All done!  If you've completed all of the above steps, your MySQL
installation should now be secure.

Thanks for using MySQL!


$
</code></pre>

<p>MySQLの初期設定</p>

<pre><code>$ sudo cp -p /etc/mysql/my.cnf{,.org}
$ ls -l /etc/mysql/my.cnf*
-rw-r--r-- 1 root root 3533 10月 17 17:49 /etc/mysql/my.cnf
-rw-r--r-- 1 root root 3533 10月 17 17:49 /etc/mysql/my.cnf.org
$
$ sudo vi /etc/mysql/my.cnf
[mysqld]
# Add the following line to last of mysqld section
character-set-server=utf8
collation-server=utf8_general_ci
skip-character-set-client-handshake
default-storage-engine=InnoDB
innodb_file_per_table
innodb_buffer_pool_size=256M
skip-name-resolve

[mysqldump]
# Add the following line to last of mysqldump section
default-character-set=utf8

[mysql]
# Add the following line to last of mysql section
default-character-set=utf8
</code></pre>

<ul>
<li><a href="https://dev.mysql.com/doc/refman/5.5/en/server-system-variables.html">MySQL :: MySQL 5.5 Reference Manual :: 5.1.4 Server System Variables</a></li>
</ul>

<p>MySQLの再起動</p>

<pre><code>$ sudo systemctl restart mysql
$ sudo systemctl enable mysql
Synchronizing state for mysql.service with sysvinit using update-rc.d...
Executing /usr/sbin/update-rc.d mysql defaults
Executing /usr/sbin/update-rc.d mysql enable
$
</code></pre>

<h3 id="cowrieのログ出力先を変更:05481c997d19830c663ad9e91abca85e">Cowrieのログ出力先を変更</h3>

<p>Cowrie用データベースの作成</p>

<pre><code>$ mysql -uroot -p
Enter password: 
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 37
Server version: 5.5.53-0+deb8u1 (Raspbian)

Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt; create database cowrie character set utf8 collate utf8_bin;
Query OK, 1 row affected (0.00 sec)

mysql&gt; grant all privileges on cowrie.* to cowrie@localhost identified by 'cowrie_password';
Query OK, 0 rows affected (0.00 sec)

mysql&gt; quit
Bye
$
$ cd ${COWRIE_INSTALL_DIR}
$ cat doc/sql/mysql.sql | mysql -ucowrie -p cowrie
Enter password:
$
$ mysql -ucowrie -p
Enter password: 
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 39
Server version: 5.5.53-0+deb8u1 (Raspbian)

Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt; use cowrie
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql&gt; show tables;
+------------------+
| Tables_in_cowrie |
+------------------+
| auth             |
| clients          |
| downloads        |
| input            |
| keyfingerprints  |
| sensors          |
| sessions         |
| ttylog           |
+------------------+
8 rows in set (0.00 sec)

mysql&gt; 
mysql&gt; quit
Bye
$
</code></pre>

<p>CowrieのログをMySQLのデータベースに出力する事前準備</p>

<pre><code>$ sudo -E apt-get install libmysqlclient-dev
パッケージリストを読み込んでいます... 完了
依存関係ツリーを作成しています                
状態情報を読み取っています... 完了
以下のパッケージが新たにインストールされます:
  libmysqlclient-dev
アップグレード: 0 個、新規インストール: 1 個、削除: 0 個、保留: 0 個。
889 kB のアーカイブを取得する必要があります。
この操作後に追加で 4,866 kB のディスク容量が消費されます。
取得:1 http://mirrordirector.raspbian.org/raspbian/ jessie/main libmysqlclient-dev armhf 5.5.53-0+deb8u1 [889 kB]
889 kB を 2秒 で取得しました (306 kB/s)     
以前に未選択のパッケージ libmysqlclient-dev を選択しています。
(データベースを読み込んでいます ... 現在 38240 個のファイルとディレクトリがインストールされています。)
.../libmysqlclient-dev_5.5.53-0+deb8u1_armhf.deb を展開する準備をしています ...
libmysqlclient-dev (5.5.53-0+deb8u1) を展開しています...
man-db (2.7.0.2-5) のトリガを処理しています ...
libmysqlclient-dev (5.5.53-0+deb8u1) を設定しています ...
$
$ sudo su - cowrie
$ cd cowrie/
$ source cowrie-env/bin/activate
$ pip install mysql-python
Downloading/unpacking mysql-python
  Downloading MySQL-python-1.2.5.zip (108kB): 108kB downloaded
  Running setup.py (path:/tmp/pip-build-prjaIE/mysql-python/setup.py) egg_info for package mysql-python
Installing collected packages: mysql-python
  Running setup.py install for mysql-python
    building '_mysql' extension
    arm-linux-gnueabihf-gcc -pthread -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -fno-strict-aliasing -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -fPIC -Dversion_info=(1,2,5,'final',1) -D__version__=1.2.5 -I/usr/include/mysql -I/usr/include/python2.7 -c _mysql.c -o build/temp.linux-armv7l-2.7/_mysql.o -DBIG_JOINS=1 -fno-strict-aliasing -g -DNDEBUG
    In file included from _mysql.c:44:0:
    /usr/include/mysql/my_config.h:423:0: warning: &quot;HAVE_WCSCOLL&quot; redefined
     #define HAVE_WCSCOLL
     ^
    In file included from /usr/include/python2.7/pyconfig.h:13:0,
                     from /usr/include/python2.7/Python.h:8,
                     from _mysql.c:29:
    /usr/include/arm-linux-gnueabihf/python2.7/pyconfig.h:911:0: note: this is the location of the previous definition
     #define HAVE_WCSCOLL 1
     ^
    arm-linux-gnueabihf-gcc -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wl,-z,relro -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security build/temp.linux-armv7l-2.7/_mysql.o -L/usr/lib/arm-linux-gnueabihf -lmysqlclient_r -lpthread -lz -lm -ldl -o build/lib.linux-armv7l-2.7/_mysql.so
  Could not find .egg-info directory in install record for mysql-python
Successfully installed mysql-python
Cleaning up...
$
$ deactivate
$
</code></pre>

<p>CowrieのログをMySQLのデータベースに出力</p>

<pre><code>$ sudo su - cowrie
$ cd cowrie/
$ cp -p cowrie.cfg{,.backup20170105}
$ ls -l cowrie.cfg*
-rw-r--r-- 1 cowrie cowrie 11597  1月  4 20:16 cowrie.cfg
-rw-r--r-- 1 cowrie cowrie 11597  1月  4 20:16 cowrie.cfg.backup20170105
-rw-r--r-- 1 cowrie cowrie 11555  1月  4 19:05 cowrie.cfg.dist
$
$ vi cowrie.cfg
# Comment out the following line
#[output_jsonlog]
#logfile = log/cowrie.json

# Remove '#'
[output_mysql]
host = localhost
database = cowrie
username = cowrie
password = cowrie_password
port = 3306
debug = false
</code></pre>

<p>Cowrieの再起動</p>

<pre><code>$ sudo supervisorctl restart cowrie
cowrie: stopped
cowrie: started
$
$ sudo supervisorctl status cowrie
cowrie                           RUNNING    pid 7848, uptime 0:00:02
$
</code></pre>

<h3 id="apache2のインストール:05481c997d19830c663ad9e91abca85e">Apache2のインストール</h3>

<p>Apache2をインストールする。</p>

<pre><code>$ sudo -E apt-get install apache2
パッケージリストを読み込んでいます... 完了
依存関係ツリーを作成しています                
状態情報を読み取っています... 完了
以下の追加パッケージがインストールされます:
  apache2-bin apache2-data apache2-utils libapr1 libaprutil1
  libaprutil1-dbd-sqlite3 libaprutil1-ldap liblua5.1-0 ssl-cert
提案パッケージ:
  www-browser apache2-doc apache2-suexec-pristine apache2-suexec-custom
  openssl-blacklist
以下のパッケージが新たにインストールされます:
  apache2 apache2-bin apache2-data apache2-utils libapr1 libaprutil1
  libaprutil1-dbd-sqlite3 libaprutil1-ldap liblua5.1-0 ssl-cert
アップグレード: 0 個、新規インストール: 10 個、削除: 0 個、保留: 0 個。
1,750 kB のアーカイブを取得する必要があります。
この操作後に追加で 5,241 kB のディスク容量が消費されます。
続行しますか? [Y/n] y
取得:1 http://mirrordirector.raspbian.org/raspbian/ jessie/main libapr1 armhf 1.5.1-3 [77.1 kB]
取得:2 http://mirrordirector.raspbian.org/raspbian/ jessie/main libaprutil1 armhf 1.5.4-1 [75.9 kB]
取得:3 http://mirrordirector.raspbian.org/raspbian/ jessie/main libaprutil1-dbd-sqlite3 armhf 1.5.4-1 [17.7 kB]
取得:4 http://mirrordirector.raspbian.org/raspbian/ jessie/main libaprutil1-ldap armhf 1.5.4-1 [16.7 kB]
取得:5 http://mirrordirector.raspbian.org/raspbian/ jessie/main liblua5.1-0 armhf 5.1.5-7.1 [83.7 kB]
取得:6 http://mirrordirector.raspbian.org/raspbian/ jessie/main apache2-bin armhf 2.4.10-10+deb8u7 [893 kB]
取得:7 http://mirrordirector.raspbian.org/raspbian/ jessie/main apache2-utils armhf 2.4.10-10+deb8u7 [194 kB]
取得:8 http://mirrordirector.raspbian.org/raspbian/ jessie/main apache2-data all 2.4.10-10+deb8u7 [163 kB]
取得:9 http://mirrordirector.raspbian.org/raspbian/ jessie/main apache2 armhf 2.4.10-10+deb8u7 [207 kB]
取得:10 http://mirrordirector.raspbian.org/raspbian/ jessie/main ssl-cert all 1.0.35 [20.9 kB]
1,750 kB を 6秒 で取得しました (256 kB/s)                                      
パッケージを事前設定しています ...
以前に未選択のパッケージ libapr1:armhf を選択しています。
(データベースを読み込んでいます ... 現在 35575 個のファイルとディレクトリがインストールされています。)
.../libapr1_1.5.1-3_armhf.deb を展開する準備をしています ...
libapr1:armhf (1.5.1-3) を展開しています...
以前に未選択のパッケージ libaprutil1:armhf を選択しています。
.../libaprutil1_1.5.4-1_armhf.deb を展開する準備をしています ...
libaprutil1:armhf (1.5.4-1) を展開しています...
以前に未選択のパッケージ libaprutil1-dbd-sqlite3:armhf を選択しています。
.../libaprutil1-dbd-sqlite3_1.5.4-1_armhf.deb を展開する準備をしています ...
libaprutil1-dbd-sqlite3:armhf (1.5.4-1) を展開しています...
以前に未選択のパッケージ libaprutil1-ldap:armhf を選択しています。
.../libaprutil1-ldap_1.5.4-1_armhf.deb を展開する準備をしています ...
libaprutil1-ldap:armhf (1.5.4-1) を展開しています...
以前に未選択のパッケージ liblua5.1-0:armhf を選択しています。
.../liblua5.1-0_5.1.5-7.1_armhf.deb を展開する準備をしています ...
liblua5.1-0:armhf (5.1.5-7.1) を展開しています...
以前に未選択のパッケージ apache2-bin を選択しています。
.../apache2-bin_2.4.10-10+deb8u7_armhf.deb を展開する準備をしています ...
apache2-bin (2.4.10-10+deb8u7) を展開しています...
以前に未選択のパッケージ apache2-utils を選択しています。
.../apache2-utils_2.4.10-10+deb8u7_armhf.deb を展開する準備をしています ...
apache2-utils (2.4.10-10+deb8u7) を展開しています...
以前に未選択のパッケージ apache2-data を選択しています。
.../apache2-data_2.4.10-10+deb8u7_all.deb を展開する準備をしています ...
apache2-data (2.4.10-10+deb8u7) を展開しています...
以前に未選択のパッケージ apache2 を選択しています。
.../apache2_2.4.10-10+deb8u7_armhf.deb を展開する準備をしています ...
apache2 (2.4.10-10+deb8u7) を展開しています...
以前に未選択のパッケージ ssl-cert を選択しています。
.../ssl-cert_1.0.35_all.deb を展開する準備をしています ...
ssl-cert (1.0.35) を展開しています...
man-db (2.7.0.2-5) のトリガを処理しています ...
systemd (215-17+deb8u5) のトリガを処理しています ...
libapr1:armhf (1.5.1-3) を設定しています ...
libaprutil1:armhf (1.5.4-1) を設定しています ...
libaprutil1-dbd-sqlite3:armhf (1.5.4-1) を設定しています ...
libaprutil1-ldap:armhf (1.5.4-1) を設定しています ...
liblua5.1-0:armhf (5.1.5-7.1) を設定しています ...
apache2-bin (2.4.10-10+deb8u7) を設定しています ...
apache2-utils (2.4.10-10+deb8u7) を設定しています ...
apache2-data (2.4.10-10+deb8u7) を設定しています ...
apache2 (2.4.10-10+deb8u7) を設定しています ...
Enabling module mpm_event.
Enabling module authz_core.
Enabling module authz_host.
Enabling module authn_core.
Enabling module auth_basic.
Enabling module access_compat.
Enabling module authn_file.
Enabling module authz_user.
Enabling module alias.
Enabling module dir.
Enabling module autoindex.
Enabling module env.
Enabling module mime.
Enabling module negotiation.
Enabling module setenvif.
Enabling module filter.
Enabling module deflate.
Enabling module status.
Enabling conf charset.
Enabling conf localized-error-pages.
Enabling conf other-vhosts-access-log.
Enabling conf security.
Enabling conf serve-cgi-bin.
Enabling site 000-default.
ssl-cert (1.0.35) を設定しています ...
libc-bin (2.19-18+deb8u6) のトリガを処理しています ...
systemd (215-17+deb8u5) のトリガを処理しています ...
$
</code></pre>

<p>Apache2のセキュリティ設定</p>

<pre><code>$ sudo cp -p /etc/apache2/conf-available/security.conf{,.org}
$ ls -l /etc/apache2/conf-available/security.conf*
-rw-r--r-- 1 root root 2190  8月  7 19:56 /etc/apache2/conf-available/security.conf
-rw-r--r-- 1 root root 2190  8月  7 19:56 /etc/apache2/conf-available/security.conf.org
$
$ sudo vi /etc/apache2/conf-available/security.conf
ServerTokens Prod
ServerSignature Off
$
</code></pre>

<p>Apache2の文字コード設定</p>

<pre><code>$ sudo cp -p /etc/apache2/conf-available/charset.conf{,.org}
$ ls -l /etc/apache2/conf-available/charset.conf*
-rw-r--r-- 1 root root 315  7月  6  2016 /etc/apache2/conf-available/charset.conf
-rw-r--r-- 1 root root 315  7月  6  2016 /etc/apache2/conf-available/charset.conf.org
$
$ sudo vi /etc/apache2/conf-available/charset.conf
#AddDefaultCharset UTF-8
$
</code></pre>

<p>Apache2のServerName設定</p>

<pre><code>$ sudo sh -c &quot;echo ServerName ${HOSTNAME} &gt; /etc/apache2/conf-available/fqdn.conf&quot;
$ sudo a2enconf fqdn
Enabling conf fqdn.
To activate the new configuration, you need to run:
  service apache2 reload
$
</code></pre>

<p>Apache2の再起動</p>

<pre><code>$ sudo apachectl configtest
Syntax OK
$
$ sudo systemctl restart apache2
$ sudo systemctl enable apache2
Synchronizing state for apache2.service with sysvinit using update-rc.d...
Executing /usr/sbin/update-rc.d apache2 defaults
Executing /usr/sbin/update-rc.d apache2 enable
$
</code></pre>

<h3 id="kippo-graphのインストール:05481c997d19830c663ad9e91abca85e">Kippo-Graphのインストール</h3>

<p>Kippo-GraphのWebサイト(<code>https://bruteforce.gr/kippo-graph</code>)を参考にKippo-Graphをインストールする。</p>

<p>関連パッケージのインストール</p>

<pre><code>$ sudo -E apt-get install libapache2-mod-php5 php5-mysql php5-gd php5-curl
パッケージリストを読み込んでいます... 完了
依存関係ツリーを作成しています                
状態情報を読み取っています... 完了
以下の追加パッケージがインストールされます:
  fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libjbig0 libonig2
  libperl4-corelibs-perl libqdbm14 libtiff5 libvpx1 libxpm4 lsof php5-cli
  php5-common php5-json php5-readline
提案パッケージ:
  php-pear libgd-tools php5-user-cache
以下のパッケージが新たにインストールされます:
  fontconfig-config fonts-dejavu-core libapache2-mod-php5 libfontconfig1
  libgd3 libjbig0 libonig2 libperl4-corelibs-perl libqdbm14 libtiff5 libvpx1
  libxpm4 lsof php5-cli php5-common php5-curl php5-gd php5-json php5-mysql
  php5-readline
アップグレード: 0 個、新規インストール: 20 個、削除: 0 個、保留: 0 個。
7,989 kB のアーカイブを取得する必要があります。
この操作後に追加で 26.1 MB のディスク容量が消費されます。
続行しますか? [Y/n] y
取得:1 http://mirrordirector.raspbian.org/raspbian/ jessie/main fonts-dejavu-core all 2.34-1 [1,047 kB]
取得:2 http://mirrordirector.raspbian.org/raspbian/ jessie/main fontconfig-config all 2.11.0-6.3+deb8u1 [274 kB]
取得:3 http://mirrordirector.raspbian.org/raspbian/ jessie/main libfontconfig1 armhf 2.11.0-6.3+deb8u1 [312 kB]
取得:4 http://mirrordirector.raspbian.org/raspbian/ jessie/main libjbig0 armhf 2.1-3.1 [27.5 kB]
取得:5 http://mirrordirector.raspbian.org/raspbian/ jessie/main libtiff5 armhf 4.0.3-12.3+deb8u1 [194 kB]
取得:6 http://mirrordirector.raspbian.org/raspbian/ jessie/main libvpx1 armhf 1.3.0-3+rvt [783 kB]
取得:7 http://mirrordirector.raspbian.org/raspbian/ jessie/main libxpm4 armhf 1:3.5.11-1 [41.7 kB]
取得:8 http://mirrordirector.raspbian.org/raspbian/ jessie/main libgd3 armhf 2.1.0-5+deb8u8 [127 kB]
取得:9 http://mirrordirector.raspbian.org/raspbian/ jessie/main libonig2 armhf 5.9.5-3.2 [101 kB]
取得:10 http://mirrordirector.raspbian.org/raspbian/ jessie/main libperl4-corelibs-perl all 0.003-1 [43.6 kB]
取得:11 http://mirrordirector.raspbian.org/raspbian/ jessie/main lsof armhf 4.86+dfsg-1 [321 kB]
取得:12 http://mirrordirector.raspbian.org/raspbian/ jessie/main libqdbm14 armhf 1.8.78-5+b1 [86.0 kB]
取得:13 http://mirrordirector.raspbian.org/raspbian/ jessie/main php5-common armhf 5.6.29+dfsg-0+deb8u1 [720 kB]
取得:14 http://mirrordirector.raspbian.org/raspbian/ jessie/main php5-json armhf 1.3.6-1 [16.9 kB]
取得:15 http://mirrordirector.raspbian.org/raspbian/ jessie/main php5-cli armhf 5.6.29+dfsg-0+deb8u1 [1,904 kB]
取得:16 http://mirrordirector.raspbian.org/raspbian/ jessie/main libapache2-mod-php5 armhf 5.6.29+dfsg-0+deb8u1 [1,879 kB]
取得:17 http://mirrordirector.raspbian.org/raspbian/ jessie/main php5-curl armhf 5.6.29+dfsg-0+deb8u1 [24.5 kB]
取得:18 http://mirrordirector.raspbian.org/raspbian/ jessie/main php5-gd armhf 5.6.29+dfsg-0+deb8u1 [23.2 kB]
取得:19 http://mirrordirector.raspbian.org/raspbian/ jessie/main php5-mysql armhf 5.6.29+dfsg-0+deb8u1 [52.2 kB]
取得:20 http://mirrordirector.raspbian.org/raspbian/ jessie/main php5-readline armhf 5.6.29+dfsg-0+deb8u1 [11.2 kB]
7,989 kB を 19秒 で取得しました (403 kB/s)                                     
パッケージを事前設定しています ...
以前に未選択のパッケージ fonts-dejavu-core を選択しています。
(データベースを読み込んでいます ... 現在 36265 個のファイルとディレクトリがインストールされています。)
.../fonts-dejavu-core_2.34-1_all.deb を展開する準備をしています ...
fonts-dejavu-core (2.34-1) を展開しています...
以前に未選択のパッケージ fontconfig-config を選択しています。
.../fontconfig-config_2.11.0-6.3+deb8u1_all.deb を展開する準備をしています ...
fontconfig-config (2.11.0-6.3+deb8u1) を展開しています...
以前に未選択のパッケージ libfontconfig1:armhf を選択しています。
.../libfontconfig1_2.11.0-6.3+deb8u1_armhf.deb を展開する準備をしています ...
libfontconfig1:armhf (2.11.0-6.3+deb8u1) を展開しています...
以前に未選択のパッケージ libjbig0:armhf を選択しています。
.../libjbig0_2.1-3.1_armhf.deb を展開する準備をしています ...
libjbig0:armhf (2.1-3.1) を展開しています...
以前に未選択のパッケージ libtiff5:armhf を選択しています。
.../libtiff5_4.0.3-12.3+deb8u1_armhf.deb を展開する準備をしています ...
libtiff5:armhf (4.0.3-12.3+deb8u1) を展開しています...
以前に未選択のパッケージ libvpx1:armhf を選択しています。
.../libvpx1_1.3.0-3+rvt_armhf.deb を展開する準備をしています ...
libvpx1:armhf (1.3.0-3+rvt) を展開しています...
以前に未選択のパッケージ libxpm4:armhf を選択しています。
.../libxpm4_1%3a3.5.11-1_armhf.deb を展開する準備をしています ...
libxpm4:armhf (1:3.5.11-1) を展開しています...
以前に未選択のパッケージ libgd3:armhf を選択しています。
.../libgd3_2.1.0-5+deb8u8_armhf.deb を展開する準備をしています ...
libgd3:armhf (2.1.0-5+deb8u8) を展開しています...
以前に未選択のパッケージ libonig2:armhf を選択しています。
.../libonig2_5.9.5-3.2_armhf.deb を展開する準備をしています ...
libonig2:armhf (5.9.5-3.2) を展開しています...
以前に未選択のパッケージ libperl4-corelibs-perl を選択しています。
.../libperl4-corelibs-perl_0.003-1_all.deb を展開する準備をしています ...
libperl4-corelibs-perl (0.003-1) を展開しています...
以前に未選択のパッケージ lsof を選択しています。
.../lsof_4.86+dfsg-1_armhf.deb を展開する準備をしています ...
lsof (4.86+dfsg-1) を展開しています...
以前に未選択のパッケージ libqdbm14 を選択しています。
.../libqdbm14_1.8.78-5+b1_armhf.deb を展開する準備をしています ...
libqdbm14 (1.8.78-5+b1) を展開しています...
以前に未選択のパッケージ php5-common を選択しています。
.../php5-common_5.6.29+dfsg-0+deb8u1_armhf.deb を展開する準備をしています ...
php5-common (5.6.29+dfsg-0+deb8u1) を展開しています...
以前に未選択のパッケージ php5-json を選択しています。
.../php5-json_1.3.6-1_armhf.deb を展開する準備をしています ...
php5-json (1.3.6-1) を展開しています...
以前に未選択のパッケージ php5-cli を選択しています。
.../php5-cli_5.6.29+dfsg-0+deb8u1_armhf.deb を展開する準備をしています ...
php5-cli (5.6.29+dfsg-0+deb8u1) を展開しています...
以前に未選択のパッケージ libapache2-mod-php5 を選択しています。
.../libapache2-mod-php5_5.6.29+dfsg-0+deb8u1_armhf.deb を展開する準備をしています ...
libapache2-mod-php5 (5.6.29+dfsg-0+deb8u1) を展開しています...
以前に未選択のパッケージ php5-curl を選択しています。
.../php5-curl_5.6.29+dfsg-0+deb8u1_armhf.deb を展開する準備をしています ...
php5-curl (5.6.29+dfsg-0+deb8u1) を展開しています...
以前に未選択のパッケージ php5-gd を選択しています。
.../php5-gd_5.6.29+dfsg-0+deb8u1_armhf.deb を展開する準備をしています ...
php5-gd (5.6.29+dfsg-0+deb8u1) を展開しています...
以前に未選択のパッケージ php5-mysql を選択しています。
.../php5-mysql_5.6.29+dfsg-0+deb8u1_armhf.deb を展開する準備をしています ...
php5-mysql (5.6.29+dfsg-0+deb8u1) を展開しています...
以前に未選択のパッケージ php5-readline を選択しています。
.../php5-readline_5.6.29+dfsg-0+deb8u1_armhf.deb を展開する準備をしています ...
php5-readline (5.6.29+dfsg-0+deb8u1) を展開しています...
man-db (2.7.0.2-5) のトリガを処理しています ...
fonts-dejavu-core (2.34-1) を設定しています ...
fontconfig-config (2.11.0-6.3+deb8u1) を設定しています ...
libfontconfig1:armhf (2.11.0-6.3+deb8u1) を設定しています ...
libjbig0:armhf (2.1-3.1) を設定しています ...
libtiff5:armhf (4.0.3-12.3+deb8u1) を設定しています ...
libvpx1:armhf (1.3.0-3+rvt) を設定しています ...
libxpm4:armhf (1:3.5.11-1) を設定しています ...
libgd3:armhf (2.1.0-5+deb8u8) を設定しています ...
libonig2:armhf (5.9.5-3.2) を設定しています ...
libperl4-corelibs-perl (0.003-1) を設定しています ...
lsof (4.86+dfsg-1) を設定しています ...
libqdbm14 (1.8.78-5+b1) を設定しています ...
php5-common (5.6.29+dfsg-0+deb8u1) を設定しています ...

Creating config file /etc/php5/mods-available/pdo.ini with new version
php5_invoke: Enable module pdo for apache2 SAPI
php5_invoke: Enable module pdo for cli SAPI

Creating config file /etc/php5/mods-available/opcache.ini with new version
php5_invoke: Enable module opcache for apache2 SAPI
php5_invoke: Enable module opcache for cli SAPI
php5-json (1.3.6-1) を設定しています ...
php5_invoke: Enable module json for apache2 SAPI
php5_invoke: Enable module json for cli SAPI
php5-cli (5.6.29+dfsg-0+deb8u1) を設定しています ...
update-alternatives: /usr/bin/php (php) を提供するために自動モードで /usr/bin/php5 を使います
update-alternatives: /usr/bin/phar (phar) を提供するために自動モードで /usr/bin/phar5 を使います

Creating config file /etc/php5/cli/php.ini with new version
libapache2-mod-php5 (5.6.29+dfsg-0+deb8u1) を設定しています ...

Creating config file /etc/php5/apache2/php.ini with new version
Module mpm_event disabled.
Enabling module mpm_prefork.
apache2_switch_mpm Switch to prefork
apache2_invoke: Enable module php5
php5-curl (5.6.29+dfsg-0+deb8u1) を設定しています ...

Creating config file /etc/php5/mods-available/curl.ini with new version
php5_invoke: Enable module curl for apache2 SAPI
php5_invoke: Enable module curl for cli SAPI
php5-gd (5.6.29+dfsg-0+deb8u1) を設定しています ...

Creating config file /etc/php5/mods-available/gd.ini with new version
php5_invoke: Enable module gd for apache2 SAPI
php5_invoke: Enable module gd for cli SAPI
php5-mysql (5.6.29+dfsg-0+deb8u1) を設定しています ...

Creating config file /etc/php5/mods-available/mysql.ini with new version
php5_invoke: Enable module mysql for apache2 SAPI
php5_invoke: Enable module mysql for cli SAPI

Creating config file /etc/php5/mods-available/mysqli.ini with new version
php5_invoke: Enable module mysqli for apache2 SAPI
php5_invoke: Enable module mysqli for cli SAPI

Creating config file /etc/php5/mods-available/pdo_mysql.ini with new version
php5_invoke: Enable module pdo_mysql for apache2 SAPI
php5_invoke: Enable module pdo_mysql for cli SAPI
php5-readline (5.6.29+dfsg-0+deb8u1) を設定しています ...

Creating config file /etc/php5/mods-available/readline.ini with new version
php5_invoke: Enable module readline for apache2 SAPI
php5_invoke: Enable module readline for cli SAPI
libc-bin (2.19-18+deb8u6) のトリガを処理しています ...
libapache2-mod-php5 (5.6.29+dfsg-0+deb8u1) のトリガを処理しています ...
$
$ sudo -E apt-get install dnsutils
パッケージリストを読み込んでいます... 完了
依存関係ツリーを作成しています                
状態情報を読み取っています... 完了
提案パッケージ:
  rblcheck
以下のパッケージが新たにインストールされます:
  dnsutils
アップグレード: 0 個、新規インストール: 1 個、削除: 0 個、保留: 0 個。
113 kB のアーカイブを取得する必要があります。
この操作後に追加で 325 kB のディスク容量が消費されます。
取得:1 http://mirrordirector.raspbian.org/raspbian/ jessie/main dnsutils armhf 1:9.9.5.dfsg-9+deb8u8 [113 kB]
113 kB を 2秒 で取得しました (46.6 kB/s)
以前に未選択のパッケージ dnsutils を選択しています。
(データベースを読み込んでいます ... 現在 36608 個のファイルとディレクトリがインストールされています。)
.../dnsutils_1%3a9.9.5.dfsg-9+deb8u8_armhf.deb を展開する準備をしています ...
dnsutils (1:9.9.5.dfsg-9+deb8u8) を展開しています...
man-db (2.7.0.2-5) のトリガを処理しています ...
dnsutils (1:9.9.5.dfsg-9+deb8u8) を設定しています ...
$
$ sudo systemctl restart apache2
$
</code></pre>

<p>Kippo-Graphのインストール</p>

<pre><code>$ wget http://bruteforce.gr/wp-content/uploads/kippo-graph-1.5.1.tar.gz
--2017-01-05 04:54:31--  http://bruteforce.gr/wp-content/uploads/kippo-graph-1.5.1.tar.gz
192.168.20.10:3128 に接続しています... 接続しました。
Proxy による接続要求を送信しました、応答を待っています... 200 OK
長さ: 17800301 (17M) [application/x-gzip]
`kippo-graph-1.5.1.tar.gz' に保存中

kippo-graph-1.5.1.t 100%[=====================&gt;]  16.98M   147KB/s 時間 1m 57s 

2017-01-05 04:56:28 (149 KB/s) - `kippo-graph-1.5.1.tar.gz' へ保存完了 [17800301/17800301]

$
$ sudo tar zxvf kippo-graph-1.5.1.tar.gz -C /usr/share
kippo-graph-1.5.1/
kippo-graph-1.5.1/.gitignore
kippo-graph-1.5.1/.htaccess
kippo-graph-1.5.1/LICENSE.txt
kippo-graph-1.5.1/README.md
kippo-graph-1.5.1/TODO.txt
kippo-graph-1.5.1/class/
kippo-graph-1.5.1/class/KippoGeo.class.php
kippo-graph-1.5.1/class/KippoGraph.class.php
kippo-graph-1.5.1/class/KippoIP.class.php
kippo-graph-1.5.1/class/KippoInput.class.php
kippo-graph-1.5.1/class/KippoPlayLog.class.php
kippo-graph-1.5.1/config.php.dist
kippo-graph-1.5.1/favicon.ico
kippo-graph-1.5.1/gallery.php
kippo-graph-1.5.1/generated-graphs/
kippo-graph-1.5.1/generated-graphs/index.php
kippo-graph-1.5.1/gpl.txt
kippo-graph-1.5.1/images/
kippo-graph-1.5.1/images/alienvault.ico
kippo-graph-1.5.1/images/bg.gif
kippo-graph-1.5.1/images/dshield.ico
kippo-graph-1.5.1/images/first.png
kippo-graph-1.5.1/images/fortiguard.ico
kippo-graph-1.5.1/images/index.php
kippo-graph-1.5.1/images/ip_tracer.png
kippo-graph-1.5.1/images/ipvoid.ico
kippo-graph-1.5.1/images/kippo-graph-img.png
kippo-graph-1.5.1/images/last.png
kippo-graph-1.5.1/images/mcafee.ico
kippo-graph-1.5.1/images/next.png
kippo-graph-1.5.1/images/novirusthanks.ico
kippo-graph-1.5.1/images/play.ico
kippo-graph-1.5.1/images/prev.png
kippo-graph-1.5.1/images/robtex.ico
kippo-graph-1.5.1/images/virustotal.ico
kippo-graph-1.5.1/images/warning.png
kippo-graph-1.5.1/images/watchguard.ico
kippo-graph-1.5.1/include/
kippo-graph-1.5.1/include/export.php
kippo-graph-1.5.1/include/geoplugin/
kippo-graph-1.5.1/include/geoplugin/geoplugin.class.php
kippo-graph-1.5.1/include/index.php
kippo-graph-1.5.1/include/kippo-ip.ajax.php
kippo-graph-1.5.1/include/languages/
kippo-graph-1.5.1/include/languages/lang.ar.php
kippo-graph-1.5.1/include/languages/lang.cs.php
kippo-graph-1.5.1/include/languages/lang.de.php
kippo-graph-1.5.1/include/languages/lang.el.php
kippo-graph-1.5.1/include/languages/lang.en.php
kippo-graph-1.5.1/include/languages/lang.es.php
kippo-graph-1.5.1/include/languages/lang.et.php
kippo-graph-1.5.1/include/languages/lang.fr.php
kippo-graph-1.5.1/include/languages/lang.it.php
kippo-graph-1.5.1/include/languages/lang.nl.php
kippo-graph-1.5.1/include/languages/lang.pl.php
kippo-graph-1.5.1/include/languages/lang.sk.php
kippo-graph-1.5.1/include/languages/lang.sv.php
kippo-graph-1.5.1/include/libchart/
kippo-graph-1.5.1/include/libchart/COPYING
kippo-graph-1.5.1/include/libchart/ChangeLog
kippo-graph-1.5.1/include/libchart/README
kippo-graph-1.5.1/include/libchart/classes/
kippo-graph-1.5.1/include/libchart/classes/libchart.php
kippo-graph-1.5.1/include/libchart/classes/model/
kippo-graph-1.5.1/include/libchart/classes/model/ChartConfig.php
kippo-graph-1.5.1/include/libchart/classes/model/DataSet.php
kippo-graph-1.5.1/include/libchart/classes/model/Point.php
kippo-graph-1.5.1/include/libchart/classes/model/XYDataSet.php
kippo-graph-1.5.1/include/libchart/classes/model/XYSeriesDataSet.php
kippo-graph-1.5.1/include/libchart/classes/view/
kippo-graph-1.5.1/include/libchart/classes/view/axis/
kippo-graph-1.5.1/include/libchart/classes/view/axis/Axis.php
kippo-graph-1.5.1/include/libchart/classes/view/axis/Bound.php
kippo-graph-1.5.1/include/libchart/classes/view/caption/
kippo-graph-1.5.1/include/libchart/classes/view/caption/Caption.php
kippo-graph-1.5.1/include/libchart/classes/view/chart/
kippo-graph-1.5.1/include/libchart/classes/view/chart/BarChart.php
kippo-graph-1.5.1/include/libchart/classes/view/chart/Chart.php
kippo-graph-1.5.1/include/libchart/classes/view/chart/HorizontalBarChart.php
kippo-graph-1.5.1/include/libchart/classes/view/chart/LineChart.php
kippo-graph-1.5.1/include/libchart/classes/view/chart/PieChart.php
kippo-graph-1.5.1/include/libchart/classes/view/chart/VerticalBarChart.php
kippo-graph-1.5.1/include/libchart/classes/view/color/
kippo-graph-1.5.1/include/libchart/classes/view/color/Color.php
kippo-graph-1.5.1/include/libchart/classes/view/color/ColorSet.php
kippo-graph-1.5.1/include/libchart/classes/view/color/Palette.php
kippo-graph-1.5.1/include/libchart/classes/view/plot/
kippo-graph-1.5.1/include/libchart/classes/view/plot/Plot.php
kippo-graph-1.5.1/include/libchart/classes/view/primitive/
kippo-graph-1.5.1/include/libchart/classes/view/primitive/Padding.php
kippo-graph-1.5.1/include/libchart/classes/view/primitive/Primitive.php
kippo-graph-1.5.1/include/libchart/classes/view/primitive/Rectangle.php
kippo-graph-1.5.1/include/libchart/classes/view/text/
kippo-graph-1.5.1/include/libchart/classes/view/text/Text.php
kippo-graph-1.5.1/include/libchart/doc/
kippo-graph-1.5.1/include/libchart/doc/DEJAVU_LICENSE
kippo-graph-1.5.1/include/libchart/doc/GNU_GPL_V3
kippo-graph-1.5.1/include/libchart/fonts/
kippo-graph-1.5.1/include/libchart/fonts/DejaVuSansCondensed-Bold.ttf
kippo-graph-1.5.1/include/libchart/fonts/DejaVuSansCondensed.ttf
kippo-graph-1.5.1/include/libchart/fonts/OpenSans-Bold.ttf
kippo-graph-1.5.1/include/libchart/fonts/OpenSans-Regular.ttf
kippo-graph-1.5.1/include/libchart/images/
kippo-graph-1.5.1/include/libchart/images/PoweredBy.png
kippo-graph-1.5.1/include/maxmind/
kippo-graph-1.5.1/include/maxmind/GeoLite2-City.mmdb
kippo-graph-1.5.1/include/maxmind/geoip2.phar
kippo-graph-1.5.1/include/misc/
kippo-graph-1.5.1/include/misc/ip2host.php
kippo-graph-1.5.1/include/misc/versionCheck.php
kippo-graph-1.5.1/include/misc/xss_clean.php
kippo-graph-1.5.1/include/play.php
kippo-graph-1.5.1/include/qgooglevisualapi/
kippo-graph-1.5.1/include/qgooglevisualapi/QAnnotatedtimelineGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QApikeyGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QAreachartGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QBarchartGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QColumnchartGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QConfig.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QGaugeGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QInflector.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QIntensitymapGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QLinechartGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QMagictableGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QMapGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QMixupGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QMotionchartGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QOrgchartGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QPiechartGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QScatterchartGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QTableGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QTool.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QVizualisationGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/QWordcloudGoogleGraph.class.php
kippo-graph-1.5.1/include/qgooglevisualapi/config.inc.php
kippo-graph-1.5.1/include/qgooglevisualapi/readme.txt
kippo-graph-1.5.1/include/rb.php
kippo-graph-1.5.1/include/sql.php
kippo-graph-1.5.1/include/tor/
kippo-graph-1.5.1/include/tor/tor.class.php
kippo-graph-1.5.1/include/tor/tor_exit_node_list.txt
kippo-graph-1.5.1/index.php
kippo-graph-1.5.1/kippo-geo.php
kippo-graph-1.5.1/kippo-graph.php
kippo-graph-1.5.1/kippo-input.php
kippo-graph-1.5.1/kippo-ip.php
kippo-graph-1.5.1/kippo-playlog.php
kippo-graph-1.5.1/kippo-scanner.php
kippo-graph-1.5.1/robots.txt
kippo-graph-1.5.1/scripts/
kippo-graph-1.5.1/scripts/BinFileReader.js
kippo-graph-1.5.1/scripts/fancybox/
kippo-graph-1.5.1/scripts/fancybox/blank.gif
kippo-graph-1.5.1/scripts/fancybox/fancy_close.png
kippo-graph-1.5.1/scripts/fancybox/fancy_loading.png
kippo-graph-1.5.1/scripts/fancybox/fancy_nav_left.png
kippo-graph-1.5.1/scripts/fancybox/fancy_nav_right.png
kippo-graph-1.5.1/scripts/fancybox/fancy_shadow_e.png
kippo-graph-1.5.1/scripts/fancybox/fancy_shadow_n.png
kippo-graph-1.5.1/scripts/fancybox/fancy_shadow_ne.png
kippo-graph-1.5.1/scripts/fancybox/fancy_shadow_nw.png
kippo-graph-1.5.1/scripts/fancybox/fancy_shadow_s.png
kippo-graph-1.5.1/scripts/fancybox/fancy_shadow_se.png
kippo-graph-1.5.1/scripts/fancybox/fancy_shadow_sw.png
kippo-graph-1.5.1/scripts/fancybox/fancy_shadow_w.png
kippo-graph-1.5.1/scripts/fancybox/fancy_title_left.png
kippo-graph-1.5.1/scripts/fancybox/fancy_title_main.png
kippo-graph-1.5.1/scripts/fancybox/fancy_title_over.png
kippo-graph-1.5.1/scripts/fancybox/fancy_title_right.png
kippo-graph-1.5.1/scripts/fancybox/fancybox-x.png
kippo-graph-1.5.1/scripts/fancybox/fancybox-y.png
kippo-graph-1.5.1/scripts/fancybox/fancybox.png
kippo-graph-1.5.1/scripts/fancybox/index.php
kippo-graph-1.5.1/scripts/fancybox/jquery.easing-1.3.pack.js
kippo-graph-1.5.1/scripts/fancybox/jquery.fancybox-1.3.2.css
kippo-graph-1.5.1/scripts/fancybox/jquery.fancybox-1.3.2.js
kippo-graph-1.5.1/scripts/fancybox/jquery.fancybox-1.3.2.pack.js
kippo-graph-1.5.1/scripts/fancybox/jquery.fancybox-1.3.2.setup.js
kippo-graph-1.5.1/scripts/fancybox/jquery.mousewheel-3.0.4.pack.js
kippo-graph-1.5.1/scripts/hoverIntent.js
kippo-graph-1.5.1/scripts/index.php
kippo-graph-1.5.1/scripts/jquery-1.4.1.min.js
kippo-graph-1.5.1/scripts/jquery-1.4.4.min.js
kippo-graph-1.5.1/scripts/jquery.getUrlParam.js
kippo-graph-1.5.1/scripts/jquery.tablesorter.js
kippo-graph-1.5.1/scripts/jquery.tablesorter.pager.js
kippo-graph-1.5.1/scripts/jspl.js
kippo-graph-1.5.1/scripts/superfish.js
kippo-graph-1.5.1/styles/
kippo-graph-1.5.1/styles/forms.css
kippo-graph-1.5.1/styles/gallery.css
kippo-graph-1.5.1/styles/homepage.css
kippo-graph-1.5.1/styles/index.php
kippo-graph-1.5.1/styles/layout.css
kippo-graph-1.5.1/styles/navi.css
kippo-graph-1.5.1/styles/playlog.css
kippo-graph-1.5.1/styles/portfolio.css
kippo-graph-1.5.1/styles/tables.css
kippo-graph-1.5.1/styles/tablesorter.css
$
$ sudo vi /etc/apache2/conf-available/kippo-graph.conf
&lt;IfModule mod_alias.c&gt;
    Alias /kippo-graph /usr/share/kippo-graph-1.5.1
&lt;/IfModule&gt;
$
$ sudo a2enconf kippo-graph
Enabling conf kippo-graph.
To activate the new configuration, you need to run:
  service apache2 reload
$
$ sudo apachectl configtest
Syntax OK
$
$ sudo systemctl restart apache2
$
</code></pre>

<p>Kippo-Graphの設定</p>

<pre><code>$ sudo chmod 777 /usr/share/kippo-graph-1.5.1/generated-graphs/
$ sudo cp -p /usr/share/kippo-graph-1.5.1/config.php.dist /usr/share/kippo-graph-1.5.1/config.php
$ ls -l /usr/share/kippo-graph-1.5.1/config.php*
-rw-rw-r-- 1 root root 3777  6月 22  2015 /usr/share/kippo-graph-1.5.1/config.php
-rw-rw-r-- 1 root root 3777  6月 22  2015 /usr/share/kippo-graph-1.5.1/config.php.dist
$
$ sudo vi /usr/share/kippo-graph-1.5.1/config.php
define('DB_HOST', 'localhost');
define('DB_USER', 'cowrie');
define('DB_PASS', 'cowrie_password');
define('DB_NAME', 'cowrie');
define('DB_PORT', '3306');
</code></pre>

<h3 id="kippo-graphの修正:05481c997d19830c663ad9e91abca85e">Kippo-Graphの修正</h3>

<p>KippoとCowrieのデータベースのテーブル構造の違いにより一部動かない機能(KIPPO-PLAYLOG)がありました。</p>

<p>PLAYLOGを再生するために以下のファイルを修正しました。一応、PLAYLOGが再生できるようになりましたが、他の部分に影響がないかは不明です。。。試すとしても自己責任でお願いします。</p>

<p><code>class/KippoPlayLog.class.php</code>の修正</p>

<pre><code>$ cd /usr/share/kippo-graph-1.5.1
$ sudo cp -p class/KippoPlayLog.class.php{,.org}
$ ls -l class/KippoPlayLog.class.php*
-rw-rw-r-- 1 root root 2134  6月 22  2015 class/KippoPlayLog.class.php
-rw-rw-r-- 1 root root 2134  6月 22  2015 class/KippoPlayLog.class.php.org
$
$ sudo vi class/KippoPlayLog.class.php
$ diff class/KippoPlayLog.class.php.org class/KippoPlayLog.class.php
21c21
&lt;             SELECT ttylog.session, timestamp, ROUND(LENGTH(ttylog)/1024, 2) AS size
---
&gt;             SELECT ttylog.session, timestamp, ROUND(size/1024, 2) AS size
$
</code></pre>

<p><code>include/play.php</code>の修正</p>

<pre><code>$ cd /usr/share/kippo-graph-1.5.1
$ sudo cp -p include/play.php{,.org}
$ls -l include/play.php*
-rw-rw-r-- 1 root root 10994  6月 22  2015 include/play.php
-rw-rw-r-- 1 root root 10994  6月 22  2015 include/play.php.org
$
$ sudo vi include/play.php
$ diff play.php.org play.php
70c70
&lt;                 $log = base64_encode($row['ttylog']);
---
&gt;                 $log = base64_encode(file_get_contents($row['ttylog']));
</code></pre>

<p>ttylogへのシンボリックリンク作成</p>

<pre><code>$ cd /usr/share/kippo-graph-1.5.1/include
$ sudo ln -s /home/cowrie/cowrie/log/ log
$ sudo chgrp www-data /home/cowrie/cowrie/log/tty/
$ sudo chmod g+s /home/cowrie/cowrie/log/tty/
$ ls -dl /home/cowrie/cowrie/log/tty
drwxr-sr-x 2 cowrie www-data 4096  1月  4 19:05 /home/cowrie/cowrie/log/tty
$
</code></pre>

<p>Cowrie起動スクリプトの修正</p>

<pre><code>$ sudo su - cowrie
$ cd cowrie
$ cp -p start.sh{,.backup20170105}
$ ls -l start.sh*
-rwxr-xr-x 1 cowrie cowrie 922  1月  4 21:10 start.sh
-rwxr-xr-x 1 cowrie cowrie 922  1月  4 21:10 start.sh.backup20170105
-rwxr-xr-x 1 cowrie cowrie 920  1月  4 19:05 start.sh.org
$
$ vi start.sh
$ diff start.sh.org start.sh
7c7
&lt; DAEMONIZE=&quot;&quot;
---
&gt; DAEMONIZE=&quot;-n&quot;
35c35
&lt;     twistd $XARGS $DAEMONIZE -l log/cowrie.log --umask 0077 --pidfile ${PIDFILE} cowrie
---
&gt;     twistd $XARGS $DAEMONIZE -l log/cowrie.log --umask 0027 --pidfile ${PIDFILE} cowrie
37c37
&lt;     authbind --deep twistd $DAEMONIZE $XARGS -l log/cowrie.log --umask 0077 --pidfile ${PIDFILE} cowrie
---
&gt;     authbind --deep twistd $DAEMONIZE $XARGS -l log/cowrie.log --umask 0027 --pidfile ${PIDFILE} cowrie
$
</code></pre>

<p>Cowrieの再起動</p>

<pre><code>$ sudo supervisorctl restart cowrie
cowrie: stopped
cowrie: started
$
</code></pre>

<p>以上</p>

                </div>
              </article>
              
              <article>
                <div class="title">
                  <h1><a href="http://www.shinayoshi.net/post/2017/01/04/setting-cowrie/">家庭内インターネット接続環境を構築する その7</a></h1>
                  <p>
                    <span class="label label-primary">Wed Jan 4, 2017</span> in
                    
                    
                    <a href="http://www.shinayoshi.net//categories/server">server</a>
                     using tags
                    
                    
                    <a href="http://www.shinayoshi.net//tags/raspberrypi">raspberrypi</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/home-network">home-network</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homepot1">homepot1</a>
                    
                  </p>
                </div>
                <div class="contents">
                  

<p>FortiGate 60DとRaspberry Piを使用して家庭内インターネット接続環境を構築します。
最終的には以下のような構成を想定しています。</p>

<p><img src="/img/20161022_01/home-network.png" alt="home network" width="640px" /></p>

<p>今回は<code>homepot1</code>を構築していきます。</p>

<h2 id="raspberry-pi-2でsshハニーポット-cowrie-構築:638054c4f24019ce8e35d2f1d32a3666">Raspberry Pi 2でSSHハニーポット(Cowrie)構築</h2>

<p>インターネットの怖さを知るためにSSHハニーポットを構築します。</p>

<h3 id="公開鍵認証方式の設定:638054c4f24019ce8e35d2f1d32a3666">公開鍵認証方式の設定</h3>

<p>公開鍵・秘密鍵の作成</p>

<pre><code>$ ssh-keygen -t rsa
Generating public/private rsa key pair.
Enter file in which to save the key (/home/pi/.ssh/id_rsa): 
Created directory '/home/pi/.ssh'.
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /home/pi/.ssh/id_rsa.
Your public key has been saved in /home/pi/.ssh/id_rsa.pub.
The key fingerprint is:
XX:XX:XX:39:e2:be:63:99:e1:a2:a5:32:f4:XX:XX:XX pi@homepot1
The key's randomart image is:
+---[RSA 2048]----+
|                 |
|                 |
|                 |
|                 |
|    . . S        |
|.o E.. .         |
|= +. +.          |
|++..B .o         |
|+o.***+.         |
+-----------------+
$
$ cd ~/.ssh/
$ cat id_rsa.pub &gt;&gt; authorized_keys
$ chmod 600 authorized_keys
$ ls -l authorized_keys 
-rw------- 1 pi pi 393  1月  4 18:04 authorized_keys
$
</code></pre>

<p>homepot1で作成した秘密鍵をローカルPCにコピー</p>

<pre><code>$ scp pi@192.168.10.10:~/.ssh/id_rsa ~/.ssh/pi@homepot1
</code></pre>

<p>公開鍵認証方式でsshログインできることを確認</p>

<pre><code>$ ssh -i ~/.ssh/id_rsa pi@192.168.10.10
</code></pre>

<h3 id="sshサーバの設定:638054c4f24019ce8e35d2f1d32a3666">SSHサーバの設定</h3>

<p>Cowrieで<code>22/tcp</code>を使用するため、SSHサーバのポートを変更します。またパスワード認証を無効化します。</p>

<pre><code>$ sudo cp -p /etc/ssh/sshd_config{,.org}
$ sudo ls -l /etc/ssh/sshd_config*
-rw-r--r-- 1 root root 2541 11月 26 02:28 /etc/ssh/sshd_config
-rw-r--r-- 1 root root 2541 11月 26 02:28 /etc/ssh/sshd_config.org
$
$ sudo vi /etc/ssh/sshd_config
#Port 22
Port 20022

#PermitRootLogin without-password
PermitRootLogin no

ChallengeResponseAuthentication no

#PasswordAuthentication yes
PasswordAuthentication no
$
$ diff /etc/ssh/sshd_config.org /etc/ssh/sshd_config
5c5,6
&lt; Port 22
---
&gt; #Port 22
&gt; Port 20022
28c29,30
&lt; PermitRootLogin without-password
---
&gt; #PermitRootLogin without-password
&gt; PermitRootLogin no
52a55
&gt; PasswordAuthentication no
$
</code></pre>

<p>SSHサーバの設定を再起動する。</p>

<pre><code>$ sudo systemctl restart ssh
</code></pre>

<p>SSHサーバのポートを変更しているため、以降の手順でSSHログインするためにはポート番号を指定する。</p>

<pre><code>$ ssh -i ~/.ssh/id_rsa -p 20022 pi@192.168.10.10
</code></pre>

<h3 id="ユーザ設定:638054c4f24019ce8e35d2f1d32a3666">ユーザ設定</h3>

<p>rootユーザが無効化されていることを確認する(2列目が<code>L</code>であることを確認)。</p>

<pre><code>$ sudo passwd -S root
root L 11/25/2016 0 99999 7 -1
</code></pre>

<p>Cowrieユーザを作成する。</p>

<pre><code>$ sudo adduser --disabled-password cowrie
ユーザ `cowrie' を追加しています...
新しいグループ `cowrie' (1001) を追加しています...
新しいユーザ `cowrie' (1001) をグループ `cowrie' として追加しています...
ホームディレクトリ `/home/cowrie' を作成しています...
`/etc/skel' からファイルをコピーしています...
cowrie のユーザ情報を変更中
新しい値を入力してください。標準設定値を使うならリターンを押してください
	フルネーム []: 
	部屋番号 []: 
	職場電話番号 []: 
	自宅電話番号 []: 
	その他 []: 
以上で正しいですか? [Y/n] y
$
$ sudo passwd -S cowrie
cowrie L 01/04/2017 0 99999 7 -1
$
</code></pre>

<h3 id="cowrieのインストール:638054c4f24019ce8e35d2f1d32a3666">Cowrieのインストール</h3>

<p>Cowrienの公式サイトの<a href="https://github.com/micheloosterhof/cowrie/blob/master/INSTALL.md">INSTALL.md</a>を参考にインストールを行う。</p>

<pre><code>$ sudo -E apt-get install git virtualenv libmpfr-dev libssl-dev libmpc-dev libffi-dev build-essential libpython-dev python2.7-minimal
パッケージリストを読み込んでいます... 完了
依存関係ツリーを作成しています                
状態情報を読み取っています... 完了
build-essential はすでに最新版です。
python2.7-minimal はすでに最新版です。
python2.7-minimal は手動でインストールしたと設定されました。
以下の追加パッケージがインストールされます:
  dh-python git-man libcurl3-gnutls liberror-perl libexpat1-dev libgmp-dev
  libgmpxx4ldbl libmpdec2 libpython2.7-dev libpython3-stdlib
  libpython3.4-minimal libpython3.4-stdlib libssl-doc python-chardet-whl
  python-colorama-whl python-distlib-whl python-html5lib-whl python-pip-whl
  python-requests-whl python-setuptools-whl python-six-whl python-urllib3-whl
  python3 python3-minimal python3-pkg-resources python3-virtualenv python3.4
  python3.4-minimal rsync
提案パッケージ:
  gettext-base git-daemon-run git-daemon-sysvinit git-doc git-el git-email
  git-gui gitk gitweb git-arch git-cvs git-mediawiki git-svn libgmp10-doc
  libmpfr-doc python3-doc python3-tk python3-venv python3-setuptools
  python3.4-venv python3.4-doc binfmt-support
以下のパッケージが新たにインストールされます:
  dh-python git git-man libcurl3-gnutls liberror-perl libexpat1-dev libffi-dev
  libgmp-dev libgmpxx4ldbl libmpc-dev libmpdec2 libmpfr-dev libpython-dev
  libpython2.7-dev libpython3-stdlib libpython3.4-minimal libpython3.4-stdlib
  libssl-dev libssl-doc python-chardet-whl python-colorama-whl
  python-distlib-whl python-html5lib-whl python-pip-whl python-requests-whl
  python-setuptools-whl python-six-whl python-urllib3-whl python3
  python3-minimal python3-pkg-resources python3-virtualenv python3.4
  python3.4-minimal rsync virtualenv
アップグレード: 0 個、新規インストール: 36 個、削除: 0 個、保留: 0 個。
31.7 MB のアーカイブを取得する必要があります。
この操作後に追加で 76.3 MB のディスク容量が消費されます。
続行しますか? [Y/n] y
取得:1 http://mirrordirector.raspbian.org/raspbian/ jessie/main libcurl3-gnutls armhf 7.38.0-4+deb8u5 [225 kB]
取得:2 http://mirrordirector.raspbian.org/raspbian/ jessie/main libgmpxx4ldbl armhf 2:6.0.0+dfsg-6+rpi1 [21.6 kB]
取得:3 http://mirrordirector.raspbian.org/raspbian/ jessie/main libmpdec2 armhf 2.4.1-1 [65.8 kB]
取得:4 http://mirrordirector.raspbian.org/raspbian/ jessie/main libexpat1-dev armhf 2.1.0-6+deb8u3 [115 kB]
取得:5 http://mirrordirector.raspbian.org/raspbian/ jessie/main libpython2.7-dev armhf 2.7.9-2+deb8u1 [17.9 MB]
取得:6 http://mirrordirector.raspbian.org/raspbian/ jessie/main libpython3.4-minimal armhf 3.4.2-1 [483 kB]
取得:7 http://mirrordirector.raspbian.org/raspbian/ jessie/main libpython3.4-stdlib armhf 3.4.2-1 [2,011 kB]
取得:8 http://mirrordirector.raspbian.org/raspbian/ jessie/main python3.4-minimal armhf 3.4.2-1 [1,355 kB]
取得:9 http://mirrordirector.raspbian.org/raspbian/ jessie/main python3.4 armhf 3.4.2-1 [204 kB]
取得:10 http://mirrordirector.raspbian.org/raspbian/ jessie/main python3-minimal armhf 3.4.2-2 [34.7 kB]
取得:11 http://mirrordirector.raspbian.org/raspbian/ jessie/main libpython3-stdlib armhf 3.4.2-2 [18.1 kB]
取得:12 http://mirrordirector.raspbian.org/raspbian/ jessie/main python3 armhf 3.4.2-2 [21.2 kB]
取得:13 http://mirrordirector.raspbian.org/raspbian/ jessie/main dh-python all 1.20141111-2 [66.4 kB]
取得:14 http://mirrordirector.raspbian.org/raspbian/ jessie/main liberror-perl all 0.17-1.1 [22.4 kB]
取得:15 http://mirrordirector.raspbian.org/raspbian/ jessie/main git-man all 1:2.1.4-2.1+deb8u2 [1,267 kB]
取得:16 http://mirrordirector.raspbian.org/raspbian/ jessie/main git armhf 1:2.1.4-2.1+deb8u2 [2,725 kB]
取得:17 http://mirrordirector.raspbian.org/raspbian/ jessie/main libffi-dev armhf 3.1-2 [152 kB]
取得:18 http://mirrordirector.raspbian.org/raspbian/ jessie/main libgmp-dev armhf 2:6.0.0+dfsg-6+rpi1 [552 kB]
取得:19 http://mirrordirector.raspbian.org/raspbian/ jessie/main libmpfr-dev armhf 3.1.2-2 [540 kB]
取得:20 http://mirrordirector.raspbian.org/raspbian/ jessie/main libpython-dev armhf 2.7.9-1 [19.6 kB]
取得:21 http://mirrordirector.raspbian.org/raspbian/ jessie/main libssl-dev armhf 1.0.1t-1+deb8u5 [1,094 kB]
取得:22 http://mirrordirector.raspbian.org/raspbian/ jessie/main libssl-doc all 1.0.1t-1+deb8u5 [1,167 kB]
取得:23 http://mirrordirector.raspbian.org/raspbian/ jessie/main python3-pkg-resources all 5.5.1-1 [34.2 kB]
取得:24 http://mirrordirector.raspbian.org/raspbian/ jessie/main python-chardet-whl all 2.3.0-1 [170 kB]
取得:25 http://mirrordirector.raspbian.org/raspbian/ jessie/main python-colorama-whl all 0.3.2-1 [20.2 kB]
取得:26 http://mirrordirector.raspbian.org/raspbian/ jessie/main python-distlib-whl all 0.1.9-1 [141 kB]
取得:27 http://mirrordirector.raspbian.org/raspbian/ jessie/main python-html5lib-whl all 0.999-3 [112 kB]
取得:28 http://mirrordirector.raspbian.org/raspbian/ jessie/main python-six-whl all 1.8.0-1 [14.8 kB]
取得:29 http://mirrordirector.raspbian.org/raspbian/ jessie/main python-urllib3-whl all 1.9.1-3 [76.8 kB]
取得:30 http://mirrordirector.raspbian.org/raspbian/ jessie/main python-requests-whl all 2.4.3-6 [241 kB]
取得:31 http://mirrordirector.raspbian.org/raspbian/ jessie/main python-setuptools-whl all 5.5.1-1 [233 kB]
取得:32 http://mirrordirector.raspbian.org/raspbian/ jessie/main python-pip-whl all 1.5.6-5 [126 kB]
取得:33 http://mirrordirector.raspbian.org/raspbian/ jessie/main python3-virtualenv all 1.11.6+ds-1 [60.5 kB]
取得:34 http://mirrordirector.raspbian.org/raspbian/ jessie/main rsync armhf 3.1.1-3 [373 kB]
取得:35 http://mirrordirector.raspbian.org/raspbian/ jessie/main virtualenv all 1.11.6+ds-1 [17.2 kB]
取得:36 http://mirrordirector.raspbian.org/raspbian/ jessie/main libmpc-dev armhf 1.0.2-1 [39.1 kB]
31.7 MB を 1分 8秒 で取得しました (463 kB/s)                                   
パッケージからテンプレートを展開しています: 100%
以前に未選択のパッケージ libcurl3-gnutls:armhf を選択しています。
(データベースを読み込んでいます ... 現在 31276 個のファイルとディレクトリがインストールされています。)
.../libcurl3-gnutls_7.38.0-4+deb8u5_armhf.deb を展開する準備をしています ...
libcurl3-gnutls:armhf (7.38.0-4+deb8u5) を展開しています...
以前に未選択のパッケージ libgmpxx4ldbl:armhf を選択しています。
.../libgmpxx4ldbl_2%3a6.0.0+dfsg-6+rpi1_armhf.deb を展開する準備をしています ...
libgmpxx4ldbl:armhf (2:6.0.0+dfsg-6+rpi1) を展開しています...
以前に未選択のパッケージ libmpdec2:armhf を選択しています。
.../libmpdec2_2.4.1-1_armhf.deb を展開する準備をしています ...
libmpdec2:armhf (2.4.1-1) を展開しています...
以前に未選択のパッケージ libexpat1-dev:armhf を選択しています。
.../libexpat1-dev_2.1.0-6+deb8u3_armhf.deb を展開する準備をしています ...
libexpat1-dev:armhf (2.1.0-6+deb8u3) を展開しています...
以前に未選択のパッケージ libpython2.7-dev:armhf を選択しています。
.../libpython2.7-dev_2.7.9-2+deb8u1_armhf.deb を展開する準備をしています ...
libpython2.7-dev:armhf (2.7.9-2+deb8u1) を展開しています...
以前に未選択のパッケージ libpython3.4-minimal:armhf を選択しています。
.../libpython3.4-minimal_3.4.2-1_armhf.deb を展開する準備をしています ...
libpython3.4-minimal:armhf (3.4.2-1) を展開しています...
以前に未選択のパッケージ libpython3.4-stdlib:armhf を選択しています。
.../libpython3.4-stdlib_3.4.2-1_armhf.deb を展開する準備をしています ...
libpython3.4-stdlib:armhf (3.4.2-1) を展開しています...
以前に未選択のパッケージ python3.4-minimal を選択しています。
.../python3.4-minimal_3.4.2-1_armhf.deb を展開する準備をしています ...
python3.4-minimal (3.4.2-1) を展開しています...
以前に未選択のパッケージ python3.4 を選択しています。
.../python3.4_3.4.2-1_armhf.deb を展開する準備をしています ...
python3.4 (3.4.2-1) を展開しています...
以前に未選択のパッケージ python3-minimal を選択しています。
.../python3-minimal_3.4.2-2_armhf.deb を展開する準備をしています ...
python3-minimal (3.4.2-2) を展開しています...
以前に未選択のパッケージ libpython3-stdlib:armhf を選択しています。
.../libpython3-stdlib_3.4.2-2_armhf.deb を展開する準備をしています ...
libpython3-stdlib:armhf (3.4.2-2) を展開しています...
以前に未選択のパッケージ python3 を選択しています。
.../python3_3.4.2-2_armhf.deb を展開する準備をしています ...
python3 (3.4.2-2) を展開しています...
以前に未選択のパッケージ dh-python を選択しています。
.../dh-python_1.20141111-2_all.deb を展開する準備をしています ...
dh-python (1.20141111-2) を展開しています...
以前に未選択のパッケージ liberror-perl を選択しています。
.../liberror-perl_0.17-1.1_all.deb を展開する準備をしています ...
liberror-perl (0.17-1.1) を展開しています...
以前に未選択のパッケージ git-man を選択しています。
.../git-man_1%3a2.1.4-2.1+deb8u2_all.deb を展開する準備をしています ...
git-man (1:2.1.4-2.1+deb8u2) を展開しています...
以前に未選択のパッケージ git を選択しています。
.../git_1%3a2.1.4-2.1+deb8u2_armhf.deb を展開する準備をしています ...
git (1:2.1.4-2.1+deb8u2) を展開しています...
以前に未選択のパッケージ libffi-dev:armhf を選択しています。
.../libffi-dev_3.1-2_armhf.deb を展開する準備をしています ...
libffi-dev:armhf (3.1-2) を展開しています...
以前に未選択のパッケージ libgmp-dev:armhf を選択しています。
.../libgmp-dev_2%3a6.0.0+dfsg-6+rpi1_armhf.deb を展開する準備をしています ...
libgmp-dev:armhf (2:6.0.0+dfsg-6+rpi1) を展開しています...
以前に未選択のパッケージ libmpfr-dev:armhf を選択しています。
.../libmpfr-dev_3.1.2-2_armhf.deb を展開する準備をしています ...
libmpfr-dev:armhf (3.1.2-2) を展開しています...
以前に未選択のパッケージ libpython-dev:armhf を選択しています。
.../libpython-dev_2.7.9-1_armhf.deb を展開する準備をしています ...
libpython-dev:armhf (2.7.9-1) を展開しています...
以前に未選択のパッケージ libssl-dev:armhf を選択しています。
.../libssl-dev_1.0.1t-1+deb8u5_armhf.deb を展開する準備をしています ...
libssl-dev:armhf (1.0.1t-1+deb8u5) を展開しています...
以前に未選択のパッケージ libssl-doc を選択しています。
.../libssl-doc_1.0.1t-1+deb8u5_all.deb を展開する準備をしています ...
libssl-doc (1.0.1t-1+deb8u5) を展開しています...
以前に未選択のパッケージ python3-pkg-resources を選択しています。
.../python3-pkg-resources_5.5.1-1_all.deb を展開する準備をしています ...
python3-pkg-resources (5.5.1-1) を展開しています...
以前に未選択のパッケージ python-chardet-whl を選択しています。
.../python-chardet-whl_2.3.0-1_all.deb を展開する準備をしています ...
python-chardet-whl (2.3.0-1) を展開しています...
以前に未選択のパッケージ python-colorama-whl を選択しています。
.../python-colorama-whl_0.3.2-1_all.deb を展開する準備をしています ...
python-colorama-whl (0.3.2-1) を展開しています...
以前に未選択のパッケージ python-distlib-whl を選択しています。
.../python-distlib-whl_0.1.9-1_all.deb を展開する準備をしています ...
python-distlib-whl (0.1.9-1) を展開しています...
以前に未選択のパッケージ python-html5lib-whl を選択しています。
.../python-html5lib-whl_0.999-3_all.deb を展開する準備をしています ...
python-html5lib-whl (0.999-3) を展開しています...
以前に未選択のパッケージ python-six-whl を選択しています。
.../python-six-whl_1.8.0-1_all.deb を展開する準備をしています ...
python-six-whl (1.8.0-1) を展開しています...
以前に未選択のパッケージ python-urllib3-whl を選択しています。
.../python-urllib3-whl_1.9.1-3_all.deb を展開する準備をしています ...
python-urllib3-whl (1.9.1-3) を展開しています...
以前に未選択のパッケージ python-requests-whl を選択しています。
.../python-requests-whl_2.4.3-6_all.deb を展開する準備をしています ...
python-requests-whl (2.4.3-6) を展開しています...
以前に未選択のパッケージ python-setuptools-whl を選択しています。
.../python-setuptools-whl_5.5.1-1_all.deb を展開する準備をしています ...
python-setuptools-whl (5.5.1-1) を展開しています...
以前に未選択のパッケージ python-pip-whl を選択しています。
.../python-pip-whl_1.5.6-5_all.deb を展開する準備をしています ...
python-pip-whl (1.5.6-5) を展開しています...
以前に未選択のパッケージ python3-virtualenv を選択しています。
.../python3-virtualenv_1.11.6+ds-1_all.deb を展開する準備をしています ...
python3-virtualenv (1.11.6+ds-1) を展開しています...
以前に未選択のパッケージ rsync を選択しています。
.../rsync_3.1.1-3_armhf.deb を展開する準備をしています ...
rsync (3.1.1-3) を展開しています...
以前に未選択のパッケージ virtualenv を選択しています。
.../virtualenv_1.11.6+ds-1_all.deb を展開する準備をしています ...
virtualenv (1.11.6+ds-1) を展開しています...
以前に未選択のパッケージ libmpc-dev:armhf を選択しています。
.../libmpc-dev_1.0.2-1_armhf.deb を展開する準備をしています ...
libmpc-dev:armhf (1.0.2-1) を展開しています...
man-db (2.7.0.2-5) のトリガを処理しています ...
mime-support (3.58) のトリガを処理しています ...
install-info (5.2.0.dfsg.1-6) のトリガを処理しています ...
systemd (215-17+deb8u5) のトリガを処理しています ...
libcurl3-gnutls:armhf (7.38.0-4+deb8u5) を設定しています ...
libgmpxx4ldbl:armhf (2:6.0.0+dfsg-6+rpi1) を設定しています ...
libmpdec2:armhf (2.4.1-1) を設定しています ...
libexpat1-dev:armhf (2.1.0-6+deb8u3) を設定しています ...
libpython2.7-dev:armhf (2.7.9-2+deb8u1) を設定しています ...
libpython3.4-minimal:armhf (3.4.2-1) を設定しています ...
libpython3.4-stdlib:armhf (3.4.2-1) を設定しています ...
python3.4-minimal (3.4.2-1) を設定しています ...
python3.4 (3.4.2-1) を設定しています ...
python3-minimal (3.4.2-2) を設定しています ...
libpython3-stdlib:armhf (3.4.2-2) を設定しています ...
liberror-perl (0.17-1.1) を設定しています ...
git-man (1:2.1.4-2.1+deb8u2) を設定しています ...
git (1:2.1.4-2.1+deb8u2) を設定しています ...
libffi-dev:armhf (3.1-2) を設定しています ...
libgmp-dev:armhf (2:6.0.0+dfsg-6+rpi1) を設定しています ...
libmpfr-dev:armhf (3.1.2-2) を設定しています ...
libpython-dev:armhf (2.7.9-1) を設定しています ...
libssl-dev:armhf (1.0.1t-1+deb8u5) を設定しています ...
libssl-doc (1.0.1t-1+deb8u5) を設定しています ...
python-colorama-whl (0.3.2-1) を設定しています ...
python-distlib-whl (0.1.9-1) を設定しています ...
python-html5lib-whl (0.999-3) を設定しています ...
python-six-whl (1.8.0-1) を設定しています ...
python-urllib3-whl (1.9.1-3) を設定しています ...
python-requests-whl (2.4.3-6) を設定しています ...
python-setuptools-whl (5.5.1-1) を設定しています ...
rsync (3.1.1-3) を設定しています ...
libmpc-dev:armhf (1.0.2-1) を設定しています ...
dh-python (1.20141111-2) を設定しています ...
python3 (3.4.2-2) を設定しています ...
running python rtupdate hooks for python3.4...
running python post-rtupdate hooks for python3.4...
python3-pkg-resources (5.5.1-1) を設定しています ...
python-chardet-whl (2.3.0-1) を設定しています ...
python-pip-whl (1.5.6-5) を設定しています ...
python3-virtualenv (1.11.6+ds-1) を設定しています ...
virtualenv (1.11.6+ds-1) を設定しています ...
libc-bin (2.19-18+deb8u6) のトリガを処理しています ...
systemd (215-17+deb8u5) のトリガを処理しています ...
$
$ sudo su - cowrie
$
$ git clone http://github.com/micheloosterhof/cowrie
Cloning into 'cowrie'...
remote: Counting objects: 7457, done.
remote: Total 7457 (delta 0), reused 0 (delta 0), pack-reused 7457
Receiving objects: 100% (7457/7457), 6.43 MiB | 202.00 KiB/s, done.
Resolving deltas: 100% (5060/5060), done.
Checking connectivity... done.
$
$ cd cowrie/
$
$ pwd
/home/cowrie/cowrie
$
$ virtualenv cowrie-env
Running virtualenv with interpreter /usr/bin/python2
New python executable in cowrie-env/bin/python2
Also creating executable in cowrie-env/bin/python
Installing setuptools, pip...done.
$
$ source cowrie-env/bin/activate
(cowrie-env) $ pip install -r requirements.txt 
Downloading/unpacking twisted&gt;=15.2.1 (from -r requirements.txt (line 1))
  Downloading Twisted-16.6.0.tar.bz2 (3.0MB): 3.0MB downloaded
  Running setup.py (path:/tmp/pip-build-BjW0UZ/twisted/setup.py) egg_info for package twisted
    no previously-included directories found matching '.travis'
    no previously-included directories found matching 'tests'
    warning: no previously-included files found matching 'examplesetup.py'
    no previously-included directories found matching 'src/exampleproj'
    no previously-included directories found matching 'src/incremental/newsfragments'
    
    Installed /tmp/pip-build-BjW0UZ/twisted/incremental-16.10.1-py2.7.egg
    
    warning: no previously-included files matching '*.misc' found under directory 'src/twisted'
    warning: no previously-included files matching '*.bugfix' found under directory 'src/twisted'
    warning: no previously-included files matching '*.doc' found under directory 'src/twisted'
    warning: no previously-included files matching '*.feature' found under directory 'src/twisted'
    warning: no previously-included files matching '*.removal' found under directory 'src/twisted'
    warning: no previously-included files matching 'NEWS' found under directory 'src/twisted'
    warning: no previously-included files matching 'README' found under directory 'src/twisted'
    warning: no previously-included files matching 'topfiles' found under directory 'src/twisted'
    warning: no previously-included files found matching 'src/twisted/topfiles/CREDITS'
    warning: no previously-included files found matching 'src/twisted/topfiles/ChangeLog.Old'
    warning: no previously-included files found matching 'codecov.yml'
    warning: no previously-included files found matching 'appveyor.yml'
    no previously-included directories found matching 'bin'
    no previously-included directories found matching 'admin'
    no previously-included directories found matching '.travis'
    warning: no previously-included files found matching 'docs/historic/2003'
    warning: no previously-included files matching '*' found under directory 'docs/historic/2003'
Downloading/unpacking cryptography (from -r requirements.txt (line 2))
  Downloading cryptography-1.7.1.tar.gz (420kB): 420kB downloaded
  Running setup.py (path:/tmp/pip-build-BjW0UZ/cryptography/setup.py) egg_info for package cryptography
    
    no previously-included directories found matching 'docs/_build'
    warning: no previously-included files matching '*' found under directory 'vectors'
Downloading/unpacking configparser (from -r requirements.txt (line 3))
  Downloading configparser-3.5.0.tar.gz
  Running setup.py (path:/tmp/pip-build-BjW0UZ/configparser/setup.py) egg_info for package configparser
    
Downloading/unpacking pyopenssl (from -r requirements.txt (line 4))
  Downloading pyOpenSSL-16.2.0-py2.py3-none-any.whl (43kB): 43kB downloaded
Downloading/unpacking gmpy2 (from -r requirements.txt (line 5))
  Downloading gmpy2-2.0.8.zip (280kB): 280kB downloaded
  Running setup.py (path:/tmp/pip-build-BjW0UZ/gmpy2/setup.py) egg_info for package gmpy2
    
Downloading/unpacking service-identity (from -r requirements.txt (line 6))
  Downloading service_identity-16.0.0-py2.py3-none-any.whl
Downloading/unpacking pycrypto (from -r requirements.txt (line 7))
  Downloading pycrypto-2.6.1.tar.gz (446kB): 446kB downloaded
  Running setup.py (path:/tmp/pip-build-BjW0UZ/pycrypto/setup.py) egg_info for package pycrypto
    
Downloading/unpacking python-dateutil (from -r requirements.txt (line 8))
  Downloading python_dateutil-2.6.0-py2.py3-none-any.whl (194kB): 194kB downloaded
Downloading/unpacking tftpy (from -r requirements.txt (line 9))
  Downloading tftpy-0.6.2.tar.gz
  Running setup.py (path:/tmp/pip-build-BjW0UZ/tftpy/setup.py) egg_info for package tftpy
    
Downloading/unpacking zope.interface&gt;=3.6.0 (from twisted&gt;=15.2.1-&gt;-r requirements.txt (line 1))
  Downloading zope.interface-4.3.3.tar.gz (150kB): 150kB downloaded
  Running setup.py (path:/tmp/pip-build-BjW0UZ/zope.interface/setup.py) egg_info for package zope.interface
    
    warning: no previously-included files matching '*.dll' found anywhere in distribution
    warning: no previously-included files matching '*.pyc' found anywhere in distribution
    warning: no previously-included files matching '*.pyo' found anywhere in distribution
    warning: no previously-included files matching '*.so' found anywhere in distribution
    warning: no previously-included files matching 'coverage.xml' found anywhere in distribution
    warning: no previously-included files matching 'appveyor.yml' found anywhere in distribution
    no previously-included directories found matching 'docs/_build'
Downloading/unpacking constantly&gt;=15.1 (from twisted&gt;=15.2.1-&gt;-r requirements.txt (line 1))
  Downloading constantly-15.1.0-py2.py3-none-any.whl
Downloading/unpacking incremental&gt;=16.10.1 (from twisted&gt;=15.2.1-&gt;-r requirements.txt (line 1))
  Downloading incremental-16.10.1-py2.py3-none-any.whl
Downloading/unpacking idna&gt;=2.0 (from cryptography-&gt;-r requirements.txt (line 2))
  Downloading idna-2.2-py2.py3-none-any.whl (55kB): 55kB downloaded
Downloading/unpacking pyasn1&gt;=0.1.8 (from cryptography-&gt;-r requirements.txt (line 2))
  Downloading pyasn1-0.1.9-py2.py3-none-any.whl
Downloading/unpacking six&gt;=1.4.1 (from cryptography-&gt;-r requirements.txt (line 2))
  Downloading six-1.10.0-py2.py3-none-any.whl
Downloading/unpacking setuptools&gt;=11.3 (from cryptography-&gt;-r requirements.txt (line 2))
  Downloading setuptools-32.3.1-py2.py3-none-any.whl (479kB): 479kB downloaded
Downloading/unpacking enum34 (from cryptography-&gt;-r requirements.txt (line 2))
  Downloading enum34-1.1.6-py2-none-any.whl
Downloading/unpacking ipaddress (from cryptography-&gt;-r requirements.txt (line 2))
  Downloading ipaddress-1.0.17-py2-none-any.whl
Downloading/unpacking cffi&gt;=1.4.1 (from cryptography-&gt;-r requirements.txt (line 2))
  Downloading cffi-1.9.1.tar.gz (407kB): 407kB downloaded
  Running setup.py (path:/tmp/pip-build-BjW0UZ/cffi/setup.py) egg_info for package cffi
    
Downloading/unpacking pyasn1-modules (from service-identity-&gt;-r requirements.txt (line 6))
  Downloading pyasn1_modules-0.0.8-py2.py3-none-any.whl
Downloading/unpacking attrs (from service-identity-&gt;-r requirements.txt (line 6))
  Downloading attrs-16.3.0-py2.py3-none-any.whl
Downloading/unpacking pycparser (from cffi&gt;=1.4.1-&gt;cryptography-&gt;-r requirements.txt (line 2))
  Downloading pycparser-2.17.tar.gz (231kB): 231kB downloaded
  Running setup.py (path:/tmp/pip-build-BjW0UZ/pycparser/setup.py) egg_info for package pycparser
    
    warning: no previously-included files matching 'yacctab.*' found under directory 'tests'
    warning: no previously-included files matching 'lextab.*' found under directory 'tests'
    warning: no previously-included files matching 'yacctab.*' found under directory 'examples'
    warning: no previously-included files matching 'lextab.*' found under directory 'examples'
Installing collected packages: twisted, cryptography, configparser, pyopenssl, gmpy2, service-identity, pycrypto, python-dateutil, tftpy, zope.interface, constantly, incremental, idna, pyasn1, six, setuptools, enum34, ipaddress, cffi, pyasn1-modules, attrs, pycparser
  Running setup.py install for twisted
    
    warning: no previously-included files matching '*.misc' found under directory 'src/twisted'
    warning: no previously-included files matching '*.bugfix' found under directory 'src/twisted'
    warning: no previously-included files matching '*.doc' found under directory 'src/twisted'
    warning: no previously-included files matching '*.feature' found under directory 'src/twisted'
    warning: no previously-included files matching '*.removal' found under directory 'src/twisted'
    warning: no previously-included files matching 'NEWS' found under directory 'src/twisted'
    warning: no previously-included files matching 'README' found under directory 'src/twisted'
    warning: no previously-included files matching 'topfiles' found under directory 'src/twisted'
    warning: no previously-included files found matching 'src/twisted/topfiles/CREDITS'
    warning: no previously-included files found matching 'src/twisted/topfiles/ChangeLog.Old'
    warning: no previously-included files found matching 'codecov.yml'
    warning: no previously-included files found matching 'appveyor.yml'
    no previously-included directories found matching 'bin'
    no previously-included directories found matching 'admin'
    no previously-included directories found matching '.travis'
    warning: no previously-included files found matching 'docs/historic/2003'
    warning: no previously-included files matching '*' found under directory 'docs/historic/2003'
    arm-linux-gnueabihf-gcc -pthread -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -fno-strict-aliasing -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -fPIC -I/usr/include/python2.7 -c conftest.c -o conftest.o
    building 'twisted.test.raiser' extension
    arm-linux-gnueabihf-gcc -pthread -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -fno-strict-aliasing -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -fPIC -I/usr/include/python2.7 -c src/twisted/test/raiser.c -o build/temp.linux-armv7l-2.7/src/twisted/test/raiser.o
    arm-linux-gnueabihf-gcc -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wl,-z,relro -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security build/temp.linux-armv7l-2.7/src/twisted/test/raiser.o -o build/lib.linux-armv7l-2.7/twisted/test/raiser.so
    building 'twisted.python._sendmsg' extension
    arm-linux-gnueabihf-gcc -pthread -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -fno-strict-aliasing -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -fPIC -I/usr/include/python2.7 -c src/twisted/python/_sendmsg.c -o build/temp.linux-armv7l-2.7/src/twisted/python/_sendmsg.o
    arm-linux-gnueabihf-gcc -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wl,-z,relro -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security build/temp.linux-armv7l-2.7/src/twisted/python/_sendmsg.o -o build/lib.linux-armv7l-2.7/twisted/python/_sendmsg.so
    building 'twisted.runner.portmap' extension
    arm-linux-gnueabihf-gcc -pthread -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -fno-strict-aliasing -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -fPIC -I/usr/include/python2.7 -c src/twisted/runner/portmap.c -o build/temp.linux-armv7l-2.7/src/twisted/runner/portmap.o
    arm-linux-gnueabihf-gcc -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wl,-z,relro -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security build/temp.linux-armv7l-2.7/src/twisted/runner/portmap.o -o build/lib.linux-armv7l-2.7/twisted/runner/portmap.so
    Installing trial script to /home/cowrie/cowrie/cowrie-env/bin
    Installing conch script to /home/cowrie/cowrie/cowrie-env/bin
    Installing ckeygen script to /home/cowrie/cowrie/cowrie-env/bin
    Installing twist script to /home/cowrie/cowrie/cowrie-env/bin
    Installing pyhtmlizer script to /home/cowrie/cowrie/cowrie-env/bin
    Installing mailmail script to /home/cowrie/cowrie/cowrie-env/bin
    Installing tkconch script to /home/cowrie/cowrie/cowrie-env/bin
    Installing twistd script to /home/cowrie/cowrie/cowrie-env/bin
    Installing cftp script to /home/cowrie/cowrie/cowrie-env/bin
  Running setup.py install for cryptography
    
    Installed /tmp/pip-build-BjW0UZ/cryptography/cffi-1.9.1-py2.7-linux-armv7l.egg
    Searching for pycparser
    Reading https://pypi.python.org/simple/pycparser/
    Best match: pycparser 2.17
    Downloading https://pypi.python.org/packages/be/64/1bb257ffb17d01f4a38d7ce686809a736837ad4371bcc5c42ba7a715c3ac/pycparser-2.17.tar.gz#md5=ca98dcb50bc1276f230118f6af5a40c7
    Processing pycparser-2.17.tar.gz
    Writing /tmp/easy_install-fNPifv/pycparser-2.17/setup.cfg
    Running pycparser-2.17/setup.py -q bdist_egg --dist-dir /tmp/easy_install-fNPifv/pycparser-2.17/egg-dist-tmp-rWDLWz
    warning: no previously-included files matching 'yacctab.*' found under directory 'tests'
    warning: no previously-included files matching 'lextab.*' found under directory 'tests'
    warning: no previously-included files matching 'yacctab.*' found under directory 'examples'
    warning: no previously-included files matching 'lextab.*' found under directory 'examples'
    zip_safe flag not set; analyzing archive contents...
    pycparser.ply.ygen: module references __file__
    pycparser.ply.yacc: module references __file__
    pycparser.ply.yacc: module MAY be using inspect.getsourcefile
    pycparser.ply.yacc: module MAY be using inspect.stack
    pycparser.ply.lex: module references __file__
    pycparser.ply.lex: module MAY be using inspect.getsourcefile
    
    Installed /tmp/pip-build-BjW0UZ/cryptography/pycparser-2.17-py2.7.egg
    
    no previously-included directories found matching 'docs/_build'
    warning: no previously-included files matching '*' found under directory 'vectors'
    generating cffi module 'build/temp.linux-armv7l-2.7/_padding.c'
    generating cffi module 'build/temp.linux-armv7l-2.7/_constant_time.c'
    generating cffi module 'build/temp.linux-armv7l-2.7/_openssl.c'
    building '_openssl' extension
    arm-linux-gnueabihf-gcc -pthread -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -fno-strict-aliasing -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -fPIC -I/usr/include/python2.7 -c build/temp.linux-armv7l-2.7/_openssl.c -o build/temp.linux-armv7l-2.7/build/temp.linux-armv7l-2.7/_openssl.o
    arm-linux-gnueabihf-gcc -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wl,-z,relro -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security build/temp.linux-armv7l-2.7/build/temp.linux-armv7l-2.7/_openssl.o -lssl -lcrypto -o build/lib.linux-armv7l-2.7/cryptography/hazmat/bindings/_openssl.so
    building '_constant_time' extension
    arm-linux-gnueabihf-gcc -pthread -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -fno-strict-aliasing -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -fPIC -I/usr/include/python2.7 -c build/temp.linux-armv7l-2.7/_constant_time.c -o build/temp.linux-armv7l-2.7/build/temp.linux-armv7l-2.7/_constant_time.o
    arm-linux-gnueabihf-gcc -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wl,-z,relro -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security build/temp.linux-armv7l-2.7/build/temp.linux-armv7l-2.7/_constant_time.o -o build/lib.linux-armv7l-2.7/cryptography/hazmat/bindings/_constant_time.so
    building '_padding' extension
    arm-linux-gnueabihf-gcc -pthread -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -fno-strict-aliasing -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -fPIC -I/usr/include/python2.7 -c build/temp.linux-armv7l-2.7/_padding.c -o build/temp.linux-armv7l-2.7/build/temp.linux-armv7l-2.7/_padding.o
    arm-linux-gnueabihf-gcc -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wl,-z,relro -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security build/temp.linux-armv7l-2.7/build/temp.linux-armv7l-2.7/_padding.o -o build/lib.linux-armv7l-2.7/cryptography/hazmat/bindings/_padding.so
  Running setup.py install for configparser
    
    Skipping installation of /home/cowrie/cowrie/cowrie-env/lib/python2.7/site-packages/backports/__init__.py (namespace package)
    Installing /home/cowrie/cowrie/cowrie-env/lib/python2.7/site-packages/configparser-3.5.0-py2.7-nspkg.pth
  Running setup.py install for gmpy2
    building 'gmpy2' extension
    arm-linux-gnueabihf-gcc -pthread -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -fno-strict-aliasing -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -fPIC -DWITHMPFR -DWITHMPC -I/usr/include/python2.7 -c src/gmpy2.c -o build/temp.linux-armv7l-2.7/src/gmpy2.o
    arm-linux-gnueabihf-gcc -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wl,-z,relro -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security build/temp.linux-armv7l-2.7/src/gmpy2.o -lgmp -lmpfr -lmpc -o build/lib.linux-armv7l-2.7/gmpy2.so
    
  Running setup.py install for pycrypto
    checking for gcc... gcc
    checking whether the C compiler works... yes
    checking for C compiler default output file name... a.out
    checking for suffix of executables...
    checking whether we are cross compiling... no
    checking for suffix of object files... o
    checking whether we are using the GNU C compiler... yes
    checking whether gcc accepts -g... yes
    checking for gcc option to accept ISO C89... none needed
    checking for __gmpz_init in -lgmp... yes
    checking for __gmpz_init in -lmpir... no
    checking whether mpz_powm is declared... yes
    checking whether mpz_powm_sec is declared... yes
    checking how to run the C preprocessor... gcc -E
    checking for grep that handles long lines and -e... /bin/grep
    checking for egrep... /bin/grep -E
    checking for ANSI C header files... yes
    checking for sys/types.h... yes
    checking for sys/stat.h... yes
    checking for stdlib.h... yes
    checking for string.h... yes
    checking for memory.h... yes
    checking for strings.h... yes
    checking for inttypes.h... yes
    checking for stdint.h... yes
    checking for unistd.h... yes
    checking for inttypes.h... (cached) yes
    checking limits.h usability... yes
    checking limits.h presence... yes
    checking for limits.h... yes
    checking stddef.h usability... yes
    checking stddef.h presence... yes
    checking for stddef.h... yes
    checking for stdint.h... (cached) yes
    checking for stdlib.h... (cached) yes
    checking for string.h... (cached) yes
    checking wchar.h usability... yes
    checking wchar.h presence... yes
    checking for wchar.h... yes
    checking for inline... inline
    checking for int16_t... yes
    checking for int32_t... yes
    checking for int64_t... yes
    checking for int8_t... yes
    checking for size_t... yes
    checking for uint16_t... yes
    checking for uint32_t... yes
    checking for uint64_t... yes
    checking for uint8_t... yes
    checking for stdlib.h... (cached) yes
    checking for GNU libc compatible malloc... yes
    checking for memmove... yes
    checking for memset... yes
    configure: creating ./config.status
    config.status: creating src/config.h
    building 'Crypto.PublicKey._fastmath' extension
    arm-linux-gnueabihf-gcc -pthread -fwrapv -Wall -Wstrict-prototypes -fno-strict-aliasing -D_FORTIFY_SOURCE=2 -fstack-protector-strong -Wformat -Werror=format-security -fPIC -std=c99 -O3 -fomit-frame-pointer -Isrc/ -I/usr/include/ -I/usr/include/python2.7 -c src/_fastmath.c -o build/temp.linux-armv7l-2.7/src/_fastmath.o
    arm-linux-gnueabihf-gcc -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wl,-z,relro -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security build/temp.linux-armv7l-2.7/src/_fastmath.o -lgmp -o build/lib.linux-armv7l-2.7/Crypto/PublicKey/_fastmath.so
    building 'Crypto.Hash._MD2' extension
    arm-linux-gnueabihf-gcc -pthread -fwrapv -Wall -Wstrict-prototypes -fno-strict-aliasing -D_FORTIFY_SOURCE=2 -fstack-protector-strong -Wformat -Werror=format-security -fPIC -std=c99 -O3 -fomit-frame-pointer -Isrc/ -I/usr/include/python2.7 -c src/MD2.c -o build/temp.linux-armv7l-2.7/src/MD2.o
    arm-linux-gnueabihf-gcc -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wl,-z,relro -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security build/temp.linux-armv7l-2.7/src/MD2.o -o build/lib.linux-armv7l-2.7/Crypto/Hash/_MD2.so
    building 'Crypto.Hash._MD4' extension
    arm-linux-gnueabihf-gcc -pthread -fwrapv -Wall -Wstrict-prototypes -fno-strict-aliasing -D_FORTIFY_SOURCE=2 -fstack-protector-strong -Wformat -Werror=format-security -fPIC -std=c99 -O3 -fomit-frame-pointer -Isrc/ -I/usr/include/python2.7 -c src/MD4.c -o build/temp.linux-armv7l-2.7/src/MD4.o
    arm-linux-gnueabihf-gcc -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wl,-z,relro -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security build/temp.linux-armv7l-2.7/src/MD4.o -o build/lib.linux-armv7l-2.7/Crypto/Hash/_MD4.so
    building 'Crypto.Hash._SHA256' extension
    arm-linux-gnueabihf-gcc -pthread -fwrapv -Wall -Wstrict-prototypes -fno-strict-aliasing -D_FORTIFY_SOURCE=2 -fstack-protector-strong -Wformat -Werror=format-security -fPIC -std=c99 -O3 -fomit-frame-pointer -Isrc/ -I/usr/include/python2.7 -c src/SHA256.c -o build/temp.linux-armv7l-2.7/src/SHA256.o
    arm-linux-gnueabihf-gcc -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wl,-z,relro -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security build/temp.linux-armv7l-2.7/src/SHA256.o -o build/lib.linux-armv7l-2.7/Crypto/Hash/_SHA256.so
    building 'Crypto.Hash._SHA224' extension
    arm-linux-gnueabihf-gcc -pthread -fwrapv -Wall -Wstrict-prototypes -fno-strict-aliasing -D_FORTIFY_SOURCE=2 -fstack-protector-strong -Wformat -Werror=format-security -fPIC -std=c99 -O3 -fomit-frame-pointer -Isrc/ -I/usr/include/python2.7 -c src/SHA224.c -o build/temp.linux-armv7l-2.7/src/SHA224.o
    arm-linux-gnueabihf-gcc -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wl,-z,relro -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security build/temp.linux-armv7l-2.7/src/SHA224.o -o build/lib.linux-armv7l-2.7/Crypto/Hash/_SHA224.so
    building 'Crypto.Hash._SHA384' extension
    arm-linux-gnueabihf-gcc -pthread -fwrapv -Wall -Wstrict-prototypes -fno-strict-aliasing -D_FORTIFY_SOURCE=2 -fstack-protector-strong -Wformat -Werror=format-security -fPIC -std=c99 -O3 -fomit-frame-pointer -Isrc/ -I/usr/include/python2.7 -c src/SHA384.c -o build/temp.linux-armv7l-2.7/src/SHA384.o
    arm-linux-gnueabihf-gcc -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wl,-z,relro -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security build/temp.linux-armv7l-2.7/src/SHA384.o -o build/lib.linux-armv7l-2.7/Crypto/Hash/_SHA384.so
    building 'Crypto.Hash._SHA512' extension
    arm-linux-gnueabihf-gcc -pthread -fwrapv -Wall -Wstrict-prototypes -fno-strict-aliasing -D_FORTIFY_SOURCE=2 -fstack-protector-strong -Wformat -Werror=format-security -fPIC -std=c99 -O3 -fomit-frame-pointer -Isrc/ -I/usr/include/python2.7 -c src/SHA512.c -o build/temp.linux-armv7l-2.7/src/SHA512.o
    arm-linux-gnueabihf-gcc -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wl,-z,relro -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security build/temp.linux-armv7l-2.7/src/SHA512.o -o build/lib.linux-armv7l-2.7/Crypto/Hash/_SHA512.so
    building 'Crypto.Hash._RIPEMD160' extension
    arm-linux-gnueabihf-gcc -pthread -fwrapv -Wall -Wstrict-prototypes -fno-strict-aliasing -D_FORTIFY_SOURCE=2 -fstack-protector-strong -Wformat -Werror=format-security -fPIC -std=c99 -O3 -fomit-frame-pointer -DPCT_LITTLE_ENDIAN=1 -Isrc/ -I/usr/include/python2.7 -c src/RIPEMD160.c -o build/temp.linux-armv7l-2.7/src/RIPEMD160.o
    arm-linux-gnueabihf-gcc -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wl,-z,relro -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security build/temp.linux-armv7l-2.7/src/RIPEMD160.o -o build/lib.linux-armv7l-2.7/Crypto/Hash/_RIPEMD160.so
    building 'Crypto.Cipher._AES' extension
    arm-linux-gnueabihf-gcc -pthread -fwrapv -Wall -Wstrict-prototypes -fno-strict-aliasing -D_FORTIFY_SOURCE=2 -fstack-protector-strong -Wformat -Werror=format-security -fPIC -std=c99 -O3 -fomit-frame-pointer -Isrc/ -I/usr/include/python2.7 -c src/AES.c -o build/temp.linux-armv7l-2.7/src/AES.o
    arm-linux-gnueabihf-gcc -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wl,-z,relro -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security build/temp.linux-armv7l-2.7/src/AES.o -o build/lib.linux-armv7l-2.7/Crypto/Cipher/_AES.so
    building 'Crypto.Cipher._ARC2' extension
    arm-linux-gnueabihf-gcc -pthread -fwrapv -Wall -Wstrict-prototypes -fno-strict-aliasing -D_FORTIFY_SOURCE=2 -fstack-protector-strong -Wformat -Werror=format-security -fPIC -std=c99 -O3 -fomit-frame-pointer -Isrc/ -I/usr/include/python2.7 -c src/ARC2.c -o build/temp.linux-armv7l-2.7/src/ARC2.o
    arm-linux-gnueabihf-gcc -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wl,-z,relro -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security build/temp.linux-armv7l-2.7/src/ARC2.o -o build/lib.linux-armv7l-2.7/Crypto/Cipher/_ARC2.so
    building 'Crypto.Cipher._Blowfish' extension
    arm-linux-gnueabihf-gcc -pthread -fwrapv -Wall -Wstrict-prototypes -fno-strict-aliasing -D_FORTIFY_SOURCE=2 -fstack-protector-strong -Wformat -Werror=format-security -fPIC -std=c99 -O3 -fomit-frame-pointer -Isrc/ -I/usr/include/python2.7 -c src/Blowfish.c -o build/temp.linux-armv7l-2.7/src/Blowfish.o
    arm-linux-gnueabihf-gcc -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wl,-z,relro -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security build/temp.linux-armv7l-2.7/src/Blowfish.o -o build/lib.linux-armv7l-2.7/Crypto/Cipher/_Blowfish.so
    building 'Crypto.Cipher._CAST' extension
    arm-linux-gnueabihf-gcc -pthread -fwrapv -Wall -Wstrict-prototypes -fno-strict-aliasing -D_FORTIFY_SOURCE=2 -fstack-protector-strong -Wformat -Werror=format-security -fPIC -std=c99 -O3 -fomit-frame-pointer -Isrc/ -I/usr/include/python2.7 -c src/CAST.c -o build/temp.linux-armv7l-2.7/src/CAST.o
    arm-linux-gnueabihf-gcc -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wl,-z,relro -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security build/temp.linux-armv7l-2.7/src/CAST.o -o build/lib.linux-armv7l-2.7/Crypto/Cipher/_CAST.so
    building 'Crypto.Cipher._DES' extension
    arm-linux-gnueabihf-gcc -pthread -fwrapv -Wall -Wstrict-prototypes -fno-strict-aliasing -D_FORTIFY_SOURCE=2 -fstack-protector-strong -Wformat -Werror=format-security -fPIC -std=c99 -O3 -fomit-frame-pointer -Isrc/ -Isrc/libtom/ -I/usr/include/python2.7 -c src/DES.c -o build/temp.linux-armv7l-2.7/src/DES.o
    arm-linux-gnueabihf-gcc -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wl,-z,relro -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security build/temp.linux-armv7l-2.7/src/DES.o -o build/lib.linux-armv7l-2.7/Crypto/Cipher/_DES.so
    building 'Crypto.Cipher._DES3' extension
    arm-linux-gnueabihf-gcc -pthread -fwrapv -Wall -Wstrict-prototypes -fno-strict-aliasing -D_FORTIFY_SOURCE=2 -fstack-protector-strong -Wformat -Werror=format-security -fPIC -std=c99 -O3 -fomit-frame-pointer -Isrc/ -Isrc/libtom/ -I/usr/include/python2.7 -c src/DES3.c -o build/temp.linux-armv7l-2.7/src/DES3.o
    arm-linux-gnueabihf-gcc -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wl,-z,relro -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security build/temp.linux-armv7l-2.7/src/DES3.o -o build/lib.linux-armv7l-2.7/Crypto/Cipher/_DES3.so
    building 'Crypto.Cipher._ARC4' extension
    arm-linux-gnueabihf-gcc -pthread -fwrapv -Wall -Wstrict-prototypes -fno-strict-aliasing -D_FORTIFY_SOURCE=2 -fstack-protector-strong -Wformat -Werror=format-security -fPIC -std=c99 -O3 -fomit-frame-pointer -Isrc/ -I/usr/include/python2.7 -c src/ARC4.c -o build/temp.linux-armv7l-2.7/src/ARC4.o
    arm-linux-gnueabihf-gcc -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wl,-z,relro -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security build/temp.linux-armv7l-2.7/src/ARC4.o -o build/lib.linux-armv7l-2.7/Crypto/Cipher/_ARC4.so
    building 'Crypto.Cipher._XOR' extension
    arm-linux-gnueabihf-gcc -pthread -fwrapv -Wall -Wstrict-prototypes -fno-strict-aliasing -D_FORTIFY_SOURCE=2 -fstack-protector-strong -Wformat -Werror=format-security -fPIC -std=c99 -O3 -fomit-frame-pointer -Isrc/ -I/usr/include/python2.7 -c src/XOR.c -o build/temp.linux-armv7l-2.7/src/XOR.o
    arm-linux-gnueabihf-gcc -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wl,-z,relro -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security build/temp.linux-armv7l-2.7/src/XOR.o -o build/lib.linux-armv7l-2.7/Crypto/Cipher/_XOR.so
    building 'Crypto.Util.strxor' extension
    arm-linux-gnueabihf-gcc -pthread -fwrapv -Wall -Wstrict-prototypes -fno-strict-aliasing -D_FORTIFY_SOURCE=2 -fstack-protector-strong -Wformat -Werror=format-security -fPIC -std=c99 -O3 -fomit-frame-pointer -Isrc/ -I/usr/include/python2.7 -c src/strxor.c -o build/temp.linux-armv7l-2.7/src/strxor.o
    arm-linux-gnueabihf-gcc -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wl,-z,relro -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security build/temp.linux-armv7l-2.7/src/strxor.o -o build/lib.linux-armv7l-2.7/Crypto/Util/strxor.so
    building 'Crypto.Util._counter' extension
    arm-linux-gnueabihf-gcc -pthread -fwrapv -Wall -Wstrict-prototypes -fno-strict-aliasing -D_FORTIFY_SOURCE=2 -fstack-protector-strong -Wformat -Werror=format-security -fPIC -std=c99 -O3 -fomit-frame-pointer -Isrc/ -I/usr/include/python2.7 -c src/_counter.c -o build/temp.linux-armv7l-2.7/src/_counter.o
    arm-linux-gnueabihf-gcc -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wl,-z,relro -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security build/temp.linux-armv7l-2.7/src/_counter.o -o build/lib.linux-armv7l-2.7/Crypto/Util/_counter.so
    
  Running setup.py install for tftpy
    changing mode of build/scripts-2.7/tftpy_client.py from 644 to 755
    changing mode of build/scripts-2.7/tftpy_server.py from 644 to 755
    
    changing mode of /home/cowrie/cowrie/cowrie-env/bin/tftpy_client.py to 755
    changing mode of /home/cowrie/cowrie/cowrie-env/bin/tftpy_server.py to 755
  Running setup.py install for zope.interface
    
    warning: no previously-included files matching '*.dll' found anywhere in distribution
    warning: no previously-included files matching '*.pyc' found anywhere in distribution
    warning: no previously-included files matching '*.pyo' found anywhere in distribution
    warning: no previously-included files matching '*.so' found anywhere in distribution
    warning: no previously-included files matching 'coverage.xml' found anywhere in distribution
    warning: no previously-included files matching 'appveyor.yml' found anywhere in distribution
    no previously-included directories found matching 'docs/_build'
    building 'zope.interface._zope_interface_coptimizations' extension
    arm-linux-gnueabihf-gcc -pthread -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -fno-strict-aliasing -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -fPIC -I/usr/include/python2.7 -c src/zope/interface/_zope_interface_coptimizations.c -o build/temp.linux-armv7l-2.7/src/zope/interface/_zope_interface_coptimizations.o
    arm-linux-gnueabihf-gcc -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wl,-z,relro -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security build/temp.linux-armv7l-2.7/src/zope/interface/_zope_interface_coptimizations.o -o build/lib.linux-armv7l-2.7/zope/interface/_zope_interface_coptimizations.so
    Skipping installation of /home/cowrie/cowrie/cowrie-env/lib/python2.7/site-packages/zope/__init__.py (namespace package)
    Installing /home/cowrie/cowrie/cowrie-env/lib/python2.7/site-packages/zope.interface-4.3.3-py2.7-nspkg.pth
  Found existing installation: setuptools 5.5.1
    Uninstalling setuptools:
      Successfully uninstalled setuptools
  Running setup.py install for cffi
    building '_cffi_backend' extension
    arm-linux-gnueabihf-gcc -pthread -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -fno-strict-aliasing -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -fPIC -DUSE__THREAD -I/usr/include/python2.7 -c c/_cffi_backend.c -o build/temp.linux-armv7l-2.7/c/_cffi_backend.o
    arm-linux-gnueabihf-gcc -pthread -shared -Wl,-O1 -Wl,-Bsymbolic-functions -Wl,-z,relro -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security -Wl,-z,relro -D_FORTIFY_SOURCE=2 -g -fstack-protector-strong -Wformat -Werror=format-security build/temp.linux-armv7l-2.7/c/_cffi_backend.o -lffi -o build/lib.linux-armv7l-2.7/_cffi_backend.so
  Could not find .egg-info directory in install record for cffi&gt;=1.4.1 (from cryptography-&gt;-r requirements.txt (line 2))
  Running setup.py install for pycparser
    warning: no previously-included files matching 'yacctab.*' found under directory 'tests'
    warning: no previously-included files matching 'lextab.*' found under directory 'tests'
    warning: no previously-included files matching 'yacctab.*' found under directory 'examples'
    warning: no previously-included files matching 'lextab.*' found under directory 'examples'
    Build the lexing/parsing tables
  Could not find .egg-info directory in install record for pycparser (from cffi&gt;=1.4.1-&gt;cryptography-&gt;-r requirements.txt (line 2))
Successfully installed twisted cryptography configparser pyopenssl gmpy2 service-identity pycrypto python-dateutil tftpy zope.interface constantly incremental idna pyasn1 six setuptools enum34 ipaddress cffi pyasn1-modules attrs pycparser
Cleaning up...
(cowrie-env) $
(cowrie-env) $ deactivate
$
</code></pre>

<h3 id="cowrieの設定:638054c4f24019ce8e35d2f1d32a3666">Cowrieの設定</h3>

<pre><code>$ cp -p cowrie.cfg.dist cowrie.cfg
$ ls -l cowrie.cfg*
-rw-r--r-- 1 cowrie cowrie 11555  1月  4 19:05 cowrie.cfg
-rw-r--r-- 1 cowrie cowrie 11555  1月  4 19:05 cowrie.cfg.dist
$
$ vi cowrie.cfg
#sensor_name=myhostname
sensor_name=homepot1

#hostname = svr04
hostname = cowrie01
$
$ diff cowrie.cfg.dist cowrie.cfg
17a18
&gt; sensor_name=homepot1
23c24,25
&lt; hostname = svr04
---
&gt; #hostname = svr04
&gt; hostname = cowrie01
$
</code></pre>

<h3 id="cowrieの起動と終了:638054c4f24019ce8e35d2f1d32a3666">Cowrieの起動と終了</h3>

<p>起動するときは以下のコマンドを実行する。</p>

<pre><code>$ ./start.sh cowrie-env/
Activating virtualenv &quot;cowrie-env/&quot;
Starting cowrie with extra arguments [ ] ...
$
</code></pre>

<p>終了するときは以下のコマンドを実行する。</p>

<pre><code>$ ./stop.sh
Stopping cowrie...
$
</code></pre>

<h3 id="cowrieポートのポートフォワード:638054c4f24019ce8e35d2f1d32a3666">Cowrieポートのポートフォワード</h3>

<p>Cowrieでは<code>2222/tcp</code>でポート待ち受けをしているため、iptablesで22/tcpにポートフォワードする。</p>

<pre><code>$ sudo iptables -t nat -A PREROUTING -p tcp --dport 22 -j REDIRECT --to-port 2222
$ sudo iptables -t nat -n -L
Chain PREROUTING (policy ACCEPT)
target     prot opt source               destination         
REDIRECT   tcp  --  0.0.0.0/0            0.0.0.0/0            tcp dpt:22 redir ports 2222
$
</code></pre>

<h3 id="iptables設定の保存:638054c4f24019ce8e35d2f1d32a3666">iptables設定の保存</h3>

<p>再起動時にもポートフォワード設定が有効になるようにiptablesの設定を保存する。</p>

<pre><code>$ sudo -E apt-get install iptables-persistent
パッケージリストを読み込んでいます... 完了
依存関係ツリーを作成しています                
状態情報を読み取っています... 完了
以下の追加パッケージがインストールされます:
  netfilter-persistent
以下のパッケージが新たにインストールされます:
  iptables-persistent netfilter-persistent
アップグレード: 0 個、新規インストール: 2 個、削除: 0 個、保留: 0 個。
19.5 kB のアーカイブを取得する必要があります。
この操作後に追加で 148 kB のディスク容量が消費されます。
続行しますか? [Y/n] y
取得:1 http://mirrordirector.raspbian.org/raspbian/ jessie/main netfilter-persistent all 1.0.3+deb8u1 [8,494 B]
取得:2 http://mirrordirector.raspbian.org/raspbian/ jessie/main iptables-persistent all 1.0.3+deb8u1 [11.0 kB]
19.5 kB を 2秒 で取得しました (7,989 B/s)      
パッケージを事前設定しています ...

 ┌─────────────────┤ iptables-persistent を設定しています ├──────────────────┐
 │                                                                           │ 
 │ 現在の iptables のルールは、設定ファイル /etc/iptables/rules.v4 に保存で  │ 
 │ きます。このルールは、システムの起動時に自動的に読み込まれるようになりま  │ 
 │ す。                                                                      │ 
 │                                                                           │ 
 │ ルールは、パッケージのインストール時にのみ自動的に保存されます。ルールの  │ 
 │ ファイルを最新に保つには、iptables-save(8) のマニュアルページを参照して   │ 
 │ ください。                                                                │ 
 │                                                                           │ 
 │ 現在の IPv4 ルールを保存しますか?                                         │ 
 │                                                                           │ 
 │                    &lt;はい&gt;                      &lt;いいえ&gt;                   │ 
 │                                                                           │ 
 └───────────────────────────────────────────────────────────────────────────┘ 
「はい」を選択

┌─────────────────┤ iptables-persistent を設定しています ├──────────────────┐
 │                                                                           │ 
 │ 現在の iptables のルールは、設定ファイル /etc/iptables/rules.v6 に保存で  │ 
 │ きます。このルールは、システムの起動時に自動的に読み込まれるようになりま  │ 
 │ す。                                                                      │ 
 │                                                                           │ 
 │ ルールは、パッケージのインストール時にのみ自動的に保存されます。ルールの  │ 
 │ ファイルを最新に保つには、ip6tables-save(8) のマニュアルページを参照して  │ 
 │ ください。                                                                │ 
 │                                                                           │ 
 │ 現在の IPv6 ルールを保存しますか?                                         │ 
 │                                                                           │ 
 │                    &lt;はい&gt;                      &lt;いいえ&gt;                   │ 
 │                                                                           │ 
 └───────────────────────────────────────────────────────────────────────────┘ 
「いいえ」を選択

以前に未選択のパッケージ netfilter-persistent を選択しています。
(データベースを読み込んでいます ... 現在 34741 個のファイルとディレクトリがインストールされています。)
.../netfilter-persistent_1.0.3+deb8u1_all.deb を展開する準備をしています ...
netfilter-persistent (1.0.3+deb8u1) を展開しています...
以前に未選択のパッケージ iptables-persistent を選択しています。
.../iptables-persistent_1.0.3+deb8u1_all.deb を展開する準備をしています ...
iptables-persistent (1.0.3+deb8u1) を展開しています...
systemd (215-17+deb8u5) のトリガを処理しています ...
man-db (2.7.0.2-5) のトリガを処理しています ...
netfilter-persistent (1.0.3+deb8u1) を設定しています ...
update-rc.d: warning: start and stop actions are no longer supported; falling back to defaults
iptables-persistent (1.0.3+deb8u1) を設定しています ...
systemd (215-17+deb8u5) のトリガを処理しています ...
$
$ sudo systemctl start netfilter-persistent
$ sudo systemctl enable netfilter-persistent
Synchronizing state for netfilter-persistent.service with sysvinit using update-rc.d...
Executing /usr/sbin/update-rc.d netfilter-persistent defaults
Executing /usr/sbin/update-rc.d netfilter-persistent enable
$
</code></pre>

<p>今後iptablesの設定変更を保存するには以下のコマンドを実行します。</p>

<pre><code>$ sudo netfilter-persistent save
</code></pre>

<h3 id="cowrieの自動起動設定:638054c4f24019ce8e35d2f1d32a3666">Cowrieの自動起動設定</h3>

<p>supervisorを使用してcowrieをデーモン化する。</p>

<pre><code>$ sudo -E apt-get install supervisor
パッケージリストを読み込んでいます... 完了
依存関係ツリーを作成しています                
状態情報を読み取っています... 完了
以下の追加パッケージがインストールされます:
  python-meld3 python-pkg-resources
提案パッケージ:
  python-distribute python-distribute-doc
以下のパッケージが新たにインストールされます:
  python-meld3 python-pkg-resources supervisor
アップグレード: 0 個、新規インストール: 3 個、削除: 0 個、保留: 0 個。
369 kB のアーカイブを取得する必要があります。
この操作後に追加で 1,670 kB のディスク容量が消費されます。
続行しますか? [Y/n] y
取得:1 http://mirrordirector.raspbian.org/raspbian/ jessie/main python-pkg-resources all 5.5.1-1 [64.4 kB]
取得:2 http://mirrordirector.raspbian.org/raspbian/ jessie/main python-meld3 armhf 1.0.0-1 [37.0 kB]
取得:3 http://mirrordirector.raspbian.org/raspbian/ jessie/main supervisor all 3.0r1-1 [267 kB]
369 kB を 1秒 で取得しました (195 kB/s)
以前に未選択のパッケージ python-pkg-resources を選択しています。
(データベースを読み込んでいます ... 現在 34759 個のファイルとディレクトリがインストールされています。)
.../python-pkg-resources_5.5.1-1_all.deb を展開する準備をしています ...
python-pkg-resources (5.5.1-1) を展開しています...
以前に未選択のパッケージ python-meld3 を選択しています。
.../python-meld3_1.0.0-1_armhf.deb を展開する準備をしています ...
python-meld3 (1.0.0-1) を展開しています...
以前に未選択のパッケージ supervisor を選択しています。
.../supervisor_3.0r1-1_all.deb を展開する準備をしています ...
supervisor (3.0r1-1) を展開しています...
systemd (215-17+deb8u5) のトリガを処理しています ...
python-pkg-resources (5.5.1-1) を設定しています ...
python-meld3 (1.0.0-1) を設定しています ...
supervisor (3.0r1-1) を設定しています ...
systemd (215-17+deb8u5) のトリガを処理しています ...
$
$ sudo systemctl restart supervisor
$ sudo systemctl enable supervisor
Synchronizing state for supervisor.service with sysvinit using update-rc.d...
Executing /usr/sbin/update-rc.d supervisor defaults
Executing /usr/sbin/update-rc.d supervisor enable
$
$ sudo vi /etc/supervisor/conf.d/cowrie.conf
[program:cowrie]
command=/home/cowrie/cowrie/start.sh cowrie-env
directory=/home/cowrie/cowrie/
user=cowrie
autorestart=true
redirect_stderr=true
$
$ sudo su - cowrie
$ cd cowrie/
$ vi start.sh
#DAEMONIZE=&quot;&quot;
DAEMONIZE=&quot;-n&quot;
$
$ sudo supervisorctl reread
cowrie: available
$
$ sudo supervisorctl add cowrie
cowrie: added process group
$
$ sudo supervisorctl status
cowrie                           RUNNING    pid 20292, uptime 0:00:04
$
</code></pre>

<p>以上</p>

                </div>
              </article>
              
              <article>
                <div class="title">
                  <h1><a href="http://www.shinayoshi.net/post/2017/01/03/setting-proxy/">家庭内インターネット接続環境を構築する その6</a></h1>
                  <p>
                    <span class="label label-primary">Tue Jan 3, 2017</span> in
                    
                    
                    <a href="http://www.shinayoshi.net//categories/server">server</a>
                     using tags
                    
                    
                    <a href="http://www.shinayoshi.net//tags/raspberrypi">raspberrypi</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/home-network">home-network</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homepxy1">homepxy1</a>
                    
                  </p>
                </div>
                <div class="contents">
                  

<p>FortiGate 60DとRaspberry Piを使用して家庭内インターネット接続環境を構築します。
最終的には以下のような構成を想定しています。</p>

<p><img src="/img/20161022_01/home-network.png" alt="home network" width="640px" /></p>

<p>前回に引き続き<code>homepxy1</code>を構築していきます。</p>

<h2 id="raspberry-pi-2でプロキシサーバ構築:4d2b653e7f73799c1b8de9cc6a404282">Raspberry Pi 2でプロキシサーバ構築</h2>

<p>家庭内インターネット接続環境からインターネットに接続するためにキャッシュDNSサーバとプロキシサーバを構築します。
今回はプロキシサーバを構築していきます。</p>

<h3 id="squidの設定:4d2b653e7f73799c1b8de9cc6a404282">Squidの設定</h3>

<p>squidのインストール</p>

<pre><code>$ sudo apt-get install squid
パッケージリストを読み込んでいます... 完了
依存関係ツリーを作成しています                
状態情報を読み取っています... 完了
以下の追加パッケージがインストールされます:
  squid-common squid-langpack
提案パッケージ:
  squidclient squid-cgi logcheck-database smbclient winbind
以下のパッケージが新たにインストールされます:
  squid squid-common squid-langpack
アップグレード: 0 個、新規インストール: 3 個、削除: 0 個、保留: 1 個。
1,106 kB のアーカイブを取得する必要があります。
この操作後に追加で 3,882 kB のディスク容量が消費されます。
続行しますか? [Y/n] y
取得:1 http://mirrordirector.raspbian.org/raspbian/ jessie/main squid-langpack all 20140506-1 [150 kB]
取得:2 http://mirrordirector.raspbian.org/raspbian/ jessie/main squid-common all 2.7.STABLE9-4.1 [352 kB]
取得:3 http://mirrordirector.raspbian.org/raspbian/ jessie/main squid armhf 2.7.STABLE9-4.1+b1 [604 kB]
1,106 kB を 4秒 で取得しました (267 kB/s)
パッケージを事前設定しています ...
以前に未選択のパッケージ squid-langpack を選択しています。
(データベースを読み込んでいます ... 現在 31342 個のファイルとディレクトリがインストールされています。)
.../squid-langpack_20140506-1_all.deb を展開する準備をしています ...
squid-langpack (20140506-1) を展開しています...
以前に未選択のパッケージ squid-common を選択しています。
.../squid-common_2.7.STABLE9-4.1_all.deb を展開する準備をしています ...
squid-common (2.7.STABLE9-4.1) を展開しています...
以前に未選択のパッケージ squid を選択しています。
.../squid_2.7.STABLE9-4.1+b1_armhf.deb を展開する準備をしています ...
squid (2.7.STABLE9-4.1+b1) を展開しています...
systemd (215-17+deb8u5) のトリガを処理しています ...
man-db (2.7.0.2-5) のトリガを処理しています ...
squid-langpack (20140506-1) を設定しています ...
squid-common (2.7.STABLE9-4.1) を設定しています ...
squid (2.7.STABLE9-4.1+b1) を設定しています ...
Creating squid spool directory structure
2017/01/03 23:26:35| Creating Swap Directories
systemd (215-17+deb8u5) のトリガを処理しています ...
$
</code></pre>

<p>Squidの設定</p>

<pre><code>$ sudo cp -p /etc/squid/squid.conf{,.org}
$ ls -l /etc/squid/squid.conf*
-rw------- 1 root root 169404  1月  3 23:26 /etc/squid/squid.conf
-rw------- 1 root root 169404  1月  3 23:26 /etc/squid/squid.conf.org
$
$ sudo vi /etc/squid/squid.conf
$ sudo diff /etc/squid/squid.conf.org /etc/squid/squid.conf
609,611c609,616
&lt; acl localnet src 10.0.0.0/8	# RFC1918 possible internal network
&lt; acl localnet src 172.16.0.0/12	# RFC1918 possible internal network
&lt; acl localnet src 192.168.0.0/16	# RFC1918 possible internal network
---
&gt; #acl localnet src 10.0.0.0/8	# RFC1918 possible internal network
&gt; #acl localnet src 172.16.0.0/12	# RFC1918 possible internal network
&gt; #acl localnet src 192.168.0.0/16	# RFC1918 possible internal network
&gt; acl localnet src 192.168.10.0/24
&gt; acl localnet src 192.168.20.0/24
&gt; acl localnet src 192.168.30.0/24
&gt; acl localnet src 192.168.40.0/24
&gt; 
676c681
&lt; #http_access allow localnet
---
&gt; http_access allow localnet
1738a1744
&gt; cache_mem 256 MB
1747a1754
&gt; maximum_object_size_in_memory 512 KB
1945a1953
&gt; cache_dir ufs /var/spool/squid 10000 16 256
1988a1997
&gt; maximum_object_size 20480 KB
2097a2107
&gt; logformat combined %&gt;a %ui %un [%tl] &quot;%rm %ru HTTP/%rv&quot; %Hs %&lt;st &quot;%{Referer}&gt;h&quot; &quot;%{User-Agent}&gt;h&quot; %Ss:%Sh
2121c2131,2132
&lt; access_log /var/log/squid/access.log squid
---
&gt; #access_log /var/log/squid/access.log squid
&gt; access_log /var/log/squid/access.log combined
2217a2229
&gt; emulate_httpd_log off
2751c2763,2768
&lt; refresh_pattern .		0	20%	4320
---
&gt; refresh_pattern -i \.(gif|png|jpe?g|tif?f|bmp)$ 1440 25% 10080
&gt; refresh_pattern -i \.(mpe?g|avi|ra?m|wmv|mov)$ 1440 25% 10080
&gt; refresh_pattern -i \.(wav|mp3|mid)$ 1440 25% 10080
&gt; refresh_pattern -i \.(class|swf|pdf)$ 1440 25% 10080
&gt; refresh_pattern -i \.(js|css)$ 1440 25% 10080
&gt; refresh_pattern . 45 20% 4320
2944a2962
&gt; via off
3100a3119,3122
&gt; header_access Referer deny all
&gt; header_access X-Forwarded-For deny all
&gt; header_access Via deny all
&gt; header_access Cache-Control deny all
3392a3415
&gt; visible_hostname unknown
4699a4723
&gt; forwarded_for off
$
</code></pre>

<p>Squidの設定不備を確認</p>

<pre><code>$ sudo squid -k parse
</code></pre>

<p>Squidの起動</p>

<pre><code>$ sudo systemctl restart squid
$ sudo systemctl enable squid
Synchronizing state for squid.service with sysvinit using update-rc.d...
Executing /usr/sbin/update-rc.d squid defaults
Executing /usr/sbin/update-rc.d squid enable
$
</code></pre>

<ul>
<li><a href="http://www.unix-power.net/linux/squid.html">CentOS Squidの設定</a></li>
<li><a href="http://tech.ckme.co.jp/proxy.shtml">Proxyサーバの設定（squid）：tech.ckme.co.jp</a></li>
<li><a href="http://nabeshiki.tumblr.com/post/20000083416/2001-sd-squid">Proxyキャッシュサーバ設定術・Squidの設定(2001年掲載) | なべしき</a></li>
<li><a href="http://blog.asial.co.jp/1076">Privoxy + Ziproxy + Squidで高速フィルタリングサーバを作ってみた : アシアルブログ</a></li>
</ul>

<h3 id="ブラウザのプロキシ設定:4d2b653e7f73799c1b8de9cc6a404282">ブラウザのプロキシ設定</h3>

<p>ブラウザ使用するプロキシ設定をSquidに変更する。</p>

<p>Squidのログを確認してSquid経由でWebアクセスができていることを確認する。</p>

<pre><code>$ sudo cat /var/log/squid/access.log
</code></pre>

<h3 id="raspbianのプロキシ設定:4d2b653e7f73799c1b8de9cc6a404282">Raspbianのプロキシ設定</h3>

<p>起動時にプロキシを使用するように設定する。</p>

<pre><code>$ sudo vi /etc/profile.d/proxy.sh
PROXY=&quot;192.168.20.10:3128&quot;
export http_proxy=&quot;http://${PROXY}&quot;
export https_proxy=&quot;http://${PROXY}&quot;
export no_proxy=&quot;localhost,127.0.0.1,192.168.*&quot;

export HTTP_PROXY=&quot;${http_proxy}&quot;
export HTTPS_PROXY=&quot;${https_proxy}&quot;
export NO_PROXY=&quot;${no_proxy}&quot;
$ source /etc/profile.d/proxy.sh
</code></pre>

<p>上記コマンドではsudo時の環境変数には反映されない。そのため、sudo時には<code>-E</code>オプションを指定する。</p>

<pre><code>$ sudo -E apt-get update
$ sudo -E apt-get upgrade
</code></pre>

<ul>
<li><a href="http://karaage.hatenadiary.jp/entry/2015/11/26/073000">Mac/Linux/Raspberry Piでプロキシサーバを手軽に設定する方法 - karaage. [からあげ]</a></li>
</ul>

<p>以上</p>

                </div>
              </article>
              
              <article>
                <div class="title">
                  <h1><a href="http://www.shinayoshi.net/post/2017/01/03/setting-cache-dns/">家庭内インターネット接続環境を構築する その5</a></h1>
                  <p>
                    <span class="label label-primary">Tue Jan 3, 2017</span> in
                    
                    
                    <a href="http://www.shinayoshi.net//categories/server">server</a>
                     using tags
                    
                    
                    <a href="http://www.shinayoshi.net//tags/raspberrypi">raspberrypi</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/home-network">home-network</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homepxy1">homepxy1</a>
                    
                  </p>
                </div>
                <div class="contents">
                  

<p>FortiGate 60DとRaspberry Piを使用して家庭内インターネット接続環境を構築します。
最終的には以下のような構成を想定しています。</p>

<p><img src="/img/20161022_01/home-network.png" alt="home network" width="640px" /></p>

<p>今回は<code>homepxy1</code>を構築していきます。</p>

<h2 id="raspberry-pi-2でキャッシュdnsサーバ構築:a3b948e685fd47b3236875750b0610c7">Raspberry Pi 2でキャッシュDNSサーバ構築</h2>

<p>家庭内インターネット接続環境からインターネットに接続するためにキャッシュDNSサーバとプロキシサーバを構築します。
まずはキャッシュDNSサーバを構築していきます。</p>

<h3 id="bind9の設定:a3b948e685fd47b3236875750b0610c7">bind9の設定</h3>

<p>bind9のインストール</p>

<pre><code>$ sudo apt-get install bind9 dnsutils
パッケージリストを読み込んでいます... 完了
依存関係ツリーを作成しています                
状態情報を読み取っています... 完了
以下の追加パッケージがインストールされます:
  bind9utils
提案パッケージ:
  bind9-doc ufw rblcheck
以下のパッケージが新たにインストールされます:
  bind9 bind9utils dnsutils
アップグレード: 0 個、新規インストール: 3 個、削除: 0 個、保留: 1 個。
562 kB のアーカイブを取得する必要があります。
この操作後に追加で 1,620 kB のディスク容量が消費されます。
続行しますか? [Y/n] y
取得:1 http://mirrordirector.raspbian.org/raspbian/ jessie/main dnsutils armhf 1:9.9.5.dfsg-9+deb8u8 [113 kB]
取得:2 http://mirrordirector.raspbian.org/raspbian/ jessie/main bind9utils armhf 1:9.9.5.dfsg-9+deb8u8 [157 kB]
取得:3 http://mirrordirector.raspbian.org/raspbian/ jessie/main bind9 armhf 1:9.9.5.dfsg-9+deb8u8 [292 kB]
562 kB を 2秒 で取得しました (229 kB/s)
パッケージを事前設定しています ...
以前に未選択のパッケージ dnsutils を選択しています。
(データベースを読み込んでいます ... 現在 31244 個のファイルとディレクトリがインストールされています。)
.../dnsutils_1%3a9.9.5.dfsg-9+deb8u8_armhf.deb を展開する準備をしています ...
dnsutils (1:9.9.5.dfsg-9+deb8u8) を展開しています...
以前に未選択のパッケージ bind9utils を選択しています。
.../bind9utils_1%3a9.9.5.dfsg-9+deb8u8_armhf.deb を展開する準備をしています ...
bind9utils (1:9.9.5.dfsg-9+deb8u8) を展開しています...
以前に未選択のパッケージ bind9 を選択しています。
.../bind9_1%3a9.9.5.dfsg-9+deb8u8_armhf.deb を展開する準備をしています ...
bind9 (1:9.9.5.dfsg-9+deb8u8) を展開しています...
man-db (2.7.0.2-5) のトリガを処理しています ...
systemd (215-17+deb8u5) のトリガを処理しています ...
dnsutils (1:9.9.5.dfsg-9+deb8u8) を設定しています ...
bind9utils (1:9.9.5.dfsg-9+deb8u8) を設定しています ...
bind9 (1:9.9.5.dfsg-9+deb8u8) を設定しています ...
グループ `bind' (グループ ID 114) を追加しています...
完了。
システムユーザ `bind' (UID 109) を追加しています...
新しいユーザ `bind' (UID 109) をグループ `bind' に追加しています...
ホームディレクトリ `/var/cache/bind' は作成しません。
wrote key file &quot;/etc/bind/rndc.key&quot;
#
systemd (215-17+deb8u5) のトリガを処理しています ...
$
</code></pre>

<p>bind9の設定</p>

<p>※変更箇所が多いため、変更箇所ではなく変更後のコンフィグを記載します。</p>

<pre><code>$ sudo cp -p /etc/bind/named.conf.options{,.org}
$ ls -l /etc/bind/named.conf.options*
-rw-r--r-- 1 root bind 890  1月  3 22:26 /etc/bind/named.conf.options
-rw-r--r-- 1 root bind 890  1月  3 22:26 /etc/bind/named.conf.options.org
$
$ sudo vi /etc/bind/named.conf.options
controls {
	inet 127.0.0.1 allow { localhost; } keys { rndc-key; };
};
include &quot;/etc/bind/rndc.key&quot;;

acl &quot;internal-network&quot; {
	localhost;
	127.0.0.1/32;
	192.168.10.0/24;
	192.168.20.0/24;
	192.168.30.0/24;
	192.168.40.0/24;
};

options {
	version &quot;unknown&quot;;

	directory &quot;/var/cache/bind&quot;;

	listen-on {
		internal-network;
	};

	querylog yes;
	allow-query {
		internal-network;
	};

	recursion yes;
	allow-recursion {
		internal-network;
	};

	forwarders {
		192.168.100.1;
	};

	notify no;

	max-ncache-ttl	300;
	max-cache-ttl	3600;
	recursive-clients	300;
	cleaning-interval	60;
	lame-ttl	600;
	max-cache-size	256m;

	allow-transfer {
		none;
	};

	allow-update {
		none;
	};
};

logging {
	channel &quot;log_default&quot; {
		file &quot;/var/log/bind/named.log&quot; versions 5 size 5m;
		print-time yes;
		severity info;
		print-category yes;
	};
	channel &quot;alert&quot; {
		file &quot;/var/log/bind/alert.log&quot; versions 8 size 4m;
		severity info;
		print-time yes;
		print-severity yes;
		print-category yes;
	};
	channel &quot;query&quot; {
		file &quot;/var/log/bind/query.log&quot; versions 8 size 50m;
		severity debug;
		print-time yes;
		print-severity yes;
		print-category yes;
	};

	category default { &quot;log_default&quot;; };
	category security { &quot;alert&quot;; };
	category queries { &quot;query&quot;; };
	category lame-servers { null; };
};
$
</code></pre>

<p>bind9のコンフィグ不備を確認</p>

<pre><code>$ sudo named-checkconf /etc/bind/named.conf
</code></pre>

<p>ログ保存先のディレクトリ作成</p>

<pre><code>$ sudo mkdir -p /var/log/bind
$ sudo chown bind:bind /var/log/bind
$ ls -ld /var/log/bind
drwxr-xr-x 2 bind bind 4096  1月  3 22:39 /var/log/bind
$
</code></pre>

<p>bind9の起動</p>

<pre><code>$ sudo systemctl restart bind9
$ sudo systemctl enable bind9
Synchronizing state for bind9.service with sysvinit using update-rc.d...
Executing /usr/sbin/update-rc.d bind9 defaults
Executing /usr/sbin/update-rc.d bind9 enable
$
</code></pre>

<p>dnsクライアントの設定</p>

<pre><code>$ sudo cp -p /etc/dhcpcd.conf{,.backup20160103}
$ ls -l /etc/dhcpcd.conf*
-rw-rw-r-- 1 root netdev 1553  9月 23 13:24 /etc/dhcpcd.conf
-rw-rw-r-- 1 root netdev 1553  9月 23 13:24 /etc/dhcpcd.conf.backup20160103
-rw-rw-r-- 1 root netdev 1247 10月 17  2015 /etc/dhcpcd.conf.org
$
$ sudo vi /etc/dhcpcd.conf
static domain_name_servers=127.0.0.1
$
$ diff /etc/dhcpcd.conf.backup20160103 /etc/dhcpcd.conf
46c46
&lt; static domain_name_servers=192.168.100.1
---
&gt; static domain_name_servers=127.0.0.1
$
$ sudo systemctl restart dhcpcd
$ cat /etc/resolv.conf 
# Generated by resolvconf
nameserver 127.0.0.1
$
</code></pre>

<p>bind9による名前解決の確認</p>

<pre><code>$ dig www.google.co.jp

; &lt;&lt;&gt;&gt; DiG 9.9.5-9+deb8u8-Raspbian &lt;&lt;&gt;&gt; www.google.co.jp
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 455
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
;www.google.co.jp.		IN	A

;; ANSWER SECTION:
www.google.co.jp.	187	IN	A	172.217.26.99

;; Query time: 70 msec
;; SERVER: 127.0.0.1#53(127.0.0.1)
;; WHEN: Tue Jan 03 22:55:14 JST 2017
;; MSG SIZE  rcvd: 61

$ dig -x 8.8.8.8

; &lt;&lt;&gt;&gt; DiG 9.9.5-9+deb8u8-Raspbian &lt;&lt;&gt;&gt; -x 8.8.8.8
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 3656
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 13, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
;8.8.8.8.in-addr.arpa.		IN	PTR

;; ANSWER SECTION:
8.8.8.8.in-addr.arpa.	3600	IN	PTR	google-public-dns-a.google.com.

;; AUTHORITY SECTION:
.			3449	IN	NS	h.root-servers.net.
.			3449	IN	NS	m.root-servers.net.
.			3449	IN	NS	c.root-servers.net.
.			3449	IN	NS	l.root-servers.net.
.			3449	IN	NS	b.root-servers.net.
.			3449	IN	NS	f.root-servers.net.
.			3449	IN	NS	g.root-servers.net.
.			3449	IN	NS	k.root-servers.net.
.			3449	IN	NS	e.root-servers.net.
.			3449	IN	NS	d.root-servers.net.
.			3449	IN	NS	a.root-servers.net.
.			3449	IN	NS	j.root-servers.net.
.			3449	IN	NS	i.root-servers.net.

;; Query time: 70 msec
;; SERVER: 127.0.0.1#53(127.0.0.1)
;; WHEN: Tue Jan 03 22:57:45 JST 2017
;; MSG SIZE  rcvd: 304

$
</code></pre>

<p>以上</p>

                </div>
              </article>
              
              <article>
                <div class="title">
                  <h1><a href="http://www.shinayoshi.net/post/2017/01/02/setting-fileserver/">家庭内インターネット接続環境を構築する その4</a></h1>
                  <p>
                    <span class="label label-primary">Mon Jan 2, 2017</span> in
                    
                    
                    <a href="http://www.shinayoshi.net//categories/server">server</a>
                     using tags
                    
                    
                    <a href="http://www.shinayoshi.net//tags/raspberrypi">raspberrypi</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/home-network">home-network</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homenas1">homenas1</a>
                    
                  </p>
                </div>
                <div class="contents">
                  

<p>FortiGate 60DとRaspberry Piを使用して家庭内インターネット接続環境を構築します。
最終的には以下のような構成を想定しています。</p>

<p><img src="/img/20161022_01/home-network.png" alt="home network" width="640px" /></p>

<p>前回に引き続き<code>homenas1</code>を構築していきます。</p>

<h2 id="raspberry-pi-2でファイルサーバ構築-nfs-samba:7daa4bd7d9cd8ea181b8fb40ded40309">Raspberry Pi 2でファイルサーバ構築(NFS/Samba)</h2>

<p>前回はUSB Storageを使用してRAIDデバイスを設定しました。
今回はNFSやSambaの設定を行っていきます。</p>

<h2 id="nfsの設定:7daa4bd7d9cd8ea181b8fb40ded40309">NFSの設定</h2>

<p>NFSのインストール</p>

<pre><code>$ sudo apt-get install nfs-kernel-server
パッケージリストを読み込んでいます... 完了
依存関係ツリーを作成しています                
状態情報を読み取っています... 完了
以下のパッケージが新たにインストールされます:
  nfs-kernel-server
アップグレード: 0 個、新規インストール: 1 個、削除: 0 個、保留: 1 個。
101 kB のアーカイブを取得する必要があります。
この操作後に追加で 373 kB のディスク容量が消費されます。
取得:1 http://mirrordirector.raspbian.org/raspbian/ jessie/main nfs-kernel-server armhf 1:1.2.8-9 [101 kB]
101 kB を 1秒 で取得しました (66.7 kB/s)  
以前に未選択のパッケージ nfs-kernel-server を選択しています。
(データベースを読み込んでいます ... 現在 31534 個のファイルとディレクトリがインストールされています。)
.../nfs-kernel-server_1%3a1.2.8-9_armhf.deb を展開する準備をしています ...
nfs-kernel-server (1:1.2.8-9) を展開しています...
systemd (215-17+deb8u5) のトリガを処理しています ...
man-db (2.7.0.2-5) のトリガを処理しています ...
nfs-kernel-server (1:1.2.8-9) を設定しています ...

Creating config file /etc/exports with new version

Creating config file /etc/default/nfs-kernel-server with new version
systemd (215-17+deb8u5) のトリガを処理しています ...
$
</code></pre>

<p>NFSの設定</p>

<pre><code>$ sudo cp -p /etc/exports{,.org}
$ ls -l /etc/exports*
-rw-r--r-- 1 root root 389  8月 13  2014 /etc/exports
-rw-r--r-- 1 root root 389  8月 13  2014 /etc/exports.org
$
$ sudo vi /etc/exports
/mnt/rpibackup	172.31.10.0/24(rw,sync,insecure,all_squash,no_subtree_check)
/mnt/syslog	172.31.10.0/24(rw,sync,insecure,all_squash,no_subtree_check)
$
$ diff /etc/exports.org /etc/exports
10a11,12
&gt; /mnt/rpibackup	172.31.10.0/24(rw,sync,insecure,all_squash,no_subtree_check)
&gt; /mnt/syslog	172.31.10.0/24(rw,sync,insecure,all_squash,no_subtree_check)
</code></pre>

<dl>
    <dt>rw</dt>
    <dd>ファイルシステムに対して変更(読み込み/書き込み)ができるようにする</dd>
    <dt>sync</dt>
    <dd>ディスクへの書き込みを同期する</dd>
    <dt>insecure</dt>
    <dd>クライアントからのアクセスに使用するポートを制限しない</dd>
    <dt>all_squash</dt>
    <dd>すべてのuidとgidをanonymousにマッピングする</dd>
    <dt>no_subtree_check</dt>
    <dd>サブツリーのチェックを無効にする</dd>
</dl>

<p>NFSの起動</p>

<pre><code>$ sudo systemctl start rpcbind
$ sudo systemctl enable rpcbind
Synchronizing state for rpcbind.service with sysvinit using update-rc.d...
Executing /usr/sbin/update-rc.d rpcbind defaults
insserv: warning: current start runlevel(s) (empty) of script `rpcbind' overrides LSB defaults (S).
insserv: warning: current stop runlevel(s) (0 1 6 S) of script `rpcbind' overrides LSB defaults (0 1 6).
Executing /usr/sbin/update-rc.d rpcbind enable
$
$ sudo systemctl restart nfs-kernel-server
$ sudo systemctl enable nfs-kernel-server
Synchronizing state for nfs-kernel-server.service with sysvinit using update-rc.d...
Executing /usr/sbin/update-rc.d nfs-kernel-server defaults
Executing /usr/sbin/update-rc.d nfs-kernel-server enable
$
$ sudo showmount -e
Export list for homenas1:
/mnt/syslog    172.31.10.0/24
/mnt/rpibackup 172.31.10.0/24
$
$ sudo exportfs -v
/mnt/rpibackup	172.31.10.0/24(rw,wdelay,insecure,root_squash,all_squash,no_subtree_check,sec=sys,rw,root_squash,all_squash)
/mnt/syslog   	172.31.10.0/24(rw,wdelay,insecure,root_squash,all_squash,no_subtree_check,sec=sys,rw,root_squash,all_squash)
$
</code></pre>

<p>NFSクライアント側の設定</p>

<pre><code>$ sudo apt-get install -y nfs-client
パッケージリストを読み込んでいます... 完了
依存関係ツリーを作成しています                
状態情報を読み取っています... 完了
Note, selecting 'nfs-common' instead of 'nfs-client'
nfs-common はすでに最新版です。
アップグレード: 0 個、新規インストール: 0 個、削除: 0 個、保留: 1 個。
$
$ sudo mkdir /mnt/rpibackup
$ sudo mkdir /mnt/syslog
$
$ sudo cp -p /etc/fstab{,.org}
$ ls -l /etc/fstab*
-rw-r--r-- 1 root root 302  9月 23 12:53 /etc/fstab
-rw-r--r-- 1 root root 302  9月 23 12:53 /etc/fstab.org
$
$ sudo vi /etc/fstab
172.31.10.110:/mnt/rpibackup	/mnt/rpibackup	nfs	defaults,nofail	0	0
172.31.10.110:/mnt/syslog	/mnt/syslog	nfs	defaults,nofail	0	0
$
$ sudo mount -a
$ df -h
ファイルシス                 サイズ  使用  残り 使用% マウント位置
/dev/root                       29G  963M   27G    4% /
devtmpfs                       459M     0  459M    0% /dev
tmpfs                          463M     0  463M    0% /dev/shm
tmpfs                          463M  6.2M  457M    2% /run
tmpfs                          5.0M  4.0K  5.0M    1% /run/lock
tmpfs                          463M     0  463M    0% /sys/fs/cgroup
/dev/mmcblk0p1                  63M   21M   43M   34% /boot
172.31.10.110:/mnt/rpibackup   325G   67M  308G    1% /mnt/rpibackup
172.31.10.110:/mnt/syslog      197G   60M  187G    1% /mnt/syslog
$
</code></pre>

<h2 id="sambaの設定:7daa4bd7d9cd8ea181b8fb40ded40309">Sambaの設定</h2>

<p>Sambaのインストール</p>

<pre><code>$ sudo apt-get install samba
パッケージリストを読み込んでいます... 完了
依存関係ツリーを作成しています                
状態情報を読み取っています... 完了
以下の追加パッケージがインストールされます:
  attr libaio1 libasn1-8-heimdal libavahi-client3 libcups2
  libfile-copy-recursive-perl libhcrypto4-heimdal libhdb9-heimdal
  libheimbase1-heimdal libhx509-5-heimdal libkrb5-26-heimdal libldb1 libntdb1
  libroken18-heimdal libtdb1 libtevent0 libwind0-heimdal python-crypto
  python-dnspython python-ldb python-ntdb python-samba python-talloc
  python-tdb samba-common-bin samba-dsdb-modules samba-libs samba-vfs-modules
  tdb-tools update-inetd
提案パッケージ:
  cups-common python-crypto-dbg python-crypto-doc bind9 bind9utils ctdb
  ldb-tools smbldap-tools winbind heimdal-clients
以下のパッケージが新たにインストールされます:
  attr libaio1 libasn1-8-heimdal libavahi-client3 libcups2
  libfile-copy-recursive-perl libhcrypto4-heimdal libhdb9-heimdal
  libheimbase1-heimdal libhx509-5-heimdal libkrb5-26-heimdal libldb1 libntdb1
  libroken18-heimdal libtdb1 libtevent0 libwind0-heimdal python-crypto
  python-dnspython python-ldb python-ntdb python-samba python-talloc
  python-tdb samba samba-common-bin samba-dsdb-modules samba-libs
  samba-vfs-modules tdb-tools update-inetd
アップグレード: 0 個、新規インストール: 31 個、削除: 0 個、保留: 1 個。
8,999 kB のアーカイブを取得する必要があります。
この操作後に追加で 44.6 MB のディスク容量が消費されます。
続行しますか? [Y/n] y
取得:1 http://mirrordirector.raspbian.org/raspbian/ jessie/main libaio1 armhf 0.3.110-1 [9,228 B]
取得:2 http://mirrordirector.raspbian.org/raspbian/ jessie/main libroken18-heimdal armhf 1.6~rc2+dfsg-9+rpi1 [56.6 kB]
取得:3 http://mirrordirector.raspbian.org/raspbian/ jessie/main libasn1-8-heimdal armhf 1.6~rc2+dfsg-9+rpi1 [161 kB]
取得:4 http://mirrordirector.raspbian.org/raspbian/ jessie/main libavahi-client3 armhf 0.6.31-5 [50.6 kB]
取得:5 http://mirrordirector.raspbian.org/raspbian/ jessie/main libcups2 armhf 1.7.5-11+deb8u1 [253 kB]
取得:6 http://mirrordirector.raspbian.org/raspbian/ jessie/main libhcrypto4-heimdal armhf 1.6~rc2+dfsg-9+rpi1 [98.3 kB]
取得:7 http://mirrordirector.raspbian.org/raspbian/ jessie/main libheimbase1-heimdal armhf 1.6~rc2+dfsg-9+rpi1 [46.4 kB]
取得:8 http://mirrordirector.raspbian.org/raspbian/ jessie/main libwind0-heimdal armhf 1.6~rc2+dfsg-9+rpi1 [71.0 kB]
取得:9 http://mirrordirector.raspbian.org/raspbian/ jessie/main libhx509-5-heimdal armhf 1.6~rc2+dfsg-9+rpi1 [111 kB]
取得:10 http://mirrordirector.raspbian.org/raspbian/ jessie/main libkrb5-26-heimdal armhf 1.6~rc2+dfsg-9+rpi1 [188 kB]
取得:11 http://mirrordirector.raspbian.org/raspbian/ jessie/main libhdb9-heimdal armhf 1.6~rc2+dfsg-9+rpi1 [73.6 kB]
取得:12 http://mirrordirector.raspbian.org/raspbian/ jessie/main libtdb1 armhf 1.3.6-0+deb8u1 [37.1 kB]
取得:13 http://mirrordirector.raspbian.org/raspbian/ jessie/main libtevent0 armhf 0.9.28-0+deb8u1 [23.5 kB]
取得:14 http://mirrordirector.raspbian.org/raspbian/ jessie/main libldb1 armhf 2:1.1.20-0+deb8u1 [90.9 kB]
取得:15 http://mirrordirector.raspbian.org/raspbian/ jessie/main libntdb1 armhf 1.0-5 [37.8 kB]
取得:16 http://mirrordirector.raspbian.org/raspbian/ jessie/main python-ldb armhf 2:1.1.20-0+deb8u1 [26.0 kB]
取得:17 http://mirrordirector.raspbian.org/raspbian/ jessie/main python-talloc armhf 2.1.2-0+deb8u1 [9,912 B]
取得:18 http://mirrordirector.raspbian.org/raspbian/ jessie/main python-dnspython all 1.12.0-1 [101 kB]
取得:19 http://mirrordirector.raspbian.org/raspbian/ jessie/main python-ntdb armhf 1.0-5 [8,372 B]
取得:20 http://mirrordirector.raspbian.org/raspbian/ jessie/main python-tdb armhf 1.3.6-0+deb8u1 [14.0 kB]
取得:21 http://mirrordirector.raspbian.org/raspbian/ jessie/main python-crypto armhf 2.6.1-5 [248 kB]
取得:22 http://mirrordirector.raspbian.org/raspbian/ jessie/main samba-libs armhf 2:4.2.14+dfsg-0+deb8u2 [4,244 kB]
取得:23 http://mirrordirector.raspbian.org/raspbian/ jessie/main python-samba armhf 2:4.2.14+dfsg-0+deb8u2 [850 kB]
取得:24 http://mirrordirector.raspbian.org/raspbian/ jessie/main samba-common-bin armhf 2:4.2.14+dfsg-0+deb8u2 [562 kB]
取得:25 http://mirrordirector.raspbian.org/raspbian/ jessie/main samba-dsdb-modules armhf 2:4.2.14+dfsg-0+deb8u2 [276 kB]
取得:26 http://mirrordirector.raspbian.org/raspbian/ jessie/main tdb-tools armhf 1.3.6-0+deb8u1 [25.5 kB]
取得:27 http://mirrordirector.raspbian.org/raspbian/ jessie/main libfile-copy-recursive-perl all 0.38-1 [20.6 kB]
取得:28 http://mirrordirector.raspbian.org/raspbian/ jessie/main update-inetd all 4.43 [21.8 kB]
取得:29 http://mirrordirector.raspbian.org/raspbian/ jessie/main samba armhf 2:4.2.14+dfsg-0+deb8u2 [939 kB]
取得:30 http://mirrordirector.raspbian.org/raspbian/ jessie/main attr armhf 1:2.4.47-2 [41.3 kB]
取得:31 http://mirrordirector.raspbian.org/raspbian/ jessie/main samba-vfs-modules armhf 2:4.2.14+dfsg-0+deb8u2 [303 kB]
8,999 kB を 1分 8秒 で取得しました (131 kB/s)                                  
パッケージからテンプレートを展開しています: 100%
パッケージを事前設定しています ...
以前に未選択のパッケージ libaio1:armhf を選択しています。
(データベースを読み込んでいます ... 現在 31562 個のファイルとディレクトリがインストールされています。)
.../libaio1_0.3.110-1_armhf.deb を展開する準備をしています ...
libaio1:armhf (0.3.110-1) を展開しています...
以前に未選択のパッケージ libroken18-heimdal:armhf を選択しています。
.../libroken18-heimdal_1.6~rc2+dfsg-9+rpi1_armhf.deb を展開する準備をしています ...
libroken18-heimdal:armhf (1.6~rc2+dfsg-9+rpi1) を展開しています...
以前に未選択のパッケージ libasn1-8-heimdal:armhf を選択しています。
.../libasn1-8-heimdal_1.6~rc2+dfsg-9+rpi1_armhf.deb を展開する準備をしています ...
libasn1-8-heimdal:armhf (1.6~rc2+dfsg-9+rpi1) を展開しています...
以前に未選択のパッケージ libavahi-client3:armhf を選択しています。
.../libavahi-client3_0.6.31-5_armhf.deb を展開する準備をしています ...
libavahi-client3:armhf (0.6.31-5) を展開しています...
以前に未選択のパッケージ libcups2:armhf を選択しています。
.../libcups2_1.7.5-11+deb8u1_armhf.deb を展開する準備をしています ...
libcups2:armhf (1.7.5-11+deb8u1) を展開しています...
以前に未選択のパッケージ libhcrypto4-heimdal:armhf を選択しています。
.../libhcrypto4-heimdal_1.6~rc2+dfsg-9+rpi1_armhf.deb を展開する準備をしています ...
libhcrypto4-heimdal:armhf (1.6~rc2+dfsg-9+rpi1) を展開しています...
以前に未選択のパッケージ libheimbase1-heimdal:armhf を選択しています。
.../libheimbase1-heimdal_1.6~rc2+dfsg-9+rpi1_armhf.deb を展開する準備をしています ...
libheimbase1-heimdal:armhf (1.6~rc2+dfsg-9+rpi1) を展開しています...
以前に未選択のパッケージ libwind0-heimdal:armhf を選択しています。
.../libwind0-heimdal_1.6~rc2+dfsg-9+rpi1_armhf.deb を展開する準備をしています ...
libwind0-heimdal:armhf (1.6~rc2+dfsg-9+rpi1) を展開しています...
以前に未選択のパッケージ libhx509-5-heimdal:armhf を選択しています。
.../libhx509-5-heimdal_1.6~rc2+dfsg-9+rpi1_armhf.deb を展開する準備をしています ...
libhx509-5-heimdal:armhf (1.6~rc2+dfsg-9+rpi1) を展開しています...
以前に未選択のパッケージ libkrb5-26-heimdal:armhf を選択しています。
.../libkrb5-26-heimdal_1.6~rc2+dfsg-9+rpi1_armhf.deb を展開する準備をしています ...
libkrb5-26-heimdal:armhf (1.6~rc2+dfsg-9+rpi1) を展開しています...
以前に未選択のパッケージ libhdb9-heimdal:armhf を選択しています。
.../libhdb9-heimdal_1.6~rc2+dfsg-9+rpi1_armhf.deb を展開する準備をしています ...
libhdb9-heimdal:armhf (1.6~rc2+dfsg-9+rpi1) を展開しています...
以前に未選択のパッケージ libtdb1:armhf を選択しています。
.../libtdb1_1.3.6-0+deb8u1_armhf.deb を展開する準備をしています ...
libtdb1:armhf (1.3.6-0+deb8u1) を展開しています...
以前に未選択のパッケージ libtevent0:armhf を選択しています。
.../libtevent0_0.9.28-0+deb8u1_armhf.deb を展開する準備をしています ...
libtevent0:armhf (0.9.28-0+deb8u1) を展開しています...
以前に未選択のパッケージ libldb1:armhf を選択しています。
.../libldb1_2%3a1.1.20-0+deb8u1_armhf.deb を展開する準備をしています ...
libldb1:armhf (2:1.1.20-0+deb8u1) を展開しています...
以前に未選択のパッケージ libntdb1:armhf を選択しています。
.../libntdb1_1.0-5_armhf.deb を展開する準備をしています ...
libntdb1:armhf (1.0-5) を展開しています...
以前に未選択のパッケージ python-ldb を選択しています。
.../python-ldb_2%3a1.1.20-0+deb8u1_armhf.deb を展開する準備をしています ...
python-ldb (2:1.1.20-0+deb8u1) を展開しています...
以前に未選択のパッケージ python-talloc を選択しています。
.../python-talloc_2.1.2-0+deb8u1_armhf.deb を展開する準備をしています ...
python-talloc (2.1.2-0+deb8u1) を展開しています...
以前に未選択のパッケージ python-dnspython を選択しています。
.../python-dnspython_1.12.0-1_all.deb を展開する準備をしています ...
python-dnspython (1.12.0-1) を展開しています...
以前に未選択のパッケージ python-ntdb を選択しています。
.../python-ntdb_1.0-5_armhf.deb を展開する準備をしています ...
python-ntdb (1.0-5) を展開しています...
以前に未選択のパッケージ python-tdb を選択しています。
.../python-tdb_1.3.6-0+deb8u1_armhf.deb を展開する準備をしています ...
python-tdb (1.3.6-0+deb8u1) を展開しています...
以前に未選択のパッケージ python-crypto を選択しています。
.../python-crypto_2.6.1-5_armhf.deb を展開する準備をしています ...
python-crypto (2.6.1-5) を展開しています...
以前に未選択のパッケージ samba-libs:armhf を選択しています。
.../samba-libs_2%3a4.2.14+dfsg-0+deb8u2_armhf.deb を展開する準備をしています ...
samba-libs:armhf (2:4.2.14+dfsg-0+deb8u2) を展開しています...
以前に未選択のパッケージ python-samba を選択しています。
.../python-samba_2%3a4.2.14+dfsg-0+deb8u2_armhf.deb を展開する準備をしています ...
python-samba (2:4.2.14+dfsg-0+deb8u2) を展開しています...
以前に未選択のパッケージ samba-common-bin を選択しています。
.../samba-common-bin_2%3a4.2.14+dfsg-0+deb8u2_armhf.deb を展開する準備をしています ...
samba-common-bin (2:4.2.14+dfsg-0+deb8u2) を展開しています...
以前に未選択のパッケージ samba-dsdb-modules を選択しています。
.../samba-dsdb-modules_2%3a4.2.14+dfsg-0+deb8u2_armhf.deb を展開する準備をしています ...
samba-dsdb-modules (2:4.2.14+dfsg-0+deb8u2) を展開しています...
以前に未選択のパッケージ tdb-tools を選択しています。
.../tdb-tools_1.3.6-0+deb8u1_armhf.deb を展開する準備をしています ...
tdb-tools (1.3.6-0+deb8u1) を展開しています...
以前に未選択のパッケージ libfile-copy-recursive-perl を選択しています。
.../libfile-copy-recursive-perl_0.38-1_all.deb を展開する準備をしています ...
libfile-copy-recursive-perl (0.38-1) を展開しています...
以前に未選択のパッケージ update-inetd を選択しています。
.../update-inetd_4.43_all.deb を展開する準備をしています ...
update-inetd (4.43) を展開しています...
以前に未選択のパッケージ samba を選択しています。
.../samba_2%3a4.2.14+dfsg-0+deb8u2_armhf.deb を展開する準備をしています ...
samba (2:4.2.14+dfsg-0+deb8u2) を展開しています...
以前に未選択のパッケージ attr を選択しています。
.../attr_1%3a2.4.47-2_armhf.deb を展開する準備をしています ...
attr (1:2.4.47-2) を展開しています...
以前に未選択のパッケージ samba-vfs-modules を選択しています。
.../samba-vfs-modules_2%3a4.2.14+dfsg-0+deb8u2_armhf.deb を展開する準備をしています ...
samba-vfs-modules (2:4.2.14+dfsg-0+deb8u2) を展開しています...
man-db (2.7.0.2-5) のトリガを処理しています ...
systemd (215-17+deb8u5) のトリガを処理しています ...
libaio1:armhf (0.3.110-1) を設定しています ...
libroken18-heimdal:armhf (1.6~rc2+dfsg-9+rpi1) を設定しています ...
libasn1-8-heimdal:armhf (1.6~rc2+dfsg-9+rpi1) を設定しています ...
libavahi-client3:armhf (0.6.31-5) を設定しています ...
libcups2:armhf (1.7.5-11+deb8u1) を設定しています ...
libhcrypto4-heimdal:armhf (1.6~rc2+dfsg-9+rpi1) を設定しています ...
libheimbase1-heimdal:armhf (1.6~rc2+dfsg-9+rpi1) を設定しています ...
libwind0-heimdal:armhf (1.6~rc2+dfsg-9+rpi1) を設定しています ...
libhx509-5-heimdal:armhf (1.6~rc2+dfsg-9+rpi1) を設定しています ...
libkrb5-26-heimdal:armhf (1.6~rc2+dfsg-9+rpi1) を設定しています ...
libhdb9-heimdal:armhf (1.6~rc2+dfsg-9+rpi1) を設定しています ...
libtdb1:armhf (1.3.6-0+deb8u1) を設定しています ...
libtevent0:armhf (0.9.28-0+deb8u1) を設定しています ...
libldb1:armhf (2:1.1.20-0+deb8u1) を設定しています ...
libntdb1:armhf (1.0-5) を設定しています ...
python-ldb (2:1.1.20-0+deb8u1) を設定しています ...
python-talloc (2.1.2-0+deb8u1) を設定しています ...
python-dnspython (1.12.0-1) を設定しています ...
python-ntdb (1.0-5) を設定しています ...
python-tdb (1.3.6-0+deb8u1) を設定しています ...
python-crypto (2.6.1-5) を設定しています ...
samba-libs:armhf (2:4.2.14+dfsg-0+deb8u2) を設定しています ...
python-samba (2:4.2.14+dfsg-0+deb8u2) を設定しています ...
samba-common-bin (2:4.2.14+dfsg-0+deb8u2) を設定しています ...
samba-dsdb-modules (2:4.2.14+dfsg-0+deb8u2) を設定しています ...
tdb-tools (1.3.6-0+deb8u1) を設定しています ...
update-alternatives: /usr/bin/tdbbackup (tdbbackup) を提供するために自動モードで /usr/bin/tdbbackup.tdbtools を使います
libfile-copy-recursive-perl (0.38-1) を設定しています ...
update-inetd (4.43) を設定しています ...
samba (2:4.2.14+dfsg-0+deb8u2) を設定しています ...
グループ `sambashare' (グループ ID 115) を追加しています...
完了。
attr (1:2.4.47-2) を設定しています ...
samba-vfs-modules (2:4.2.14+dfsg-0+deb8u2) を設定しています ...
libc-bin (2.19-18+deb8u6) のトリガを処理しています ...
systemd (215-17+deb8u5) のトリガを処理しています ...
$
</code></pre>

<p>Sambaの設定(後日見直し要素)</p>

<pre><code>$ sudo cp -p /etc/samba/smb.conf{,.org}
$ ls -l /etc/samba/smb.conf*
-rw-r--r-- 1 root root 9231 12月 31 18:33 /etc/samba/smb.conf
-rw-r--r-- 1 root root 9231 12月 31 18:33 /etc/samba/smb.conf.org
$
$ sudo vi /etc/samba/smb.conf
[global]
   dos charset = CP932
   unix charset = UTF-8
   unix extensions = no

   load printers = no
   printing = bsd
   printcap name = /dev/null

;   interfaces = 127.0.0.0/8 eth0
   interfaces = 127.0.0.0/8 192.168.40.0/24 eth0
   hosts allow = 192.168.40.0/24

;   map to guest = bad user
   map to guest = never

;   usershare allow guests = yes
   usershare allow guests = no

;[homes]
;   comment = Home Directories
;   browseable = no

;   read only = yes

;   create mask = 0700

;   directory mask = 0700

;   valid users = %S

;[printers]
;   comment = All Printers
;   browseable = no
;   path = /var/spool/samba
;   printable = yes
;   guest ok = no
;   read only = yes
;   create mask = 0700

;[print$]
;   comment = Printer Drivers
;   path = /var/lib/samba/printers
;   browseable = yes
;   read only = yes
;   guest ok = no

[share]
   path = /mnt/nas
   writable = yes
   valid users = @sambashare
   force user = root
   force group = adm
   create mask = 0664
   directory mask = 0775
</code></pre>

<p>Sambaを起動する</p>

<pre><code>$ testparm /etc/samba/smb.conf
Load smb config files from /etc/samba/smb.conf
Processing section &quot;[share]&quot;
Loaded services file OK.
Server role: ROLE_STANDALONE

Press enter to see a dump of your service definitions

# Global parameters
[global]
	dos charset = CP932
	interfaces = 127.0.0.0/8 192.168.40.0/24 eth0
	server role = standalone server
	obey pam restrictions = Yes
	pam password change = Yes
	passwd program = /usr/bin/passwd %u
	passwd chat = *Enter\snew\s*\spassword:* %n\n *Retype\snew\s*\spassword:* %n\n *password\supdated\ssuccessfully* .
	unix password sync = Yes
	syslog = 0
	log file = /var/log/samba/log.%m
	max log size = 1000
	unix extensions = No
	load printers = No
	printcap name = /dev/null
	dns proxy = No
	panic action = /usr/share/samba/panic-action %d
	idmap config * : backend = tdb
	hosts allow = 192.168.40.0/24
	printing = bsd


[share]
	path = /mnt/nas
	valid users = @sambashare
	force user = root
	force group = adm
	read only = No
	create mask = 0664
	directory mask = 0775
$
$ sudo systemctl restart smbd
$ sudo systemctl restart nmbd
$
$ sudo systemctl enable smbd
Synchronizing state for smbd.service with sysvinit using update-rc.d...
Executing /usr/sbin/update-rc.d smbd defaults
Executing /usr/sbin/update-rc.d smbd enable
$
$ sudo systemctl enable nmbd
Synchronizing state for nmbd.service with sysvinit using update-rc.d...
Executing /usr/sbin/update-rc.d nmbd defaults
Executing /usr/sbin/update-rc.d nmbd enable
$
</code></pre>

<p>Samba接続用のユーザ作成</p>

<pre><code>$ sudo useradd samba -u 1100 -g sambashare -s /bin/false
$ sudo passwd -l samba
passwd: パスワード期限切れ情報を変更しました
$
$ sudo pdbedit -a -u samba
new password:
retype new password:
Unix username:        samba
NT username:          
Account Flags:        [U          ]
User SID:             S-1-5-21-4142804337-213291639-510360124-1000
Primary Group SID:    S-1-5-21-4142804337-213291639-510360124-513
Full Name:            
Home Directory:       \\homenas1\samba
HomeDir Drive:        
Logon Script:         
Profile Path:         \\homenas1\samba\profile
Domain:               HOMENAS1
Account desc:         
Workstations:         
Munged dial:          
Logon time:           0
Logoff time:          never
Kickoff time:         never
Password last set:    月, 02  1月 2017 23:15:52 JST
Password can change:  月, 02  1月 2017 23:15:52 JST
Password must change: never
Last bad password   : 0
Bad password count  : 0
Logon hours         : FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
$
$ sudo pdbedit -Lw
samba:1100:XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX:016FADE2356324CBD21E6685516D4A24:[U          ]:LCT-586A6098:
$
</code></pre>

<p>MacからSambaに接続</p>

<ol>
<li>Finderを開く</li>
<li><code>Command + K</code>を入力する</li>
<li>サーバアドレスに<code>smb://192.168.40.10/share</code>を入力する</li>
<li>ユーザの種類に<code>登録ユーザ</code>を選択、名前に<code>samba</code>、パスワードに<code>sambaユーザのパスワード</code>を入力して接続をクリックする</li>
</ol>

<h2 id="参考url:7daa4bd7d9cd8ea181b8fb40ded40309">参考URL</h2>

<ul>
<li><a href="http://denshikousaku.net/raspberry-pi-file-server-part1-basic-samba">Raspberry Piでファイルサーバ、Part1 Samba基本編 | ものづくりエクスペリメント</a></li>
<li><a href="http://ossfan.net/setup/samba-03.html">Samba 4.2.3をCentOS 7.2にインストールしてファイルサーバとして設定 | OSSでLinuxサーバ構築 | OSS Fan</a></li>
<li><a href="https://www.virment.com/config-sambaserver/">sambaサーバによるファイル共有環境の構築手順</a></li>
</ul>

<p>以上</p>

                </div>
              </article>
              
              <article>
                <div class="title">
                  <h1><a href="http://www.shinayoshi.net/post/2017/01/01/setting-usb-storage/">家庭内インターネット接続環境を構築する その3</a></h1>
                  <p>
                    <span class="label label-primary">Sun Jan 1, 2017</span> in
                    
                    
                    <a href="http://www.shinayoshi.net//categories/server">server</a>
                     using tags
                    
                    
                    <a href="http://www.shinayoshi.net//tags/raspberrypi">raspberrypi</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/home-network">home-network</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/homenas1">homenas1</a>
                    
                  </p>
                </div>
                <div class="contents">
                  

<p>FortiGate 60DとRaspberry Piを使用して家庭内インターネット接続環境を構築します。
最終的には以下のような構成を想定しています。</p>

<p><img src="/img/20161022_01/home-network.png" alt="home network" width="640px" /></p>

<p>今回は<code>homenas1</code>を構築していきます。</p>

<h2 id="raspberry-pi-2でファイルサーバ構築-mdadm:edd1b43dbf3196488adbf69244ff43d1">Raspberry Pi 2でファイルサーバ構築(mdadm)</h2>

<p>家庭内インターネット接続環境で使用するファイルサーバを構築します。
ファイルサーバの利用目的は以下の3つです。</p>

<ol>
<li>LAN内のファイル共有</li>
<li>Raspberry Piバックアップ</li>
<li>Syslog等のログ保管</li>
</ol>

<p>今回はUSB Storageを使用する準備までを行います。
次回はNFSやSambaの設定を行っていきます。</p>

<h2 id="用意したもの:edd1b43dbf3196488adbf69244ff43d1">用意したもの</h2>

<table>
<thead>
<tr>
<th align="left">品名</th>
<th align="right">台数</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left">Raspberry Pi 2</td>
<td align="right">1台</td>
</tr>

<tr>
<td align="left">USB Storage 1TB</td>
<td align="right">3台</td>
</tr>

<tr>
<td align="left">USB Hub</td>
<td align="right">1台</td>
</tr>
</tbody>
</table>

<h2 id="物理構成:edd1b43dbf3196488adbf69244ff43d1">物理構成</h2>

<p>物理構成は以下のような構成を想定しています。</p>

<p><img src="/img/20170101_01/physical_composition.png" alt="physical composition" width="320px" /></p>

<h2 id="設定:edd1b43dbf3196488adbf69244ff43d1">設定</h2>

<h3 id="mdadmのインストール:edd1b43dbf3196488adbf69244ff43d1">mdadmのインストール</h3>

<pre><code>$ sudo apt-get update
$ sudo apt-get upgrade
$ sudo apt-get install mdadm
パッケージリストを読み込んでいます... 完了
依存関係ツリーを作成しています                
状態情報を読み取っています... 完了
以下の追加パッケージがインストールされます:
  bsd-mailx exim4-base exim4-config exim4-daemon-light liblockfile-bin
  liblockfile1
提案パッケージ:
  mail-reader eximon4 exim4-doc-html exim4-doc-info spf-tools-perl swaks
推奨パッケージ:
  mailx default-mta mail-transport-agent
以下のパッケージが新たにインストールされます:
  bsd-mailx exim4-base exim4-config exim4-daemon-light liblockfile-bin
  liblockfile1 mdadm
アップグレード: 0 個、新規インストール: 7 個、削除: 0 個、保留: 1 個。
2,630 kB のアーカイブを取得する必要があります。
この操作後に追加で 4,960 kB のディスク容量が消費されます。
続行しますか? [Y/n] y
取得:1 http://mirrordirector.raspbian.org/raspbian/ jessie/main liblockfile-bin armhf 1.09-6 [18.2 kB]
取得:2 http://mirrordirector.raspbian.org/raspbian/ jessie/main liblockfile1 armhf 1.09-6 [14.7 kB]
取得:3 http://mirrordirector.raspbian.org/raspbian/ jessie/main exim4-config all 4.84.2-2+deb8u2 [503 kB]
取得:4 http://mirrordirector.raspbian.org/raspbian/ jessie/main exim4-base armhf 4.84.2-2+deb8u2 [1,046 kB]
取得:5 http://mirrordirector.raspbian.org/raspbian/ jessie/main exim4-daemon-light armhf 4.84.2-2+deb8u2 [578 kB]
取得:6 http://mirrordirector.raspbian.org/raspbian/ jessie/main bsd-mailx armhf 8.1.2-0.20141216cvs-2 [74.3 kB]
取得:7 http://mirrordirector.raspbian.org/raspbian/ jessie/main mdadm armhf 3.3.2-5+deb8u1 [397 kB]
2,630 kB を 5秒 で取得しました (467 kB/s)
パッケージを事前設定しています ...
以前に未選択のパッケージ liblockfile-bin を選択しています。
(データベースを読み込んでいます ... 現在 31247 個のファイルとディレクトリがインストールされています。)
.../liblockfile-bin_1.09-6_armhf.deb を展開する準備をしています ...
liblockfile-bin (1.09-6) を展開しています...
以前に未選択のパッケージ liblockfile1:armhf を選択しています。
.../liblockfile1_1.09-6_armhf.deb を展開する準備をしています ...
liblockfile1:armhf (1.09-6) を展開しています...
以前に未選択のパッケージ exim4-config を選択しています。
.../exim4-config_4.84.2-2+deb8u2_all.deb を展開する準備をしています ...
exim4-config (4.84.2-2+deb8u2) を展開しています...
以前に未選択のパッケージ exim4-base を選択しています。
.../exim4-base_4.84.2-2+deb8u2_armhf.deb を展開する準備をしています ...
exim4-base (4.84.2-2+deb8u2) を展開しています...
以前に未選択のパッケージ exim4-daemon-light を選択しています。
.../exim4-daemon-light_4.84.2-2+deb8u2_armhf.deb を展開する準備をしています ...
exim4-daemon-light (4.84.2-2+deb8u2) を展開しています...
以前に未選択のパッケージ bsd-mailx を選択しています。
.../bsd-mailx_8.1.2-0.20141216cvs-2_armhf.deb を展開する準備をしています ...
bsd-mailx (8.1.2-0.20141216cvs-2) を展開しています...
以前に未選択のパッケージ mdadm を選択しています。
.../mdadm_3.3.2-5+deb8u1_armhf.deb を展開する準備をしています ...
mdadm (3.3.2-5+deb8u1) を展開しています...
man-db (2.7.0.2-5) のトリガを処理しています ...
systemd (215-17+deb8u5) のトリガを処理しています ...
liblockfile-bin (1.09-6) を設定しています ...
liblockfile1:armhf (1.09-6) を設定しています ...
exim4-config (4.84.2-2+deb8u2) を設定しています ...
Adding system-user for exim (v4)
exim4-base (4.84.2-2+deb8u2) を設定しています ...
exim: DB upgrade, deleting hints-db
exim4-daemon-light (4.84.2-2+deb8u2) を設定しています ...
bsd-mailx (8.1.2-0.20141216cvs-2) を設定しています ...
update-alternatives: /usr/bin/mailx (mailx) を提供するために自動モードで /usr/bin/bsd-mailx を使います
mdadm (3.3.2-5+deb8u1) を設定しています ...
 ┌────────────────────────┤ mdadm を設定しています ├─────────────────────────┐
 │                                                                           │ 
 │ あなたのシステムのルートファイルシステムが MD アレイ (RAID) 上に配置され  | 
 │ ているならば、ブートシーケンスの初期段階で MD アレイを開始する必要があり  | 
 │ ます。ルートファイルシステムが MD のような論理ボリューム (LVM) 上にある   | 
 │ 場合は、構成しているアレイ全ての開始が必要です。                          | 
 │                                                                           | 
 │ どのアレイがルートファイルシステムの立ち上げに必要かを正確に知っており、  | 
 │ ブートシーケンスの後の時点まで意図しているもの以外全てのアレイ起動を遅ら  | 
 │ せたい場合、ここで最初に起動するアレイを入力してください。そうでない場合  | 
 │ 、'all' と入力して単に全ての利用可能なアレイを最初に立ち上げてください。  | 
 │                                                                           | 
 │ ルートファイルシステムのために、どのアレイも必要ない、あるいはどのアレイ  | 
 │ も起動したくは無いという場合は、空白のままに (あるいは 'none' と入力) し  | 
 │ てください。これは、カーネルで自動的に起動される場合や起動時にはアレイは  | 
 │ 不要であるという場合です。                                                | 
 │                                                                           | 
 │                                  &lt;了解&gt;                                   | 
 │                                                                           │ 
 └───────────────────────────────────────────────────────────────────────────┘ 

 ┌─────────┤ mdadm を設定しています ├─────────┐
 │ ルートファイルシステムに必要な MD アレイ:  │ 
 │                                            │ 
 │ all_______________________________________ │ 
 │                                            │ 
 │                   &lt;了解&gt;                   │ 
 │                                            │ 
 └────────────────────────────────────────────┘ 
Generating mdadm.conf... done.
update-initramfs: deferring update (trigger activated)
update-rc.d: warning: start and stop actions are no longer supported; falling back to defaults
update-rc.d: warning: start and stop actions are no longer supported; falling back to defaults
libc-bin (2.19-18+deb8u6) のトリガを処理しています ...
systemd (215-17+deb8u5) のトリガを処理しています ...
initramfs-tools (0.120+deb8u2) のトリガを処理しています ...

</code></pre>

<h3 id="usbストレージの初期化:edd1b43dbf3196488adbf69244ff43d1">USBストレージの初期化</h3>

<p>1つ目のUSBストレージを接続して、フォーマットを行う。</p>

<pre><code>$ dmesg | grep sd
[ 8792.405426] sd 0:0:0:0: [sda] Spinning up disk...
[ 8792.412833] sd 0:0:0:0: Attached scsi generic sg0 type 0
[ 8798.460733] sd 0:0:0:0: [sda] 1953458176 512-byte logical blocks: (1.00 TB/931 GiB)
[ 8798.461289] sd 0:0:0:0: [sda] Write Protect is off
[ 8798.461313] sd 0:0:0:0: [sda] Mode Sense: 47 00 10 08
[ 8798.461831] sd 0:0:0:0: [sda] No Caching mode page found
[ 8798.461853] sd 0:0:0:0: [sda] Assuming drive cache: write through
[ 8798.526543] sd 0:0:0:0: [sda] Attached SCSI disk
$ sudo fdisk /dev/sda

Welcome to fdisk (util-linux 2.25.2).
Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.

Device does not contain a recognized partition table.
Created a new DOS disklabel with disk identifier 0x21f377b8.

Command (m for help): p
Disk /dev/sda: 931.5 GiB, 1000170586112 bytes, 1953458176 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x21f377b8



Command (m for help): n
Partition type
   p   primary (0 primary, 0 extended, 4 free)
   e   extended (container for logical partitions)
Select (default p): 

Using default response p.
Partition number (1-4, default 1): 
First sector (2048-1953458175, default 2048): 
Last sector, +sectors or +size{K,M,G,T,P} (2048-1953458175, default 1953458175): +838860800

Created a new partition 1 of type 'Linux' and of size 400 GiB.

Command (m for help): n
Partition type
   p   primary (1 primary, 0 extended, 3 free)
   e   extended (container for logical partitions)
Select (default p): 

Using default response p.
Partition number (2-4, default 2): 
First sector (838862848-1953458175, default 838862848):  
Last sector, +sectors or +size{K,M,G,T,P} (838862848-1953458175, default 1953458175): +692060160

Created a new partition 2 of type 'Linux' and of size 330 GiB.

Command (m for help): n
Partition type
   p   primary (2 primary, 0 extended, 2 free)
   e   extended (container for logical partitions)
Select (default p): 

Using default response p.
Partition number (3,4, default 3): 
First sector (1530923008-1953458175, default 1530923008): 
Last sector, +sectors or +size{K,M,G,T,P} (1530923008-1953458175, default 1953458175): +419430400

Created a new partition 3 of type 'Linux' and of size 200 GiB.

Command (m for help): p
Disk /dev/sda: 931.5 GiB, 1000170586112 bytes, 1953458176 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x21f377b8

Device     Boot      Start        End   Sectors  Size Id Type
/dev/sda1             2048  838862847 838860800  400G 83 Linux
/dev/sda2        838862848 1530923007 692060160  330G 83 Linux
/dev/sda3       1530923008 1950353407 419430400  200G 83 Linux


Command (m for help): t
Partition number (1-3, default 3): 1
Hex code (type L to list all codes): fd

Changed type of partition 'Linux' to 'Linux raid autodetect'.

Command (m for help): t
Partition number (1-3, default 3): 2
Hex code (type L to list all codes): fd

Changed type of partition 'Linux' to 'Linux raid autodetect'.

Command (m for help): t
Partition number (1-3, default 3): 3
Hex code (type L to list all codes): fd

Changed type of partition 'Linux' to 'Linux raid autodetect'.

Command (m for help): p
Disk /dev/sda: 931.5 GiB, 1000170586112 bytes, 1953458176 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x21f377b8

Device     Boot      Start        End   Sectors  Size Id Type
/dev/sda1             2048  838862847 838860800  400G fd Linux raid autodetect
/dev/sda2        838862848 1530923007 692060160  330G fd Linux raid autodetect
/dev/sda3       1530923008 1950353407 419430400  200G fd Linux raid autodetect


Command (m for help): w
The partition table has been altered.
Calling ioctl() to re-read partition table.
Syncing disks.

</code></pre>

<p>2つ目のUSBストレージを接続して、フォーマットを行う。</p>

<pre><code>$ dmesg | grep sd
[11121.958187] sd 1:0:0:0: Attached scsi generic sg1 type 0
[11121.959776] sd 1:0:0:0: [sdb] Spinning up disk...
[11128.015762] sd 1:0:0:0: [sdb] 1953458176 512-byte logical blocks: (1.00 TB/931 GiB)
[11128.016326] sd 1:0:0:0: [sdb] Write Protect is off
[11128.016352] sd 1:0:0:0: [sdb] Mode Sense: 47 00 10 08
[11128.016885] sd 1:0:0:0: [sdb] No Caching mode page found
[11128.016907] sd 1:0:0:0: [sdb] Assuming drive cache: write through
[11128.078805] sd 1:0:0:0: [sdb] Attached SCSI disk
$ sudo fdisk /dev/sdb

Welcome to fdisk (util-linux 2.25.2).
Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.

Device does not contain a recognized partition table.
Created a new DOS disklabel with disk identifier 0x09c6efcf.

Command (m for help): p
Disk /dev/sdb: 931.5 GiB, 1000170586112 bytes, 1953458176 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x09c6efcf



Command (m for help): n
Partition type
   p   primary (0 primary, 0 extended, 4 free)
   e   extended (container for logical partitions)
Select (default p): 

Using default response p.
Partition number (1-4, default 1): 
First sector (2048-1953458175, default 2048): 
Last sector, +sectors or +size{K,M,G,T,P} (2048-1953458175, default 1953458175): +838860800

Created a new partition 1 of type 'Linux' and of size 400 GiB.

Command (m for help): n
Partition type
   p   primary (1 primary, 0 extended, 3 free)
   e   extended (container for logical partitions)
Select (default p): 

Using default response p.
Partition number (2-4, default 2): 
First sector (838862848-1953458175, default 838862848): 
Last sector, +sectors or +size{K,M,G,T,P} (838862848-1953458175, default 1953458175): +692060160

Created a new partition 2 of type 'Linux' and of size 330 GiB.

Command (m for help): n
Partition type
   p   primary (2 primary, 0 extended, 2 free)
   e   extended (container for logical partitions)
Select (default p): 

Using default response p.
Partition number (3,4, default 3): 
First sector (1530923008-1953458175, default 1530923008): 
Last sector, +sectors or +size{K,M,G,T,P} (1530923008-1953458175, default 1953458175): +419430400

Created a new partition 3 of type 'Linux' and of size 200 GiB.

Command (m for help): p
Disk /dev/sdb: 931.5 GiB, 1000170586112 bytes, 1953458176 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x09c6efcf

Device     Boot      Start        End   Sectors  Size Id Type
/dev/sdb1             2048  838862847 838860800  400G 83 Linux
/dev/sdb2        838862848 1530923007 692060160  330G 83 Linux
/dev/sdb3       1530923008 1950353407 419430400  200G 83 Linux


Command (m for help): t
Partition number (1-3, default 3): 1
Hex code (type L to list all codes): fd

Changed type of partition 'Linux' to 'Linux raid autodetect'.

Command (m for help): t
Partition number (1-3, default 3): 2
Hex code (type L to list all codes): fd

Changed type of partition 'Linux' to 'Linux raid autodetect'.

Command (m for help): t
Partition number (1-3, default 3): 3
Hex code (type L to list all codes): fd

Changed type of partition 'Linux' to 'Linux raid autodetect'.

Command (m for help): p
Disk /dev/sdb: 931.5 GiB, 1000170586112 bytes, 1953458176 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x09c6efcf

Device     Boot      Start        End   Sectors  Size Id Type
/dev/sdb1             2048  838862847 838860800  400G fd Linux raid autodetect
/dev/sdb2        838862848 1530923007 692060160  330G fd Linux raid autodetect
/dev/sdb3       1530923008 1950353407 419430400  200G fd Linux raid autodetect


Command (m for help): w
The partition table has been altered.
Calling ioctl() to re-read partition table.
Syncing disks.

</code></pre>

<h3 id="mdadmでraid1の構築:edd1b43dbf3196488adbf69244ff43d1">mdadmでraid1の構築</h3>

<p>デバイスIDを確認する。</p>

<pre><code>$ sudo ls -l /dev/disk/by-id/
合計 0
lrwxrwxrwx 1 root root 13 12月 31 18:34 mmc-USDU1_0x66f01af2 -&gt; ../../mmcblk0
lrwxrwxrwx 1 root root 15 12月 31 18:34 mmc-USDU1_0x66f01af2-part1 -&gt; ../../mmcblk0p1
lrwxrwxrwx 1 root root 15 12月 31 18:34 mmc-USDU1_0x66f01af2-part2 -&gt; ../../mmcblk0p2
lrwxrwxrwx 1 root root  9 12月 31 21:43 usb-WD_Elements_10B8_575834314132354E3330594B-0:0 -&gt; ../../sdb
lrwxrwxrwx 1 root root 10 12月 31 21:43 usb-WD_Elements_10B8_575834314132354E3330594B-0:0-part1 -&gt; ../../sdb1
lrwxrwxrwx 1 root root 10 12月 31 21:43 usb-WD_Elements_10B8_575834314132354E3330594B-0:0-part2 -&gt; ../../sdb2
lrwxrwxrwx 1 root root 10 12月 31 21:43 usb-WD_Elements_10B8_575834314132354E3330594B-0:0-part3 -&gt; ../../sdb3
lrwxrwxrwx 1 root root  9 12月 31 21:37 usb-WD_Elements_25A2_57583731413736363234444E-0:0 -&gt; ../../sda
lrwxrwxrwx 1 root root 10 12月 31 21:37 usb-WD_Elements_25A2_57583731413736363234444E-0:0-part1 -&gt; ../../sda1
lrwxrwxrwx 1 root root 10 12月 31 21:37 usb-WD_Elements_25A2_57583731413736363234444E-0:0-part2 -&gt; ../../sda2
lrwxrwxrwx 1 root root 10 12月 31 21:37 usb-WD_Elements_25A2_57583731413736363234444E-0:0-part3 -&gt; ../../sda3
</code></pre>

<p>mdadmコマンドでraid1を構築する</p>

<pre><code>$ sudo mdadm --create /dev/md0 --level=1 --raid-devices=2 /dev/disk/by-id/usb-WD_Elements_25A2_57583731413736363234444E-0\:0-part1 /dev/disk/by-id/usb-WD_Elements_10B8_575834314132354E3330594B-0\:0-part1 
mdadm: Note: this array has metadata at the start and
    may not be suitable as a boot device.  If you plan to
    store '/boot' on this device please ensure that
    your boot-loader understands md/v1.x metadata, or use
    --metadata=0.90
Continue creating array? yes
mdadm: Defaulting to version 1.2 metadata
mdadm: array /dev/md0 started.
$ sudo mdadm --create /dev/md1 --level=1 --raid-devices=2 /dev/disk/by-id/usb-WD_Elements_25A2_57583731413736363234444E-0\:0-part2 /dev/disk/by-id/usb-WD_Elements_10B8_575834314132354E3330594B-0\:0-part2 
mdadm: Note: this array has metadata at the start and
    may not be suitable as a boot device.  If you plan to
    store '/boot' on this device please ensure that
    your boot-loader understands md/v1.x metadata, or use
    --metadata=0.90
Continue creating array? yes
mdadm: Defaulting to version 1.2 metadata
mdadm: array /dev/md1 started.
$ sudo mdadm --create /dev/md2 --level=1 --raid-devices=2 /dev/disk/by-id/usb-WD_Elements_25A2_57583731413736363234444E-0\:0-part3 /dev/disk/by-id/usb-WD_Elements_10B8_575834314132354E3330594B-0\:0-part3 
mdadm: Note: this array has metadata at the start and
    may not be suitable as a boot device.  If you plan to
    store '/boot' on this device please ensure that
    your boot-loader understands md/v1.x metadata, or use
    --metadata=0.90
Continue creating array? yes
mdadm: Defaulting to version 1.2 metadata
mdadm: array /dev/md2 started.
$
$ sudo cat /proc/mdstat 
Personalities : [raid1] 
md2 : active raid1 sdb3[1] sda3[0]
      209584128 blocks super 1.2 [2/2] [UU]
      	resync=DELAYED
      bitmap: 2/2 pages [8KB], 65536KB chunk

md1 : active raid1 sdb2[1] sda2[0]
      345899008 blocks super 1.2 [2/2] [UU]
      	resync=DELAYED
      bitmap: 3/3 pages [12KB], 65536KB chunk

md0 : active raid1 sdb1[1] sda1[0]
      419299328 blocks super 1.2 [2/2] [UU]
      [&gt;....................]  resync =  0.5% (2202240/419299328) finish=403.4min speed=17230K/sec
      bitmap: 4/4 pages [16KB], 65536KB chunk

unused devices: &lt;none&gt;
$
$ sudo mdadm --detail /dev/md*
mdadm: /dev/md does not appear to be an md device
/dev/md0:
        Version : 1.2
  Creation Time : Sat Dec 31 21:50:28 2016
     Raid Level : raid1
     Array Size : 419299328 (399.88 GiB 429.36 GB)
  Used Dev Size : 419299328 (399.88 GiB 429.36 GB)
   Raid Devices : 2
  Total Devices : 2
    Persistence : Superblock is persistent

  Intent Bitmap : Internal

    Update Time : Sat Dec 31 21:53:07 2016
          State : clean, resyncing 
 Active Devices : 2
Working Devices : 2
 Failed Devices : 0
  Spare Devices : 0

  Resync Status : 0% complete

           Name : homenas1:0  (local to host homenas1)
           UUID : ff0b51a1:559b9e27:476e5946:50ee7174
         Events : 31

    Number   Major   Minor   RaidDevice State
       0       8        1        0      active sync   /dev/sda1
       1       8       17        1      active sync   /dev/sdb1
/dev/md1:
        Version : 1.2
  Creation Time : Sat Dec 31 21:51:17 2016
     Raid Level : raid1
     Array Size : 345899008 (329.88 GiB 354.20 GB)
  Used Dev Size : 345899008 (329.88 GiB 354.20 GB)
   Raid Devices : 2
  Total Devices : 2
    Persistence : Superblock is persistent

  Intent Bitmap : Internal

    Update Time : Sat Dec 31 21:51:17 2016
          State : clean, resyncing (DELAYED) 
 Active Devices : 2
Working Devices : 2
 Failed Devices : 0
  Spare Devices : 0

           Name : homenas1:1  (local to host homenas1)
           UUID : 8ae07a1b:967f0164:d564ec68:7e77c145
         Events : 0

    Number   Major   Minor   RaidDevice State
       0       8        2        0      active sync   /dev/sda2
       1       8       18        1      active sync   /dev/sdb2
/dev/md2:
        Version : 1.2
  Creation Time : Sat Dec 31 21:51:43 2016
     Raid Level : raid1
     Array Size : 209584128 (199.88 GiB 214.61 GB)
  Used Dev Size : 209584128 (199.88 GiB 214.61 GB)
   Raid Devices : 2
  Total Devices : 2
    Persistence : Superblock is persistent

  Intent Bitmap : Internal

    Update Time : Sat Dec 31 21:51:43 2016
          State : clean, resyncing (DELAYED) 
 Active Devices : 2
Working Devices : 2
 Failed Devices : 0
  Spare Devices : 0

           Name : homenas1:2  (local to host homenas1)
           UUID : 3cb34c46:3ace2238:e6c98f2e:6aa29e8e
         Events : 0

    Number   Major   Minor   RaidDevice State
       0       8        3        0      active sync   /dev/sda3
       1       8       19        1      active sync   /dev/sdb3
</code></pre>

<h3 id="raid1のフォーマット:edd1b43dbf3196488adbf69244ff43d1">raid1のフォーマット</h3>

<p>raid1デバイスをext4でフォーマットする。</p>

<pre><code>$ sudo mkfs -t ext4 /dev/md0 
mke2fs 1.42.12 (29-Aug-2014)
Creating filesystem with 104824832 4k blocks and 26206208 inodes
Filesystem UUID: 29e7e530-5125-48b9-a0c7-539e285dbac3
Superblock backups stored on blocks: 
	32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 
	4096000, 7962624, 11239424, 20480000, 23887872, 71663616, 78675968, 
	102400000

Allocating group tables: done                            
Writing inode tables: done                            
Creating journal (32768 blocks): done
Writing superblocks and filesystem accounting information: done     

$
$ sudo mkfs -t ext4 /dev/md1
mke2fs 1.42.12 (29-Aug-2014)
Creating filesystem with 86474752 4k blocks and 21618688 inodes
Filesystem UUID: 3cf0d3fe-0d04-4fe0-8fe2-b383a669fc3e
Superblock backups stored on blocks: 
	32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 
	4096000, 7962624, 11239424, 20480000, 23887872, 71663616, 78675968

Allocating group tables: done                            
Writing inode tables: done                            
Creating journal (32768 blocks): done
Writing superblocks and filesystem accounting information: done     

$
$ sudo mkfs -t ext4 /dev/md2
mke2fs 1.42.12 (29-Aug-2014)
Creating filesystem with 52396032 4k blocks and 13099008 inodes
Filesystem UUID: 2968a01e-1116-4895-b06c-c70208ecd6a4
Superblock backups stored on blocks: 
	32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 
	4096000, 7962624, 11239424, 20480000, 23887872

Allocating group tables: done                            
Writing inode tables: done                            
Creating journal (32768 blocks): done
Writing superblocks and filesystem accounting information: done     

</code></pre>

<h3 id="raid1デバイスをマウント:edd1b43dbf3196488adbf69244ff43d1">raid1デバイスをマウント</h3>

<pre><code>$ sudo mkdir /mnt/nas
$ sudo mount -t ext4 /dev/md0 /mnt/nas
$ sudo chmod 775 /mnt/nas
$ sudo chown root:adm /mnt/nas
$ 
$ sudo mkdir /mnt/rpibackup
$ sudo mount -t ext4 /dev/md1 /mnt/rpibackup
$ sudo chmod 775 /mnt/rpibackup
$ sudo chown root:adm /mnt/rpibackup
$ 
$ sudo mkdir /mnt/syslog
$ sudo mount -t ext4 /dev/md2 /mnt/syslog
$ sudo chmod 775 /mnt/syslog
$ sudo chown root:adm /mnt/syslog
</code></pre>

<h3 id="起動時にraid1デバイスをマウントする:edd1b43dbf3196488adbf69244ff43d1">起動時にraid1デバイスをマウントする</h3>

<p>起動時にraid1デバイスをマウントするためにfstabを設定する。</p>

<pre><code>$ sudo blkid
/dev/md0: UUID=&quot;29e7e530-5125-48b9-a0c7-539e285dbac3&quot; TYPE=&quot;ext4&quot;
/dev/md1: UUID=&quot;3cf0d3fe-0d04-4fe0-8fe2-b383a669fc3e&quot; TYPE=&quot;ext4&quot;
/dev/md2: UUID=&quot;2968a01e-1116-4895-b06c-c70208ecd6a4&quot; TYPE=&quot;ext4&quot;
$
$ sudo cp -p /etc/fstab{,.org}
$ ls -l /etc/fstab*
-rw-r--r-- 1 root root 302  9月 23 12:53 /etc/fstab
-rw-r--r-- 1 root root 302  9月 23 12:53 /etc/fstab.org
$
$ sudo vi /etc/fstab
UUID=&quot;29e7e530-5125-48b9-a0c7-539e285dbac3&quot;     /mnt/nas        ext4    defaults,nofail 0       0
UUID=&quot;3cf0d3fe-0d04-4fe0-8fe2-b383a669fc3e&quot;     /mnt/rpibackup  ext4    defaults,nofail 0       0
UUID=&quot;2968a01e-1116-4895-b06c-c70208ecd6a4&quot;     /mnt/syslog     ext4    defaults,nofail 0       0
</code></pre>

<p>USBストレージのUUIDが判明するまでマウント作業を遅延させる。</p>

<pre><code>$ sudo cp -p /boot/cmdline.txt{,.org}
$ ls -l /boot/cmdline.txt*
-rwxr-xr-x 1 root root 136  1月  1  1980 /boot/cmdline.txt
-rwxr-xr-x 1 root root 136  1月  1  1980 /boot/cmdline.txt.org
$
$ sudo vi /boot/cmdline.txt
dwc_otg.lpm_enable=0 console=serial0,115200 console=tty1 root=/dev/mmcblk0p2 rootfstype=ext4 elevator=deadline fsck.repair=yes rootwait rootdelay=10
$
</code></pre>

<p>RAID1デバイスの同期速度を変更する</p>

<pre><code>$ cat /proc/sys/dev/raid/speed_limit_min 
1000
$ sudo sh -c &quot;echo 50000 &gt; /proc/sys/dev/raid/speed_limit_min&quot;
$ cat /proc/sys/dev/raid/speed_limit_min
50000
$
$ sudo cp -p /etc/sysctl.conf{,.org}
$ ls -l /etc/sysctl.conf*
-rw-r--r-- 1 root root 2084  3月  7  2015 /etc/sysctl.conf
-rw-r--r-- 1 root root 2084  3月  7  2015 /etc/sysctl.conf.org
$ sudo vi /etc/sysctl.conf
dev.raid.speed_limit_min = 50000
dev.raid.speed_limit_max = 200000
$
</code></pre>

<h3 id="raid1-backup用ストレージの設定:edd1b43dbf3196488adbf69244ff43d1">RAID1 Backup用ストレージの設定</h3>

<pre><code>$ dmesg | grep sd
[ 7875.564180] sd 2:0:0:0: Attached scsi generic sg2 type 0
[ 7875.571270] sd 2:0:0:0: [sdc] Spinning up disk...
[ 7880.622204] sd 2:0:0:0: [sdc] 1953458176 512-byte logical blocks: (1.00 TB/931 GiB)
[ 7880.622788] sd 2:0:0:0: [sdc] Write Protect is off
[ 7880.622813] sd 2:0:0:0: [sdc] Mode Sense: 47 00 10 08
[ 7880.623346] sd 2:0:0:0: [sdc] No Caching mode page found
[ 7880.623368] sd 2:0:0:0: [sdc] Assuming drive cache: write through
[ 7880.638880] sd 2:0:0:0: [sdc] Attached SCSI disk
$
$ sudo fdisk /dev/sdc 

Welcome to fdisk (util-linux 2.25.2).
Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.


Command (m for help): p
Disk /dev/sdc: 931.5 GiB, 1000170586112 bytes, 1953458176 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x6c9f0b39



Command (m for help): n
Partition type
   p   primary (0 primary, 0 extended, 4 free)
   e   extended (container for logical partitions)
Select (default p): 

Using default response p.
Partition number (1-4, default 1): 
First sector (2048-1953458175, default 2048): 
Last sector, +sectors or +size{K,M,G,T,P} (2048-1953458175, default 1953458175): 

Created a new partition 1 of type 'Linux' and of size 931.5 GiB.

Command (m for help): p
Disk /dev/sdc: 931.5 GiB, 1000170586112 bytes, 1953458176 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x6c9f0b39

Device     Boot Start        End    Sectors   Size Id Type
/dev/sdc1        2048 1953458175 1953456128 931.5G 83 Linux


Command (m for help): w
The partition table has been altered.
Calling ioctl() to re-read partition table.
Syncing disks.

$
$ sudo mkfs -t ext4 /dev/sdc1 
mke2fs 1.42.12 (29-Aug-2014)
Creating filesystem with 244182016 4k blocks and 61046784 inodes
Filesystem UUID: 80e310e4-44d9-4de2-a3b7-a71915318f29
Superblock backups stored on blocks: 
	32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 
	4096000, 7962624, 11239424, 20480000, 23887872, 71663616, 78675968, 
	102400000, 214990848

Allocating group tables: done                            
Writing inode tables: done                            
Creating journal (32768 blocks): done
Writing superblocks and filesystem accounting information: done     

$
$ sudo mkdir /backup
$ sudo mount -t ext4 /dev/sdc1 /backup/
$ sudo chmod 775 /backup/
$ sudo chown root:adm /backup/
$
$ sudo blkid
/dev/sdc1: UUID=&quot;80e310e4-44d9-4de2-a3b7-a71915318f29&quot; TYPE=&quot;ext4&quot; PARTUUID=&quot;6c9f0b39-01&quot;
$
$ sudo vi /etc/fstab
UUID=&quot;80e310e4-44d9-4de2-a3b7-a71915318f29&quot;     /backup ext4    defaults,nofail 0       0
$
</code></pre>

<h2 id="参考url:edd1b43dbf3196488adbf69244ff43d1">参考URL</h2>

<ul>
<li><a href="http://projpi.com/diy-home-projects-with-a-raspberry-pi/raspberry-pi-raid-array-with-usb-hdds/">Raspberry Pi raid array with USB HDDs</a></li>
</ul>

<p>以上</p>

                </div>
              </article>
              
              <article>
                <div class="title">
                  <h1><a href="http://www.shinayoshi.net/post/2016/10/22/raspberrypi-initial-setup/">家庭内インターネット接続環境を構築する その2</a></h1>
                  <p>
                    <span class="label label-primary">Sat Oct 22, 2016</span> in
                    
                    
                    <a href="http://www.shinayoshi.net//categories/server">server</a>
                     using tags
                    
                    
                    <a href="http://www.shinayoshi.net//tags/raspberrypi">raspberrypi</a>
                    
                     , 
                    <a href="http://www.shinayoshi.net//tags/home-network">home-network</a>
                    
                  </p>
                </div>
                <div class="contents">
                  

<h2 id="raspberry-pi-2共通初期設定:4734a81b60315110a1536277d531cee2">Raspberry Pi 2共通初期設定</h2>

<p>家庭内インターネット接続環境で使用するRaspberry Pi 2の初期設定を行います。</p>

<h2 id="前提:4734a81b60315110a1536277d531cee2">前提</h2>

<p>Raspberry Pi 2にRaspbian Jessie(2016-09-23-raspbian-jessie-lite.img)をインストールした環境の初期設定を想定します。
セキュリティ関連の設定は個別に行いますので、ここでは省略します。</p>

<h2 id="パッケージ更新:4734a81b60315110a1536277d531cee2">パッケージ更新</h2>

<pre><code>$ sudo apt-get update
$ sudo apt-get upgrade
</code></pre>

<ul>
<li><a href="https://www.raspberrypi.org/documentation/raspbian/updating.md">Updating and Upgrading Raspbian - Raspberry Pi Documentation</a></li>
</ul>

<h2 id="ipアドレス固定化:4734a81b60315110a1536277d531cee2">IPアドレス固定化</h2>

<p>Raspberry Pi 2のIPアドレスを固定する。</p>

<pre><code>$ sudo cp -p /etc/dhcpcd.conf /etc/dhcpcd.conf.org
$ sudo vi /etc/dhcpcd.conf
#Add the following line
interface eth0
static ip_address=192.168.40.10/24
static routers=192.168.40.254
static domain_name_servers=192.168.100.1
#static domain_name=
#static domain_search=

interface eth1
static ip_address=172.31.10.110/24
static routers=
static domain_name_servers=
#static domain_name=
#static domain_search=
</code></pre>

<ul>
<li>&ldquo;man dhcpcd.conf&rdquo;</li>
</ul>

<h2 id="usbポートの電流供給増加:4734a81b60315110a1536277d531cee2">USBポートの電流供給増加</h2>

<p>USBポートの電流供給を1.2A(4ポート合計)まで供給できるようにする。</p>

<pre><code>$ sudo cp -p /boot/config.txt /boot/config.txt.org
$ sudo vi /boot/config.txt
#Add the following line
max_usb_current=1
</code></pre>

<ul>
<li><a href="http://elinux.org/RPiconfig">RPiconfig - eLinux.org</a></li>
</ul>

<h2 id="ntp設定:4734a81b60315110a1536277d531cee2">NTP設定</h2>

<p>NTP同期先を設定する。</p>

<pre><code>$ sudo cp -p /etc/ntp.conf /etc/ntp.conf.org
$ sudo vi /etc/ntp.conf
#Add the line
server ntp.nict.jp iburst
server ntp.jst.mfeed.ad.jp iburst
# comment out
#server 0.debian.pool.ntp.org iburst
#server 1.debian.pool.ntp.org iburst
#server 2.debian.pool.ntp.org iburst
#server 3.debian.pool.ntp.org iburst
</code></pre>

<p>NTPサーバを再起動する。</p>

<pre><code>$ sudo systemctl restart ntp
</code></pre>

<p>時刻同期の状態を確認する。</p>

<pre><code>$ ntpq -p
</code></pre>

<ul>
<li><a href="http://vogel.at.webry.info/201501/article_5.html">NTPサーバの設定 パソコン鳥のブログ/ウェブリブログ</a></li>
</ul>

<h2 id="raspi-config関連:4734a81b60315110a1536277d531cee2">raspi-config関連</h2>

<pre><code>$ sudo raspi-config
</code></pre>

<h3 id="文字コード設定:4734a81b60315110a1536277d531cee2">文字コード設定</h3>

<ol>
<li>「4 Internationalisation Options」を選択する。</li>
<li>「I1 Change Locale」を選択する。</li>
<li>「en_GB.UTF-8 UTF-8」の選択を外す。</li>
<li>「ja_JP.UTF-8 UTF-8」を選択する。</li>
<li>「Ok」を選択する。</li>
<li>「ja_JP.UTF-8」を選択する。</li>
<li>「Ok」を選択する。</li>
<li>raspi-configの初期画面に戻る。</li>
</ol>

<h3 id="タイムゾーン設定:4734a81b60315110a1536277d531cee2">タイムゾーン設定</h3>

<ol>
<li>「4 Internationalisation Options」を選択する。</li>
<li>「I2 Change Timezone」を選択する。</li>
<li>「Asia」を選択する。</li>
<li>「Tokyo」を選択する。</li>
<li>raspi-configの初期画面に戻る。</li>
</ol>

<h3 id="wifiの国設定:4734a81b60315110a1536277d531cee2">Wifiの国設定</h3>

<ol>
<li>「4 Internationalisation Options」を選択する。</li>
<li>「I4 Change Wi-fi Country」を選択する。</li>
<li>「JP Japan」を選択する。</li>
<li>「Ok」を選択する。</li>
<li>raspi-configの初期画面に戻る。</li>
</ol>

<h3 id="ホスト名変更:4734a81b60315110a1536277d531cee2">ホスト名変更</h3>

<ol>
<li>「7 Advanced Options」を選択する。</li>
<li>「A2 Hostname」を選択する。</li>
<li>「Ok」を選択する。</li>
<li>ホスト名を設定する。</li>
<li>「Ok」を選択する。</li>
<li>raspi-configの初期画面に戻る。</li>
</ol>

<h3 id="raspi-config終了:4734a81b60315110a1536277d531cee2">raspi-config終了</h3>

<ol>
<li>「Finish」を選択する。</li>
<li>リブートの確認が求められるため、「Yes」を選択する。</li>
</ol>

<p>以上</p>

                </div>
              </article>
              
              <div class="pagination">
                <ul class="pager">
  
  <li>Page 1 of 4</li>
  
  <li class="next"><a href="/page/2/">Older &rarr;</a></li>
  
</ul>

              </div>
            </div>
            <div class="sidebar col-md-3">
              <aside>
  
<section class="panel panel-default">
  <div class="panel-heading">
    <h1 class="panel-title">Profile</h1>
  </div>
  <div id="profile" class="panel-body text-center">
    <img src="http://www.shinayoshi.net//img/logo.png" alt="logo" class="img-responsive center-block" />
    <p>
      <a href="http://www.shinayoshi.net//about/">Author: shinayoshi</a>
    </p>
    <ul class="list-inline">
  

  

  

  
  <li>
    <a href="https://github.com/shinayoshi" target="_blank">
      <i class="fa fa-github-square fa-lg"></i>
    </a>
  </li>
  

  
  <li>
    <a href="https://bitbucket.org/shinayoshi" target="_blank">
      <i class="fa fa-bitbucket-square fa-lg"></i>
    </a>
  </li>
  

  
  <li>
    <a href="http://www.slideshare.net/shinayoshi" target="_blank">
      <i class="fa fa-slideshare fa-lg"></i>
    </a>
  </li>
  
</ul>

  </div>
</section>

  <section class="panel panel-default">
  <div class="panel-heading">
    <h1 class="panel-title">Recent Posts</h1>
  </div>
  <div id="recent_posts" class="list-group">
    
      
      <a href="http://www.shinayoshi.net/post/2017/01/07/setting-rsyslog/" class="list-group-item">家庭内インターネット接続環境を構築する その11 [ 2017-01-07 ]</a>
      
      <a href="http://www.shinayoshi.net/post/2017/01/07/setting-ntp-server/" class="list-group-item">家庭内インターネット接続環境を構築する その10 [ 2017-01-07 ]</a>
      
      <a href="http://www.shinayoshi.net/post/2017/01/07/setting-cowrie-security/" class="list-group-item">家庭内インターネット接続環境を構築する その9 [ 2017-01-07 ]</a>
      
      <a href="http://www.shinayoshi.net/post/2017/01/05/setting-kippo-graph/" class="list-group-item">家庭内インターネット接続環境を構築する その8 [ 2017-01-05 ]</a>
      
      <a href="http://www.shinayoshi.net/post/2017/01/04/setting-cowrie/" class="list-group-item">家庭内インターネット接続環境を構築する その7 [ 2017-01-04 ]</a>
      
      <a href="http://www.shinayoshi.net/post/2017/01/03/setting-proxy/" class="list-group-item">家庭内インターネット接続環境を構築する その6 [ 2017-01-03 ]</a>
      
      <a href="http://www.shinayoshi.net/post/2017/01/03/setting-cache-dns/" class="list-group-item">家庭内インターネット接続環境を構築する その5 [ 2017-01-03 ]</a>
      
      <a href="http://www.shinayoshi.net/post/2017/01/02/setting-fileserver/" class="list-group-item">家庭内インターネット接続環境を構築する その4 [ 2017-01-02 ]</a>
      
      <a href="http://www.shinayoshi.net/post/2017/01/01/setting-usb-storage/" class="list-group-item">家庭内インターネット接続環境を構築する その3 [ 2017-01-01 ]</a>
      
      <a href="http://www.shinayoshi.net/post/2016/10/22/raspberrypi-initial-setup/" class="list-group-item">家庭内インターネット接続環境を構築する その2 [ 2016-10-22 ]</a>
      
    
  </div>
</section>

  
<section class="panel panel-default">
  <div class="panel-heading">
    <h1 class="panel-title">Categories</h1>
  </div>
  <div id="categories" class="list-group">
    
    <a href="http://www.shinayoshi.net//categories/diary" class="list-group-item"><span class="badge">2</span>diary</a>
    
    <a href="http://www.shinayoshi.net//categories/server" class="list-group-item"><span class="badge">30</span>server</a>
    
  </div>
</section>

  
<section class="panel panel-default">
  <div class="panel-heading">
    <h1 class="panel-title">Tags</h1>
  </div>
  <div id="tags" class="panel-body">
    
    
    <a href="http://www.shinayoshi.net//tags/backup" >backup (1)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/bind" >bind (1)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/blog" >blog (1)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/cacti" >cacti (2)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/centos" >centos (2)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/cowrie" >cowrie (3)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/fgt-60d" >fgt-60d (1)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/fortigate" >fortigate (1)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/home-network" >home-network (11)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/homefw01" >homefw01 (1)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/homemon1" >homemon1 (2)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/homemon2" >homemon2 (2)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/homenas1" >homenas1 (2)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/homepot1" >homepot1 (3)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/homepxy1" >homepxy1 (2)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/igo" >igo (1)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/jessie" >jessie (14)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/kippo-graph" >kippo-graph (1)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/kivy" >kivy (1)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/raspberrypi" >raspberrypi (26)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/shogi" >shogi (1)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/squid" >squid (1)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/wifi" >wifi (1)</a>
    
    
    
    <a href="http://www.shinayoshi.net//tags/zabbix" >zabbix (3)</a>
    
    
  </div>
</section>

</aside>

            </div>
          </div>
        </div>
      </div>

      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <hr />
          </div>
        </div>
      </div>
      <footer role="contentinfo">
        <div class="container">
          <p class="text-muted credits">
            Copyright (c) 2016 shinayoshi<br />
            <small>
              <span class="credit">Powered By <a href="http://hugo.spf13.com">Hugo</a></span>
            </small>
          </p>
        </div>
      </footer>

      
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
      
      <script src="http://www.shinayoshi.net//js/bootstrap.min.js"></script>

      <script src="https://yandex.st/highlightjs/8.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script>
      
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-37226857-2', 'auto');
  ga('send', 'pageview');
</script>


    </div>
  </body>
</html>

